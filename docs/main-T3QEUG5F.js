var Eue=Object.create;var sA=Object.defineProperty,vue=Object.defineProperties,yue=Object.getOwnPropertyDescriptor,Sue=Object.getOwnPropertyDescriptors,Tue=Object.getOwnPropertyNames,dW=Object.getOwnPropertySymbols,uW=Object.getPrototypeOf,hW=Object.prototype.hasOwnProperty,Cue=Object.prototype.propertyIsEnumerable,Rue=Reflect.get;var oA=(o,s)=>(s=Symbol[o])?s:Symbol.for("Symbol."+o),Iue=o=>{throw TypeError(o)};var lW=(o,s,a)=>s in o?sA(o,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[s]=a,Ee=(o,s)=>{for(var a in s||={})hW.call(s,a)&&lW(o,a,s[a]);if(dW)for(var a of dW(s))Cue.call(s,a)&&lW(o,a,s[a]);return o},gt=(o,s)=>vue(o,Sue(s));var We=(o,s)=>()=>(s||o((s={exports:{}}).exports,s),s.exports);var bue=(o,s,a,d)=>{if(s&&typeof s=="object"||typeof s=="function")for(let p of Tue(s))!hW.call(o,p)&&p!==a&&sA(o,p,{get:()=>s[p],enumerable:!(d=yue(s,p))||d.enumerable});return o};var pW=(o,s,a)=>(a=o!=null?Eue(uW(o)):{},bue(s||!o||!o.__esModule?sA(a,"default",{value:o,enumerable:!0}):a,o));var aA=(o,s,a)=>Rue(uW(o),a,s);var O=(o,s,a)=>new Promise((d,p)=>{var g=b=>{try{T(a.next(b))}catch(x){p(x)}},v=b=>{try{T(a.throw(b))}catch(x){p(x)}},T=b=>b.done?d(b.value):Promise.resolve(b.value).then(g,v);T((a=a.apply(o,s)).next())}),wue=function(o,s){this[0]=o,this[1]=s};var ol=o=>{var s=o[oA("asyncIterator")],a=!1,d,p={};return s==null?(s=o[oA("iterator")](),d=g=>p[g]=v=>s[g](v)):(s=s.call(o),d=g=>p[g]=v=>{if(a){if(a=!1,g==="throw")throw v;return v}return a=!0,{done:!1,value:new wue(new Promise(T=>{var b=s[g](v);b instanceof Object||Iue("Object expected"),T(b)}),1)}}),p[oA("iterator")]=()=>p,d("next"),"throw"in s?d("throw"):p.throw=g=>{throw g},"return"in s&&d("return"),p};var Zq=We((bFe,WN)=>{"use strict";global.crypto&&global.crypto.getRandomValues?WN.exports.randomBytes=function(o){var s=new Uint8Array(o);return global.crypto.getRandomValues(s),s}:WN.exports.randomBytes=function(o){for(var s=new Array(o),a=0;a<o;a++)s[a]=Math.floor(Math.random()*256);return s}});var ql=We((wFe,ez)=>{"use strict";var Vve=Zq(),Qq="abcdefghijklmnopqrstuvwxyz012345";ez.exports={string:function(o){for(var s=Qq.length,a=Vve.randomBytes(o),d=[],p=0;p<o;p++)d.push(Qq.substr(a[p]%s,1));return d.join("")},number:function(o){return Math.floor(Math.random()*o)},numberString:function(o){var s=(""+(o-1)).length,a=new Array(s+1).join("0");return(a+this.number(o)).slice(-s)}}});var Ka=We((AFe,YT)=>{"use strict";var jve=ql(),bp={},qN=!1,tz=global.chrome&&global.chrome.app&&global.chrome.app.runtime;YT.exports={attachEvent:function(o,s){typeof global.addEventListener<"u"?global.addEventListener(o,s,!1):global.document&&global.attachEvent&&(global.document.attachEvent("on"+o,s),global.attachEvent("on"+o,s))},detachEvent:function(o,s){typeof global.addEventListener<"u"?global.removeEventListener(o,s,!1):global.document&&global.detachEvent&&(global.document.detachEvent("on"+o,s),global.detachEvent("on"+o,s))},unloadAdd:function(o){if(tz)return null;var s=jve.string(8);return bp[s]=o,qN&&setTimeout(this.triggerUnloadCallbacks,0),s},unloadDel:function(o){o in bp&&delete bp[o]},triggerUnloadCallbacks:function(){for(var o in bp)bp[o](),delete bp[o]}};var Bve=function(){qN||(qN=!0,YT.exports.triggerUnloadCallbacks())};tz||YT.exports.attachEvent("unload",Bve)});var rz=We((DFe,nz)=>{"use strict";nz.exports=function(s,a){if(a=a.split(":")[0],s=+s,!s)return!1;switch(a){case"http":case"ws":return s!==80;case"https":case"wss":return s!==443;case"ftp":return s!==21;case"gopher":return s!==70;case"file":return!1}return s!==0}});var sz=We(zN=>{"use strict";var Hve=Object.prototype.hasOwnProperty,Gve;function iz(o){try{return decodeURIComponent(o.replace(/\+/g," "))}catch{return null}}function oz(o){try{return encodeURIComponent(o)}catch{return null}}function Wve(o){for(var s=/([^=?#&]+)=?([^&]*)/g,a={},d;d=s.exec(o);){var p=iz(d[1]),g=iz(d[2]);p===null||g===null||p in a||(a[p]=g)}return a}function qve(o,s){s=s||"";var a=[],d,p;typeof s!="string"&&(s="?");for(p in o)if(Hve.call(o,p)){if(d=o[p],!d&&(d===null||d===Gve||isNaN(d))&&(d=""),p=oz(p),d=oz(d),p===null||d===null)continue;a.push(p+"="+d)}return a.length?s+a.join("&"):""}zN.stringify=qve;zN.parse=Wve});var $N=We((NFe,pz)=>{"use strict";var cz=rz(),$T=sz(),zve=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,dz=/[\n\r\t]/g,Kve=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,lz=/:\d+$/,Yve=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,$ve=/^[a-zA-Z]:/;function YN(o){return(o||"").toString().replace(zve,"")}var KN=[["#","hash"],["?","query"],function(s,a){return ca(a.protocol)?s.replace(/\\/g,"/"):s},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],az={hash:1,query:1};function uz(o){var s;typeof window<"u"?s=window:typeof global<"u"?s=global:typeof self<"u"?s=self:s={};var a=s.location||{};o=o||a;var d={},p=typeof o,g;if(o.protocol==="blob:")d=new da(unescape(o.pathname),{});else if(p==="string"){d=new da(o,{});for(g in az)delete d[g]}else if(p==="object"){for(g in o)g in az||(d[g]=o[g]);d.slashes===void 0&&(d.slashes=Kve.test(o.href))}return d}function ca(o){return o==="file:"||o==="ftp:"||o==="http:"||o==="https:"||o==="ws:"||o==="wss:"}function hz(o,s){o=YN(o),o=o.replace(dz,""),s=s||{};var a=Yve.exec(o),d=a[1]?a[1].toLowerCase():"",p=!!a[2],g=!!a[3],v=0,T;return p?g?(T=a[2]+a[3]+a[4],v=a[2].length+a[3].length):(T=a[2]+a[4],v=a[2].length):g?(T=a[3]+a[4],v=a[3].length):T=a[4],d==="file:"?v>=2&&(T=T.slice(2)):ca(d)?T=a[4]:d?p&&(T=T.slice(2)):v>=2&&ca(s.protocol)&&(T=a[4]),{protocol:d,slashes:p||ca(d),slashesCount:v,rest:T}}function Xve(o,s){if(o==="")return s;for(var a=(s||"/").split("/").slice(0,-1).concat(o.split("/")),d=a.length,p=a[d-1],g=!1,v=0;d--;)a[d]==="."?a.splice(d,1):a[d]===".."?(a.splice(d,1),v++):v&&(d===0&&(g=!0),a.splice(d,1),v--);return g&&a.unshift(""),(p==="."||p==="..")&&a.push(""),a.join("/")}function da(o,s,a){if(o=YN(o),o=o.replace(dz,""),!(this instanceof da))return new da(o,s,a);var d,p,g,v,T,b,x=KN.slice(),B=typeof s,W=this,ee=0;for(B!=="object"&&B!=="string"&&(a=s,s=null),a&&typeof a!="function"&&(a=$T.parse),s=uz(s),p=hz(o||"",s),d=!p.protocol&&!p.slashes,W.slashes=p.slashes||d&&s.slashes,W.protocol=p.protocol||s.protocol||"",o=p.rest,(p.protocol==="file:"&&(p.slashesCount!==2||$ve.test(o))||!p.slashes&&(p.protocol||p.slashesCount<2||!ca(W.protocol)))&&(x[3]=[/(.*)/,"pathname"]);ee<x.length;ee++){if(v=x[ee],typeof v=="function"){o=v(o,W);continue}g=v[0],b=v[1],g!==g?W[b]=o:typeof g=="string"?(T=g==="@"?o.lastIndexOf(g):o.indexOf(g),~T&&(typeof v[2]=="number"?(W[b]=o.slice(0,T),o=o.slice(T+v[2])):(W[b]=o.slice(T),o=o.slice(0,T)))):(T=g.exec(o))&&(W[b]=T[1],o=o.slice(0,T.index)),W[b]=W[b]||d&&v[3]&&s[b]||"",v[4]&&(W[b]=W[b].toLowerCase())}a&&(W.query=a(W.query)),d&&s.slashes&&W.pathname.charAt(0)!=="/"&&(W.pathname!==""||s.pathname!=="")&&(W.pathname=Xve(W.pathname,s.pathname)),W.pathname.charAt(0)!=="/"&&ca(W.protocol)&&(W.pathname="/"+W.pathname),cz(W.port,W.protocol)||(W.host=W.hostname,W.port=""),W.username=W.password="",W.auth&&(T=W.auth.indexOf(":"),~T?(W.username=W.auth.slice(0,T),W.username=encodeURIComponent(decodeURIComponent(W.username)),W.password=W.auth.slice(T+1),W.password=encodeURIComponent(decodeURIComponent(W.password))):W.username=encodeURIComponent(decodeURIComponent(W.auth)),W.auth=W.password?W.username+":"+W.password:W.username),W.origin=W.protocol!=="file:"&&ca(W.protocol)&&W.host?W.protocol+"//"+W.host:"null",W.href=W.toString()}function Jve(o,s,a){var d=this;switch(o){case"query":typeof s=="string"&&s.length&&(s=(a||$T.parse)(s)),d[o]=s;break;case"port":d[o]=s,cz(s,d.protocol)?s&&(d.host=d.hostname+":"+s):(d.host=d.hostname,d[o]="");break;case"hostname":d[o]=s,d.port&&(s+=":"+d.port),d.host=s;break;case"host":d[o]=s,lz.test(s)?(s=s.split(":"),d.port=s.pop(),d.hostname=s.join(":")):(d.hostname=s,d.port="");break;case"protocol":d.protocol=s.toLowerCase(),d.slashes=!a;break;case"pathname":case"hash":if(s){var p=o==="pathname"?"/":"#";d[o]=s.charAt(0)!==p?p+s:s}else d[o]=s;break;case"username":case"password":d[o]=encodeURIComponent(s);break;case"auth":var g=s.indexOf(":");~g?(d.username=s.slice(0,g),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=s.slice(g+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(s))}for(var v=0;v<KN.length;v++){var T=KN[v];T[4]&&(d[T[1]]=d[T[1]].toLowerCase())}return d.auth=d.password?d.username+":"+d.password:d.username,d.origin=d.protocol!=="file:"&&ca(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString(),d}function Zve(o){(!o||typeof o!="function")&&(o=$T.stringify);var s,a=this,d=a.host,p=a.protocol;p&&p.charAt(p.length-1)!==":"&&(p+=":");var g=p+(a.protocol&&a.slashes||ca(a.protocol)?"//":"");return a.username?(g+=a.username,a.password&&(g+=":"+a.password),g+="@"):a.password?(g+=":"+a.password,g+="@"):a.protocol!=="file:"&&ca(a.protocol)&&!d&&a.pathname!=="/"&&(g+="@"),(d[d.length-1]===":"||lz.test(a.hostname)&&!a.port)&&(d+=":"),g+=d+a.pathname,s=typeof a.query=="object"?o(a.query):a.query,s&&(g+=s.charAt(0)!=="?"?"?"+s:s),a.hash&&(g+=a.hash),g}da.prototype={set:Jve,toString:Zve};da.extractProtocol=hz;da.location=uz;da.trimLeft=YN;da.qs=$T;pz.exports=da});var ao=We((PFe,fz)=>{"use strict";var Qve=$N(),eye=function(){};fz.exports={getOrigin:function(o){if(!o)return null;var s=new Qve(o);if(s.protocol==="file:")return null;var a=s.port;return a||(a=s.protocol==="https:"?"443":"80"),s.protocol+"//"+s.hostname+":"+a},isOriginEqual:function(o,s){var a=this.getOrigin(o)===this.getOrigin(s);return eye("same",o,s,a),a},isSchemeEqual:function(o,s){return o.split(":")[0]===s.split(":")[0]},addPath:function(o,s){var a=o.split("?");return a[0]+s+(a[1]?"?"+a[1]:"")},addQuery:function(o,s){return o+(o.indexOf("?")===-1?"?"+s:"&"+s)},isLoopbackAddr:function(o){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(o)||/^\[::1\]$/.test(o)}}});var Xt=We((LFe,XN)=>{"use strict";typeof Object.create=="function"?XN.exports=function(s,a){a&&(s.super_=a,s.prototype=Object.create(a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}))}:XN.exports=function(s,a){if(a){s.super_=a;var d=function(){};d.prototype=a.prototype,s.prototype=new d,s.prototype.constructor=s}}});var JN=We((kFe,mz)=>{"use strict";function XT(){this._listeners={}}XT.prototype.addEventListener=function(o,s){o in this._listeners||(this._listeners[o]=[]);var a=this._listeners[o];a.indexOf(s)===-1&&(a=a.concat([s])),this._listeners[o]=a};XT.prototype.removeEventListener=function(o,s){var a=this._listeners[o];if(a){var d=a.indexOf(s);if(d!==-1){a.length>1?this._listeners[o]=a.slice(0,d).concat(a.slice(d+1)):delete this._listeners[o];return}}};XT.prototype.dispatchEvent=function(){var o=arguments[0],s=o.type,a=arguments.length===1?[o]:Array.apply(null,arguments);if(this["on"+s]&&this["on"+s].apply(this,a),s in this._listeners)for(var d=this._listeners[s],p=0;p<d.length;p++)d[p].apply(this,a)};mz.exports=XT});var ii=We((MFe,gz)=>{"use strict";var tye=Xt(),JT=JN();function od(){JT.call(this)}tye(od,JT);od.prototype.removeAllListeners=function(o){o?delete this._listeners[o]:this._listeners={}};od.prototype.once=function(o,s){var a=this,d=!1;function p(){a.removeListener(o,p),d||(d=!0,s.apply(this,arguments))}this.on(o,p)};od.prototype.emit=function(){var o=arguments[0],s=this._listeners[o];if(s){for(var a=arguments.length,d=new Array(a-1),p=1;p<a;p++)d[p-1]=arguments[p];for(var g=0;g<s.length;g++)s[g].apply(this,d)}};od.prototype.on=od.prototype.addListener=JT.prototype.addEventListener;od.prototype.removeListener=JT.prototype.removeEventListener;gz.exports.EventEmitter=od});var Ez=We((xFe,ZN)=>{"use strict";var _z=global.WebSocket||global.MozWebSocket;_z?ZN.exports=function(s){return new _z(s)}:ZN.exports=void 0});var Cz=We((UFe,Tz)=>{"use strict";var vz=Ka(),nye=ao(),rye=Xt(),yz=ii().EventEmitter,Sz=Ez(),Ya=function(){};function $a(o,s,a){if(!$a.enabled())throw new Error("Transport created when disabled");yz.call(this),Ya("constructor",o);var d=this,p=nye.addPath(o,"/websocket");p.slice(0,5)==="https"?p="wss"+p.slice(5):p="ws"+p.slice(4),this.url=p,this.ws=new Sz(this.url,[],a),this.ws.onmessage=function(g){Ya("message event",g.data),d.emit("message",g.data)},this.unloadRef=vz.unloadAdd(function(){Ya("unload"),d.ws.close()}),this.ws.onclose=function(g){Ya("close event",g.code,g.reason),d.emit("close",g.code,g.reason),d._cleanup()},this.ws.onerror=function(g){Ya("error event",g),d.emit("close",1006,"WebSocket connection broken"),d._cleanup()}}rye($a,yz);$a.prototype.send=function(o){var s="["+o+"]";Ya("send",s),this.ws.send(s)};$a.prototype.close=function(){Ya("close");var o=this.ws;this._cleanup(),o&&o.close()};$a.prototype._cleanup=function(){Ya("_cleanup");var o=this.ws;o&&(o.onmessage=o.onclose=o.onerror=null),vz.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()};$a.enabled=function(){return Ya("enabled"),!!Sz};$a.transportName="websocket";$a.roundTrips=2;Tz.exports=$a});var bz=We((FFe,Iz)=>{"use strict";var iye=Xt(),Rz=ii().EventEmitter,Xa=function(){};function zl(o,s){Xa(o),Rz.call(this),this.sendBuffer=[],this.sender=s,this.url=o}iye(zl,Rz);zl.prototype.send=function(o){Xa("send",o),this.sendBuffer.push(o),this.sendStop||this.sendSchedule()};zl.prototype.sendScheduleWait=function(){Xa("sendScheduleWait");var o=this,s;this.sendStop=function(){Xa("sendStop"),o.sendStop=null,clearTimeout(s)},s=setTimeout(function(){Xa("timeout"),o.sendStop=null,o.sendSchedule()},25)};zl.prototype.sendSchedule=function(){Xa("sendSchedule",this.sendBuffer.length);var o=this;if(this.sendBuffer.length>0){var s="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,s,function(a){o.sendStop=null,a?(Xa("error",a),o.emit("close",a.code||1006,"Sending error: "+a),o.close()):o.sendScheduleWait()}),this.sendBuffer=[]}};zl.prototype._cleanup=function(){Xa("_cleanup"),this.removeAllListeners()};zl.prototype.close=function(){Xa("close"),this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)};Iz.exports=zl});var Dz=We((VFe,Az)=>{"use strict";var oye=Xt(),wz=ii().EventEmitter,kg=function(){};function ZT(o,s,a){kg(s),wz.call(this),this.Receiver=o,this.receiveUrl=s,this.AjaxObject=a,this._scheduleReceiver()}oye(ZT,wz);ZT.prototype._scheduleReceiver=function(){kg("_scheduleReceiver");var o=this,s=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);s.on("message",function(a){kg("message",a),o.emit("message",a)}),s.once("close",function(a,d){kg("close",a,d,o.pollIsClosing),o.poll=s=null,o.pollIsClosing||(d==="network"?o._scheduleReceiver():(o.emit("close",a||1006,d),o.removeAllListeners()))})};ZT.prototype.abort=function(){kg("abort"),this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()};Az.exports=ZT});var tP=We((jFe,Oz)=>{"use strict";var sye=Xt(),aye=ao(),QN=bz(),cye=Dz(),QT=function(){};function eP(o,s,a,d,p){var g=aye.addPath(o,s);QT(g);var v=this;QN.call(this,o,a),this.poll=new cye(d,g,p),this.poll.on("message",function(T){QT("poll message",T),v.emit("message",T)}),this.poll.once("close",function(T,b){QT("poll close",T,b),v.poll=null,v.emit("close",T,b),v.close()})}sye(eP,QN);eP.prototype.close=function(){QN.prototype.close.call(this),QT("close"),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)};Oz.exports=eP});var Kl=We((BFe,Lz)=>{"use strict";var dye=Xt(),lye=ao(),Nz=tP(),nP=function(){};function uye(o){return function(s,a,d){nP("create ajax sender",s,a);var p={};typeof a=="string"&&(p.headers={"Content-type":"text/plain"});var g=lye.addPath(s,"/xhr_send"),v=new o("POST",g,a,p);return v.once("finish",function(T){if(nP("finish",T),v=null,T!==200&&T!==204)return d(new Error("http status "+T));d()}),function(){nP("abort"),v.close(),v=null;var T=new Error("Aborted");T.code=1e3,d(T)}}}function Pz(o,s,a,d){Nz.call(this,o,s,uye(d),a,d)}dye(Pz,Nz);Lz.exports=Pz});var xg=We((HFe,Mz)=>{"use strict";var hye=Xt(),kz=ii().EventEmitter,sd=function(){};function Mg(o,s){sd(o),kz.call(this);var a=this;this.bufferPosition=0,this.xo=new s("POST",o,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(d,p){sd("finish",d,p),a._chunkHandler(d,p),a.xo=null;var g=d===200?"network":"permanent";sd("close",g),a.emit("close",null,g),a._cleanup()})}hye(Mg,kz);Mg.prototype._chunkHandler=function(o,s){if(sd("_chunkHandler",o),!(o!==200||!s))for(var a=-1;;this.bufferPosition+=a+1){var d=s.slice(this.bufferPosition);if(a=d.indexOf(`
`),a===-1)break;var p=d.slice(0,a);p&&(sd("message",p),this.emit("message",p))}};Mg.prototype._cleanup=function(){sd("_cleanup"),this.removeAllListeners()};Mg.prototype.abort=function(){sd("abort"),this.xo&&(this.xo.close(),sd("close"),this.emit("close",null,"user"),this.xo=null),this._cleanup()};Mz.exports=Mg});var rP=We((GFe,jz)=>{"use strict";var Uz=ii().EventEmitter,pye=Xt(),Fz=Ka(),fye=ao(),Ug=global.XMLHttpRequest,ki=function(){};function la(o,s,a,d){ki(o,s);var p=this;Uz.call(this),setTimeout(function(){p._start(o,s,a,d)},0)}pye(la,Uz);la.prototype._start=function(o,s,a,d){var p=this;try{this.xhr=new Ug}catch{}if(!this.xhr){ki("no xhr"),this.emit("finish",0,"no xhr support"),this._cleanup();return}s=fye.addQuery(s,"t="+ +new Date),this.unloadRef=Fz.unloadAdd(function(){ki("unload cleanup"),p._cleanup(!0)});try{this.xhr.open(o,s,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){ki("xhr timeout"),p.emit("finish",0,""),p._cleanup(!1)})}catch(v){ki("exception",v),this.emit("finish",0,""),this._cleanup(!1);return}if((!d||!d.noCredentials)&&la.supportsCORS&&(ki("withCredentials"),this.xhr.withCredentials=!0),d&&d.headers)for(var g in d.headers)this.xhr.setRequestHeader(g,d.headers[g]);this.xhr.onreadystatechange=function(){if(p.xhr){var v=p.xhr,T,b;switch(ki("readyState",v.readyState),v.readyState){case 3:try{b=v.status,T=v.responseText}catch{}ki("status",b),b===1223&&(b=204),b===200&&T&&T.length>0&&(ki("chunk"),p.emit("chunk",b,T));break;case 4:b=v.status,ki("status",b),b===1223&&(b=204),(b===12005||b===12029)&&(b=0),ki("finish",b,v.responseText),p.emit("finish",b,v.responseText),p._cleanup(!1);break}}};try{p.xhr.send(a)}catch{p.emit("finish",0,""),p._cleanup(!1)}};la.prototype._cleanup=function(o){if(ki("cleanup"),!!this.xhr){if(this.removeAllListeners(),Fz.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),o)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}};la.prototype.close=function(){ki("close"),this._cleanup(!0)};la.enabled=!!Ug;var xz=["Active"].concat("Object").join("X");!la.enabled&&xz in global&&(ki("overriding xmlhttprequest"),Ug=function(){try{return new global[xz]("Microsoft.XMLHTTP")}catch{return null}},la.enabled=!!new Ug);var Vz=!1;try{Vz="withCredentials"in new Ug}catch{}la.supportsCORS=Vz;jz.exports=la});var Fg=We((WFe,Bz)=>{"use strict";var mye=Xt(),eC=rP();function iP(o,s,a,d){eC.call(this,o,s,a,d)}mye(iP,eC);iP.enabled=eC.enabled&&eC.supportsCORS;Bz.exports=iP});var wp=We((qFe,Hz)=>{"use strict";var gye=Xt(),oP=rP();function sP(o,s,a){oP.call(this,o,s,a,{noCredentials:!0})}gye(sP,oP);sP.enabled=oP.enabled;Hz.exports=sP});var Ap=We((zFe,Gz)=>{"use strict";Gz.exports={isOpera:function(){return global.navigator&&/opera/i.test(global.navigator.userAgent)},isKonqueror:function(){return global.navigator&&/konqueror/i.test(global.navigator.userAgent)},hasDomain:function(){if(!global.document)return!0;try{return!!global.document.domain}catch{return!1}}}});var zz=We((KFe,qz)=>{"use strict";var _ye=Xt(),Wz=Kl(),Eye=xg(),aP=Fg(),vye=wp(),yye=Ap();function Dp(o){if(!vye.enabled&&!aP.enabled)throw new Error("Transport created when disabled");Wz.call(this,o,"/xhr_streaming",Eye,aP)}_ye(Dp,Wz);Dp.enabled=function(o){return o.nullOrigin||yye.isOpera()?!1:aP.enabled};Dp.transportName="xhr-streaming";Dp.roundTrips=2;Dp.needBody=!!global.document;qz.exports=Dp});var tC=We((YFe,$z)=>{"use strict";var Kz=ii().EventEmitter,Sye=Xt(),Yz=Ka(),Tye=Ap(),Cye=ao(),ad=function(){};function Yl(o,s,a){ad(o,s);var d=this;Kz.call(this),setTimeout(function(){d._start(o,s,a)},0)}Sye(Yl,Kz);Yl.prototype._start=function(o,s,a){ad("_start");var d=this,p=new global.XDomainRequest;s=Cye.addQuery(s,"t="+ +new Date),p.onerror=function(){ad("onerror"),d._error()},p.ontimeout=function(){ad("ontimeout"),d._error()},p.onprogress=function(){ad("progress",p.responseText),d.emit("chunk",200,p.responseText)},p.onload=function(){ad("load"),d.emit("finish",200,p.responseText),d._cleanup(!1)},this.xdr=p,this.unloadRef=Yz.unloadAdd(function(){d._cleanup(!0)});try{this.xdr.open(o,s),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(a)}catch{this._error()}};Yl.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)};Yl.prototype._cleanup=function(o){if(ad("cleanup",o),!!this.xdr){if(this.removeAllListeners(),Yz.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,o)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}};Yl.prototype.close=function(){ad("close"),this._cleanup(!0)};Yl.enabled=!!(global.XDomainRequest&&Tye.hasDomain());$z.exports=Yl});var dP=We(($Fe,Jz)=>{"use strict";var Rye=Xt(),Xz=Kl(),Iye=xg(),cP=tC();function Vg(o){if(!cP.enabled)throw new Error("Transport created when disabled");Xz.call(this,o,"/xhr_streaming",Iye,cP)}Rye(Vg,Xz);Vg.enabled=function(o){return o.cookie_needed||o.nullOrigin?!1:cP.enabled&&o.sameScheme};Vg.transportName="xdr-streaming";Vg.roundTrips=2;Jz.exports=Vg});var lP=We((XFe,Zz)=>{"use strict";Zz.exports=global.EventSource});var tK=We((JFe,eK)=>{"use strict";var bye=Xt(),Qz=ii().EventEmitter,wye=lP(),Op=function(){};function jg(o){Op(o),Qz.call(this);var s=this,a=this.es=new wye(o);a.onmessage=function(d){Op("message",d.data),s.emit("message",decodeURI(d.data))},a.onerror=function(d){Op("error",a.readyState,d);var p=a.readyState!==2?"network":"permanent";s._cleanup(),s._close(p)}}bye(jg,Qz);jg.prototype.abort=function(){Op("abort"),this._cleanup(),this._close("user")};jg.prototype._cleanup=function(){Op("cleanup");var o=this.es;o&&(o.onmessage=o.onerror=null,o.close(),this.es=null)};jg.prototype._close=function(o){Op("close",o);var s=this;setTimeout(function(){s.emit("close",null,o),s.removeAllListeners()},200)};eK.exports=jg});var uP=We((ZFe,rK)=>{"use strict";var Aye=Xt(),nK=Kl(),Dye=tK(),Oye=Fg(),Nye=lP();function Np(o){if(!Np.enabled())throw new Error("Transport created when disabled");nK.call(this,o,"/eventsource",Dye,Oye)}Aye(Np,nK);Np.enabled=function(){return!!Nye};Np.transportName="eventsource";Np.roundTrips=2;rK.exports=Np});var hP=We((QFe,iK)=>{"use strict";iK.exports="1.6.1"});var Pp=We((e2e,Ja)=>{"use strict";var nC=Ka(),Pye=Ap(),$l=function(){};Ja.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){Ja.exports.WPrefix in global||(global[Ja.exports.WPrefix]={})},postMessage:function(o,s){global.parent!==global?global.parent.postMessage(JSON.stringify({windowId:Ja.exports.currentWindowId,type:o,data:s||""}),"*"):$l("Cannot postMessage, no parent window.",o,s)},createIframe:function(o,s){var a=global.document.createElement("iframe"),d,p,g=function(){$l("unattach"),clearTimeout(d);try{a.onload=null}catch{}a.onerror=null},v=function(){$l("cleanup"),a&&(g(),setTimeout(function(){a&&a.parentNode.removeChild(a),a=null},0),nC.unloadDel(p))},T=function(x){$l("onerror",x),a&&(v(),s(x))},b=function(x,B){$l("post",x,B),setTimeout(function(){try{a&&a.contentWindow&&a.contentWindow.postMessage(x,B)}catch{}},0)};return a.src=o,a.style.display="none",a.style.position="absolute",a.onerror=function(){T("onerror")},a.onload=function(){$l("onload"),clearTimeout(d),d=setTimeout(function(){T("onload timeout")},2e3)},global.document.body.appendChild(a),d=setTimeout(function(){T("timeout")},15e3),p=nC.unloadAdd(v),{post:b,cleanup:v,loaded:g}},createHtmlfile:function(o,s){var a=["Active"].concat("Object").join("X"),d=new global[a]("htmlfile"),p,g,v,T=function(){clearTimeout(p),v.onerror=null},b=function(){d&&(T(),nC.unloadDel(g),v.parentNode.removeChild(v),v=d=null,CollectGarbage())},x=function(ee){$l("onerror",ee),d&&(b(),s(ee))},B=function(ee,re){try{setTimeout(function(){v&&v.contentWindow&&v.contentWindow.postMessage(ee,re)},0)}catch{}};d.open(),d.write('<html><script>document.domain="'+global.document.domain+'";<\/script></html>'),d.close(),d.parentWindow[Ja.exports.WPrefix]=global[Ja.exports.WPrefix];var W=d.createElement("div");return d.body.appendChild(W),v=d.createElement("iframe"),W.appendChild(v),v.src=o,v.onerror=function(){x("onerror")},p=setTimeout(function(){x("timeout")},15e3),g=nC.unloadAdd(b),{post:B,cleanup:b,loaded:T}}};Ja.exports.iframeEnabled=!1;global.document&&(Ja.exports.iframeEnabled=(typeof global.postMessage=="function"||typeof global.postMessage=="object")&&!Pye.isKonqueror())});var fP=We((t2e,cK)=>{"use strict";var Lye=Xt(),oK=ii().EventEmitter,kye=hP(),pP=ao(),sK=Pp(),aK=Ka(),Mye=ql(),ua=function(){};function ha(o,s,a){if(!ha.enabled())throw new Error("Transport created when disabled");oK.call(this);var d=this;this.origin=pP.getOrigin(a),this.baseUrl=a,this.transUrl=s,this.transport=o,this.windowId=Mye.string(8);var p=pP.addPath(a,"/iframe.html")+"#"+this.windowId;ua(o,s,p),this.iframeObj=sK.createIframe(p,function(g){ua("err callback"),d.emit("close",1006,"Unable to load an iframe ("+g+")"),d.close()}),this.onmessageCallback=this._message.bind(this),aK.attachEvent("message",this.onmessageCallback)}Lye(ha,oK);ha.prototype.close=function(){if(ua("close"),this.removeAllListeners(),this.iframeObj){aK.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}};ha.prototype._message=function(o){if(ua("message",o.data),!pP.isOriginEqual(o.origin,this.origin)){ua("not same origin",o.origin,this.origin);return}var s;try{s=JSON.parse(o.data)}catch{ua("bad json",o.data);return}if(s.windowId!==this.windowId){ua("mismatched window id",s.windowId,this.windowId);return}switch(s.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([kye,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",s.data);break;case"c":var a;try{a=JSON.parse(s.data)}catch{ua("bad json",s.data);return}this.emit("close",a[0],a[1]),this.close();break}};ha.prototype.postMessage=function(o,s){ua("postMessage",o,s),this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:o,data:s||""}),this.origin)};ha.prototype.send=function(o){ua("send",o),this.postMessage("m",o)};ha.enabled=function(){return sK.iframeEnabled};ha.transportName="iframe";ha.roundTrips=2;cK.exports=ha});var rC=We((n2e,dK)=>{"use strict";dK.exports={isObject:function(o){var s=typeof o;return s==="function"||s==="object"&&!!o},extend:function(o){if(!this.isObject(o))return o;for(var s,a,d=1,p=arguments.length;d<p;d++){s=arguments[d];for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o[a]=s[a])}return o}}});var oC=We((r2e,lK)=>{"use strict";var xye=Xt(),iC=fP(),Uye=rC();lK.exports=function(o){function s(a,d){iC.call(this,o.transportName,a,d)}return xye(s,iC),s.enabled=function(a,d){if(!global.document)return!1;var p=Uye.extend({},d);return p.sameOrigin=!0,o.enabled(p)&&iC.enabled()},s.transportName="iframe-"+o.transportName,s.needBody=!0,s.roundTrips=iC.roundTrips+o.roundTrips-1,s.facadeTransport=o,s}});var fK=We((i2e,pK)=>{"use strict";var Fye=Xt(),Xl=Pp(),Vye=ao(),hK=ii().EventEmitter,jye=ql(),Za=function(){};function Ts(o){Za(o),hK.call(this);var s=this;Xl.polluteGlobalNamespace(),this.id="a"+jye.string(6),o=Vye.addQuery(o,"c="+decodeURIComponent(Xl.WPrefix+"."+this.id)),Za("using htmlfile",Ts.htmlfileEnabled);var a=Ts.htmlfileEnabled?Xl.createHtmlfile:Xl.createIframe;global[Xl.WPrefix][this.id]={start:function(){Za("start"),s.iframeObj.loaded()},message:function(d){Za("message",d),s.emit("message",d)},stop:function(){Za("stop"),s._cleanup(),s._close("network")}},this.iframeObj=a(o,function(){Za("callback"),s._cleanup(),s._close("permanent")})}Fye(Ts,hK);Ts.prototype.abort=function(){Za("abort"),this._cleanup(),this._close("user")};Ts.prototype._cleanup=function(){Za("_cleanup"),this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete global[Xl.WPrefix][this.id]};Ts.prototype._close=function(o){Za("_close",o),this.emit("close",null,o),this.removeAllListeners()};Ts.htmlfileEnabled=!1;var uK=["Active"].concat("Object").join("X");if(uK in global)try{Ts.htmlfileEnabled=!!new global[uK]("htmlfile")}catch{}Ts.enabled=Ts.htmlfileEnabled||Xl.iframeEnabled;pK.exports=Ts});var gP=We((o2e,gK)=>{"use strict";var Bye=Xt(),mP=fK(),Hye=wp(),mK=Kl();function Bg(o){if(!mP.enabled)throw new Error("Transport created when disabled");mK.call(this,o,"/htmlfile",mP,Hye)}Bye(Bg,mK);Bg.enabled=function(o){return mP.enabled&&o.sameOrigin};Bg.transportName="htmlfile";Bg.roundTrips=2;gK.exports=Bg});var EP=We((s2e,vK)=>{"use strict";var Gye=Xt(),_K=Kl(),Wye=xg(),_P=Fg(),EK=wp();function Hg(o){if(!EK.enabled&&!_P.enabled)throw new Error("Transport created when disabled");_K.call(this,o,"/xhr",Wye,_P)}Gye(Hg,_K);Hg.enabled=function(o){return o.nullOrigin?!1:EK.enabled&&o.sameOrigin?!0:_P.enabled};Hg.transportName="xhr-polling";Hg.roundTrips=2;vK.exports=Hg});var CK=We((a2e,TK)=>{"use strict";var qye=Xt(),SK=Kl(),zye=dP(),Kye=xg(),yK=tC();function Gg(o){if(!yK.enabled)throw new Error("Transport created when disabled");SK.call(this,o,"/xhr",Kye,yK)}qye(Gg,SK);Gg.enabled=zye.enabled;Gg.transportName="xdr-polling";Gg.roundTrips=2;TK.exports=Gg});var wK=We((c2e,bK)=>{"use strict";var Wg=Pp(),RK=ql(),Yye=Ap(),$ye=ao(),Xye=Xt(),IK=ii().EventEmitter,Cs=function(){};function Vo(o){Cs(o);var s=this;IK.call(this),Wg.polluteGlobalNamespace(),this.id="a"+RK.string(6);var a=$ye.addQuery(o,"c="+encodeURIComponent(Wg.WPrefix+"."+this.id));global[Wg.WPrefix][this.id]=this._callback.bind(this),this._createScript(a),this.timeoutId=setTimeout(function(){Cs("timeout"),s._abort(new Error("JSONP script loaded abnormally (timeout)"))},Vo.timeout)}Xye(Vo,IK);Vo.prototype.abort=function(){if(Cs("abort"),global[Wg.WPrefix][this.id]){var o=new Error("JSONP user aborted read");o.code=1e3,this._abort(o)}};Vo.timeout=35e3;Vo.scriptErrorTimeout=1e3;Vo.prototype._callback=function(o){Cs("_callback",o),this._cleanup(),!this.aborting&&(o&&(Cs("message",o),this.emit("message",o)),this.emit("close",null,"network"),this.removeAllListeners())};Vo.prototype._abort=function(o){Cs("_abort",o),this._cleanup(),this.aborting=!0,this.emit("close",o.code,o.message),this.removeAllListeners()};Vo.prototype._cleanup=function(){if(Cs("_cleanup"),clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var o=this.script;o.parentNode.removeChild(o),o.onreadystatechange=o.onerror=o.onload=o.onclick=null,this.script=null}delete global[Wg.WPrefix][this.id]};Vo.prototype._scriptError=function(){Cs("_scriptError");var o=this;this.errorTimer||(this.errorTimer=setTimeout(function(){o.loadedOkay||o._abort(new Error("JSONP script loaded abnormally (onerror)"))},Vo.scriptErrorTimeout))};Vo.prototype._createScript=function(o){Cs("_createScript",o);var s=this,a=this.script=global.document.createElement("script"),d;if(a.id="a"+RK.string(8),a.src=o,a.type="text/javascript",a.charset="UTF-8",a.onerror=this._scriptError.bind(this),a.onload=function(){Cs("onload"),s._abort(new Error("JSONP script loaded abnormally (onload)"))},a.onreadystatechange=function(){if(Cs("onreadystatechange",a.readyState),/loaded|closed/.test(a.readyState)){if(a&&a.htmlFor&&a.onclick){s.loadedOkay=!0;try{a.onclick()}catch{}}a&&s._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof a.async>"u"&&global.document.attachEvent)if(Yye.isOpera())d=this.script2=global.document.createElement("script"),d.text="try{var a = document.getElementById('"+a.id+"'); if(a)a.onerror();}catch(x){};",a.async=d.async=!1;else{try{a.htmlFor=a.id,a.event="onclick"}catch{}a.async=!0}typeof a.async<"u"&&(a.async=!0);var p=global.document.getElementsByTagName("head")[0];p.insertBefore(a,p.firstChild),d&&p.insertBefore(d,p.firstChild)};bK.exports=Vo});var OK=We((d2e,DK)=>{"use strict";var Jye=ql(),AK=ao(),Qa=function(){},co,qg;function Zye(o){Qa("createIframe",o);try{return global.document.createElement('<iframe name="'+o+'">')}catch{var s=global.document.createElement("iframe");return s.name=o,s}}function Qye(){Qa("createForm"),co=global.document.createElement("form"),co.style.display="none",co.style.position="absolute",co.method="POST",co.enctype="application/x-www-form-urlencoded",co.acceptCharset="UTF-8",qg=global.document.createElement("textarea"),qg.name="d",co.appendChild(qg),global.document.body.appendChild(co)}DK.exports=function(o,s,a){Qa(o,s),co||Qye();var d="a"+Jye.string(8);co.target=d,co.action=AK.addQuery(AK.addPath(o,"/jsonp_send"),"i="+d);var p=Zye(d);p.id=d,p.style.display="none",co.appendChild(p);try{qg.value=s}catch{}co.submit();var g=function(v){Qa("completed",d,v),p.onerror&&(p.onreadystatechange=p.onerror=p.onload=null,setTimeout(function(){Qa("cleaning up",d),p.parentNode.removeChild(p),p=null},500),qg.value="",a(v))};return p.onerror=function(){Qa("onerror",d),g()},p.onload=function(){Qa("onload",d),g()},p.onreadystatechange=function(v){Qa("onreadystatechange",d,p.readyState,v),p.readyState==="complete"&&g()},function(){Qa("aborted",d),g(new Error("Aborted"))}}});var LK=We((l2e,PK)=>{"use strict";var eSe=Xt(),NK=tP(),tSe=wK(),nSe=OK();function Jl(o){if(!Jl.enabled())throw new Error("Transport created when disabled");NK.call(this,o,"/jsonp",nSe,tSe)}eSe(Jl,NK);Jl.enabled=function(){return!!global.document};Jl.transportName="jsonp-polling";Jl.roundTrips=1;Jl.needBody=!0;PK.exports=Jl});var MK=We((u2e,kK)=>{"use strict";kK.exports=[Cz(),zz(),dP(),uP(),oC()(uP()),gP(),oC()(gP()),EP(),CK(),oC()(EP()),LK()]});var HK=We(()=>{"use strict";var zg=Array.prototype,TP=Object.prototype,rSe=Function.prototype,Kg=String.prototype,vP=zg.slice,CP=TP.toString,FK=function(o){return TP.toString.call(o)==="[object Function]"},iSe=function(s){return CP.call(s)==="[object Array]"},VK=function(s){return CP.call(s)==="[object String]"},oSe=Object.defineProperty&&(function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}})(),SP;oSe?SP=function(o,s,a,d){!d&&s in o||Object.defineProperty(o,s,{configurable:!0,enumerable:!1,writable:!0,value:a})}:SP=function(o,s,a,d){!d&&s in o||(o[s]=a)};var Yg=function(o,s,a){for(var d in s)TP.hasOwnProperty.call(s,d)&&SP(o,d,s[d],a)},jK=function(o){if(o==null)throw new TypeError("can't convert "+o+" to object");return Object(o)};function sSe(o){var s=+o;return s!==s?s=0:s!==0&&s!==1/0&&s!==-1/0&&(s=(s>0||-1)*Math.floor(Math.abs(s))),s}function aSe(o){return o>>>0}function yP(){}Yg(rSe,{bind:function(s){var a=this;if(!FK(a))throw new TypeError("Function.prototype.bind called on incompatible "+a);for(var d=vP.call(arguments,1),p=function(){if(this instanceof b){var x=a.apply(this,d.concat(vP.call(arguments)));return Object(x)===x?x:this}else return a.apply(s,d.concat(vP.call(arguments)))},g=Math.max(0,a.length-d.length),v=[],T=0;T<g;T++)v.push("$"+T);var b=Function("binder","return function ("+v.join(",")+"){ return binder.apply(this, arguments); }")(p);return a.prototype&&(yP.prototype=a.prototype,b.prototype=new yP,yP.prototype=null),b}});Yg(Array,{isArray:iSe});var xK=Object("a"),BK=xK[0]!=="a"||!(0 in xK),cSe=function(s){var a=!0,d=!0;return s&&(s.call("foo",function(p,g,v){typeof v!="object"&&(a=!1)}),s.call([1],function(){"use strict";d=typeof this=="string"},"x")),!!s&&a&&d};Yg(zg,{forEach:function(s){var a=jK(this),d=BK&&VK(this)?this.split(""):a,p=arguments[1],g=-1,v=d.length>>>0;if(!FK(s))throw new TypeError;for(;++g<v;)g in d&&s.call(p,d[g],g,a)}},!cSe(zg.forEach));var dSe=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;Yg(zg,{indexOf:function(s){var a=BK&&VK(this)?this.split(""):jK(this),d=a.length>>>0;if(!d)return-1;var p=0;for(arguments.length>1&&(p=sSe(arguments[1])),p=p>=0?p:Math.max(0,d+p);p<d;p++)if(p in a&&a[p]===s)return p;return-1}},dSe);var UK=Kg.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?(function(){var o=/()??/.exec("")[1]===void 0;Kg.split=function(s,a){var d=this;if(s===void 0&&a===0)return[];if(CP.call(s)!=="[object RegExp]")return UK.call(this,s,a);var p=[],g=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.extended?"x":"")+(s.sticky?"y":""),v=0,T,b,x,B;for(s=new RegExp(s.source,g+"g"),d+="",o||(T=new RegExp("^"+s.source+"$(?!\\s)",g)),a=a===void 0?-1>>>0:aSe(a);(b=s.exec(d))&&(x=b.index+b[0].length,!(x>v&&(p.push(d.slice(v,b.index)),!o&&b.length>1&&b[0].replace(T,function(){for(var W=1;W<arguments.length-2;W++)arguments[W]===void 0&&(b[W]=void 0)}),b.length>1&&b.index<d.length&&zg.push.apply(p,b.slice(1)),B=b[0].length,v=x,p.length>=a)));)s.lastIndex===b.index&&s.lastIndex++;return v===d.length?(B||!s.test(""))&&p.push(""):p.push(d.slice(v)),p.length>a?p.slice(0,a):p}})():"0".split(void 0,0).length&&(Kg.split=function(s,a){return s===void 0&&a===0?[]:UK.call(this,s,a)});var lSe=Kg.substr,uSe="".substr&&"0b".substr(-1)!=="b";Yg(Kg,{substr:function(s,a){return lSe.call(this,s<0&&(s=this.length+s)<0?0:s,a)}},uSe)});var WK=We((f2e,GK)=>{"use strict";var sC=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,RP,hSe=function(o){var s,a={},d=[];for(s=0;s<65536;s++)d.push(String.fromCharCode(s));return o.lastIndex=0,d.join("").replace(o,function(p){return a[p]="\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4),""}),o.lastIndex=0,a};GK.exports={quote:function(o){var s=JSON.stringify(o);return sC.lastIndex=0,sC.test(s)?(RP||(RP=hSe(sC)),s.replace(sC,function(a){return RP[a]})):s}}});var zK=We((m2e,qK)=>{"use strict";var aC=function(){};qK.exports=function(o){return{filterToEnabled:function(s,a){var d={main:[],facade:[]};return s?typeof s=="string"&&(s=[s]):s=[],o.forEach(function(p){if(p){if(p.transportName==="websocket"&&a.websocket===!1){aC("disabled from server","websocket");return}if(s.length&&s.indexOf(p.transportName)===-1){aC("not in whitelist",p.transportName);return}p.enabled(a)?(aC("enabled",p.transportName),d.main.push(p),p.facadeTransport&&d.facade.push(p.facadeTransport)):aC("disabled",p.transportName)}}),d}}}});var YK=We((g2e,KK)=>{"use strict";var IP={};["log","debug","warn"].forEach(function(o){var s;try{s=global.console&&global.console[o]&&global.console[o].apply}catch{}IP[o]=s?function(){return global.console[o].apply(global.console,arguments)}:o==="log"?function(){}:IP.log});KK.exports=IP});var cC=We((_2e,$K)=>{"use strict";function Zl(o){this.type=o}Zl.prototype.initEvent=function(o,s,a){return this.type=o,this.bubbles=s,this.cancelable=a,this.timeStamp=+new Date,this};Zl.prototype.stopPropagation=function(){};Zl.prototype.preventDefault=function(){};Zl.CAPTURING_PHASE=1;Zl.AT_TARGET=2;Zl.BUBBLING_PHASE=3;$K.exports=Zl});var bP=We((E2e,XK)=>{"use strict";XK.exports=global.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}});var eY=We((v2e,QK)=>{"use strict";var pSe=Xt(),JK=cC();function ZK(){JK.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}pSe(ZK,JK);QK.exports=ZK});var iY=We((y2e,rY)=>{"use strict";var fSe=Xt(),tY=cC();function nY(o){tY.call(this),this.initEvent("message",!1,!1),this.data=o}fSe(nY,tY);rY.exports=nY});var aY=We((S2e,sY)=>{"use strict";var oY=ii().EventEmitter,mSe=Xt();function $g(){var o=this;oY.call(this),this.to=setTimeout(function(){o.emit("finish",200,"{}")},$g.timeout)}mSe($g,oY);$g.prototype.close=function(){clearTimeout(this.to)};$g.timeout=2e3;sY.exports=$g});var AP=We((T2e,dY)=>{"use strict";var cY=ii().EventEmitter,gSe=Xt(),_Se=rC(),ESe=function(){};function wP(o,s){cY.call(this);var a=this,d=+new Date;this.xo=new s("GET",o),this.xo.once("finish",function(p,g){var v,T;if(p===200){if(T=+new Date-d,g)try{v=JSON.parse(g)}catch{ESe("bad json",g)}_Se.isObject(v)||(v={})}a.emit("finish",v,T),a.removeAllListeners()})}gSe(wP,cY);wP.prototype.close=function(){this.removeAllListeners(),this.xo.close()};dY.exports=wP});var DP=We((C2e,uY)=>{"use strict";var vSe=Xt(),lY=ii().EventEmitter,ySe=wp(),SSe=AP();function dC(o){var s=this;lY.call(this),this.ir=new SSe(o,ySe),this.ir.once("finish",function(a,d){s.ir=null,s.emit("message",JSON.stringify([a,d]))})}vSe(dC,lY);dC.transportName="iframe-info-receiver";dC.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()};uY.exports=dC});var mY=We((R2e,fY)=>{"use strict";var hY=ii().EventEmitter,TSe=Xt(),CSe=Ka(),pY=fP(),RSe=DP(),ISe=function(){};function lC(o,s){var a=this;hY.call(this);var d=function(){var p=a.ifr=new pY(RSe.transportName,s,o);p.once("message",function(g){if(g){var v;try{v=JSON.parse(g)}catch{ISe("bad json",g),a.emit("finish"),a.close();return}var T=v[0],b=v[1];a.emit("finish",T,b)}a.close()}),p.once("close",function(){a.emit("finish"),a.close()})};global.document.body?d():CSe.attachEvent("load",d)}TSe(lC,hY);lC.enabled=function(){return pY.enabled()};lC.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null};fY.exports=lC});var SY=We((I2e,yY)=>{"use strict";var vY=ii().EventEmitter,bSe=Xt(),wSe=ao(),gY=tC(),_Y=Fg(),ASe=wp(),DSe=aY(),EY=mY(),uC=AP(),Lp=function(){};function ec(o,s){Lp(o);var a=this;vY.call(this),setTimeout(function(){a.doXhr(o,s)},0)}bSe(ec,vY);ec._getReceiver=function(o,s,a){return a.sameOrigin?new uC(s,ASe):_Y.enabled?new uC(s,_Y):gY.enabled&&a.sameScheme?new uC(s,gY):EY.enabled()?new EY(o,s):new uC(s,DSe)};ec.prototype.doXhr=function(o,s){var a=this,d=wSe.addPath(o,"/info");Lp("doXhr",d),this.xo=ec._getReceiver(o,d,s),this.timeoutRef=setTimeout(function(){Lp("timeout"),a._cleanup(!1),a.emit("finish")},ec.timeout),this.xo.once("finish",function(p,g){Lp("finish",p,g),a._cleanup(!0),a.emit("finish",p,g)})};ec.prototype._cleanup=function(o){Lp("_cleanup"),clearTimeout(this.timeoutRef),this.timeoutRef=null,!o&&this.xo&&this.xo.close(),this.xo=null};ec.prototype.close=function(){Lp("close"),this.removeAllListeners(),this._cleanup(!1)};ec.timeout=8e3;yY.exports=ec});var RY=We((b2e,CY)=>{"use strict";var TY=Pp();function Xg(o){this._transport=o,o.on("message",this._transportMessage.bind(this)),o.on("close",this._transportClose.bind(this))}Xg.prototype._transportClose=function(o,s){TY.postMessage("c",JSON.stringify([o,s]))};Xg.prototype._transportMessage=function(o){TY.postMessage("t",o)};Xg.prototype._send=function(o){this._transport.send(o)};Xg.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()};CY.exports=Xg});var AY=We((w2e,wY)=>{"use strict";var IY=ao(),OSe=Ka(),NSe=RY(),bY=DP(),OP=Pp(),hC=bP(),NP=function(){};wY.exports=function(o,s){var a={};s.forEach(function(p){p.facadeTransport&&(a[p.facadeTransport.transportName]=p.facadeTransport)}),a[bY.transportName]=bY;var d;o.bootstrap_iframe=function(){var p;OP.currentWindowId=hC.hash.slice(1);var g=function(v){if(v.source===parent&&(typeof d>"u"&&(d=v.origin),v.origin===d)){var T;try{T=JSON.parse(v.data)}catch{NP("bad json",v.data);return}if(T.windowId===OP.currentWindowId)switch(T.type){case"s":var b;try{b=JSON.parse(T.data)}catch{NP("bad json",T.data);break}var x=b[0],B=b[1],W=b[2],ee=b[3];if(NP(x,B,W,ee),x!==o.version)throw new Error('Incompatible SockJS! Main site uses: "'+x+'", the iframe: "'+o.version+'".');if(!IY.isOriginEqual(W,hC.href)||!IY.isOriginEqual(ee,hC.href))throw new Error("Can't connect to different domain from within an iframe. ("+hC.href+", "+W+", "+ee+")");p=new NSe(new a[B](W,ee));break;case"m":p._send(T.data);break;case"c":p&&p._close(),p=null;break}}};OSe.attachEvent("message",g),OP.postMessage("s")}}});var MY=We((A2e,kY)=>{"use strict";HK();var PSe=$N(),LSe=Xt(),DY=ql(),kSe=WK(),Jg=ao(),MSe=Ka(),xSe=zK(),USe=rC(),FSe=Ap(),VSe=YK(),PP=cC(),NY=JN(),pC=bP(),jSe=eY(),OY=iY(),BSe=SY(),ar=function(){},PY;function Jt(o,s,a){if(!(this instanceof Jt))return new Jt(o,s,a);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");NY.call(this),this.readyState=Jt.CONNECTING,this.extensions="",this.protocol="",a=a||{},a.protocols_whitelist&&VSe.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=a.transports,this._transportOptions=a.transportOptions||{},this._timeout=a.timeout||0;var d=a.sessionId||8;if(typeof d=="function")this._generateSessionId=d;else if(typeof d=="number")this._generateSessionId=function(){return DY.string(d)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=a.server||DY.numberString(1e3);var p=new PSe(o);if(!p.host||!p.protocol)throw new SyntaxError("The URL '"+o+"' is invalid");if(p.hash)throw new SyntaxError("The URL must not contain a fragment");if(p.protocol!=="http:"&&p.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+p.protocol+"' is not allowed.");var g=p.protocol==="https:";if(pC.protocol==="https:"&&!g&&!Jg.isLoopbackAddr(p.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");s?Array.isArray(s)||(s=[s]):s=[];var v=s.sort();v.forEach(function(b,x){if(!b)throw new SyntaxError("The protocols entry '"+b+"' is invalid.");if(x<v.length-1&&b===v[x+1])throw new SyntaxError("The protocols entry '"+b+"' is duplicated.")});var T=Jg.getOrigin(pC.href);this._origin=T?T.toLowerCase():null,p.set("pathname",p.pathname.replace(/\/+$/,"")),this.url=p.href,ar("using url",this.url),this._urlInfo={nullOrigin:!FSe.hasDomain(),sameOrigin:Jg.isOriginEqual(this.url,pC.href),sameScheme:Jg.isSchemeEqual(this.url,pC.href)},this._ir=new BSe(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}LSe(Jt,NY);function LY(o){return o===1e3||o>=3e3&&o<=4999}Jt.prototype.close=function(o,s){if(o&&!LY(o))throw new Error("InvalidAccessError: Invalid code");if(s&&s.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===Jt.CLOSING||this.readyState===Jt.CLOSED)){var a=!0;this._close(o||1e3,s||"Normal closure",a)}};Jt.prototype.send=function(o){if(typeof o!="string"&&(o=""+o),this.readyState===Jt.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===Jt.OPEN&&this._transport.send(kSe.quote(o))};Jt.version=hP();Jt.CONNECTING=0;Jt.OPEN=1;Jt.CLOSING=2;Jt.CLOSED=3;Jt.prototype._receiveInfo=function(o,s){if(ar("_receiveInfo",s),this._ir=null,!o){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(s),this._transUrl=o.base_url?o.base_url:this.url,o=USe.extend(o,this._urlInfo),ar("info",o);var a=PY.filterToEnabled(this._transportsWhitelist,o);this._transports=a.main,ar(this._transports.length+" enabled transports"),this._connect()};Jt.prototype._connect=function(){for(var o=this._transports.shift();o;o=this._transports.shift()){if(ar("attempt",o.transportName),o.needBody&&(!global.document.body||typeof global.document.readyState<"u"&&global.document.readyState!=="complete"&&global.document.readyState!=="interactive")){ar("waiting for body"),this._transports.unshift(o),MSe.attachEvent("load",this._connect.bind(this));return}var s=Math.max(this._timeout,this._rto*o.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),s),ar("using timeout",s);var a=Jg.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),d=this._transportOptions[o.transportName];ar("transport url",a);var p=new o(a,this._transUrl,d);p.on("message",this._transportMessage.bind(this)),p.once("close",this._transportClose.bind(this)),p.transportName=o.transportName,this._transport=p;return}this._close(2e3,"All transports failed",!1)};Jt.prototype._transportTimeout=function(){ar("_transportTimeout"),this.readyState===Jt.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))};Jt.prototype._transportMessage=function(o){ar("_transportMessage",o);var s=this,a=o.slice(0,1),d=o.slice(1),p;switch(a){case"o":this._open();return;case"h":this.dispatchEvent(new PP("heartbeat")),ar("heartbeat",this.transport);return}if(d)try{p=JSON.parse(d)}catch{ar("bad json",d)}if(typeof p>"u"){ar("empty payload",d);return}switch(a){case"a":Array.isArray(p)&&p.forEach(function(g){ar("message",s.transport,g),s.dispatchEvent(new OY(g))});break;case"m":ar("message",this.transport,p),this.dispatchEvent(new OY(p));break;case"c":Array.isArray(p)&&p.length===2&&this._close(p[0],p[1],!0);break}};Jt.prototype._transportClose=function(o,s){if(ar("_transportClose",this.transport,o,s),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!LY(o)&&o!==2e3&&this.readyState===Jt.CONNECTING){this._connect();return}this._close(o,s)};Jt.prototype._open=function(){ar("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===Jt.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=Jt.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new PP("open")),ar("connected",this.transport)):this._close(1006,"Server lost session")};Jt.prototype._close=function(o,s,a){ar("_close",this.transport,o,s,a,this.readyState);var d=!1;if(this._ir&&(d=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===Jt.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=Jt.CLOSING,setTimeout((function(){this.readyState=Jt.CLOSED,d&&this.dispatchEvent(new PP("error"));var p=new jSe("close");p.wasClean=a||!1,p.code=o||1e3,p.reason=s,this.dispatchEvent(p),this.onmessage=this.onclose=this.onerror=null,ar("disconnected")}).bind(this),0)};Jt.prototype.countRTO=function(o){return o>100?4*o:300+o};kY.exports=function(o){return PY=xSe(o),AY()(Jt,o),Jt}});var UY=We((D2e,xY)=>{"use strict";var HSe=MK();xY.exports=MY()(HSe);"_sockjs_onload"in global&&setTimeout(global._sockjs_onload,1)});var HY=We((LP,kP)=>{"use strict";(function(o,s){typeof LP=="object"&&typeof kP<"u"?kP.exports=s():typeof define=="function"&&define.amd?define(s):(o=typeof globalThis<"u"?globalThis:o||self).AgoraRTC=s()})(LP,function(){"use strict";function o(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},p=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),g=p,v=Function.prototype,T=v.call,b=g&&v.bind.bind(T,T),x=g?b:function(e){return function(){return T.apply(e,arguments)}},B=x({}.isPrototypeOf),W=function(e){return e&&e.Math===Math&&e},ee=W(typeof globalThis=="object"&&globalThis)||W(typeof window=="object"&&window)||W(typeof self=="object"&&self)||W(typeof s=="object"&&s)||W(typeof s=="object"&&s)||(function(){return this})()||Function("return this")(),re=p,Se=Function.prototype,ze=Se.apply,Me=Se.call,Oe=typeof Reflect=="object"&&Reflect.apply||(re?Me.bind(ze):function(){return Me.apply(ze,arguments)}),kn=x,Mi=kn({}.toString),gr=kn("".slice),_r=function(e){return gr(Mi(e),8,-1)},pa=_r,CC=x,Fp=function(e){if(pa(e)==="Function")return CC(e)},RC=typeof document=="object"&&document.all,Mn=RC===void 0&&RC!==void 0?function(e){return typeof e=="function"||e===RC}:function(e){return typeof e=="function"},n_={},zr=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),qY=p,r_=Function.prototype.call,Hn=qY?r_.bind(r_):function(){return r_.apply(r_,arguments)},i_={},MP={}.propertyIsEnumerable,xP=Object.getOwnPropertyDescriptor,zY=xP&&!MP.call({1:2},1);i_.f=zY?function(e){var t=xP(this,e);return!!t&&t.enumerable}:MP;var nc,o_,rc=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},KY=d,YY=_r,IC=Object,$Y=x("".split),s_=KY(function(){return!IC("z").propertyIsEnumerable(0)})?function(e){return YY(e)==="String"?$Y(e,""):IC(e)}:IC,a_=function(e){return e==null},XY=a_,JY=TypeError,ic=function(e){if(XY(e))throw new JY("Can't call method on "+e);return e},ZY=s_,QY=ic,oc=function(e){return ZY(QY(e))},e9=Mn,Er=function(e){return typeof e=="object"?e!==null:e9(e)},mi={},bC=mi,wC=ee,t9=Mn,UP=function(e){return t9(e)?e:void 0},Nr=function(e,t){return arguments.length<2?UP(bC[e])||UP(wC[e]):bC[e]&&bC[e][t]||wC[e]&&wC[e][t]},FP=ee.navigator,VP=FP&&FP.userAgent,fa=VP?String(VP):"",jP=ee,AC=fa,BP=jP.process,HP=jP.Deno,GP=BP&&BP.versions||HP&&HP.version,WP=GP&&GP.v8;WP&&(o_=(nc=WP.split("."))[0]>0&&nc[0]<4?1:+(nc[0]+nc[1])),!o_&&AC&&(!(nc=AC.match(/Edge\/(\d+)/))||nc[1]>=74)&&(nc=AC.match(/Chrome\/(\d+)/))&&(o_=+nc[1]);var cd=o_,qP=cd,n9=d,r9=ee.String,tu=!!Object.getOwnPropertySymbols&&!n9(function(){var e=Symbol("symbol detection");return!r9(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&qP&&qP<41}),zP=tu&&!Symbol.sham&&typeof Symbol.iterator=="symbol",i9=Nr,o9=Mn,s9=B,a9=Object,Vp=zP?function(e){return typeof e=="symbol"}:function(e){var t=i9("Symbol");return o9(t)&&s9(t.prototype,a9(e))},c9=String,nu=function(e){try{return c9(e)}catch{return"Object"}},d9=Mn,l9=nu,u9=TypeError,gi=function(e){if(d9(e))return e;throw new u9(l9(e)+" is not a function")},h9=gi,p9=a_,jp=function(e,t){var n=e[t];return p9(n)?void 0:h9(n)},DC=Hn,OC=Mn,NC=Er,f9=TypeError,KP={exports:{}},YP=ee,m9=Object.defineProperty,g9=ee,_9=function(e,t){try{m9(YP,e,{value:t,configurable:!0,writable:!0})}catch{YP[e]=t}return t},$P="__core-js_shared__",XP=KP.exports=g9[$P]||_9($P,{});(XP.versions||(XP.versions=[])).push({version:"3.46.0",mode:"pure",copyright:"\xA9 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var PC=KP.exports,JP=PC,ru=function(e,t){return JP[e]||(JP[e]=t||{})},E9=ic,v9=Object,jo=function(e){return v9(E9(e))},y9=jo,S9=x({}.hasOwnProperty),Qn=Object.hasOwn||function(e,t){return S9(y9(e),t)},T9=x,C9=0,R9=Math.random(),I9=T9(1.1.toString),LC=function(e){return"Symbol("+(e===void 0?"":e)+")_"+I9(++C9+R9,36)},b9=ru,ZP=Qn,w9=LC,A9=tu,D9=zP,iu=ee.Symbol,kC=b9("wks"),O9=D9?iu.for||iu:iu&&iu.withoutSetter||w9,un=function(e){return ZP(kC,e)||(kC[e]=A9&&ZP(iu,e)?iu[e]:O9("Symbol."+e)),kC[e]},N9=Hn,QP=Er,eL=Vp,P9=jp,L9=function(e,t){var n,r;if(t==="string"&&OC(n=e.toString)&&!NC(r=DC(n,e))||OC(n=e.valueOf)&&!NC(r=DC(n,e))||t!=="string"&&OC(n=e.toString)&&!NC(r=DC(n,e)))return r;throw new f9("Can't convert object to primitive value")},k9=TypeError,M9=un("toPrimitive"),x9=function(e,t){if(!QP(e)||eL(e))return e;var n,r=P9(e,M9);if(r){if(t===void 0&&(t="default"),n=N9(r,e,t),!QP(n)||eL(n))return n;throw new k9("Can't convert object to primitive value")}return t===void 0&&(t="number"),L9(e,t)},U9=Vp,MC=function(e){var t=x9(e,"string");return U9(t)?t:t+""},tL=Er,xC=ee.document,F9=tL(xC)&&tL(xC.createElement),UC=function(e){return F9?xC.createElement(e):{}},V9=UC,nL=!zr&&!d(function(){return Object.defineProperty(V9("div"),"a",{get:function(){return 7}}).a!==7}),j9=zr,B9=Hn,H9=i_,G9=rc,W9=oc,q9=MC,z9=Qn,K9=nL,rL=Object.getOwnPropertyDescriptor;n_.f=j9?rL:function(e,t){if(e=W9(e),t=q9(t),K9)try{return rL(e,t)}catch{}if(z9(e,t))return G9(!B9(H9.f,e,t),e[t])};var Y9=d,$9=Mn,X9=/#|\.prototype\./,Bp=function(e,t){var n=Z9[J9(e)];return n===e$||n!==Q9&&($9(t)?Y9(t):!!t)},J9=Bp.normalize=function(e){return String(e).replace(X9,".").toLowerCase()},Z9=Bp.data={},Q9=Bp.NATIVE="N",e$=Bp.POLYFILL="P",iL=Bp,t$=gi,n$=p,r$=Fp(Fp.bind),sc=function(e,t){return t$(e),t===void 0?e:n$?r$(e,t):function(){return e.apply(t,arguments)}},lo={},oL=zr&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),i$=Er,o$=String,s$=TypeError,oi=function(e){if(i$(e))return e;throw new s$(o$(e)+" is not an object")},a$=zr,c$=nL,d$=oL,c_=oi,sL=MC,l$=TypeError,FC=Object.defineProperty,u$=Object.getOwnPropertyDescriptor,VC="enumerable",jC="configurable",BC="writable";lo.f=a$?d$?function(e,t,n){if(c_(e),t=sL(t),c_(n),typeof e=="function"&&t==="prototype"&&"value"in n&&BC in n&&!n[BC]){var r=u$(e,t);r&&r[BC]&&(e[t]=n.value,n={configurable:jC in n?n[jC]:r[jC],enumerable:VC in n?n[VC]:r[VC],writable:!1})}return FC(e,t,n)}:FC:function(e,t,n){if(c_(e),t=sL(t),c_(n),c$)try{return FC(e,t,n)}catch{}if("get"in n||"set"in n)throw new l$("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var h$=lo,p$=rc,dd=zr?function(e,t,n){return h$.f(e,t,p$(1,n))}:function(e,t,n){return e[t]=n,e},Hp=ee,f$=Oe,m$=Fp,g$=Mn,_$=n_.f,E$=iL,ou=mi,v$=sc,su=dd,aL=Qn,y$=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return f$(e,this,arguments)};return t.prototype=e.prototype,t},st=function(e,t){var n,r,i,c,l,u,h,f,m,E=e.target,_=e.global,y=e.stat,A=e.proto,C=_?Hp:y?Hp[E]:Hp[E]&&Hp[E].prototype,I=_?ou:ou[E]||su(ou,E,{})[E],N=I.prototype;for(c in t)r=!(n=E$(_?c:E+(y?".":"#")+c,e.forced))&&C&&aL(C,c),u=I[c],r&&(h=e.dontCallGetSet?(m=_$(C,c))&&m.value:C[c]),l=r&&h?h:t[c],(n||A||typeof u!=typeof l)&&(f=e.bind&&r?v$(l,Hp):e.wrap&&r?y$(l):A&&g$(l)?m$(l):l,(e.sham||l&&l.sham||u&&u.sham)&&su(f,"sham",!0),su(I,c,f),A&&(aL(ou,i=E+"Prototype")||su(ou,i,{}),su(ou[i],c,l),e.real&&N&&(n||!N[c])&&su(N,c,l)))},S$=Math.ceil,T$=Math.floor,C$=Math.trunc||function(e){var t=+e;return(t>0?T$:S$)(t)},R$=C$,HC=function(e){var t=+e;return t!=t||t===0?0:R$(t)},I$=HC,b$=Math.max,w$=Math.min,GC=function(e,t){var n=I$(e);return n<0?b$(n+t,0):w$(n,t)},A$=HC,D$=Math.min,cL=function(e){var t=A$(e);return t>0?D$(t,9007199254740991):0},O$=cL,ac=function(e){return O$(e.length)},N$=oc,P$=GC,L$=ac,dL=function(e){return function(t,n,r){var i=N$(t),c=L$(i);if(c===0)return!e&&-1;var l,u=P$(r,c);if(e&&n!=n){for(;c>u;)if((l=i[u++])!=l)return!0}else for(;c>u;u++)if((e||u in i)&&i[u]===n)return e||u||0;return!e&&-1}},WC={includes:dL(!0),indexOf:dL(!1)},k$=WC.includes;st({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return k$(this,e,arguments.length>1?arguments[1]:void 0)}});var M$=ee,x$=mi,xi=function(e,t){var n=x$[e+"Prototype"],r=n&&n[t];if(r)return r;var i=M$[e],c=i&&i.prototype;return c&&c[t]},U$=xi("Array","includes"),F$=Er,V$=_r,j$=un("match"),qC=function(e){var t;return F$(e)&&((t=e[j$])!==void 0?!!t:V$(e)==="RegExp")},B$=qC,H$=TypeError,lL={};lL[un("toStringTag")]="z";var zC=String(lL)==="[object z]",G$=zC,W$=Mn,d_=_r,q$=un("toStringTag"),z$=Object,K$=d_((function(){return arguments})())==="Arguments",cc=G$?d_:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=(function(i,c){try{return i[c]}catch{}})(t=z$(e),q$))=="string"?n:K$?d_(t):(r=d_(t))==="Object"&&W$(t.callee)?"Arguments":r},Y$=cc,$$=String,si=function(e){if(Y$(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return $$(e)},X$=un("match"),J$=st,Z$=function(e){if(B$(e))throw new H$("The method doesn't accept regular expressions");return e},Q$=ic,uL=si,e7=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[X$]=!1,"/./"[e](t)}catch{}}return!1},t7=x("".indexOf);J$({target:"String",proto:!0,forced:!e7("includes")},{includes:function(e){return!!~t7(uL(Q$(this)),uL(Z$(e)),arguments.length>1?arguments[1]:void 0)}});var n7=xi("String","includes"),hL=B,r7=U$,i7=n7,KC=Array.prototype,YC=String.prototype,o7=function(e){var t=e.includes;return e===KC||hL(KC,e)&&t===KC.includes?r7:typeof e=="string"||e===YC||hL(YC,e)&&t===YC.includes?i7:t},J=a(o7),s7=gi,a7=jo,c7=s_,d7=ac,pL=TypeError,fL="Reduce of empty array with no initial value",mL=function(e){return function(t,n,r,i){var c=a7(t),l=c7(c),u=d7(c);if(s7(n),u===0&&r<2)throw new pL(fL);var h=e?u-1:0,f=e?-1:1;if(r<2)for(;;){if(h in l){i=l[h],h+=f;break}if(h+=f,e?h<0:u<=h)throw new pL(fL)}for(;e?h>=0:u>h;h+=f)h in l&&(i=n(i,l[h],h,c));return i}},l7={left:mL(!1),right:mL(!0)},u7=d,l_=function(e,t){var n=[][e];return!!n&&u7(function(){n.call(null,t||function(){return 1},1)})},Gp=ee,h7=fa,p7=_r,u_=function(e){return h7.slice(0,e.length)===e},$C=u_("Bun/")?"BUN":u_("Cloudflare-Workers")?"CLOUDFLARE":u_("Deno/")?"DENO":u_("Node.js/")?"NODE":Gp.Bun&&typeof Bun.version=="string"?"BUN":Gp.Deno&&typeof Deno.version=="object"?"DENO":p7(Gp.process)==="process"?"NODE":Gp.window&&Gp.document?"BROWSER":"REST",h_=$C==="NODE",f7=l7.left;st({target:"Array",proto:!0,forced:!h_&&cd>79&&cd<83||!l_("reduce")},{reduce:function(e){var t=arguments.length;return f7(this,e,t,t>1?arguments[1]:void 0)}});var m7=xi("Array","reduce"),g7=B,_7=m7,XC=Array.prototype,E7=function(e){var t=e.reduce;return e===XC||g7(XC,e)&&t===XC.reduce?_7:t},gL=E7,Ui=a(gL),v7=_r,Wp=Array.isArray||function(e){return v7(e)==="Array"},y7=st,S7=Wp,T7=x([].reverse),_L=[1,2];y7({target:"Array",proto:!0,forced:String(_L)===String(_L.reverse())},{reverse:function(){return S7(this)&&(this.length=this.length),T7(this)}});var C7=xi("Array","reverse"),R7=B,I7=C7,JC=Array.prototype,b7=function(e){var t=e.reverse;return e===JC||R7(JC,e)&&t===JC.reverse?I7:t},EL=b7,vL=a(EL),w7=LC,yL=ru("keys"),p_=function(e){return yL[e]||(yL[e]=w7(e))},A7=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),D7=Qn,O7=Mn,N7=jo,P7=A7,SL=p_("IE_PROTO"),ZC=Object,L7=ZC.prototype,QC=P7?ZC.getPrototypeOf:function(e){var t=N7(e);if(D7(t,SL))return t[SL];var n=t.constructor;return O7(n)&&t instanceof n?n.prototype:t instanceof ZC?L7:null},k7=x,M7=gi,x7=Er,U7=function(e){return x7(e)||e===null},F7=String,V7=TypeError,j7=function(e,t,n){try{return k7(M7(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},B7=Er,H7=ic,G7=function(e){if(U7(e))return e;throw new V7("Can't set "+F7(e)+" as a prototype")},W7=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,n={};try{(e=j7(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return H7(r),G7(i),B7(r)&&(t?e(r,i):r.__proto__=i),r}})():void 0),f_={},m_={},eR=Qn,q7=oc,z7=WC.indexOf,K7=m_,TL=x([].push),CL=function(e,t){var n,r=q7(e),i=0,c=[];for(n in r)!eR(K7,n)&&eR(r,n)&&TL(c,n);for(;t.length>i;)eR(r,n=t[i++])&&(~z7(c,n)||TL(c,n));return c},tR=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Y7=CL,$7=tR.concat("length","prototype");f_.f=Object.getOwnPropertyNames||function(e){return Y7(e,$7)};var qp={};qp.f=Object.getOwnPropertySymbols;var X7=Nr,J7=f_,Z7=qp,Q7=oi,eX=x([].concat),tX=X7("Reflect","ownKeys")||function(e){var t=J7.f(Q7(e)),n=Z7.f;return n?eX(t,n(e)):t},RL=Qn,nX=tX,rX=n_,iX=lo,nR={},oX=CL,sX=tR,g_=Object.keys||function(e){return oX(e,sX)},aX=zr,cX=oL,dX=lo,lX=oi,uX=oc,hX=g_;nR.f=aX&&!cX?Object.defineProperties:function(e,t){lX(e);for(var n,r=uX(t),i=hX(t),c=i.length,l=0;c>l;)dX.f(e,n=i[l++],r[n]);return e};var __,IL=Nr("document","documentElement"),pX=oi,fX=nR,bL=tR,mX=m_,gX=IL,_X=UC,rR="prototype",iR="script",wL=p_("IE_PROTO"),oR=function(){},AL=function(e){return"<"+iR+">"+e+"</"+iR+">"},DL=function(e){e.write(AL("")),e.close();var t=e.parentWindow.Object;return e=null,t},E_=function(){try{__=new ActiveXObject("htmlfile")}catch{}var e,t,n;E_=typeof document<"u"?document.domain&&__?DL(__):(t=_X("iframe"),n="java"+iR+":",t.style.display="none",gX.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(AL("document.F=Object")),e.close(),e.F):DL(__);for(var r=bL.length;r--;)delete E_[rR][bL[r]];return E_()};mX[wL]=!0;var zp=Object.create||function(e,t){var n;return e!==null?(oR[rR]=pX(e),n=new oR,oR[rR]=null,n[wL]=e):n=E_(),t===void 0?n:fX.f(n,t)},EX=Er,vX=dd,OL=Error,yX=x("".replace),SX=String(new OL("zxcasd").stack),NL=/\n\s*at [^:]*:[^\n]*/,TX=NL.test(SX),CX=rc,RX=!d(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",CX(1,7)),e.stack!==7)}),IX=dd,bX=function(e,t){if(TX&&typeof e=="string"&&!OL.prepareStackTrace)for(;t--;)e=yX(e,NL,"");return e},wX=RX,PL=Error.captureStackTrace,au={},AX=au,DX=un("iterator"),OX=Array.prototype,LL=function(e){return e!==void 0&&(AX.Array===e||OX[DX]===e)},NX=cc,kL=jp,PX=a_,LX=au,kX=un("iterator"),v_=function(e){if(!PX(e))return kL(e,kX)||kL(e,"@@iterator")||LX[NX(e)]},MX=Hn,xX=gi,UX=oi,FX=nu,VX=v_,jX=TypeError,sR=function(e,t){var n=arguments.length<2?VX(e):t;if(xX(n))return UX(MX(n,e));throw new jX(FX(e)+" is not iterable")},BX=Hn,ML=oi,HX=jp,xL=function(e,t,n){var r,i;ML(e);try{if(!(r=HX(e,"return"))){if(t==="throw")throw n;return n}r=BX(r,e)}catch(c){i=!0,r=c}if(t==="throw")throw n;if(i)throw r;return ML(r),n},GX=sc,WX=Hn,qX=oi,zX=nu,KX=LL,YX=ac,UL=B,$X=sR,XX=v_,FL=xL,JX=TypeError,y_=function(e,t){this.stopped=e,this.result=t},VL=y_.prototype,Kp=function(e,t,n){var r,i,c,l,u,h,f,m=n&&n.that,E=!(!n||!n.AS_ENTRIES),_=!(!n||!n.IS_RECORD),y=!(!n||!n.IS_ITERATOR),A=!(!n||!n.INTERRUPTED),C=GX(t,m),I=function(L){return r&&FL(r,"normal"),new y_(!0,L)},N=function(L){return E?(qX(L),A?C(L[0],L[1],I):C(L[0],L[1])):A?C(L,I):C(L)};if(_)r=e.iterator;else if(y)r=e;else{if(!(i=XX(e)))throw new JX(zX(e)+" is not iterable");if(KX(i)){for(c=0,l=YX(e);l>c;c++)if((u=N(e[c]))&&UL(VL,u))return u;return new y_(!1)}r=$X(e,i)}for(h=_?e.next:r.next;!(f=WX(h,r)).done;){try{u=N(f.value)}catch(L){FL(r,"throw",L)}if(typeof u=="object"&&u&&UL(VL,u))return u}return new y_(!1)},ZX=si,QX=st,eJ=B,tJ=QC,S_=W7,nJ=function(e,t,n){for(var r=nX(t),i=iX.f,c=rX.f,l=0;l<r.length;l++){var u=r[l];RL(e,u)||n&&RL(n,u)||i(e,u,c(t,u))}},jL=zp,aR=dd,cR=rc,rJ=function(e,t){EX(t)&&"cause"in t&&vX(e,"cause",t.cause)},iJ=function(e,t,n,r){wX&&(PL?PL(e,t):IX(e,"stack",bX(n,r)))},oJ=Kp,sJ=function(e,t){return e===void 0?arguments.length<2?"":t:ZX(e)},aJ=un("toStringTag"),T_=Error,cJ=[].push,cu=function(e,t){var n,r=eJ(dR,this);S_?n=S_(new T_,r?tJ(this):dR):(n=r?this:jL(dR),aR(n,aJ,"Error")),t!==void 0&&aR(n,"message",sJ(t)),iJ(n,cu,n.stack,1),arguments.length>2&&rJ(n,arguments[2]);var i=[];return oJ(e,cJ,{that:i}),aR(n,"errors",i),n};S_?S_(cu,T_):nJ(cu,T_,{name:!0});var dR=cu.prototype=jL(T_.prototype,{constructor:cR(1,cu),message:cR(1,""),name:cR(1,"AggregateError")});QX({global:!0,constructor:!0,arity:2},{AggregateError:cu});var C_,Yp,R_,dJ=Mn,BL=ee.WeakMap,lJ=dJ(BL)&&/native code/.test(String(BL)),HL=ee,uJ=Er,hJ=dd,lR=Qn,uR=PC,pJ=p_,fJ=m_,GL="Object already initialized",hR=HL.TypeError,mJ=HL.WeakMap;if(lJ||uR.state){var Is=uR.state||(uR.state=new mJ);Is.get=Is.get,Is.has=Is.has,Is.set=Is.set,C_=function(e,t){if(Is.has(e))throw new hR(GL);return t.facade=e,Is.set(e,t),t},Yp=function(e){return Is.get(e)||{}},R_=function(e){return Is.has(e)}}else{var du=pJ("state");fJ[du]=!0,C_=function(e,t){if(lR(e,du))throw new hR(GL);return t.facade=e,hJ(e,du,t),t},Yp=function(e){return lR(e,du)?e[du]:{}},R_=function(e){return lR(e,du)}}var ld,WL,qL,ud={set:C_,get:Yp,has:R_,enforce:function(e){return R_(e)?Yp(e):C_(e,{})},getterFor:function(e){return function(t){var n;if(!uJ(t)||(n=Yp(t)).type!==e)throw new hR("Incompatible receiver, "+e+" required");return n}}},pR=zr,gJ=Qn,zL=Function.prototype,_J=pR&&Object.getOwnPropertyDescriptor,fR=gJ(zL,"name"),KL={EXISTS:fR,PROPER:fR&&(function(){}).name==="something",CONFIGURABLE:fR&&(!pR||pR&&_J(zL,"name").configurable)},EJ=dd,dc=function(e,t,n,r){return r&&r.enumerable?e[t]=n:EJ(e,t,n),e},vJ=d,yJ=Mn,SJ=Er,TJ=zp,YL=QC,CJ=dc,mR=un("iterator"),$L=!1;[].keys&&("next"in(qL=[].keys())?(WL=YL(YL(qL)))!==Object.prototype&&(ld=WL):$L=!0);var RJ=!SJ(ld)||vJ(function(){var e={};return ld[mR].call(e)!==e});yJ((ld=RJ?{}:TJ(ld))[mR])||CJ(ld,mR,function(){return this});var XL={IteratorPrototype:ld,BUGGY_SAFARI_ITERATORS:$L},IJ=cc,bJ=zC?{}.toString:function(){return"[object "+IJ(this)+"]"},wJ=zC,AJ=lo.f,DJ=dd,OJ=Qn,NJ=bJ,JL=un("toStringTag"),ma=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(OJ(i,JL)||AJ(i,JL,{configurable:!0,value:t}),r&&!wJ&&DJ(i,"toString",NJ))},PJ=XL.IteratorPrototype,LJ=zp,kJ=rc,MJ=ma,xJ=au,UJ=function(){return this},gR=function(e,t,n,r){var i=t+" Iterator";return e.prototype=LJ(PJ,{next:kJ(+!r,n)}),MJ(e,i,!1,!0),xJ[i]=UJ,e},FJ=st,VJ=Hn,jJ=KL,BJ=gR,HJ=QC,GJ=ma,ZL=dc,QL=au,WJ=XL,qJ=jJ.PROPER,I_=WJ.BUGGY_SAFARI_ITERATORS,_R=un("iterator"),ek="keys",b_="values",tk="entries",zJ=function(){return this},nk=function(e,t,n,r,i,c,l){BJ(n,t,r);var u,h,f,m=function(N){if(N===i&&C)return C;if(!I_&&N&&N in y)return y[N];switch(N){case ek:case b_:case tk:return function(){return new n(this,N)}}return function(){return new n(this)}},E=t+" Iterator",_=!1,y=e.prototype,A=y[_R]||y["@@iterator"]||i&&y[i],C=!I_&&A||m(i),I=t==="Array"&&y.entries||A;if(I&&(u=HJ(I.call(new e)))!==Object.prototype&&u.next&&(GJ(u,E,!0,!0),QL[E]=zJ),qJ&&i===b_&&A&&A.name!==b_&&(_=!0,C=function(){return VJ(A,this)}),i)if(h={values:m(b_),keys:c?C:m(ek),entries:m(tk)},l)for(f in h)(I_||_||!(f in y))&&ZL(y,f,h[f]);else FJ({target:t,proto:!0,forced:I_||_},h);return l&&y[_R]!==C&&ZL(y,_R,C,{name:i}),QL[t]=C,h},w_=function(e,t){return{value:e,done:t}},KJ=oc,rk=au,ik=ud;lo.f;var YJ=nk,A_=w_,ok="Array Iterator",$J=ik.set,XJ=ik.getterFor(ok);YJ(Array,"Array",function(e,t){$J(this,{type:ok,target:KJ(e),index:0,kind:t})},function(){var e=XJ(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,A_(void 0,!0);switch(e.kind){case"keys":return A_(n,!1);case"values":return A_(t[n],!1)}return A_([n,t[n]],!1)},"values"),rk.Arguments=rk.Array;var JJ=lo,D_=function(e,t,n){return JJ.f(e,t,n)},ZJ=Nr,QJ=D_,eZ=zr,sk=un("species"),tZ=B,nZ=TypeError,ER=function(e,t){if(tZ(t,e))return e;throw new nZ("Incorrect invocation")},rZ=Mn,vR=PC,iZ=x(Function.toString);rZ(vR.inspectSource)||(vR.inspectSource=function(e){return iZ(e)});var ak=vR.inspectSource,oZ=x,sZ=d,ck=Mn,aZ=cc,cZ=ak,dk=function(){},lk=Nr("Reflect","construct"),yR=/^\s*(?:class|function)\b/,dZ=oZ(yR.exec),lZ=!yR.test(dk),$p=function(e){if(!ck(e))return!1;try{return lk(dk,[],e),!0}catch{return!1}},uk=function(e){if(!ck(e))return!1;switch(aZ(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return lZ||!!dZ(yR,cZ(e))}catch{return!0}};uk.sham=!0;var Xp,lu,hk,SR,O_=!lk||sZ(function(){var e;return $p($p.call)||!$p(Object)||!$p(function(){e=!0})||e})?uk:$p,uZ=O_,hZ=nu,pZ=TypeError,pk=oi,fZ=function(e){if(uZ(e))return e;throw new pZ(hZ(e)+" is not a constructor")},mZ=a_,gZ=un("species"),TR=function(e,t){var n,r=pk(e).constructor;return r===void 0||mZ(n=pk(r)[gZ])?t:fZ(n)},lc=x([].slice),_Z=TypeError,hd=function(e,t){if(e<t)throw new _Z("Not enough arguments");return e},fk=/(?:ipad|iphone|ipod).*applewebkit/i.test(fa),Fi=ee,EZ=Oe,vZ=sc,mk=Mn,yZ=Qn,gk=d,_k=IL,SZ=lc,Ek=UC,TZ=hd,CZ=fk,RZ=h_,CR=Fi.setImmediate,RR=Fi.clearImmediate,IZ=Fi.process,IR=Fi.Dispatch,bZ=Fi.Function,vk=Fi.MessageChannel,wZ=Fi.String,bR=0,Jp={},yk="onreadystatechange";gk(function(){Xp=Fi.location});var wR=function(e){if(yZ(Jp,e)){var t=Jp[e];delete Jp[e],t()}},AR=function(e){return function(){wR(e)}},Sk=function(e){wR(e.data)},Tk=function(e){Fi.postMessage(wZ(e),Xp.protocol+"//"+Xp.host)};CR&&RR||(CR=function(e){TZ(arguments.length,1);var t=mk(e)?e:bZ(e),n=SZ(arguments,1);return Jp[++bR]=function(){EZ(t,void 0,n)},lu(bR),bR},RR=function(e){delete Jp[e]},RZ?lu=function(e){IZ.nextTick(AR(e))}:IR&&IR.now?lu=function(e){IR.now(AR(e))}:vk&&!CZ?(SR=(hk=new vk).port2,hk.port1.onmessage=Sk,lu=vZ(SR.postMessage,SR)):Fi.addEventListener&&mk(Fi.postMessage)&&!Fi.importScripts&&Xp&&Xp.protocol!=="file:"&&!gk(Tk)?(lu=Tk,Fi.addEventListener("message",Sk,!1)):lu=yk in Ek("script")?function(e){_k.appendChild(Ek("script"))[yk]=function(){_k.removeChild(this),wR(e)}}:function(e){setTimeout(AR(e),0)});var N_={set:CR,clear:RR},Ck=ee,AZ=zr,DZ=Object.getOwnPropertyDescriptor,Rk=function(e){if(!AZ)return Ck[e];var t=DZ(Ck,e);return t&&t.value},Ik=function(){this.head=null,this.tail=null};Ik.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var uu,DR,OR,NR,bk,wk=Ik,OZ=/ipad|iphone|ipod/i.test(fa)&&typeof Pebble<"u",NZ=/web0s(?!.*chrome)/i.test(fa),hu=ee,PZ=Rk,Ak=sc,PR=N_.set,LZ=wk,kZ=fk,MZ=OZ,xZ=NZ,LR=h_,Dk=hu.MutationObserver||hu.WebKitMutationObserver,Ok=hu.document,Nk=hu.process,P_=hu.Promise,kR=PZ("queueMicrotask");if(!kR){var L_=new LZ,k_=function(){var e,t;for(LR&&(e=Nk.domain)&&e.exit();t=L_.get();)try{t()}catch(n){throw L_.head&&uu(),n}e&&e.enter()};kZ||LR||xZ||!Dk||!Ok?!MZ&&P_&&P_.resolve?((NR=P_.resolve(void 0)).constructor=P_,bk=Ak(NR.then,NR),uu=function(){bk(k_)}):LR?uu=function(){Nk.nextTick(k_)}:(PR=Ak(PR,hu),uu=function(){PR(k_)}):(DR=!0,OR=Ok.createTextNode(""),new Dk(k_).observe(OR,{characterData:!0}),uu=function(){OR.data=DR=!DR}),kR=function(e){L_.head||uu(),L_.add(e)}}var Pk=kR,pu=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},pd=ee.Promise,UZ=ee,Zp=pd,FZ=Mn,VZ=iL,jZ=ak,BZ=un,Lk=$C,MR=cd,kk=Zp&&Zp.prototype,HZ=BZ("species"),Mk=!1,xk=FZ(UZ.PromiseRejectionEvent),GZ=VZ("Promise",function(){var e=jZ(Zp),t=e!==String(Zp);if(!t&&MR===66||!kk.catch||!kk.finally)return!0;if(!MR||MR<51||!/native code/.test(e)){var n=new Zp(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[HZ]=r,!(Mk=n.then(function(){})instanceof r))return!0}return!(t||Lk!=="BROWSER"&&Lk!=="DENO"||xk)}),Qp={CONSTRUCTOR:GZ,REJECTION_EVENT:xk,SUBCLASSING:Mk},bs={},Uk=gi,WZ=TypeError,qZ=function(e){var t,n;this.promise=new e(function(r,i){if(t!==void 0||n!==void 0)throw new WZ("Bad Promise constructor");t=r,n=i}),this.resolve=Uk(t),this.reject=Uk(n)};bs.f=function(e){return new qZ(e)};var xR,Fk,Vk,zZ=st,M_=h_,uc=ee,KZ=mi,ef=Hn,YZ=dc,$Z=ma,XZ=function(e){var t=ZJ(e);eZ&&t&&!t[sk]&&QJ(t,sk,{configurable:!0,get:function(){return this}})},JZ=gi,UR=Mn,ZZ=Er,QZ=ER,eQ=TR,jk=N_.set,FR=Pk,tQ=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},nQ=pu,rQ=wk,Bk=ud,VR=pd,Hk=Qp,Gk=bs,x_="Promise",Wk=Hk.CONSTRUCTOR,iQ=Hk.REJECTION_EVENT,jR=Bk.getterFor(x_),oQ=Bk.set,sQ=VR&&VR.prototype,tf=VR,BR=sQ,qk=uc.TypeError,HR=uc.document,GR=uc.process,WR=Gk.f,aQ=WR,cQ=!!(HR&&HR.createEvent&&uc.dispatchEvent),zk="unhandledrejection",Kk=function(e){var t;return!(!ZZ(e)||!UR(t=e.then))&&t},Yk=function(e,t){var n,r,i,c=t.value,l=t.state===1,u=l?e.ok:e.fail,h=e.resolve,f=e.reject,m=e.domain;try{u?(l||(t.rejection===2&&lQ(t),t.rejection=1),u===!0?n=c:(m&&m.enter(),n=u(c),m&&(m.exit(),i=!0)),n===e.promise?f(new qk("Promise-chain cycle")):(r=Kk(n))?ef(r,n,h,f):h(n)):f(c)}catch(E){m&&!i&&m.exit(),f(E)}},$k=function(e,t){e.notified||(e.notified=!0,FR(function(){for(var n,r=e.reactions;n=r.get();)Yk(n,e);e.notified=!1,t&&!e.rejection&&dQ(e)}))},Xk=function(e,t,n){var r,i;cQ?((r=HR.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),uc.dispatchEvent(r)):r={promise:t,reason:n},!iQ&&(i=uc["on"+e])?i(r):e===zk&&tQ("Unhandled promise rejection",n)},dQ=function(e){ef(jk,uc,function(){var t,n=e.facade,r=e.value;if(Jk(e)&&(t=nQ(function(){M_?GR.emit("unhandledRejection",r,n):Xk(zk,n,r)}),e.rejection=M_||Jk(e)?2:1,t.error))throw t.value})},Jk=function(e){return e.rejection!==1&&!e.parent},lQ=function(e){ef(jk,uc,function(){var t=e.facade;M_?GR.emit("rejectionHandled",t):Xk("rejectionhandled",t,e.value)})},fu=function(e,t,n){return function(r){e(t,r,n)}},mu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,$k(e,!0))},qR=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new qk("Promise can't be resolved itself");var r=Kk(t);r?FR(function(){var i={done:!1};try{ef(r,t,fu(qR,i,e),fu(mu,i,e))}catch(c){mu(i,c,e)}}):(e.value=t,e.state=1,$k(e,!1))}catch(i){mu({done:!1},i,e)}}};Wk&&(BR=(tf=function(e){QZ(this,BR),JZ(e),ef(xR,this);var t=jR(this);try{e(fu(qR,t),fu(mu,t))}catch(n){mu(t,n)}}).prototype,(xR=function(e){oQ(this,{type:x_,done:!1,notified:!1,parent:!1,reactions:new rQ,rejection:!1,state:0,value:null})}).prototype=YZ(BR,"then",function(e,t){var n=jR(this),r=WR(eQ(this,tf));return n.parent=!0,r.ok=!UR(e)||e,r.fail=UR(t)&&t,r.domain=M_?GR.domain:void 0,n.state===0?n.reactions.add(r):FR(function(){Yk(r,n)}),r.promise}),Fk=function(){var e=new xR,t=jR(e);this.promise=e,this.resolve=fu(qR,t),this.reject=fu(mu,t)},Gk.f=WR=function(e){return e===tf||e===Vk?new Fk(e):aQ(e)}),zZ({global:!0,constructor:!0,wrap:!0,forced:Wk},{Promise:tf}),Vk=KZ.Promise,$Z(tf,x_,!1,!0),XZ(x_);var Zk=un("iterator"),Qk=!1;try{var uQ=0,eM={next:function(){return{done:!!uQ++}},return:function(){Qk=!0}};eM[Zk]=function(){return this},Array.from(eM,function(){throw 2})}catch{}var hQ=pd,pQ=function(e,t){try{if(!t&&!Qk)return!1}catch{return!1}var n=!1;try{var r={};r[Zk]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},U_=Qp.CONSTRUCTOR||!pQ(function(e){hQ.all(e).then(void 0,function(){})}),fQ=Hn,mQ=gi,gQ=bs,_Q=pu,EQ=Kp;st({target:"Promise",stat:!0,forced:U_},{all:function(e){var t=this,n=gQ.f(t),r=n.resolve,i=n.reject,c=_Q(function(){var l=mQ(t.resolve),u=[],h=0,f=1;EQ(e,function(m){var E=h++,_=!1;f++,fQ(l,t,m).then(function(y){_||(_=!0,u[E]=y,--f||r(u))},i)}),--f||r(u)});return c.error&&i(c.value),n.promise}});var vQ=st,yQ=Qp.CONSTRUCTOR;pd&&pd.prototype,vQ({target:"Promise",proto:!0,forced:yQ,real:!0},{catch:function(e){return this.then(void 0,e)}});var SQ=Hn,TQ=gi,CQ=bs,RQ=pu,IQ=Kp;st({target:"Promise",stat:!0,forced:U_},{race:function(e){var t=this,n=CQ.f(t),r=n.reject,i=RQ(function(){var c=TQ(t.resolve);IQ(e,function(l){SQ(c,t,l).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var bQ=bs;st({target:"Promise",stat:!0,forced:Qp.CONSTRUCTOR},{reject:function(e){var t=bQ.f(this);return(0,t.reject)(e),t.promise}});var wQ=oi,AQ=Er,DQ=bs,tM=function(e,t){if(wQ(e),AQ(t)&&t.constructor===e)return t;var n=DQ.f(e);return(0,n.resolve)(t),n.promise},OQ=st,NQ=pd,PQ=Qp.CONSTRUCTOR,LQ=tM,kQ=Nr("Promise"),MQ=!PQ;OQ({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return LQ(MQ&&this===kQ?NQ:this,e)}});var xQ=Hn,UQ=gi,FQ=bs,VQ=pu,jQ=Kp;st({target:"Promise",stat:!0,forced:U_},{allSettled:function(e){var t=this,n=FQ.f(t),r=n.resolve,i=n.reject,c=VQ(function(){var l=UQ(t.resolve),u=[],h=0,f=1;jQ(e,function(m){var E=h++,_=!1;f++,xQ(l,t,m).then(function(y){_||(_=!0,u[E]={status:"fulfilled",value:y},--f||r(u))},function(y){_||(_=!0,u[E]={status:"rejected",reason:y},--f||r(u))})}),--f||r(u)});return c.error&&i(c.value),n.promise}});var BQ=Hn,HQ=gi,GQ=Nr,WQ=bs,qQ=pu,zQ=Kp,nM="No one promise resolved";st({target:"Promise",stat:!0,forced:U_},{any:function(e){var t=this,n=GQ("AggregateError"),r=WQ.f(t),i=r.resolve,c=r.reject,l=qQ(function(){var u=HQ(t.resolve),h=[],f=0,m=1,E=!1;zQ(e,function(_){var y=f++,A=!1;m++,BQ(u,t,_).then(function(C){A||E||(E=!0,i(C))},function(C){A||E||(A=!0,h[y]=C,--m||c(new n(h,nM)))})}),--m||c(new n(h,nM))});return l.error&&c(l.value),r.promise}});var KQ=st,YQ=Oe,$Q=lc,XQ=bs,JQ=gi,rM=pu,zR=ee.Promise,iM=!1;KQ({target:"Promise",stat:!0,forced:!zR||!zR.try||rM(function(){zR.try(function(e){iM=e===8},8)}).error||!iM},{try:function(e){var t=arguments.length>1?$Q(arguments,1):[],n=XQ.f(this),r=rM(function(){return YQ(JQ(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var ZQ=bs;st({target:"Promise",stat:!0},{withResolvers:function(){var e=ZQ.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var QQ=st,KR=pd,eee=d,tee=Nr,nee=Mn,ree=TR,oM=tM,iee=KR&&KR.prototype;QQ({target:"Promise",proto:!0,real:!0,forced:!!KR&&eee(function(){iee.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=ree(this,tee("Promise")),n=nee(e);return this.then(n?function(r){return oM(t,e()).then(function(){return r})}:e,n?function(r){return oM(t,e()).then(function(){throw r})}:e)}});var YR=x,oee=HC,see=si,aee=ic,cee=YR("".charAt),sM=YR("".charCodeAt),dee=YR("".slice),aM=function(e){return function(t,n){var r,i,c=see(aee(t)),l=oee(n),u=c.length;return l<0||l>=u?e?"":void 0:(r=sM(c,l))<55296||r>56319||l+1===u||(i=sM(c,l+1))<56320||i>57343?e?cee(c,l):r:e?dee(c,l,l+2):i-56320+(r-55296<<10)+65536}},$R={codeAt:aM(!1),charAt:aM(!0)},lee=$R.charAt,uee=si,cM=ud,hee=nk,dM=w_,lM="String Iterator",pee=cM.set,fee=cM.getterFor(lM);hee(String,"String",function(e){pee(this,{type:lM,string:uee(e),index:0})},function(){var e,t=fee(this),n=t.string,r=t.index;return r>=n.length?dM(void 0,!0):(e=lee(n,r),t.index+=e.length,dM(e,!1))});var mee=mi.Promise,gee={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},_ee=ee,Eee=ma,uM=au;for(var XR in gee)Eee(_ee[XR],XR),uM[XR]=uM.Array;var hM=mee,ie=a(hM),vee=xi("Array","values"),yee=cc,See=Qn,Tee=B,Cee=vee,JR=Array.prototype,Ree={DOMTokenList:!0,NodeList:!0},Iee=function(e){var t=e.values;return e===JR||Tee(JR,e)&&t===JR.values||See(Ree,yee(e))?Cee:t},ai=a(Iee),pM=nu,bee=TypeError,fM=lc,wee=Math.floor,ZR=function(e,t){var n=e.length;if(n<8)for(var r,i,c=1;c<n;){for(i=c,r=e[c];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==c++&&(e[i]=r)}else for(var l=wee(n/2),u=ZR(fM(e,0,l),t),h=ZR(fM(e,l),t),f=u.length,m=h.length,E=0,_=0;E<f||_<m;)e[E+_]=E<f&&_<m?t(u[E],h[_])<=0?u[E++]:h[_++]:E<f?u[E++]:h[_++];return e},mM=ZR,gM=fa.match(/firefox\/(\d+)/i),Aee=!!gM&&+gM[1],Dee=/MSIE|Trident/.test(fa),_M=fa.match(/AppleWebKit\/(\d+)\./),Oee=!!_M&&+_M[1],Nee=st,EM=x,Pee=gi,Lee=jo,vM=ac,kee=function(e,t){if(!delete e[t])throw new bee("Cannot delete property "+pM(t)+" of "+pM(e))},yM=si,QR=d,Mee=mM,xee=l_,SM=Aee,Uee=Dee,TM=cd,CM=Oee,hc=[],RM=EM(hc.sort),Fee=EM(hc.push),Vee=QR(function(){hc.sort(void 0)}),jee=QR(function(){hc.sort(null)}),Bee=xee("sort"),IM=!QR(function(){if(TM)return TM<70;if(!(SM&&SM>3)){if(Uee)return!0;if(CM)return CM<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)hc.push({k:t+r,v:n})}for(hc.sort(function(c,l){return l.v-c.v}),r=0;r<hc.length;r++)t=hc[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});Nee({target:"Array",proto:!0,forced:Vee||!jee||!Bee||!IM},{sort:function(e){e!==void 0&&Pee(e);var t=Lee(this);if(IM)return e===void 0?RM(t):RM(t,e);var n,r,i=[],c=vM(t);for(r=0;r<c;r++)r in t&&Fee(i,t[r]);for(Mee(i,(function(l){return function(u,h){return h===void 0?-1:u===void 0?1:l!==void 0?+l(u,h)||0:yM(u)>yM(h)?1:-1}})(e)),n=vM(i),r=0;r<n;)t[r]=i[r++];for(;r<c;)kee(t,r++);return t}});var Hee=xi("Array","sort"),Gee=B,Wee=Hee,eI=Array.prototype,qee=function(e){var t=e.sort;return e===eI||Gee(eI,e)&&t===eI.sort?Wee:t},fd=a(qee),zee=st,Kee=x,Yee=GC,$ee=RangeError,bM=String.fromCharCode,wM=String.fromCodePoint,Xee=Kee([].join);zee({target:"String",stat:!0,arity:1,forced:!!wM&&wM.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],Yee(t,1114111)!==t)throw new $ee(t+" is not a valid code point");n[i]=t<65536?bM(t):bM(55296+((t-=65536)>>10),t%1024+56320)}return Xee(n,"")}});var Jee=d,Zee=un("iterator"),F_=!Jee(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(i,c){t.delete("b"),r+=c+i}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[Zee]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("https://a#\u0431").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Qee=dc,tI=st,AM=ee,nI=Rk,ete=Nr,V_=Hn,Bo=x,nf=zr,DM=F_,OM=dc,tte=D_,nte=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:Qee(e,r,t[r],n);return e},rte=ma,ite=gR,rI=ud,NM=ER,iI=Mn,ote=Qn,ste=sc,ate=cc,cte=oi,PM=Er,ci=si,dte=zp,LM=rc,kM=sR,lte=v_,j_=w_,gu=hd,ute=mM,hte=un("iterator"),_u="URLSearchParams",MM=_u+"Iterator",xM=rI.set,uo=rI.getterFor(_u),pte=rI.getterFor(MM),UM=nI("fetch"),B_=nI("Request"),rf=nI("Headers"),oI=B_&&B_.prototype,FM=rf&&rf.prototype,fte=AM.TypeError,mte=AM.encodeURIComponent,gte=String.fromCharCode,_te=ete("String","fromCodePoint"),Ete=parseInt,H_=Bo("".charAt),VM=Bo([].join),pc=Bo([].push),jM=Bo("".replace),vte=Bo([].shift),BM=Bo([].splice),HM=Bo("".split),GM=Bo("".slice),yte=Bo(/./.exec),Ste=/\+/g,Tte=/^[0-9a-f]+$/i,WM=function(e,t){var n=GM(e,t,t+2);return yte(Tte,n)?Ete(n,16):NaN},Cte=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},Rte=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},qM=function(e){for(var t=(e=jM(e,Ste," ")).length,n="",r=0;r<t;){var i=H_(e,r);if(i==="%"){if(H_(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var c=WM(e,r+1);if(c!=c){n+=i,r++;continue}r+=2;var l=Cte(c);if(l===0)i=gte(c);else{if(l===1||l>4){n+="\uFFFD",r++;continue}for(var u=[c],h=1;h<l&&!(++r+3>t||H_(e,r)!=="%");){var f=WM(e,r+1);if(f!=f){r+=3;break}if(f>191||f<128)break;pc(u,f),r+=2,h++}if(u.length!==l){n+="\uFFFD";continue}var m=Rte(u);m===null?n+="\uFFFD":i=_te(m)}}n+=i,r++}return n},Ite=/[!'()~]|%20/g,bte={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},wte=function(e){return bte[e]},zM=function(e){return jM(mte(e),Ite,wte)},sI=ite(function(e,t){xM(this,{type:MM,target:uo(e).entries,index:0,kind:t})},_u,function(){var e=pte(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,j_(void 0,!0);var r=t[n];switch(e.kind){case"keys":return j_(r.key,!1);case"values":return j_(r.value,!1)}return j_([r.key,r.value],!1)},!0),KM=function(e){this.entries=[],this.url=null,e!==void 0&&(PM(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?H_(e,0)==="?"?GM(e,1):e:ci(e)))};KM.prototype={type:_u,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,c,l,u,h=this.entries,f=lte(e);if(f)for(n=(t=kM(e,f)).next;!(r=V_(n,t)).done;){if(c=(i=kM(cte(r.value))).next,(l=V_(c,i)).done||(u=V_(c,i)).done||!V_(c,i).done)throw new fte("Expected sequence with length 2");pc(h,{key:ci(l.value),value:ci(u.value)})}else for(var m in e)ote(e,m)&&pc(h,{key:m,value:ci(e[m])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=HM(e,"&"),c=0;c<i.length;)(t=i[c++]).length&&(n=HM(t,"="),pc(r,{key:qM(vte(n)),value:qM(VM(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],pc(n,zM(e.key)+"="+zM(e.value));return VM(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var G_=function(){NM(this,Eu);var e=xM(this,new KM(arguments.length>0?arguments[0]:void 0));nf||(this.size=e.entries.length)},Eu=G_.prototype;if(nte(Eu,{append:function(e,t){var n=uo(this);gu(arguments.length,2),pc(n.entries,{key:ci(e),value:ci(t)}),nf||this.length++,n.updateURL()},delete:function(e){for(var t=uo(this),n=gu(arguments.length,1),r=t.entries,i=ci(e),c=n<2?void 0:arguments[1],l=c===void 0?c:ci(c),u=0;u<r.length;){var h=r[u];if(h.key!==i||l!==void 0&&h.value!==l)u++;else if(BM(r,u,1),l!==void 0)break}nf||(this.size=r.length),t.updateURL()},get:function(e){var t=uo(this).entries;gu(arguments.length,1);for(var n=ci(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=uo(this).entries;gu(arguments.length,1);for(var n=ci(e),r=[],i=0;i<t.length;i++)t[i].key===n&&pc(r,t[i].value);return r},has:function(e){for(var t=uo(this).entries,n=gu(arguments.length,1),r=ci(e),i=n<2?void 0:arguments[1],c=i===void 0?i:ci(i),l=0;l<t.length;){var u=t[l++];if(u.key===r&&(c===void 0||u.value===c))return!0}return!1},set:function(e,t){var n=uo(this);gu(arguments.length,1);for(var r,i=n.entries,c=!1,l=ci(e),u=ci(t),h=0;h<i.length;h++)(r=i[h]).key===l&&(c?BM(i,h--,1):(c=!0,r.value=u));c||pc(i,{key:l,value:u}),nf||(this.size=i.length),n.updateURL()},sort:function(){var e=uo(this);ute(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=uo(this).entries,r=ste(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new sI(this,"keys")},values:function(){return new sI(this,"values")},entries:function(){return new sI(this,"entries")}},{enumerable:!0}),OM(Eu,hte,Eu.entries,{name:"entries"}),OM(Eu,"toString",function(){return uo(this).serialize()},{enumerable:!0}),nf&&tte(Eu,"size",{get:function(){return uo(this).entries.length},configurable:!0,enumerable:!0}),rte(G_,_u),tI({global:!0,constructor:!0,forced:!DM},{URLSearchParams:G_}),!DM&&iI(rf)){var Ate=Bo(FM.has),Dte=Bo(FM.set),YM=function(e){if(PM(e)){var t,n=e.body;if(ate(n)===_u)return t=e.headers?new rf(e.headers):new rf,Ate(t,"content-type")||Dte(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),dte(e,{body:LM(0,ci(n)),headers:LM(0,t)})}return e};if(iI(UM)&&tI({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return UM(e,arguments.length>1?YM(arguments[1]):{})}}),iI(B_)){var aI=function(e){return NM(this,oI),new B_(e,arguments.length>1?YM(arguments[1]):{})};oI.constructor=aI,aI.prototype=oI,tI({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:aI})}}var ho,Ote={URLSearchParams:G_,getState:uo},Nte=mi.URLSearchParams,$M=zr,Pte=x,Lte=Hn,kte=d,cI=g_,Mte=qp,xte=i_,Ute=jo,Fte=s_,vu=Object.assign,XM=Object.defineProperty,Vte=Pte([].concat),jte=!vu||kte(function(){if($M&&vu({b:1},vu(XM({},"a",{enumerable:!0,get:function(){XM(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(i){t[i]=i}),vu({},e)[n]!==7||cI(vu({},t)).join("")!==r})?function(e,t){for(var n=Ute(e),r=arguments.length,i=1,c=Mte.f,l=xte.f;r>i;)for(var u,h=Fte(arguments[i++]),f=c?Vte(cI(h),c(h)):cI(h),m=f.length,E=0;m>E;)u=f[E++],$M&&!Lte(l,h,u)||(n[u]=h[u]);return n}:vu,Bte=oi,Hte=xL,Gte=zr,Wte=lo,qte=rc,dI=function(e,t,n){Gte?Wte.f(e,t,qte(0,n)):e[t]=n},zte=sc,Kte=Hn,Yte=jo,$te=function(e,t,n,r){try{return r?t(Bte(n)[0],n[1]):t(n)}catch(i){Hte(e,"throw",i)}},Xte=LL,Jte=O_,Zte=ac,JM=dI,Qte=sR,ene=v_,ZM=Array,md=x,lI=2147483647,tne=/[^\0-\u007E]/,QM=/[.\u3002\uFF0E\uFF61]/g,e1="Overflow: input needs wider integers to process",t1=RangeError,nne=md(QM.exec),yu=Math.floor,uI=String.fromCharCode,n1=md("".charCodeAt),r1=md([].join),fc=md([].push),rne=md("".replace),ine=md("".split),one=md("".toLowerCase),i1=function(e){return e+22+75*(e<26)},sne=function(e,t,n){var r=0;for(e=n?yu(e/700):e>>1,e+=yu(e/t);e>455;)e=yu(e/35),r+=36;return yu(r+36*e/(e+38))},ane=function(e){var t=[];e=(function(N){for(var L=[],M=0,V=N.length;M<V;){var j=n1(N,M++);if(j>=55296&&j<=56319&&M<V){var U=n1(N,M++);(64512&U)==56320?fc(L,((1023&j)<<10)+(1023&U)+65536):(fc(L,j),M--)}else fc(L,j)}return L})(e);var n,r,i=e.length,c=128,l=0,u=72;for(n=0;n<e.length;n++)(r=e[n])<128&&fc(t,uI(r));var h=t.length,f=h;for(h&&fc(t,"-");f<i;){var m=lI;for(n=0;n<e.length;n++)(r=e[n])>=c&&r<m&&(m=r);var E=f+1;if(m-c>yu((lI-l)/E))throw new t1(e1);for(l+=(m-c)*E,c=m,n=0;n<e.length;n++){if((r=e[n])<c&&++l>lI)throw new t1(e1);if(r===c){for(var _=l,y=36;;){var A=y<=u?1:y>=u+26?26:y-u;if(_<A)break;var C=_-A,I=36-A;fc(t,uI(i1(A+C%I))),_=yu(C/I),y+=36}fc(t,uI(i1(_))),u=sne(l,E,f===h),l=0,f++}}l++,c++}return r1(t,"")},cne=st,hI=zr,dne=F_,pI=ee,o1=sc,po=x,W_=dc,fo=D_,lne=ER,fI=Qn,mI=jte,Su=function(e){var t=Yte(e),n=Jte(this),r=arguments.length,i=r>1?arguments[1]:void 0,c=i!==void 0;c&&(i=zte(i,r>2?arguments[2]:void 0));var l,u,h,f,m,E,_=ene(t),y=0;if(!_||this===ZM&&Xte(_))for(l=Zte(t),u=n?new this(l):ZM(l);l>y;y++)E=c?i(t[y],y):t[y],JM(u,y,E);else for(u=n?new this:[],m=(f=Qte(t,_)).next;!(h=Kte(m,f)).done;y++)E=c?$te(f,i,[h.value,y],!0):h.value,JM(u,y,E);return u.length=y,u},Ho=lc,une=$R.codeAt,hne=function(e){var t,n,r=[],i=ine(rne(one(e),QM,"."),".");for(t=0;t<i.length;t++)n=i[t],fc(r,nne(tne,n)?"xn--"+ane(n):n);return r1(r,".")},ga=si,pne=ma,fne=hd,s1=Ote,a1=ud,mne=a1.set,q_=a1.getterFor("URL"),gne=s1.URLSearchParams,_ne=s1.getState,of=pI.URL,gI=pI.TypeError,z_=pI.parseInt,Ene=Math.floor,c1=Math.pow,mo=po("".charAt),Go=po(/./.exec),sf=po([].join),vne=po(1.1.toString),yne=po([].pop),Tu=po([].push),_I=po("".replace),Sne=po([].shift),Tne=po("".split),af=po("".slice),K_=po("".toLowerCase),Cne=po([].unshift),EI="Invalid scheme",gd="Invalid host",d1="Invalid port",l1=/[a-z]/i,Rne=/[\d+-.a-z]/i,vI=/\d/,Ine=/^0x/i,bne=/^[0-7]+$/,wne=/^\d+$/,u1=/^[\da-f]+$/i,Ane=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Dne=/[\0\t\n\r #/:<>?@[\\\]^|]/,One=/^[\u0000-\u0020]+/,Nne=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Pne=/[\t\n\r]/g,cf=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)Cne(t,e%256),e=Ene(e/256);return sf(t,".")}if(typeof e=="object"){for(t="",r=(function(c){for(var l=null,u=1,h=null,f=0,m=0;m<8;m++)c[m]!==0?(f>u&&(l=h,u=f),h=null,f=0):(h===null&&(h=m),++f);return f>u?h:l})(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=vne(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Y_={},h1=mI({},Y_,{" ":1,'"':1,"<":1,">":1,"`":1}),p1=mI({},h1,{"#":1,"?":1,"{":1,"}":1}),yI=mI({},p1,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),mc=function(e,t){var n=une(e,0);return n>32&&n<127&&!fI(t,e)?e:encodeURIComponent(e)},$_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},df=function(e,t){var n;return e.length===2&&Go(l1,mo(e,0))&&((n=mo(e,1))===":"||!t&&n==="|")},f1=function(e){var t;return e.length>1&&df(af(e,0,2))&&(e.length===2||(t=mo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Lne=function(e){return e==="."||K_(e)==="%2e"},SI={},m1={},TI={},g1={},_1={},CI={},E1={},v1={},X_={},J_={},RI={},II={},bI={},wI={},y1={},AI={},Cu={},ws={},S1={},_d={},_a={},DI=function(e,t,n){var r,i,c,l=ga(e);if(t){if(i=this.parse(l))throw new gI(i);this.searchParams=null}else{if(n!==void 0&&(r=new DI(n,!0)),i=this.parse(l,null,r))throw new gI(i);(c=_ne(new gne)).bindURL(this),this.searchParams=c}};DI.prototype={type:"URL",parse:function(e,t,n){var r,i,c,l,u,h=this,f=t||SI,m=0,E="",_=!1,y=!1,A=!1;for(e=ga(e),t||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,e=_I(e,One,""),e=_I(e,Nne,"$1")),e=_I(e,Pne,""),r=Su(e);m<=r.length;){switch(i=r[m],f){case SI:if(!i||!Go(l1,i)){if(t)return EI;f=TI;continue}E+=K_(i),f=m1;break;case m1:if(i&&(Go(Rne,i)||i==="+"||i==="-"||i==="."))E+=K_(i);else{if(i!==":"){if(t)return EI;E="",f=TI,m=0;continue}if(t&&(h.isSpecial()!==fI($_,E)||E==="file"&&(h.includesCredentials()||h.port!==null)||h.scheme==="file"&&!h.host))return;if(h.scheme=E,t)return void(h.isSpecial()&&$_[h.scheme]===h.port&&(h.port=null));E="",h.scheme==="file"?f=wI:h.isSpecial()&&n&&n.scheme===h.scheme?f=g1:h.isSpecial()?f=v1:r[m+1]==="/"?(f=_1,m++):(h.cannotBeABaseURL=!0,Tu(h.path,""),f=S1)}break;case TI:if(!n||n.cannotBeABaseURL&&i!=="#")return EI;if(n.cannotBeABaseURL&&i==="#"){h.scheme=n.scheme,h.path=Ho(n.path),h.query=n.query,h.fragment="",h.cannotBeABaseURL=!0,f=_a;break}f=n.scheme==="file"?wI:CI;continue;case g1:if(i!=="/"||r[m+1]!=="/"){f=CI;continue}f=X_,m++;break;case _1:if(i==="/"){f=J_;break}f=ws;continue;case CI:if(h.scheme=n.scheme,i===ho)h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=Ho(n.path),h.query=n.query;else if(i==="/"||i==="\\"&&h.isSpecial())f=E1;else if(i==="?")h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=Ho(n.path),h.query="",f=_d;else{if(i!=="#"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=Ho(n.path),h.path.length--,f=ws;continue}h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=Ho(n.path),h.query=n.query,h.fragment="",f=_a}break;case E1:if(!h.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,f=ws;continue}f=J_}else f=X_;break;case v1:if(f=X_,i!=="/"||mo(E,m+1)!=="/")continue;m++;break;case X_:if(i!=="/"&&i!=="\\"){f=J_;continue}break;case J_:if(i==="@"){_&&(E="%40"+E),_=!0,c=Su(E);for(var C=0;C<c.length;C++){var I=c[C];if(I!==":"||A){var N=mc(I,yI);A?h.password+=N:h.username+=N}else A=!0}E=""}else if(i===ho||i==="/"||i==="?"||i==="#"||i==="\\"&&h.isSpecial()){if(_&&E==="")return"Invalid authority";m-=Su(E).length+1,E="",f=RI}else E+=i;break;case RI:case II:if(t&&h.scheme==="file"){f=AI;continue}if(i!==":"||y){if(i===ho||i==="/"||i==="?"||i==="#"||i==="\\"&&h.isSpecial()){if(h.isSpecial()&&E==="")return gd;if(t&&E===""&&(h.includesCredentials()||h.port!==null))return;if(l=h.parseHost(E))return l;if(E="",f=Cu,t)return;continue}i==="["?y=!0:i==="]"&&(y=!1),E+=i}else{if(E==="")return gd;if(l=h.parseHost(E))return l;if(E="",f=bI,t===II)return}break;case bI:if(!Go(vI,i)){if(i===ho||i==="/"||i==="?"||i==="#"||i==="\\"&&h.isSpecial()||t){if(E!==""){var L=z_(E,10);if(L>65535)return d1;h.port=h.isSpecial()&&L===$_[h.scheme]?null:L,E=""}if(t)return;f=Cu;continue}return d1}E+=i;break;case wI:if(h.scheme="file",i==="/"||i==="\\")f=y1;else{if(!n||n.scheme!=="file"){f=ws;continue}switch(i){case ho:h.host=n.host,h.path=Ho(n.path),h.query=n.query;break;case"?":h.host=n.host,h.path=Ho(n.path),h.query="",f=_d;break;case"#":h.host=n.host,h.path=Ho(n.path),h.query=n.query,h.fragment="",f=_a;break;default:f1(sf(Ho(r,m),""))||(h.host=n.host,h.path=Ho(n.path),h.shortenPath()),f=ws;continue}}break;case y1:if(i==="/"||i==="\\"){f=AI;break}n&&n.scheme==="file"&&!f1(sf(Ho(r,m),""))&&(df(n.path[0],!0)?Tu(h.path,n.path[0]):h.host=n.host),f=ws;continue;case AI:if(i===ho||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&df(E))f=ws;else if(E===""){if(h.host="",t)return;f=Cu}else{if(l=h.parseHost(E))return l;if(h.host==="localhost"&&(h.host=""),t)return;E="",f=Cu}continue}E+=i;break;case Cu:if(h.isSpecial()){if(f=ws,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==ho&&(f=ws,i!=="/"))continue}else h.fragment="",f=_a;else h.query="",f=_d;break;case ws:if(i===ho||i==="/"||i==="\\"&&h.isSpecial()||!t&&(i==="?"||i==="#")){if((u=K_(u=E))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(h.shortenPath(),i==="/"||i==="\\"&&h.isSpecial()||Tu(h.path,"")):Lne(E)?i==="/"||i==="\\"&&h.isSpecial()||Tu(h.path,""):(h.scheme==="file"&&!h.path.length&&df(E)&&(h.host&&(h.host=""),E=mo(E,0)+":"),Tu(h.path,E)),E="",h.scheme==="file"&&(i===ho||i==="?"||i==="#"))for(;h.path.length>1&&h.path[0]==="";)Sne(h.path);i==="?"?(h.query="",f=_d):i==="#"&&(h.fragment="",f=_a)}else E+=mc(i,p1);break;case S1:i==="?"?(h.query="",f=_d):i==="#"?(h.fragment="",f=_a):i!==ho&&(h.path[0]+=mc(i,Y_));break;case _d:t||i!=="#"?i!==ho&&(i==="'"&&h.isSpecial()?h.query+="%27":h.query+=i==="#"?"%23":mc(i,Y_)):(h.fragment="",f=_a);break;case _a:i!==ho&&(h.fragment+=mc(i,h1))}m++}},parseHost:function(e){var t,n,r;if(mo(e,0)==="["){if(mo(e,e.length-1)!=="]"||(t=(function(i){var c,l,u,h,f,m,E,_=[0,0,0,0,0,0,0,0],y=0,A=null,C=0,I=function(){return mo(i,C)};if(I()===":"){if(mo(i,1)!==":")return;C+=2,A=++y}for(;I();){if(y===8)return;if(I()!==":"){for(c=l=0;l<4&&Go(u1,I());)c=16*c+z_(I(),16),C++,l++;if(I()==="."){if(l===0||(C-=l,y>6))return;for(u=0;I();){if(h=null,u>0){if(!(I()==="."&&u<4))return;C++}if(!Go(vI,I()))return;for(;Go(vI,I());){if(f=z_(I(),10),h===null)h=f;else{if(h===0)return;h=10*h+f}if(h>255)return;C++}_[y]=256*_[y]+h,++u!=2&&u!==4||y++}if(u!==4)return;break}if(I()===":"){if(C++,!I())return}else if(I())return;_[y++]=c}else{if(A!==null)return;C++,A=++y}}if(A!==null)for(m=y-A,y=7;y!==0&&m>0;)E=_[y],_[y--]=_[A+m-1],_[A+--m]=E;else if(y!==8)return;return _})(af(e,1,-1)),!t))return gd;this.host=t}else if(this.isSpecial()){if(e=hne(e),Go(Ane,e)||(t=(function(i){var c,l,u,h,f,m,E,_=Tne(i,".");if(_.length&&_[_.length-1]===""&&_.length--,(c=_.length)>4)return i;for(l=[],u=0;u<c;u++){if((h=_[u])==="")return i;if(f=10,h.length>1&&mo(h,0)==="0"&&(f=Go(Ine,h)?16:8,h=af(h,f===8?1:2)),h==="")m=0;else{if(!Go(f===10?wne:f===8?bne:u1,h))return i;m=z_(h,f)}Tu(l,m)}for(u=0;u<c;u++)if(m=l[u],u===c-1){if(m>=c1(256,5-c))return null}else if(m>255)return null;for(E=yne(l),u=0;u<l.length;u++)E+=l[u]*c1(256,3-u);return E})(e),t===null))return gd;this.host=t}else{if(Go(Dne,e))return gd;for(t="",n=Su(e),r=0;r<n.length;r++)t+=mc(n[r],Y_);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return fI($_,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&df(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,c=e.port,l=e.path,u=e.query,h=e.fragment,f=t+":";return i!==null?(f+="//",e.includesCredentials()&&(f+=n+(r?":"+r:"")+"@"),f+=cf(i),c!==null&&(f+=":"+c)):t==="file"&&(f+="//"),f+=e.cannotBeABaseURL?l[0]:l.length?"/"+sf(l,"/"):"",u!==null&&(f+="?"+u),h!==null&&(f+="#"+h),f},setHref:function(e){var t=this.parse(e);if(t)throw new gI(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Ru(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+cf(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ga(e)+":",SI)},getUsername:function(){return this.username},setUsername:function(e){var t=Su(ga(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=mc(t[n],yI)}},getPassword:function(){return this.password},setPassword:function(e){var t=Su(ga(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=mc(t[n],yI)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?cf(e):cf(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,RI)},getHostname:function(){var e=this.host;return e===null?"":cf(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,II)},getPort:function(){var e=this.port;return e===null?"":ga(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ga(e))===""?this.port=null:this.parse(e,bI))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+sf(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Cu))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ga(e))===""?this.query=null:(mo(e,0)==="?"&&(e=af(e,1)),this.query="",this.parse(e,_d)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ga(e))!==""?(mo(e,0)==="#"&&(e=af(e,1)),this.fragment="",this.parse(e,_a)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ru=function(e){var t=lne(this,di),n=fne(arguments.length,1)>1?arguments[1]:void 0,r=mne(t,new DI(e,!1,n));hI||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},di=Ru.prototype,go=function(e,t){return{get:function(){return q_(this)[e]()},set:t&&function(n){return q_(this)[t](n)},configurable:!0,enumerable:!0}};if(hI&&(fo(di,"href",go("serialize","setHref")),fo(di,"origin",go("getOrigin")),fo(di,"protocol",go("getProtocol","setProtocol")),fo(di,"username",go("getUsername","setUsername")),fo(di,"password",go("getPassword","setPassword")),fo(di,"host",go("getHost","setHost")),fo(di,"hostname",go("getHostname","setHostname")),fo(di,"port",go("getPort","setPort")),fo(di,"pathname",go("getPathname","setPathname")),fo(di,"search",go("getSearch","setSearch")),fo(di,"searchParams",go("getSearchParams")),fo(di,"hash",go("getHash","setHash"))),W_(di,"toJSON",function(){return q_(this).serialize()},{enumerable:!0}),W_(di,"toString",function(){return q_(this).serialize()},{enumerable:!0}),of){var T1=of.createObjectURL,C1=of.revokeObjectURL;T1&&W_(Ru,"createObjectURL",o1(T1,of)),C1&&W_(Ru,"revokeObjectURL",o1(C1,of))}pne(Ru,"URL"),cne({global:!0,constructor:!0,forced:!dne,sham:!hI},{URL:Ru});var kne=st,R1=d,Mne=hd,I1=si,xne=F_,OI=Nr("URL"),Une=xne&&R1(function(){OI.canParse()}),Fne=R1(function(){return OI.canParse.length!==1});kne({target:"URL",stat:!0,forced:!Une||Fne},{canParse:function(e){var t=Mne(arguments.length,1),n=I1(e),r=t<2||arguments[1]===void 0?void 0:I1(arguments[1]);try{return!!new OI(n,r)}catch{return!1}}});var Vne=st,jne=hd,b1=si,Bne=F_,Hne=Nr("URL");Vne({target:"URL",stat:!0,forced:!Bne},{parse:function(e){var t=jne(arguments.length,1),n=b1(e),r=t<2||arguments[1]===void 0?void 0:b1(arguments[1]);try{return new Hne(n,r)}catch{return null}}});var Z_=a(mi.URL);let w1=!0,A1=!0;function Q_(e,t,n){let r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Ed(e,t,n){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(l,u){if(l!==t)return i.apply(this,arguments);let h=f=>{let m=n(f);m&&(u.handleEvent?u.handleEvent(m):u(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,h),i.apply(this,[l,h])};let c=r.removeEventListener;r.removeEventListener=function(l,u){if(l!==t||!this._eventMap||!this._eventMap[t])return c.apply(this,arguments);if(!this._eventMap[t].has(u))return c.apply(this,arguments);let h=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[l,h])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(l){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),l&&this.addEventListener(t,this["_on"+t]=l)},enumerable:!0,configurable:!0})}function Gne(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(w1=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Wne(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(A1=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function D1(){if(typeof window=="object"){if(w1)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function NI(e,t){A1&&console.warn(e+" is deprecated, please use "+t+" instead.")}function O1(e){return Object.prototype.toString.call(e)==="[object Object]"}function N1(e){var t;return O1(e)?Ui(t=Object.keys(e)).call(t,function(n,r){let i=O1(e[r]),c=i?N1(e[r]):e[r],l=i&&!Object.keys(c).length;return c===void 0||l?n:Object.assign(n,{[r]:c})},{}):e}function PI(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?PI(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{PI(e,e.get(i),n)})}))}function P1(e,t,n){let r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;let c=[];return e.forEach(l=>{l.type==="track"&&l.trackIdentifier===t.id&&c.push(l)}),c.forEach(l=>{e.forEach(u=>{u.type===r&&u.trackId===l.id&&PI(e,u,i)})}),i}let L1=D1;function k1(e,t){let n=e&&e.navigator;if(!n.mediaDevices)return;let r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;let u={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;let f=typeof l[h]=="object"?l[h]:{ideal:l[h]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);let m=function(E,_){return E?E+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(f.ideal!==void 0){u.optional=u.optional||[];let E={};typeof f.ideal=="number"?(E[m("min",h)]=f.ideal,u.optional.push(E),E={},E[m("max",h)]=f.ideal,u.optional.push(E)):(E[m("",h)]=f.ideal,u.optional.push(E))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[m("",h)]=f.exact):["min","max"].forEach(E=>{f[E]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[m(E,h)]=f[E])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},i=function(l,u){if(t.version>=61)return u(l);if((l=JSON.parse(JSON.stringify(l)))&&typeof l.audio=="object"){let h=function(f,m,E){m in f&&!(E in f)&&(f[E]=f[m],delete f[m])};h((l=JSON.parse(JSON.stringify(l))).audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});let f=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||f)){let m;if(delete l.video.facingMode,h.exact==="environment"||h.ideal==="environment"?m=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(E=>{E=E.filter(y=>y.kind==="videoinput");let _=E.find(y=>m.some(A=>{var C;return J(C=y.label.toLowerCase()).call(C,A)}));return!_&&E.length&&J(m).call(m,"back")&&(_=E[E.length-1]),_&&(l.video.deviceId=h.exact?{exact:_.deviceId}:{ideal:_.deviceId}),l.video=r(l.video),L1("chrome: "+JSON.stringify(l)),u(l)})}l.video=r(l.video)}return L1("chrome: "+JSON.stringify(l)),u(l)},c=function(l){return t.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(l,u,h){i(l,f=>{n.webkitGetUserMedia(f,u,m=>{h&&h(c(m))})})}).bind(n),n.mediaDevices.getUserMedia){let l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return i(u,h=>l(h).then(f=>{if(h.audio&&!f.getAudioTracks().length||h.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return f},f=>ie.reject(c(f))))}}}function M1(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function x1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===r.track.id):{track:r.track};let c=new Event("track");c.track=r.track,c.receiver=i,c.transceiver={receiver:i},c.streams=[n.stream],this.dispatchEvent(c)}),n.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===r.id):{track:r};let c=new Event("track");c.track=r,c.receiver=i,c.transceiver={receiver:i},c.streams=[n.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ed(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function U1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(i,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=i.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){let h=i.apply(this,arguments);return h||(h=t(this,l),this._senders.push(h)),h};let c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){c.apply(this,arguments);let u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(c=>{this._senders.push(t(this,c))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(c=>{let l=this._senders.find(u=>u.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function F1(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);let c=function(u){let h={};return u.result().forEach(f=>{let m={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(E=>{m[E]=f.stat(E)}),h[m.id]=m}),h},l=function(u){return new Map(Object.keys(u).map(h=>[h,u[h]]))};if(arguments.length>=2){let u=function(h){r(l(c(h)))};return t.apply(this,[u,n])}return new ie((u,h)=>{t.apply(this,[function(f){u(l(c(f)))},h])}).then(r,i)}}function V1(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){let i=n.apply(this,[]);return i.forEach(c=>c._pc=this),i});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){let i=this;return this._pc.getStats().then(c=>P1(c,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Ed(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){let r=this;return this._pc.getStats().then(i=>P1(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let n=arguments[0],r,i,c;return this.getSenders().forEach(l=>{l.track===n&&(r?c=!0:r=l)}),this.getReceivers().forEach(l=>(l.track===n&&(i?c=!0:i=l),l.track===n)),c||r&&i?ie.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():ie.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function j1(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let u=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});let l=this.getSenders();n.apply(this,arguments);let u=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[c.id]=[c].concat(u)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],r.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{let u=this._shimmedLocalStreams[l].indexOf(c);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),i.apply(this,arguments)}}function B1(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return j1(e);let n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let h=n.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(f=>this._reverseStreams[f.id])};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(f=>{if(this.getSenders().find(E=>E.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){let f=new e.MediaStream(h.getTracks());this._streams[h.id]=f,this._reverseStreams[f.id]=h,h=f}r.apply(this,[h])};let i=e.RTCPeerConnection.prototype.removeStream;function c(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(E=>{let _=h._reverseStreams[E],y=h._streams[_.id];m=m.replace(new RegExp(y.id,"g"),_.id)}),new RTCSessionDescription({type:f.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(y=>y===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let _=this._streams[f.id];if(_)_.addTrack(h),ie.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let y=new e.MediaStream([h]);this._streams[f.id]=y,this._reverseStreams[y.id]=f,this.addStream(y)}return this.getSenders().find(y=>y.track===h)},["createOffer","createAnswer"].forEach(function(h){let f=e.RTCPeerConnection.prototype[h],m={[h](){let E=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[_=>{let y=c(this,_);E[0].apply(null,[y])},_=>{E[1]&&E[1].apply(null,_)},arguments[2]]):f.apply(this,arguments).then(_=>c(this,_))}};e.RTCPeerConnection.prototype[h]=m[h]});let l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(E=>{let _=h._reverseStreams[E],y=h._streams[_.id];m=m.replace(new RegExp(_.id,"g"),y.id)}),new RTCSessionDescription({type:f.type,sdp:m})})(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};let u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let h=u.get.apply(this);return h.type===""?h:c(this,h)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(E=>h.track===E)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function LI(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){let r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function H1(e,t){Ed(e,"negotiationneeded",n=>{let r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var G1=Object.freeze({__proto__:null,fixNegotiationNeeded:H1,shimAddTrackRemoveTrack:B1,shimAddTrackRemoveTrackWithNative:j1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{let i=n.video&&n.video.width,c=n.video&&n.video.height,l=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:l||3}},i&&(n.video.mandatory.maxWidth=i),c&&(n.video.mandatory.maxHeight=c),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:U1,shimGetStats:F1,shimGetUserMedia:k1,shimMediaStream:M1,shimOnTrack:x1,shimPeerConnection:LI,shimSenderReceiverGetStats:V1});function W1(e,t){let n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,c,l){NI("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(c,l)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){let i=function(l,u,h){u in l&&!(h in l)&&(l[h]=l[u],delete l[u])},c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l.audio,"autoGainControl","mozAutoGainControl"),i(l.audio,"noiseSuppression","mozNoiseSuppression")),c(l)},r&&r.prototype.getSettings){let l=r.prototype.getSettings;r.prototype.getSettings=function(){let u=l.apply(this,arguments);return i(u,"mozAutoGainControl","autoGainControl"),i(u,"mozNoiseSuppression","noiseSuppression"),u}}if(r&&r.prototype.applyConstraints){let l=r.prototype.applyConstraints;r.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),i(u,"autoGainControl","mozAutoGainControl"),i(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function q1(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kI(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let c=e.RTCPeerConnection.prototype[i],l={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=l[i]});let n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,c,l]=arguments;return r.apply(this,[i||null]).then(u=>{if(t.version<53&&!c)try{u.forEach(h=>{h.type=n[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((f,m)=>{u.set(m,Object.assign({},f,{type:n[f.type]||f.type}))})}return u}).then(c,l)}}function z1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ie.resolve(new Map)}}function K1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Ed(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Y1(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){NI("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&J(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function $1(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function X1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];let r=n.length>0;r&&n.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let i=t.apply(this,arguments);if(r){let{sender:c}=i,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=n,c.sendEncodings=n,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return i})}function J1(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Z1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ie.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Q1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ie.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var ex=Object.freeze({__proto__:null,shimAddTransceiver:X1,shimCreateAnswer:Q1,shimCreateOffer:Z1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){let r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ie.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:J1,shimGetUserMedia:W1,shimOnTrack:q1,shimPeerConnection:kI,shimRTCDataChannel:$1,shimReceiverGetStats:K1,shimRemoveStream:Y1,shimSenderGetStats:z1});function tx(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),J(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),c=1;c<r;c++)i[c-1]=arguments[c];return i&&i.forEach(l=>{var u;this._localStreams?J(u=this._localStreams).call(u,l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);let r=t.getTracks();this.getSenders().forEach(i=>{J(r).call(r,i.track)&&this.removeTrack(i)})})}}function nx(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var c;if(this._remoteStreams||(this._remoteStreams=[]),J(c=this._remoteStreams).call(c,i))return;this._remoteStreams.push(i);let l=new Event("addstream");l.stream=i,this.dispatchEvent(l)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);let c=new Event("addstream");c.stream=i,n.dispatchEvent(c)})}),t.apply(n,arguments)}}}function rx(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,c=t.setRemoteDescription,l=t.addIceCandidate;t.createOffer=function(h,f){let m=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[m]);return f?(E.then(h,f),ie.resolve()):E},t.createAnswer=function(h,f){let m=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[m]);return f?(E.then(h,f),ie.resolve()):E};let u=function(h,f,m){let E=i.apply(this,[h]);return m?(E.then(f,m),ie.resolve()):E};t.setLocalDescription=u,u=function(h,f,m){let E=c.apply(this,[h]);return m?(E.then(f,m),ie.resolve()):E},t.setRemoteDescription=u,u=function(h,f,m){let E=l.apply(this,[h]);return m?(E.then(f,m),ie.resolve()):E},t.addIceCandidate=u}function ix(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(ox(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function ox(e){return e&&e.video!==void 0?Object.assign({},e,{video:N1(e.video)}):e}function sx(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){let i=[];for(let c=0;c<n.iceServers.length;c++){let l=n.iceServers[c];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(NI("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(n.iceServers[c])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ax(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cx(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);let r=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);let i=this.getTransceivers().find(c=>c.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function dx(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var lx=Object.freeze({__proto__:null,shimAudioContext:dx,shimCallbacksAPI:rx,shimConstraints:ox,shimCreateOfferLegacy:cx,shimGetUserMedia:ix,shimLocalStreamsAPI:tx,shimRTCIceServerUrls:sx,shimRemoteStreamsAPI:nx,shimTrackEventTransceiver:ax}),ux=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,qne=ic,zne=si,MI=ux,hx=x("".replace),Kne=RegExp("^["+MI+"]+"),Yne=RegExp("(^|[^"+MI+"])["+MI+"]+$"),xI=function(e){return function(t){var n=zne(qne(t));return 1&e&&(n=hx(n,Kne,"")),2&e&&(n=hx(n,Yne,"$1")),n}},$ne={start:xI(1),end:xI(2),trim:xI(3)},Xne=KL.PROPER,Jne=d,px=ux,Zne=$ne.trim;st({target:"String",proto:!0,forced:(function(e){return Jne(function(){return!!px[e]()||"\u200B\x85\u180E"[e]()!=="\u200B\x85\u180E"||Xne&&px[e].name!==e})})("trim")},{trim:function(){return Zne(this)}});var Qne=xi("String","trim"),ere=B,tre=Qne,UI=String.prototype,nre=function(e){var t=e.trim;return typeof e=="string"||e===UI||ere(UI,e)&&t===UI.trim?tre:t},vr=a(nre),fx={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){let r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){let r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");let i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let c=8;c<r.length;c+=2)switch(r[c]){case"raddr":i.relatedAddress=r[c+1];break;case"rport":i.relatedPort=parseInt(r[c+1],10);break;case"tcptype":i.tcpType=r[c+1];break;case"ufrag":i.ufrag=r[c+1],i.usernameFragment=r[c+1];break;default:i[r[c]]===void 0&&(i[r[c]]=r[c+1])}return i},t.writeCandidate=function(n){let r=[];r.push(n.foundation);let i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);let c=n.type;return r.push("typ"),r.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" "),i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);let i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){let r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){let r={},i,c=n.substring(n.indexOf(" ")+1).split(";");for(let l=0;l<c.length;l++)i=c[l].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){let c=[];Object.keys(n.parameters).forEach(l=>{n.parameters[l]!==void 0?c.push(l+"="+n.parameters[l]):c.push(l)}),r+="a=fmtp:"+i+" "+c.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){let r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(c=>{r+="a=rtcp-fb:"+i+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){let r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},c=n.indexOf(":",r);return c>-1?(i.attribute=n.substring(r+1,c),i.value=n.substring(c+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){let r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){let r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){let r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(c=>{i+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),i},t.parseCryptoLine=function(n){let r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;let r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){let i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],c=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&c?{usernameFragment:i.substring(12),password:c.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){let r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){let u=i[l],h=t.matchPrefix(n,"a=rtpmap:"+u+" ")[0];if(h){let f=t.parseRtpMap(h),m=t.matchPrefix(n,"a=fmtp:"+u+" ");switch(f.parameters=m.length?t.parseFmtp(m[0]):{},f.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),r.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(f.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(t.parseExtmap(l))});let c=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(l=>{c.forEach(u=>{l.rtcpFeedback.find(h=>h.type===u.type&&h.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(l=>{i+=t.writeRtpMap(l),i+=t.writeFmtp(l),i+=t.writeRtcpFb(l)});let c=0;return r.codecs.forEach(l=>{l.maxptime>c&&(c=l.maxptime)}),c>0&&(i+="a=maxptime:"+c+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(l=>{i+=t.writeExtmap(l)}),i},t.parseRtpEncodingParameters=function(n){let r=[],i=t.parseRtpParameters(n),c=i.fecMechanisms.indexOf("RED")!==-1,l=i.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(n,"a=ssrc:").map(_=>t.parseSsrcMedia(_)).filter(_=>_.attribute==="cname"),h=u.length>0&&u[0].ssrc,f,m=t.matchPrefix(n,"a=ssrc-group:FID").map(_=>_.substring(17).split(" ").map(y=>parseInt(y,10)));m.length>0&&m[0].length>1&&m[0][0]===h&&(f=m[0][1]),i.codecs.forEach(_=>{if(_.name.toUpperCase()==="RTX"&&_.parameters.apt){let y={ssrc:h,codecPayloadType:parseInt(_.parameters.apt,10)};h&&f&&(y.rtx={ssrc:f}),r.push(y),c&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:h,mechanism:l?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&h&&r.push({ssrc:h});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,r.forEach(_=>{_.maxBitrate=E})),r},t.parseRtcpParameters=function(n){let r={},i=t.matchPrefix(n,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);let c=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=c.length>0,r.compound=c.length===0;let l=t.matchPrefix(n,"a=rtcp-mux");return r.mux=l.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r,i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};let c=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");return c.length>0?(r=c[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){let r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:"),c;i.length>0&&(c=parseInt(i[0].substring(19),10)),isNaN(c)&&(c=65536);let l=t.matchPrefix(n,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:r.fmt,maxMessageSize:c};let u=t.matchPrefix(n,"a=sctpmap:");if(u.length>0){let h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:c}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let c,l=r!==void 0?r:2;return c=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+c+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){let i=t.splitLines(n);for(let c=0;c<i.length;c++)switch(i[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[c].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){let r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){let r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;let r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(fx);var mx=fx.exports,Iu=a(mx),rre=o({__proto__:null,default:Iu},[mx]);function eE(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){let r=new t(n),i=Iu.parseCandidate(n.candidate),c=Object.assign(r,i);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Ed(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function FI(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ed(e,"icecandidate",t=>{if(t.candidate){let n=Iu.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function tE(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let n=function(u){if(!u||!u.sdp)return!1;let h=Iu.splitSections(u.sdp);return h.shift(),h.some(f=>{let m=Iu.parseMLine(f);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},r=function(u){let h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;let f=parseInt(h[1],10);return f!=f?-1:f},i=function(u){let h=65536;return t.browser==="firefox"&&(h=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),h},c=function(u,h){let f=65536;t.browser==="firefox"&&t.version===57&&(f=65535);let m=Iu.matchPrefix(u.sdp,"a=max-message-size:");return m.length>0?f=parseInt(m[0].substr(19),10):t.browser==="firefox"&&h!==-1&&(f=2147483637),f},l=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){let u=r(arguments[0]),h=i(u),f=c(arguments[0],u),m;m=h===0&&f===0?Number.POSITIVE_INFINITY:h===0||f===0?Math.max(h,f):Math.min(h,f);let E={};Object.defineProperty(E,"maxMessageSize",{get:()=>m}),this._sctp=E}return l.apply(this,arguments)}}function nE(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){let c=r.send;r.send=function(){let l=arguments[0],u=l.length||l.size||l.byteLength;if(r.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return c.apply(r,arguments)}}let n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let r=n.apply(this,arguments);return t(r,this),r},Ed(e,"datachannel",r=>(t(r.channel,r.target),r))}function VI(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{let r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{let c=i.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;let l=new Event("connectionstatechange",i);c.dispatchEvent(l)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function jI(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let i=r.sdp.split(`
`).filter(c=>vr(c).call(c)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function rE(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ie.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ie.resolve())})}function iE(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var ire=Object.freeze({__proto__:null,removeExtmapAllowMixed:jI,shimAddIceCandidateNullOrEmpty:rE,shimConnectionState:VI,shimMaxMessageSize:tE,shimParameterlessSetLocalDescription:iE,shimRTCIceCandidate:eE,shimRTCIceCandidateRelayProtocol:FI,shimSendThrowTypeError:nE});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=D1,r=(function(c){let l={browser:null,version:null};if(c===void 0||!c.navigator)return l.browser="Not a browser.",l;let{navigator:u}=c;if(u.mozGetUserMedia)l.browser="firefox",l.version=Q_(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection)l.browser="chrome",l.version=Q_(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!c.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=Q_(u.userAgent,/AppleWebKit\/(\d+)\./,1),l.supportsUnifiedPlan=c.RTCRtpTransceiver&&"currentDirection"in c.RTCRtpTransceiver.prototype}return l})(e),i={browserDetails:r,commonShim:ire,extractVersion:Q_,disableLog:Gne,disableWarnings:Wne,sdp:rre};switch(r.browser){case"chrome":if(!G1||!LI||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=G1,rE(e,r),iE(e),k1(e,r),M1(e),LI(e,r),x1(e),B1(e,r),U1(e),F1(e),V1(e),H1(e,r),eE(e),FI(e),VI(e),tE(e,r),nE(e),jI(e,r);break;case"firefox":if(!ex||!kI||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=ex,rE(e,r),iE(e),W1(e,r),kI(e,r),q1(e),Y1(e),z1(e),K1(e),$1(e),X1(e),J1(e),Z1(e),Q1(e),eE(e),VI(e),tE(e,r),nE(e);break;case"safari":if(!lx||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=lx,rE(e,r),iE(e),sx(e),cx(e),rx(e),tx(e),nx(e),ax(e),ix(e),dx(e),eE(e),FI(e),tE(e,r),nE(e),jI(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var ore=d,gx=ee.RegExp,sre=!ore(function(){var e=!0;try{gx(".","d")}catch{e=!1}var t={},n="",r=e?"dgimsy":"gimsy",i=function(u,h){Object.defineProperty(t,u,{get:function(){return n+=h,!0}})},c={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var l in e&&(c.hasIndices="d"),c)i(l,c[l]);return Object.getOwnPropertyDescriptor(gx.prototype,"flags").get.call(t)!==r||n!==r}),are=oi,cre=Hn,dre=Qn,lre=B,_x={correct:sre},ure=function(){var e=are(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},hre=RegExp.prototype,BI=_x.correct?function(e){return e.flags}:function(e){return _x.correct||!lre(hre,e)||dre(e,"flags")?e.flags:cre(ure,e)},HI=x,pre=jo,fre=Math.floor,GI=HI("".charAt),mre=HI("".replace),WI=HI("".slice),gre=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,_re=/\$([$&'`]|\d{1,2})/g,Ere=st,vre=Hn,qI=x,Ex=ic,yre=Mn,Sre=Er,Tre=qC,bu=si,Cre=jp,Rre=BI,Ire=function(e,t,n,r,i,c){var l=n+e.length,u=r.length,h=_re;return i!==void 0&&(i=pre(i),h=gre),mre(c,h,function(f,m){var E;switch(GI(m,0)){case"$":return"$";case"&":return e;case"`":return WI(t,0,n);case"'":return WI(t,l);case"<":E=i[WI(m,1,-1)];break;default:var _=+m;if(_===0)return f;if(_>u){var y=fre(_/10);return y===0?f:y<=u?r[y-1]===void 0?GI(m,1):r[y-1]+GI(m,1):f}E=r[_-1]}return E===void 0?"":E})},bre=un("replace"),wre=TypeError,zI=qI("".indexOf),Are=qI("".replace),vx=qI("".slice),Dre=Math.max;Ere({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,i,c,l,u,h,f,m,E,_=Ex(this),y=0,A="";if(Sre(e)){if((n=Tre(e))&&(r=bu(Ex(Rre(e))),!~zI(r,"g")))throw new wre("`.replaceAll` does not allow non-global regexes");if(i=Cre(e,bre))return vre(i,e,_,t);if(n)return Are(bu(_),e,t)}for(c=bu(_),l=bu(e),(u=yre(t))||(t=bu(t)),h=l.length,f=Dre(1,h),m=zI(c,l);m!==-1;)E=u?bu(t(l,m,c)):Ire(l,c,m,[],void 0,t),A+=vx(c,y,m)+E,y=m+h,m=m+f>c.length?-1:zI(c,l,m+f);return y<c.length&&(A+=vx(c,y)),A}});var Ore=xi("String","replaceAll"),Nre=B,Pre=Ore,KI=String.prototype,Lre=function(e){var t=e.replaceAll;return typeof e=="string"||e===KI||Nre(KI,e)&&t===KI.replaceAll?Pre:t},kre=a(Lre),YI=ee;st({global:!0,forced:YI.globalThis!==YI},{globalThis:YI});var yx=a(ee),$I={exports:{}};(function(e,t){(function(n,r){var i="function",c="undefined",l="object",u="string",h="major",f="model",m="name",E="type",_="vendor",y="version",A="architecture",C="console",I="mobile",N="tablet",L="smarttv",M="wearable",V="embedded",j="Amazon",U="Apple",H="ASUS",K="BlackBerry",Y="Browser",ae="Chrome",Ce="Firefox",Te="Google",Le="Honor",De="Huawei",tt="LG",Ut="Microsoft",$="Motorola",ne="Nvidia",le="OnePlus",X="Opera",R="OPPO",k="Samsung",F="Sharp",Q="Sony",be="Xiaomi",bt="Zebra",bn="Facebook",Yi="Chromium OS",xc="Mac OS",ey=" Browser",Rh=function(fn){for(var vn={},kt=0;kt<fn.length;kt++)vn[fn[kt].toUpperCase()]=fn[kt];return vn},ty=function(fn,vn){return typeof fn===u&&nl(vn).indexOf(nl(fn))!==-1},nl=function(fn){return fn.toLowerCase()},pm=function(fn,vn){if(typeof fn===u)return fn=fn.replace(/^\s\s*/,""),typeof vn===c?fn:fn.substring(0,500)},rl=function(fn,vn){for(var kt,Zr,cs,rn,Aa,Xe,ds=0;ds<vn.length&&!Aa;){var il=vn[ds],Ys=vn[ds+1];for(kt=Zr=0;kt<il.length&&!Aa&&il[kt];)if(Aa=il[kt++].exec(fn))for(cs=0;cs<Ys.length;cs++)Xe=Aa[++Zr],typeof(rn=Ys[cs])===l&&rn.length>0?rn.length===2?typeof rn[1]==i?this[rn[0]]=rn[1].call(this,Xe):this[rn[0]]=rn[1]:rn.length===3?typeof rn[1]!==i||rn[1].exec&&rn[1].test?this[rn[0]]=Xe?Xe.replace(rn[1],rn[2]):r:this[rn[0]]=Xe?rn[1].call(this,Xe,rn[2]):r:rn.length===4&&(this[rn[0]]=Xe?rn[3].call(this,Xe.replace(rn[1],rn[2])):r):this[rn]=Xe||r;ds+=2}},Uc=function(fn,vn){for(var kt in vn)if(typeof vn[kt]===l&&vn[kt].length>0){for(var Zr=0;Zr<vn[kt].length;Zr++)if(ty(vn[kt][Zr],fn))return kt==="?"?r:kt}else if(ty(vn[kt],fn))return kt==="?"?r:kt;return vn.hasOwnProperty("*")?vn["*"]:fn},aW={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},cW={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,y],[/opios[\/ ]+([\w\.]+)/i],[y,[m,X+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[m,X+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[m,X]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[m,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[m,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[m,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[m,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[m,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[m,"UC"+Y]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[m,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[m,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[m,"Smart Lenovo "+Y]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+Y],y],[/\bfocus\/([\w\.]+)/i],[y,[m,Ce+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[m,X+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[m,X+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[m,"MIUI"+ey]],[/fxios\/([\w\.-]+)/i],[y,[m,Ce]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[m,"360"]],[/\b(qq)\/([\w\.]+)/i],[[m,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1"+ey],y],[/samsungbrowser\/([\w\.]+)/i],[y,[m,k+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[m,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[m,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[m,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[m],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,bn],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[m,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[m,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[m,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[m,ae+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,ae+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[m,"Android "+Y]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[y,Uc,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[m,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[m,Ce+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[m,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[m,[y,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[A,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[A,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[A,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[A,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[A,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[A,/ower/,"",nl]],[/ sun4\w[;\)]/i],[[A,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[A,nl]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[_,k],[E,N]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[_,k],[E,I]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[_,U],[E,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[_,U],[E,N]],[/(macintosh);/i],[f,[_,U]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[_,F],[E,I]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[f,[_,Le],[E,N]],[/honor([-\w ]+)[;\)]/i],[f,[_,Le],[E,I]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[f,[_,De],[E,N]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[_,De],[E,I]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[f,/_/g," "],[_,be],[E,N]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[f,/_/g," "],[_,be],[E,I]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[_,R],[E,I]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[f,[_,Uc,{OnePlus:["304","403","203"],"*":R}],[E,N]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[_,"Vivo"],[E,I]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[_,"Realme"],[E,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[_,$],[E,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[_,$],[E,N]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[_,tt],[E,N]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[_,tt],[E,I]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[f,[_,"Lenovo"],[E,N]],[/(nokia) (t[12][01])/i],[_,f,[E,N]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[f,/_/g," "],[E,I],[_,"Nokia"]],[/(pixel (c|tablet))\b/i],[f,[_,Te],[E,N]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[_,Te],[E,I]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[_,Q],[E,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[_,Q],[E,N]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[_,le],[E,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[_,j],[E,N]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[_,j],[E,I]],[/(playbook);[-\w\),; ]+(rim)/i],[f,_,[E,N]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[_,K],[E,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[_,H],[E,N]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[_,H],[E,I]],[/(nexus 9)/i],[f,[_,"HTC"],[E,N]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[f,/_/g," "],[E,I]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[f,[_,"TCL"],[E,N]],[/(itel) ((\w+))/i],[[_,nl],f,[E,Uc,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[_,"Acer"],[E,N]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[_,"Meizu"],[E,I]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[_,"Ulefone"],[E,I]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[_,"Energizer"],[E,I]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[_,"Cat"],[E,I]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[_,"Smartfren"],[E,I]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[_,"Nothing"],[E,I]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[f,[_,"Archos"],[E,N]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[f,[_,"Archos"],[E,I]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[_,f,[E,N]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[_,f,[E,I]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,f,[E,N]],[/(surface duo)/i],[f,[_,Ut],[E,N]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[_,"Fairphone"],[E,I]],[/(u304aa)/i],[f,[_,"AT&T"],[E,I]],[/\bsie-(\w*)/i],[f,[_,"Siemens"],[E,I]],[/\b(rct\w+) b/i],[f,[_,"RCA"],[E,N]],[/\b(venue[\d ]{2,7}) b/i],[f,[_,"Dell"],[E,N]],[/\b(q(?:mv|ta)\w+) b/i],[f,[_,"Verizon"],[E,N]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[_,"Barnes & Noble"],[E,N]],[/\b(tm\d{3}\w+) b/i],[f,[_,"NuVision"],[E,N]],[/\b(k88) b/i],[f,[_,"ZTE"],[E,N]],[/\b(nx\d{3}j) b/i],[f,[_,"ZTE"],[E,I]],[/\b(gen\d{3}) b.+49h/i],[f,[_,"Swiss"],[E,I]],[/\b(zur\d{3}) b/i],[f,[_,"Swiss"],[E,N]],[/\b((zeki)?tb.*\b) b/i],[f,[_,"Zeki"],[E,N]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],f,[E,N]],[/\b(ns-?\w{0,9}) b/i],[f,[_,"Insignia"],[E,N]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[_,"NextBook"],[E,N]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],f,[E,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],f,[E,I]],[/\b(ph-1) /i],[f,[_,"Essential"],[E,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[_,"Envizen"],[E,N]],[/\b(trio[-\w\. ]+) b/i],[f,[_,"MachSpeed"],[E,N]],[/\btu_(1491) b/i],[f,[_,"Rotor"],[E,N]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[f,[_,ne],[E,N]],[/(sprint) (\w+)/i],[_,f,[E,I]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[_,Ut],[E,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[_,bt],[E,N]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[_,bt],[E,I]],[/smart-tv.+(samsung)/i],[_,[E,L]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[_,k],[E,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,tt],[E,L]],[/(apple) ?tv/i],[_,[f,U+" TV"],[E,L]],[/crkey/i],[[f,ae+"cast"],[_,Te],[E,L]],[/droid.+aft(\w+)( bui|\))/i],[f,[_,j],[E,L]],[/(shield \w+ tv)/i],[f,[_,ne],[E,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[_,F],[E,L]],[/(bravia[\w ]+)( bui|\))/i],[f,[_,Q],[E,L]],[/(mi(tv|box)-?\w+) bui/i],[f,[_,be],[E,L]],[/Hbbtv.*(technisat) (.*);/i],[_,f,[E,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,pm],[f,pm],[E,L]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[f,[E,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,L]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,f,[E,C]],[/droid.+; (shield)( bui|\))/i],[f,[_,ne],[E,C]],[/(playstation \w+)/i],[f,[_,Q],[E,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[_,Ut],[E,C]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[f,[_,k],[E,M]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[_,f,[E,M]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[f,[_,R],[E,M]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[_,U],[E,M]],[/(opwwe\d{3})/i],[f,[_,le],[E,M]],[/(moto 360)/i],[f,[_,$],[E,M]],[/(smartwatch 3)/i],[f,[_,Q],[E,M]],[/(g watch r)/i],[f,[_,tt],[E,M]],[/droid.+; (wt63?0{2,3})\)/i],[f,[_,bt],[E,M]],[/droid.+; (glass) \d/i],[f,[_,Te],[E,M]],[/(pico) (4|neo3(?: link|pro)?)/i],[_,f,[E,M]],[/; (quest( \d| pro)?)/i],[f,[_,bn],[E,M]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[E,V]],[/(aeobc)\b/i],[f,[_,j],[E,V]],[/(homepod).+mac os/i],[f,[_,U],[E,V]],[/windows iot/i],[[E,V]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[E,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[E,N]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,N]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,I]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[f,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[m,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[m,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[m,y],[/ladybird\//i],[[m,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,y],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[m,[y,Uc,aW]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,Uc,aW],[m,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,xc],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,m],[/(ubuntu) ([\w\.]+) like android/i],[[m,/(.+)/,"$1 Touch"],y],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[m,y],[/\(bb(10);/i],[y,[m,K]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[y,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[m,Ce+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[m,ae+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,Yi],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,y],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[m,y]]},as=function(fn,vn){if(typeof fn===l&&(vn=fn,fn=r),!(this instanceof as))return new as(fn,vn).getResult();var kt=typeof n!==c&&n.navigator?n.navigator:r,Zr=fn||(kt&&kt.userAgent?kt.userAgent:""),cs=kt&&kt.userAgentData?kt.userAgentData:r,rn=vn?(function(Xe,ds){var il={};for(var Ys in Xe)ds[Ys]&&ds[Ys].length%2==0?il[Ys]=ds[Ys].concat(Xe[Ys]):il[Ys]=Xe[Ys];return il})(cW,vn):cW,Aa=kt&&kt.userAgent==Zr;return this.getBrowser=function(){var Xe={};return Xe[m]=r,Xe[y]=r,rl.call(Xe,Zr,rn.browser),Xe[h]=(function(ds){return typeof ds===u?ds.replace(/[^\d\.]/g,"").split(".")[0]:r})(Xe[y]),Aa&&kt&&kt.brave&&typeof kt.brave.isBrave==i&&(Xe[m]="Brave"),Xe},this.getCPU=function(){var Xe={};return Xe[A]=r,rl.call(Xe,Zr,rn.cpu),Xe},this.getDevice=function(){var Xe={};return Xe[_]=r,Xe[f]=r,Xe[E]=r,rl.call(Xe,Zr,rn.device),Aa&&!Xe[E]&&cs&&cs.mobile&&(Xe[E]=I),Aa&&Xe[f]=="Macintosh"&&kt&&typeof kt.standalone!==c&&kt.maxTouchPoints&&kt.maxTouchPoints>2&&(Xe[f]="iPad",Xe[E]=N),Xe},this.getEngine=function(){var Xe={};return Xe[m]=r,Xe[y]=r,rl.call(Xe,Zr,rn.engine),Xe},this.getOS=function(){var Xe={};return Xe[m]=r,Xe[y]=r,rl.call(Xe,Zr,rn.os),Aa&&!Xe[m]&&cs&&cs.platform&&cs.platform!="Unknown"&&(Xe[m]=cs.platform.replace(/chrome os/i,Yi).replace(/macos/i,xc)),Xe},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Zr},this.setUA=function(Xe){return Zr=typeof Xe===u&&Xe.length>500?pm(Xe,500):Xe,this},this.setUA(Zr),this};as.VERSION="0.7.41",as.BROWSER=Rh([m,y,h]),as.CPU=Rh([A]),as.DEVICE=Rh([f,_,E,C,I,L,N,M,V]),as.ENGINE=as.OS=Rh([m,y]),e.exports&&(t=e.exports=as),t.UAParser=as;var Ih=typeof n!==c&&(n.jQuery||n.Zepto);if(Ih&&!Ih.ua){var ny=new as;Ih.ua=ny.getResult(),Ih.ua.get=function(){return ny.getUA()},Ih.ua.set=function(fn){ny.setUA(fn);var vn=ny.getResult();for(var kt in vn)Ih.ua[kt]=vn[kt]}}})(typeof window=="object"?window:s)})($I,$I.exports);var Mre=a($I.exports),Sx=N_.clear;st({global:!0,bind:!0,enumerable:!0,forced:ee.clearImmediate!==Sx},{clearImmediate:Sx});var Tx=ee,xre=Oe,Ure=Mn,Fre=$C,Vre=fa,jre=lc,Bre=hd,Hre=Tx.Function,Gre=/MSIE .\./.test(Vre)||Fre==="BUN"&&(function(){var e=Tx.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),Wre=st,Cx=ee,Rx=N_.set,qre=function(e,t){var n=t?2:1;return Gre?function(r,i){var c=Bre(arguments.length,1)>n,l=Ure(r)?r:Hre(r),u=c?jre(arguments,n):[],h=c?function(){xre(l,this,u)}:l;return t?e(h,i):e(h)}:e},Ix=Cx.setImmediate?qre(Rx,!1):Rx;Wre({global:!0,bind:!0,enumerable:!0,forced:Cx.setImmediate!==Ix},{setImmediate:Ix});var bx=a(mi.setImmediate),zre=ee,Kre=Pk,Yre=gi,$re=hd,Xre=zr;st({global:!0,enumerable:!0,dontCallGetSet:!0,forced:d(function(){return Xre&&Object.getOwnPropertyDescriptor(zre,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){$re(arguments.length,1),Kre(Yre(e))}});var wx=a(mi.queueMicrotask);function Ax(e,t){return function(){return e.apply(t,arguments)}}let{toString:Jre}=Object.prototype,{getPrototypeOf:XI}=Object,{iterator:oE,toStringTag:Dx}=Symbol,sE=(JI=Object.create(null),e=>{let t=Jre.call(e);return JI[t]||(JI[t]=t.slice(8,-1).toLowerCase())});var JI;let Wo=e=>(e=e.toLowerCase(),t=>sE(t)===e),aE=e=>t=>typeof t===e,{isArray:wu}=Array,Au=aE("undefined");function lf(e){return e!==null&&!Au(e)&&e.constructor!==null&&!Au(e.constructor)&&_i(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}let Ox=Wo("ArrayBuffer"),Zre=aE("string"),_i=aE("function"),Nx=aE("number"),uf=e=>e!==null&&typeof e=="object",cE=e=>{if(sE(e)!=="object")return!1;let t=XI(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Dx in e||oE in e)},Qre=Wo("Date"),eie=Wo("File"),tie=Wo("Blob"),nie=Wo("FileList"),rie=Wo("URLSearchParams"),[iie,oie,sie,aie]=["ReadableStream","Request","Response","Headers"].map(Wo);function hf(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),wu(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{if(lf(e))return;let c=i?Object.getOwnPropertyNames(e):Object.keys(e),l=c.length,u;for(n=0;n<l;n++)u=c[n],t.call(null,e[u],u,e)}}function Px(e,t){if(lf(e))return null;t=t.toLowerCase();let n=Object.keys(e),r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}let vd=yx!==void 0?yx:typeof self<"u"?self:typeof window<"u"?window:global,Lx=e=>!Au(e)&&e!==vd,cie=(ZI=typeof Uint8Array<"u"&&XI(Uint8Array),e=>ZI&&e instanceof ZI);var ZI;let die=Wo("HTMLFormElement"),kx=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),lie=Wo("RegExp"),Mx=(e,t)=>{let n=Object.getOwnPropertyDescriptors(e),r={};hf(n,(i,c)=>{let l;(l=t(i,c,e))!==!1&&(r[c]=l||i)}),Object.defineProperties(e,r)},uie=Wo("AsyncFunction"),xx=(Ux=typeof bx=="function",Fx=_i(vd.postMessage),Ux?bx:Fx?(QI="axios@".concat(Math.random()),dE=[],vd.addEventListener("message",e=>{let{source:t,data:n}=e;t===vd&&n===QI&&dE.length&&dE.shift()()},!1),e=>{dE.push(e),vd.postMessage(QI,"*")}):e=>setTimeout(e));var Ux,Fx,QI,dE;let hie=wx!==void 0?wx.bind(vd):typeof process<"u"&&process.nextTick||xx;var se={isArray:wu,isArrayBuffer:Ox,isBuffer:lf,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||_i(e.append)&&((t=sE(e))==="formdata"||t==="object"&&_i(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ox(e.buffer),t},isString:Zre,isNumber:Nx,isBoolean:e=>e===!0||e===!1,isObject:uf,isPlainObject:cE,isEmptyObject:e=>{if(!uf(e)||lf(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:iie,isRequest:oie,isResponse:sie,isHeaders:aie,isUndefined:Au,isDate:Qre,isFile:eie,isBlob:tie,isRegExp:lie,isFunction:_i,isStream:e=>uf(e)&&_i(e.pipe),isURLSearchParams:rie,isTypedArray:cie,isFileList:nie,forEach:hf,merge:function e(){let{caseless:t,skipUndefined:n}=Lx(this)&&this||{},r={},i=(c,l)=>{let u=t&&Px(r,l)||l;cE(r[u])&&cE(c)?r[u]=e(r[u],c):cE(c)?r[u]=e({},c):wu(c)?r[u]=c.slice():n&&Au(c)||(r[u]=c)};for(let c=0,l=arguments.length;c<l;c++)arguments[c]&&hf(arguments[c],i);return r},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return hf(t,(i,c)=>{n&&_i(i)?e[c]=Ax(i,n):e[c]=i},{allOwnKeys:r}),e},trim:e=>vr(e)?vr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,c,l,u={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),c=i.length;c-- >0;)l=i[c],r&&!r(l,e,t)||u[l]||(t[l]=e[l],u[l]=!0);e=n!==!1&&XI(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:sE,kindOfTest:Wo,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;let r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(wu(e))return e;let t=e.length;if(!Nx(t))return null;let n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{let n=(e&&e[oE]).call(e),r;for(;(r=n.next())&&!r.done;){let i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n,r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:die,hasOwnProperty:kx,hasOwnProp:kx,reduceDescriptors:Mx,freezeMethods:e=>{Mx(e,(t,n)=>{if(_i(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;let r=e[n];_i(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{let n={},r=i=>{i.forEach(c=>{n[c]=!0})};return wu(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:Px,global:vd,isContextDefined:Lx,isSpecCompliantForm:function(e){return!!(e&&_i(e.append)&&e[Dx]==="FormData"&&e[oE])},toJSONObject:e=>{let t=new Array(10),n=(r,i)=>{if(uf(r)){if(t.indexOf(r)>=0)return;if(lf(r))return r;if(!("toJSON"in r)){t[i]=r;let c=wu(r)?[]:{};return hf(r,(l,u)=>{let h=n(l,i+1);!Au(h)&&(c[u]=h)}),t[i]=void 0,c}}return r};return n(e,0)},isAsyncFn:uie,isThenable:e=>e&&(uf(e)||_i(e))&&_i(e.then)&&_i(e.catch),setImmediate:xx,asap:hie,isIterable:e=>e!=null&&_i(e[oE])};function vt(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}se.inherits(vt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:se.toJSONObject(this.config),code:this.code,status:this.status}}});let Vx=vt.prototype,jx={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{jx[e]={value:e}}),Object.defineProperties(vt,jx),Object.defineProperty(Vx,"isAxiosError",{value:!0}),vt.from=(e,t,n,r,i,c)=>{let l=Object.create(Vx);se.toFlatObject(e,l,function(f){return f!==Error.prototype},f=>f!=="isAxiosError");let u=e&&e.message?e.message:"Error",h=t==null&&e?e.code:t;return vt.call(l,u,h,n,r,i),e&&l.cause==null&&Object.defineProperty(l,"cause",{value:e,configurable:!0}),l.name=e&&e.name||"Error",c&&Object.assign(l,c),l};function eb(e){return se.isPlainObject(e)||se.isArray(e)}function Bx(e){return se.endsWith(e,"[]")?e.slice(0,-2):e}function Hx(e,t,n){return e?e.concat(t).map(function(r,i){return r=Bx(r),!n&&i?"["+r+"]":r}).join(n?".":""):t}let pie=se.toFlatObject(se,{},null,function(e){return/^is[A-Z]/.test(e)});function lE(e,t,n){if(!se.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let r=(n=se.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,y){return!se.isUndefined(y[_])})).metaTokens,i=n.visitor||f,c=n.dots,l=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&se.isSpecCompliantForm(t);if(!se.isFunction(i))throw new TypeError("visitor must be a function");function h(_){if(_===null)return"";if(se.isDate(_))return _.toISOString();if(se.isBoolean(_))return _.toString();if(!u&&se.isBlob(_))throw new vt("Blob is not supported. Use a Buffer instead.");return se.isArrayBuffer(_)||se.isTypedArray(_)?u&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function f(_,y,A){let C=_;if(_&&!A&&typeof _=="object"){if(se.endsWith(y,"{}"))y=r?y:y.slice(0,-2),_=JSON.stringify(_);else if(se.isArray(_)&&(function(I){return se.isArray(I)&&!I.some(eb)})(_)||(se.isFileList(_)||se.endsWith(y,"[]"))&&(C=se.toArray(_)))return y=Bx(y),C.forEach(function(I,N){!se.isUndefined(I)&&I!==null&&t.append(l===!0?Hx([y],N,c):l===null?y:y+"[]",h(I))}),!1}return!!eb(_)||(t.append(Hx(A,y,c),h(_)),!1)}let m=[],E=Object.assign(pie,{defaultVisitor:f,convertValue:h,isVisitable:eb});if(!se.isObject(e))throw new TypeError("data must be an object");return(function _(y,A){if(!se.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+A.join("."));m.push(y),se.forEach(y,function(C,I){(!(se.isUndefined(C)||C===null)&&i.call(t,C,se.isString(I)?vr(I).call(I):I,A,E))===!0&&_(C,A?A.concat(I):[I])}),m.pop()}})(e),t}function Gx(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function tb(e,t){this._pairs=[],e&&lE(e,this,t)}let Wx=tb.prototype;function fie(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function qx(e,t,n){if(!t)return e;let r=n&&n.encode||fie;se.isFunction(n)&&(n={serialize:n});let i=n&&n.serialize,c;if(c=i?i(t,n):se.isURLSearchParams(t)?t.toString():new tb(t,n).toString(r),c){let l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+c}return e}Wx.append=function(e,t){this._pairs.push([e,t])},Wx.toString=function(e){let t=e?function(n){return e.call(this,n,Gx)}:Gx;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var zx=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){se.forEach(this.handlers,function(t){t!==null&&e(t)})}},Kx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Yx={exports:{}},mie=st,gie=zr,$x=lo.f;mie({target:"Object",stat:!0,forced:Object.defineProperty!==$x,sham:!gie},{defineProperty:$x});var Xx=mi.Object,_ie=Yx.exports=function(e,t,n){return Xx.defineProperty(e,t,n)};Xx.defineProperty.sham&&(_ie.sham=!0);var Jx=a(Yx.exports),Eie=TypeError,Zx=Wp,vie=O_,yie=Er,Sie=un("species"),Qx=Array,Tie=function(e){var t;return Zx(e)&&(t=e.constructor,(vie(t)&&(t===Qx||Zx(t.prototype))||yie(t)&&(t=t[Sie])===null)&&(t=void 0)),t===void 0?Qx:t},eU=function(e,t){return new(Tie(e))(t===0?0:t)},Cie=d,Rie=cd,Iie=un("species"),tU=function(e){return Rie>=51||!Cie(function(){var t=[];return(t.constructor={})[Iie]=function(){return{foo:1}},t[e](Boolean).foo!==1})},bie=st,wie=d,Aie=Wp,Die=Er,Oie=jo,Nie=ac,nU=function(e){if(e>9007199254740991)throw Eie("Maximum allowed index exceeded");return e},rU=dI,Pie=eU,Lie=tU,kie=cd,iU=un("isConcatSpreadable"),Mie=kie>=51||!wie(function(){var e=[];return e[iU]=!1,e.concat()[0]!==e}),xie=function(e){if(!Die(e))return!1;var t=e[iU];return t!==void 0?!!t:Aie(e)};bie({target:"Array",proto:!0,arity:1,forced:!Mie||!Lie("concat")},{concat:function(e){var t,n,r,i,c,l=Oie(this),u=Pie(l,0),h=0;for(t=-1,r=arguments.length;t<r;t++)if(xie(c=t===-1?l:arguments[t]))for(i=Nie(c),nU(h+i),n=0;n<i;n++,h++)n in c&&rU(u,h,c[n]);else nU(h+1),rU(u,h++,c);return u.length=h,u}});var oU={},Uie=_r,Fie=oc,sU=f_.f,Vie=lc,aU=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];oU.f=function(e){return aU&&Uie(e)==="Window"?(function(t){try{return sU(t)}catch{return Vie(aU)}})(e):sU(Fie(e))};var Du={},jie=un;Du.f=jie;var cU=mi,Bie=Qn,Hie=Du,Gie=lo.f,xn=function(e){var t=cU.Symbol||(cU.Symbol={});Bie(t,e)||Gie(t,e,{value:Hie.f(e)})},Wie=Hn,qie=Nr,zie=un,Kie=dc,dU=function(){var e=qie("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=zie("toPrimitive");t&&!t[r]&&Kie(t,r,function(i){return Wie(n,this)},{arity:1})},Yie=sc,$ie=s_,Xie=jo,Jie=ac,Zie=eU,lU=x([].push),gc=function(e){var t=e===1,n=e===2,r=e===3,i=e===4,c=e===6,l=e===7,u=e===5||c;return function(h,f,m,E){for(var _,y,A=Xie(h),C=$ie(A),I=Jie(C),N=Yie(f,m),L=0,M=E||Zie,V=t?M(h,I):n||l?M(h,0):void 0;I>L;L++)if((u||L in C)&&(y=N(_=C[L],L,A),e))if(t)V[L]=y;else if(y)switch(e){case 3:return!0;case 5:return _;case 6:return L;case 2:lU(V,_)}else switch(e){case 4:return!1;case 7:lU(V,_)}return c?-1:r||i?i:V}},uU={forEach:gc(0),map:gc(1),filter:gc(2),some:gc(3),every:gc(4),find:gc(5),findIndex:gc(6),filterReject:gc(7)},uE=st,pf=ee,nb=Hn,Qie=x,Ou=zr,Nu=tu,eoe=d,yr=Qn,toe=B,rb=oi,hE=oc,ib=MC,noe=si,ob=rc,Pu=zp,hU=g_,roe=f_,pU=oU,ioe=qp,fU=n_,mU=lo,ooe=nR,gU=i_,_U=dc,soe=D_,sb=ru,EU=m_,vU=LC,aoe=un,coe=Du,doe=xn,loe=dU,uoe=ma,yU=ud,pE=uU.forEach,Ei=p_("hidden"),fE="Symbol",ff="prototype",hoe=yU.set,SU=yU.getterFor(fE),qo=Object[ff],yd=pf.Symbol,mE=yd&&yd[ff],poe=pf.RangeError,foe=pf.TypeError,ab=pf.QObject,TU=fU.f,Sd=mU.f,CU=pU.f,moe=gU.f,RU=Qie([].push),Ea=sb("symbols"),mf=sb("op-symbols"),goe=sb("wks"),cb=!ab||!ab[ff]||!ab[ff].findChild,IU=function(e,t,n){var r=TU(qo,t);r&&delete qo[t],Sd(e,t,n),r&&e!==qo&&Sd(qo,t,r)},db=Ou&&eoe(function(){return Pu(Sd({},"a",{get:function(){return Sd(this,"a",{value:7}).a}})).a!==7})?IU:Sd,lb=function(e,t){var n=Ea[e]=Pu(mE);return hoe(n,{type:fE,tag:e,description:t}),Ou||(n.description=t),n},gE=function(e,t,n){e===qo&&gE(mf,t,n),rb(e);var r=ib(t);return rb(n),yr(Ea,r)?(n.enumerable?(yr(e,Ei)&&e[Ei][r]&&(e[Ei][r]=!1),n=Pu(n,{enumerable:ob(0,!1)})):(yr(e,Ei)||Sd(e,Ei,ob(1,Pu(null))),e[Ei][r]=!0),db(e,r,n)):Sd(e,r,n)},ub=function(e,t){rb(e);var n=hE(t),r=hU(n).concat(DU(n));return pE(r,function(i){Ou&&!nb(bU,n,i)||gE(e,i,n[i])}),e},bU=function(e){var t=ib(e),n=nb(moe,this,t);return!(this===qo&&yr(Ea,t)&&!yr(mf,t))&&(!(n||!yr(this,t)||!yr(Ea,t)||yr(this,Ei)&&this[Ei][t])||n)},wU=function(e,t){var n=hE(e),r=ib(t);if(n!==qo||!yr(Ea,r)||yr(mf,r)){var i=TU(n,r);return!i||!yr(Ea,r)||yr(n,Ei)&&n[Ei][r]||(i.enumerable=!0),i}},AU=function(e){var t=CU(hE(e)),n=[];return pE(t,function(r){yr(Ea,r)||yr(EU,r)||RU(n,r)}),n},DU=function(e){var t=e===qo,n=CU(t?mf:hE(e)),r=[];return pE(n,function(i){!yr(Ea,i)||t&&!yr(qo,i)||RU(r,Ea[i])}),r};Nu||(yd=function(){if(toe(mE,this))throw new foe("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?noe(arguments[0]):void 0,t=vU(e),n=function(r){var i=this===void 0?pf:this;i===qo&&nb(n,mf,r),yr(i,Ei)&&yr(i[Ei],t)&&(i[Ei][t]=!1);var c=ob(1,r);try{db(i,t,c)}catch(l){if(!(l instanceof poe))throw l;IU(i,t,c)}};return Ou&&cb&&db(qo,t,{configurable:!0,set:n}),lb(t,e)},_U(mE=yd[ff],"toString",function(){return SU(this).tag}),_U(yd,"withoutSetter",function(e){return lb(vU(e),e)}),gU.f=bU,mU.f=gE,ooe.f=ub,fU.f=wU,roe.f=pU.f=AU,ioe.f=DU,coe.f=function(e){return lb(aoe(e),e)},Ou&&soe(mE,"description",{configurable:!0,get:function(){return SU(this).description}})),uE({global:!0,constructor:!0,wrap:!0,forced:!Nu,sham:!Nu},{Symbol:yd}),pE(hU(goe),function(e){doe(e)}),uE({target:fE,stat:!0,forced:!Nu},{useSetter:function(){cb=!0},useSimple:function(){cb=!1}}),uE({target:"Object",stat:!0,forced:!Nu,sham:!Ou},{create:function(e,t){return t===void 0?Pu(e):ub(Pu(e),t)},defineProperty:gE,defineProperties:ub,getOwnPropertyDescriptor:wU}),uE({target:"Object",stat:!0,forced:!Nu},{getOwnPropertyNames:AU}),loe(),uoe(yd,fE),EU[Ei]=!0;var OU=tu&&!!Symbol.for&&!!Symbol.keyFor,_oe=st,Eoe=Nr,voe=Qn,yoe=si,NU=ru,Soe=OU,hb=NU("string-to-symbol-registry"),Toe=NU("symbol-to-string-registry");_oe({target:"Symbol",stat:!0,forced:!Soe},{for:function(e){var t=yoe(e);if(voe(hb,t))return hb[t];var n=Eoe("Symbol")(t);return hb[t]=n,Toe[n]=t,n}});var Coe=st,Roe=Qn,Ioe=Vp,boe=nu,woe=OU,PU=ru("symbol-to-string-registry");Coe({target:"Symbol",stat:!0,forced:!woe},{keyFor:function(e){if(!Ioe(e))throw new TypeError(boe(e)+" is not a symbol");if(Roe(PU,e))return PU[e]}});var LU=Wp,Aoe=Mn,kU=_r,Doe=si,MU=x([].push),Ooe=st,xU=Nr,UU=Oe,Noe=Hn,gf=x,FU=d,VU=Mn,jU=Vp,BU=lc,Poe=function(e){if(Aoe(e))return e;if(LU(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?MU(n,i):typeof i!="number"&&kU(i)!=="Number"&&kU(i)!=="String"||MU(n,Doe(i))}var c=n.length,l=!0;return function(u,h){if(l)return l=!1,h;if(LU(this))return h;for(var f=0;f<c;f++)if(n[f]===u)return h}}},Loe=tu,koe=String,_c=xU("JSON","stringify"),_E=gf(/./.exec),HU=gf("".charAt),Moe=gf("".charCodeAt),xoe=gf("".replace),Uoe=gf(1.1.toString),Foe=/[\uD800-\uDFFF]/g,GU=/^[\uD800-\uDBFF]$/,WU=/^[\uDC00-\uDFFF]$/,qU=!Loe||FU(function(){var e=xU("Symbol")("stringify detection");return _c([e])!=="[null]"||_c({a:e})!=="{}"||_c(Object(e))!=="{}"}),zU=FU(function(){return _c("\uDF06\uD834")!=='"\\udf06\\ud834"'||_c("\uDEAD")!=='"\\udead"'}),Voe=function(e,t){var n=BU(arguments),r=Poe(t);if(VU(r)||e!==void 0&&!jU(e))return n[1]=function(i,c){if(VU(r)&&(c=Noe(r,this,koe(i),c)),!jU(c))return c},UU(_c,null,n)},joe=function(e,t,n){var r=HU(n,t-1),i=HU(n,t+1);return _E(GU,e)&&!_E(WU,i)||_E(WU,e)&&!_E(GU,r)?"\\u"+Uoe(Moe(e,0),16):e};_c&&Ooe({target:"JSON",stat:!0,arity:3,forced:qU||zU},{stringify:function(e,t,n){var r=BU(arguments),i=UU(qU?Voe:_c,null,r);return zU&&typeof i=="string"?xoe(i,Foe,joe):i}});var KU=qp,Boe=jo;st({target:"Object",stat:!0,forced:!tu||d(function(){KU.f(1)})},{getOwnPropertySymbols:function(e){var t=KU.f;return t?t(Boe(e)):[]}}),xn("asyncDispose"),xn("asyncIterator"),xn("dispose"),xn("hasInstance"),xn("isConcatSpreadable"),xn("iterator"),xn("match"),xn("matchAll"),xn("replace"),xn("search"),xn("species"),xn("split");var Hoe=dU;xn("toPrimitive"),Hoe();var Goe=Nr,Woe=ma;xn("toStringTag"),Woe(Goe("Symbol"),"Symbol"),xn("unscopables"),ma(ee.JSON,"JSON",!0);var qoe=mi.Symbol,zoe=un,Koe=lo.f,YU=zoe("metadata"),$U=Function.prototype;$U[YU]===void 0&&Koe($U,YU,{value:null}),xn("metadata");var Yoe=qoe,$oe=x,pb=Nr("Symbol"),Xoe=pb.keyFor,Joe=$oe(pb.prototype.valueOf),XU=pb.isRegisteredSymbol||function(e){try{return Xoe(Joe(e))!==void 0}catch{return!1}};st({target:"Symbol",stat:!0},{isRegisteredSymbol:XU});for(var Zoe=ru,JU=Nr,Qoe=x,ese=Vp,tse=un,EE=JU("Symbol"),ZU=EE.isWellKnownSymbol,QU=JU("Object","getOwnPropertyNames"),nse=Qoe(EE.prototype.valueOf),eF=Zoe("wks"),fb=0,tF=QU(EE),rse=tF.length;fb<rse;fb++)try{var nF=tF[fb];ese(EE[nF])&&tse(nF)}catch{}var rF=function(e){if(ZU&&ZU(e))return!0;try{for(var t=nse(e),n=0,r=QU(eF),i=r.length;n<i;n++)if(eF[r[n]]==t)return!0}catch{}return!1};st({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:rF}),xn("customMatcher"),xn("observable"),st({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:XU}),st({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:rF}),xn("matcher"),xn("metadataKey"),xn("patternMatch"),xn("replaceAll");var Lu=a(Yoe),iF=a(Du.f("iterator"));function _f(e){return _f=typeof Lu=="function"&&typeof iF=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Lu=="function"&&t.constructor===Lu&&t!==Lu.prototype?"symbol":typeof t},_f(e)}var ise=a(Du.f("toPrimitive"));function ose(e){var t=(function(n,r){if(_f(n)!="object"||!n)return n;var i=n[ise];if(i!==void 0){var c=i.call(n,r||"default");if(_f(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)})(e,"string");return _f(t)=="symbol"?t:t+""}function w(e,t,n){return(t=ose(t))in e?Jx(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oF=a(Nte),sse={isBrowser:!0,classes:{URLSearchParams:oF!==void 0?oF:tb,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let mb=typeof window<"u"&&typeof document<"u",gb=typeof navigator=="object"&&navigator||void 0,ase=mb&&(!gb||["ReactNative","NativeScript","NS"].indexOf(gb.product)<0),cse=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",dse=mb&&window.location.href||"http://localhost";function sF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function aF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sF(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Kr=aF(aF({},Object.freeze({__proto__:null,hasBrowserEnv:mb,hasStandardBrowserEnv:ase,hasStandardBrowserWebWorkerEnv:cse,navigator:gb,origin:dse})),sse);function cF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function lse(e,t){return lE(e,new Kr.classes.URLSearchParams,(function(n){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?cF(Object(i),!0).forEach(function(c){w(n,c,i[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):cF(Object(i)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(i,c))})}return n})({visitor:function(n,r,i,c){return Kr.isNode&&se.isBuffer(n)?(this.append(r,n.toString("base64")),!1):c.defaultVisitor.apply(this,arguments)}},t))}var use=$R.charAt,dF=Hn,hse=oi,pse=Mn,fse=_r,mse=/./.exec,gse=TypeError,_se=st,lF=Hn,uF=Fp,Ese=gR,vE=w_,hF=ic,pF=cL,Ef=si,vse=oi,yse=Er,Sse=_r,Tse=qC,fF=BI,Cse=jp,Rse=d,Ise=TR,bse=function(e,t,n){return t+(n?use(e,t).length:1)},wse=function(e,t){var n=e.exec;if(pse(n)){var r=dF(n,e,t);return r!==null&&hse(r),r}if(fse(e)==="RegExp")return dF(mse,e,t);throw new gse("RegExp#exec called on incompatible receiver")},mF=ud,Ase=un("matchAll"),gF="RegExp String",_F=gF+" Iterator",Dse=mF.set,Ose=mF.getterFor(_F),Nse=TypeError,_b=uF("".indexOf),yE=uF("".matchAll),Eb=!!yE&&!Rse(function(){yE("a",/./)}),Pse=Ese(function(e,t,n,r){Dse(this,{type:_F,regexp:e,string:t,global:n,unicode:r,done:!1})},gF,function(){var e=Ose(this);if(e.done)return vE(void 0,!0);var t=e.regexp,n=e.string,r=wse(t,n);return r===null?(e.done=!0,vE(void 0,!0)):e.global?(Ef(r[0])===""&&(t.lastIndex=bse(n,pF(t.lastIndex),e.unicode)),vE(r,!1)):(e.done=!0,vE(r,!1))}),EF=function(e){var t,n,r,i=vse(this),c=Ef(e),l=Ise(i,RegExp),u=Ef(fF(i));return t=new l(l===RegExp?i.source:i,u),n=!!~_b(u,"g"),r=!!~_b(u,"u"),t.lastIndex=pF(i.lastIndex),new Pse(t,c,n,r)};_se({target:"String",proto:!0,forced:Eb},{matchAll:function(e){var t,n,r,i,c=hF(this);if(yse(e)){if(Tse(e)&&(t=Ef(hF(fF(e))),!~_b(t,"g")))throw new Nse("`.matchAll` does not allow non-global regexes");if(Eb)return yE(c,e);if((r=Cse(e,Ase))===void 0&&Sse(e)==="RegExp"&&(r=EF),r)return lF(r,e,c)}else if(Eb)return yE(c,e);return n=Ef(c),i=new RegExp(e,"g"),lF(EF,i,n)}});var Lse=xi("String","matchAll"),kse=B,Mse=Lse,vb=String.prototype,xse=function(e){var t=e.matchAll;return typeof e=="string"||e===vb||kse(vb,e)&&t===vb.matchAll?Mse:t},Use=a(xse);function vF(e){function t(n,r,i,c){let l=n[c++];if(l==="__proto__")return!0;let u=Number.isFinite(+l),h=c>=n.length;return l=!l&&se.isArray(i)?i.length:l,h?(se.hasOwnProp(i,l)?i[l]=[i[l],r]:i[l]=r,!u):(i[l]&&se.isObject(i[l])||(i[l]=[]),t(n,r,i[l],c)&&se.isArray(i[l])&&(i[l]=(function(f){let m={},E=Object.keys(f),_,y=E.length,A;for(_=0;_<y;_++)A=E[_],m[A]=f[A];return m})(i[l])),!u)}if(se.isFormData(e)&&se.isFunction(e.entries)){let n={};return se.forEachEntry(e,(r,i)=>{t((function(c){return Use(se).call(se,/\w+|\[(\w*)]/g,c).map(l=>l[0]==="[]"?"":l[1]||l[0])})(r),i,n,0)}),n}return null}let yb={transitional:Kx,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=se.isObject(e);if(i&&se.isHTMLForm(e)&&(e=new FormData(e)),se.isFormData(e))return r?JSON.stringify(vF(e)):e;if(se.isArrayBuffer(e)||se.isBuffer(e)||se.isStream(e)||se.isFile(e)||se.isBlob(e)||se.isReadableStream(e))return e;if(se.isArrayBufferView(e))return e.buffer;if(se.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return lse(e,this.formSerializer).toString();if((c=se.isFileList(e))||n.indexOf("multipart/form-data")>-1){let l=this.env&&this.env.FormData;return lE(c?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),(function(l,u,h){if(se.isString(l))try{return(u||JSON.parse)(l),vr(se).call(se,l)}catch(f){if(f.name!=="SyntaxError")throw f}return(h||JSON.stringify)(l)})(e)):e}],transformResponse:[function(e){let t=this.transitional||yb.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(se.isResponse(e)||se.isReadableStream(e))return e;if(e&&se.isString(e)&&(n&&!this.responseType||r)){let i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(c){if(i)throw c.name==="SyntaxError"?vt.from(c,vt.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Kr.classes.FormData,Blob:Kr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};se.forEach(["delete","get","head","post","put","patch"],e=>{yb.headers[e]={}});var Sb=yb;let Fse=se.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),yF=Symbol("internals");function vf(e){var t;return e&&vr(t=String(e)).call(t).toLowerCase()}function SE(e){return e===!1||e==null?e:se.isArray(e)?e.map(SE):String(e)}function Tb(e,t,n,r,i){return se.isFunction(r)?r.call(this,t,n):(i&&(t=n),se.isString(t)?se.isString(r)?t.indexOf(r)!==-1:se.isRegExp(r)?r.test(t):void 0:void 0)}class TE{constructor(t){t&&this.set(t)}set(t,n,r){let i=this;function c(h,f,m){let E=vf(f);if(!E)throw new Error("header name must be a non-empty string");let _=se.findKey(i,E);(!_||i[_]===void 0||m===!0||m===void 0&&i[_]!==!1)&&(i[_||f]=SE(h))}let l=(h,f)=>se.forEach(h,(m,E)=>c(m,E,f));if(se.isPlainObject(t)||t instanceof this.constructor)l(t,n);else if(se.isString(t)&&(t=vr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(vr(u=t).call(u)))l((h=>{let f={},m,E,_;return h&&h.split(`
`).forEach(function(y){var A,C;_=y.indexOf(":"),m=vr(A=y.substring(0,_)).call(A).toLowerCase(),E=vr(C=y.substring(_+1)).call(C),!m||f[m]&&Fse[m]||(m==="set-cookie"?f[m]?f[m].push(E):f[m]=[E]:f[m]=f[m]?f[m]+", "+E:E)}),f})(t),n);else if(se.isObject(t)&&se.isIterable(t)){let h,f,m={};for(let E of t){if(!se.isArray(E))throw TypeError("Object iterator must return a key-value pair");m[f=E[0]]=(h=m[f])?se.isArray(h)?[...h,E[1]]:[h,E[1]]:E[1]}l(m,n)}else t!=null&&c(n,t,r);var u;return this}get(t,n){if(t=vf(t)){let r=se.findKey(this,t);if(r){let i=this[r];if(!n)return i;if(n===!0)return(function(c){let l=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,h;for(;h=u.exec(c);)l[h[1]]=h[2];return l})(i);if(se.isFunction(n))return n.call(this,i,r);if(se.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=vf(t)){let r=se.findKey(this,t);return!(!r||this[r]===void 0||n&&!Tb(0,this[r],r,n))}return!1}delete(t,n){let r=this,i=!1;function c(l){if(l=vf(l)){let u=se.findKey(r,l);!u||n&&!Tb(0,r[u],u,n)||(delete r[u],i=!0)}}return se.isArray(t)?t.forEach(c):c(t),i}clear(t){let n=Object.keys(this),r=n.length,i=!1;for(;r--;){let c=n[r];t&&!Tb(0,this[c],c,t,!0)||(delete this[c],i=!0)}return i}normalize(t){let n=this,r={};return se.forEach(this,(i,c)=>{var l;let u=se.findKey(r,c);if(u)return n[u]=SE(i),void delete n[c];let h=t?(function(f){return vr(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,E,_)=>E.toUpperCase()+_)})(c):vr(l=String(c)).call(l);h!==c&&delete n[c],n[h]=SE(i),r[h]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){let n=Object.create(null);return se.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=t&&se.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),c=1;c<r;c++)i[c-1]=arguments[c];return i.forEach(l=>n.set(l)),n}static accessor(t){let n=(this[yF]=this[yF]={accessors:{}}).accessors,r=this.prototype;function i(c){let l=vf(c);n[l]||((function(u,h){let f=se.toCamelCase(" "+h);["get","set","has"].forEach(m=>{Object.defineProperty(u,m+f,{value:function(E,_,y){return this[m].call(this,h,E,_,y)},configurable:!0})})})(r,c),n[l]=!0)}return se.isArray(t)?t.forEach(i):i(t),this}}TE.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),se.reduceDescriptors(TE.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}}),se.freezeMethods(TE);var zo=TE;function Cb(e,t){let n=this||Sb,r=t||n,i=zo.from(r.headers),c=r.data;return se.forEach(e,function(l){c=l.call(n,c,i.normalize(),t?t.status:void 0)}),i.normalize(),c}function SF(e){return!(!e||!e.__CANCEL__)}function ku(e,t,n){vt.call(this,e??"canceled",vt.ERR_CANCELED,t,n),this.name="CanceledError"}function TF(e,t,n){let r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new vt("Request failed with status code "+n.status,[vt.ERR_BAD_REQUEST,vt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}se.inherits(ku,vt,{__CANCEL__:!0});let CE=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0,i=(function(c,l){c=c||10;let u=new Array(c),h=new Array(c),f,m=0,E=0;return l=l!==void 0?l:1e3,function(_){let y=Date.now(),A=h[E];f||(f=y),u[m]=_,h[m]=y;let C=E,I=0;for(;C!==m;)I+=u[C++],C%=c;if(m=(m+1)%c,m===E&&(E=(E+1)%c),y-f<l)return;let N=A&&y-A;return N?Math.round(1e3*I/N):void 0}})(50,250);return(function(c,l){let u,h,f=0,m=1e3/l,E=function(_){f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),u=null,h&&(clearTimeout(h),h=null),c(..._)};return[function(){let _=Date.now(),y=_-f;for(var A=arguments.length,C=new Array(A),I=0;I<A;I++)C[I]=arguments[I];y>=m?E(C,_):(u=C,h||(h=setTimeout(()=>{h=null,E(u)},m-y)))},()=>u&&E(u)]})(c=>{let l=c.loaded,u=c.lengthComputable?c.total:void 0,h=l-r,f=i(h);r=l,e({loaded:l,total:u,progress:u?l/u:void 0,bytes:h,rate:f||void 0,estimated:f&&u&&l<=u?(u-l)/f:void 0,event:c,lengthComputable:u!=null,[t?"download":"upload"]:!0})},n)},CF=(e,t)=>{let n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},RF=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return se.asap(()=>e(...n))};var Vse=Kr.hasStandardBrowserEnv?((e,t)=>n=>(n=new Z_(n,Kr.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new Z_(Kr.origin),Kr.navigator&&/(msie|trident)/i.test(Kr.navigator.userAgent)):()=>!0,jse=Kr.hasStandardBrowserEnv?{write(e,t,n,r,i,c,l){if(typeof document>"u")return;let u=["".concat(e,"=").concat(encodeURIComponent(t))];se.isNumber(n)&&u.push("expires=".concat(new Date(n).toUTCString())),se.isString(r)&&u.push("path=".concat(r)),se.isString(i)&&u.push("domain=".concat(i)),c===!0&&u.push("secure"),se.isString(l)&&u.push("SameSite=".concat(l)),document.cookie=u.join("; ")},read(e){if(typeof document>"u")return null;let t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function IF(e,t,n){let r=!(function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)})(t);return e&&(r||n==0)?(function(i,c){return c?i.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):i})(e,t):t}function bF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Rb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bF(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let wF=e=>e instanceof zo?Rb({},e):e;function Td(e,t){t=t||{};let n={};function r(f,m,E,_){return se.isPlainObject(f)&&se.isPlainObject(m)?se.merge.call({caseless:_},f,m):se.isPlainObject(m)?se.merge({},m):se.isArray(m)?m.slice():m}function i(f,m,E,_){return se.isUndefined(m)?se.isUndefined(f)?void 0:r(void 0,f,0,_):r(f,m,0,_)}function c(f,m){if(!se.isUndefined(m))return r(void 0,m)}function l(f,m){return se.isUndefined(m)?se.isUndefined(f)?void 0:r(void 0,f):r(void 0,m)}function u(f,m,E){return E in t?r(f,m):E in e?r(void 0,f):void 0}let h={url:c,method:c,data:c,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(f,m,E)=>i(wF(f),wF(m),0,!0)};return se.forEach(Object.keys(Rb(Rb({},e),t)),function(f){let m=h[f]||i,E=m(e[f],t[f],f);se.isUndefined(E)&&m!==u||(n[f]=E)}),n}var AF=e=>{let t=Td({},e),{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:c,headers:l,auth:u}=t;if(t.headers=l=zo.from(l),t.url=qx(IF(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),se.isFormData(n)){if(Kr.hasStandardBrowserEnv||Kr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(se.isFunction(n.getHeaders)){let h=n.getHeaders(),f=["content-type","content-length"];Object.entries(h).forEach(m=>{let[E,_]=m;J(f).call(f,E.toLowerCase())&&l.set(E,_)})}}if(Kr.hasStandardBrowserEnv&&(r&&se.isFunction(r)&&(r=r(t)),r||r!==!1&&Vse(t.url))){let h=i&&c&&jse.read(c);h&&l.set(i,h)}return t},Bse=typeof XMLHttpRequest<"u"&&function(e){return new ie(function(t,n){let r=AF(e),i=r.data,c=zo.from(r.headers).normalize(),l,u,h,f,m,{responseType:E,onUploadProgress:_,onDownloadProgress:y}=r;function A(){f&&f(),m&&m(),r.cancelToken&&r.cancelToken.unsubscribe(l),r.signal&&r.signal.removeEventListener("abort",l)}let C=new XMLHttpRequest;function I(){if(!C)return;let L=zo.from("getAllResponseHeaders"in C&&C.getAllResponseHeaders());TF(function(M){t(M),A()},function(M){n(M),A()},{data:E&&E!=="text"&&E!=="json"?C.response:C.responseText,status:C.status,statusText:C.statusText,headers:L,config:e,request:C}),C=null}C.open(r.method.toUpperCase(),r.url,!0),C.timeout=r.timeout,"onloadend"in C?C.onloadend=I:C.onreadystatechange=function(){C&&C.readyState===4&&(C.status!==0||C.responseURL&&C.responseURL.indexOf("file:")===0)&&setTimeout(I)},C.onabort=function(){C&&(n(new vt("Request aborted",vt.ECONNABORTED,e,C)),C=null)},C.onerror=function(L){let M=new vt(L&&L.message?L.message:"Network Error",vt.ERR_NETWORK,e,C);M.event=L||null,n(M),C=null},C.ontimeout=function(){let L=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",M=r.transitional||Kx;r.timeoutErrorMessage&&(L=r.timeoutErrorMessage),n(new vt(L,M.clarifyTimeoutError?vt.ETIMEDOUT:vt.ECONNABORTED,e,C)),C=null},i===void 0&&c.setContentType(null),"setRequestHeader"in C&&se.forEach(c.toJSON(),function(L,M){C.setRequestHeader(M,L)}),se.isUndefined(r.withCredentials)||(C.withCredentials=!!r.withCredentials),E&&E!=="json"&&(C.responseType=r.responseType),y&&([h,m]=CE(y,!0),C.addEventListener("progress",h)),_&&C.upload&&([u,f]=CE(_),C.upload.addEventListener("progress",u),C.upload.addEventListener("loadend",f)),(r.cancelToken||r.signal)&&(l=L=>{C&&(n(!L||L.type?new ku(null,e,C):L),C.abort(),C=null)},r.cancelToken&&r.cancelToken.subscribe(l),r.signal&&(r.signal.aborted?l():r.signal.addEventListener("abort",l)));let N=(function(L){let M=/^([-+\w]{1,25})(:?\/\/|:)/.exec(L);return M&&M[1]||""})(r.url);N&&Kr.protocols.indexOf(N)===-1?n(new vt("Unsupported protocol "+N+":",vt.ERR_BAD_REQUEST,e)):C.send(i||null)})},Hse=(e,t)=>{let{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,i=new AbortController,c=function(f){if(!r){r=!0,u();let m=f instanceof Error?f:this.reason;i.abort(m instanceof vt?m:new ku(m instanceof Error?m.message:m))}},l=t&&setTimeout(()=>{l=null,c(new vt("timeout ".concat(t," of ms exceeded"),vt.ETIMEDOUT))},t),u=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(c):f.removeEventListener("abort",c)}),e=null)};e.forEach(f=>f.addEventListener("abort",c));let{signal:h}=i;return h.unsubscribe=()=>se.asap(u),h}},Ib=a(hM),DF=Du.f("asyncIterator"),Gse=a(DF);function bb(e,t){this.v=e,this.k=t}function Pr(e){return function(){return new yf(e.apply(this,arguments))}}function yf(e){var t,n;function r(c,l){try{var u=e[c](l),h=u.value,f=h instanceof bb;Ib.resolve(f?h.v:h).then(function(m){if(f){var E=c==="return"?"return":"next";if(!h.k||m.done)return r(E,m);m=e[E](m).value}i(u.done?"return":"normal",m)},function(m){r("throw",m)})}catch(m){i("throw",m)}}function i(c,l){switch(c){case"return":t.resolve({value:l,done:!0});break;case"throw":t.reject(l);break;default:t.resolve({value:l,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(c,l){return new Ib(function(u,h){var f={key:c,arg:l,resolve:u,reject:h,next:null};n?n=n.next=f:(t=n=f,r(c,l))})},typeof e.return!="function"&&(this.return=void 0)}function ke(e){return new bb(e,0)}function Mu(e){var t={},n=!1;function r(i,c){return n=!0,c=new Ib(function(l){l(e[i](c))}),{done:!1,value:new bb(c,1)}}return t[Lu!==void 0&&iF||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}yf.prototype[typeof Lu=="function"&&Gse||"@@asyncIterator"]=function(){return this},yf.prototype.next=function(e){return this._invoke("next",e)},yf.prototype.throw=function(e){return this._invoke("throw",e)},yf.prototype.return=function(e){return this._invoke("return",e)};var RE=a(DF);function wb(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=RE,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new IE(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function IE(e){function t(n){if(Object(n)!==n)return ie.reject(new TypeError(n+" is not an object."));var r=n.done;return ie.resolve(n.value).then(function(i){return{value:i,done:r}})}return IE=function(n){this.s=n,this.n=n.next},IE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ie.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ie.reject(n):t(r.apply(this.s,arguments))}},new IE(e)}let Wse=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},qse=(function(){var e=Pr(function*(t,n){var r,i=!1,c=!1;try{for(var l,u=wb(zse(t));i=!(l=yield ke(u.next())).done;i=!1){let h=l.value;yield*ol(Mu(wb(Wse(h,n))))}}catch(h){c=!0,r=h}finally{try{i&&u.return!=null&&(yield ke(u.return()))}finally{if(c)throw r}}});return function(t,n){return e.apply(this,arguments)}})(),zse=(function(){var e=Pr(function*(t){if(t[RE])return void(yield*ol(Mu(wb(t))));let n=t.getReader();try{for(;;){let{done:r,value:i}=yield ke(n.read());if(r)break;yield i}}finally{yield ke(n.cancel())}});return function(t){return e.apply(this,arguments)}})(),OF=(e,t,n,r)=>{let i=qse(e,t),c,l=0,u=f=>{c||(c=!0,r&&r(f))};return new ReadableStream({pull(f){return O(this,null,function*(){try{let{done:m,value:E}=yield i.next();if(m)return u(),void f.close();let _=E.byteLength;if(n){let y=l+=_;n(y)}f.enqueue(new Uint8Array(E))}catch(m){throw u(m),m}})},cancel:f=>(u(f),i.return())},{highWaterMark:2})};function NF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function PF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NF(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let{isFunction:bE}=se,Kse=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(se.global),{ReadableStream:LF,TextEncoder:kF}=se.global,MF=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},Yse=e=>{e=se.merge.call({skipUndefined:!0},Kse,e);let{fetch:t,Request:n,Response:r}=e,i=t?bE(t):typeof fetch=="function",c=bE(n),l=bE(r);if(!i)return!1;let u=i&&bE(LF),h=i&&(typeof kF=="function"?(f=new kF,A=>f.encode(A)):A=>O(null,null,function*(){return new Uint8Array(yield new n(A).arrayBuffer())}));var f;let m=c&&u&&MF(()=>{let A=!1,C=new n(Kr.origin,{body:new LF,method:"POST",get duplex(){return A=!0,"half"}}).headers.has("Content-Type");return A&&!C}),E=l&&u&&MF(()=>se.isReadableStream(new r("").body)),_={stream:E&&(A=>A.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(A=>{!_[A]&&(_[A]=(C,I)=>{let N=C&&C[A];if(N)return N.call(C);throw new vt("Response type '".concat(A,"' is not supported"),vt.ERR_NOT_SUPPORT,I)})});let y=(A,C)=>O(null,null,function*(){let I=se.toFiniteNumber(A.getContentLength());return I??(N=>O(null,null,function*(){return N==null?0:se.isBlob(N)?N.size:se.isSpecCompliantForm(N)?(yield new n(Kr.origin,{method:"POST",body:N}).arrayBuffer()).byteLength:se.isArrayBufferView(N)||se.isArrayBuffer(N)?N.byteLength:(se.isURLSearchParams(N)&&(N+=""),se.isString(N)?(yield h(N)).byteLength:void 0)}))(C)});return A=>O(null,null,function*(){let{url:C,method:I,data:N,signal:L,cancelToken:M,timeout:V,onDownloadProgress:j,onUploadProgress:U,responseType:H,headers:K,withCredentials:Y="same-origin",fetchOptions:ae}=AF(A),Ce=t||fetch;H=H?(H+"").toLowerCase():"text";let Te=Hse([L,M&&M.toAbortSignal()],V),Le=null,De=Te&&Te.unsubscribe&&(()=>{Te.unsubscribe()}),tt;try{if(U&&m&&I!=="get"&&I!=="head"&&(tt=yield y(K,N))!==0){let R,k=new n(C,{method:"POST",body:N,duplex:"half"});if(se.isFormData(N)&&(R=k.headers.get("content-type"))&&K.setContentType(R),k.body){let[F,Q]=CF(tt,CE(RF(U)));N=OF(k.body,65536,F,Q)}}se.isString(Y)||(Y=Y?"include":"omit");let Ut=c&&"credentials"in n.prototype,$=PF(PF({},ae),{},{signal:Te,method:I.toUpperCase(),headers:K.normalize().toJSON(),body:N,duplex:"half",credentials:Ut?Y:void 0});Le=c&&new n(C,$);let ne=yield c?Ce(Le,ae):Ce(C,$),le=E&&(H==="stream"||H==="response");if(E&&(j||le&&De)){let R={};["status","statusText","headers"].forEach(be=>{R[be]=ne[be]});let k=se.toFiniteNumber(ne.headers.get("content-length")),[F,Q]=j&&CF(k,CE(RF(j),!0))||[];ne=new r(OF(ne.body,65536,F,()=>{Q&&Q(),De&&De()}),R)}H=H||"text";let X=yield _[se.findKey(_,H)||"text"](ne,A);return!le&&De&&De(),yield new ie((R,k)=>{TF(R,k,{data:X,headers:zo.from(ne.headers),status:ne.status,statusText:ne.statusText,config:A,request:Le})})}catch(Ut){throw De&&De(),Ut&&Ut.name==="TypeError"&&/Load failed|fetch/i.test(Ut.message)?Object.assign(new vt("Network Error",vt.ERR_NETWORK,A,Le),{cause:Ut.cause||Ut}):vt.from(Ut,Ut&&Ut.code,A,Le)}})},$se=new Map,xF=e=>{let t=e&&e.env||{},{fetch:n,Request:r,Response:i}=t,c=[r,i,n],l,u,h=c.length,f=$se;for(;h--;)l=c[h],u=f.get(l),u===void 0&&f.set(l,u=h?new Map:Yse(t)),f=u;return u};xF();let Ab={http:null,xhr:Bse,fetch:{get:xF}};se.forEach(Ab,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let UF=e=>"- ".concat(e),Xse=e=>se.isFunction(e)||e===null||e===!1;var FF={getAdapter:function(e,t){e=se.isArray(e)?e:[e];let{length:n}=e,r,i,c={};for(let l=0;l<n;l++){let u;if(r=e[l],i=r,!Xse(r)&&(i=Ab[(u=String(r)).toLowerCase()],i===void 0))throw new vt("Unknown adapter '".concat(u,"'"));if(i&&(se.isFunction(i)||(i=i.get(t))))break;c[u||"#"+l]=i}if(!i){let l=Object.entries(c).map(u=>{let[h,f]=u;return"adapter ".concat(h," ")+(f===!1?"is not supported by the environment":"is not available in the build")});throw new vt("There is no suitable adapter to dispatch the request "+(n?l.length>1?`since :
`+l.map(UF).join(`
`):" "+UF(l[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:Ab};function Db(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ku(null,e)}function VF(e){return Db(e),e.headers=zo.from(e.headers),e.data=Cb.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),FF.getAdapter(e.adapter||Sb.adapter,e)(e).then(function(t){return Db(e),t.data=Cb.call(e,e.transformResponse,t),t.headers=zo.from(t.headers),t},function(t){return SF(t)||(Db(e),t&&t.response&&(t.response.data=Cb.call(e,e.transformResponse,t.response),t.response.headers=zo.from(t.response.headers))),ie.reject(t)})}let jF="1.13.2",wE={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{wE[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});let BF={};wE.transitional=function(e,t,n){function r(i,c){return"[Axios v"+jF+"] Transitional option '"+i+"'"+c+(n?". "+n:"")}return(i,c,l)=>{if(e===!1)throw new vt(r(c," has been removed"+(t?" in "+t:"")),vt.ERR_DEPRECATED);return t&&!BF[c]&&(BF[c]=!0,console.warn(r(c," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,c,l)}},wE.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var AE={assertOptions:function(e,t,n){if(typeof e!="object")throw new vt("options must be an object",vt.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),i=r.length;for(;i-- >0;){let c=r[i],l=t[c];if(l){let u=e[c],h=u===void 0||l(u,c,e);if(h!==!0)throw new vt("option "+c+" must be "+h,vt.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new vt("Unknown option "+c,vt.ERR_BAD_OPTION)}},validators:wE};let As=AE.validators,DE=class{constructor(e){this.defaults=e||{},this.interceptors={request:new zx,response:new zx}}request(e,t){return O(this,null,function*(){try{return yield this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;let i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}})}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Td(this.defaults,t);let{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&AE.assertOptions(n,{silentJSONParsing:As.transitional(As.boolean),forcedJSONParsing:As.transitional(As.boolean),clarifyTimeoutError:As.transitional(As.boolean)},!1),r!=null&&(se.isFunction(r)?t.paramsSerializer={serialize:r}:AE.assertOptions(r,{encode:As.function,serialize:As.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),AE.assertOptions(t,{baseUrl:As.spelling("baseURL"),withXsrfToken:As.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let c=i&&se.merge(i.common,i[t.method]);i&&se.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),t.headers=zo.concat(c,i);let l=[],u=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(u=u&&y.synchronous,l.unshift(y.fulfilled,y.rejected))});let h=[],f;this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)});let m,E=0;if(!u){let y=[VF.bind(this),void 0];for(y.unshift(...l),y.push(...h),m=y.length,f=ie.resolve(t);E<m;)f=f.then(y[E++],y[E++]);return f}m=l.length;let _=t;for(;E<m;){let y=l[E++],A=l[E++];try{_=y(_)}catch(C){A.call(this,C);break}}try{f=VF.call(this,_)}catch(y){return ie.reject(y)}for(E=0,m=h.length;E<m;)f=f.then(h[E++],h[E++]);return f}getUri(e){return qx(IF((e=Td(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};se.forEach(["delete","get","head","options"],function(e){DE.prototype[e]=function(t,n){return this.request(Td(n||{},{method:e,url:t,data:(n||{}).data}))}}),se.forEach(["post","put","patch"],function(e){function t(n){return function(r,i,c){return this.request(Td(c||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}DE.prototype[e]=t(),DE.prototype[e+"Form"]=t(!0)});var OE=DE;class Ob{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ie(function(i){n=i});let r=this;this.promise.then(i=>{if(!r._listeners)return;let c=r._listeners.length;for(;c-- >0;)r._listeners[c](i);r._listeners=null}),this.promise.then=i=>{let c,l=new ie(u=>{r.subscribe(u),c=u}).then(i);return l.cancel=function(){r.unsubscribe(c)},l},t(function(i,c,l){r.reason||(r.reason=new ku(i,c,l),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){let t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new Ob(function(r){t=r}),cancel:t}}}var Jse=Ob;let Nb={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Nb).forEach(e=>{let[t,n]=e;Nb[n]=t});var Zse=Nb;let er=(function e(t){let n=new OE(t),r=Ax(OE.prototype.request,n);return se.extend(r,OE.prototype,n,{allOwnKeys:!0}),se.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(Td(t,i))},r})(Sb);er.Axios=OE,er.CanceledError=ku,er.CancelToken=Jse,er.isCancel=SF,er.VERSION=jF,er.toFormData=lE,er.AxiosError=vt,er.Cancel=er.CanceledError,er.all=function(e){return ie.all(e)},er.spread=function(e){return function(t){return e.apply(null,t)}},er.isAxiosError=function(e){return se.isObject(e)&&e.isAxiosError===!0},er.mergeConfig=Td,er.AxiosHeaders=zo,er.formToJSON=e=>vF(se.isHTMLForm(e)?new FormData(e):e),er.getAdapter=FF.getAdapter,er.HttpStatusCode=Zse,er.default=er;var Lr=er;let Qse=()=>{};function Sf(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Qse};return e.promise=new ie((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}let NE=new Map,PE=new Map,Ds=new Map,Sn=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),Qe=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({}),Pb=new Mre,Ko=Pb.getResult(),Lb=null;function Je(e){if(!Lb){e&&Pb.setUA(e),Ko=Pb.getResult();let t=(function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return Qe.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Qe.CHROME;case"Safari":case"Mobile Safari":return Qe.SAFARI;case"Edge":return Qe.EDGE;case"Firefox":return Qe.FIREFOX;case"QQ":case"QQBrowser":return Qe.QQ;case"Opera":return Qe.OPERA;case"WeChat":return Qe.WECHAT;default:return u.browser.name||""}})(Ko),n=HF(Ko),r=(function(u){return u.os.name==="Windows"?u.os.version?u.os.name+" "+u.os.version:u.os.name:u.os.name||""})(Ko),i=Ko.os.version,c=HF(Ko,!1),l=Ko.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:c,deviceType:l};Lb={name:t,version:n,os:r,osVersion:i,browserVersion:c,deviceType:l}}return Lb}function HF(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function LE(){return Je().os}function GF(){let e=Je();return"".concat(e.os," ").concat(e.osVersion)}function kE(){let e=Je();return!!(Ko.engine.name==="WebKit"&&e.os===Sn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Qe.SAFARI||tr()&&e.name!==Qe.SAFARI)}function va(){return Je().name===Qe.CHROME}function An(){return Je().name===Qe.SAFARI}function WF(){let e=Je();if(e.name!==Qe.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function qF(){return Je().name===Qe.EDGE}function Nt(){return Je().name===Qe.FIREFOX}function tr(){return Je().os===Sn.IOS}function Os(e){let t=Je();return!(t.name!==Qe.CHROME||!t.osVersion)&&Number(t.version)>=e}function zF(e){let t=Je();return!(t.name!==Qe.CHROME||!t.osVersion)&&Number(t.version)<e}function kb(e,t,n){let r=Je();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function Cd(e){let t=Je();return!(t.name!==Qe.EDGE||!t.osVersion)&&Number(t.version)>=e}function Mb(e){let t=Je();return!(t.name!==Qe.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function KF(e){let t=Je();return!(t.name!==Qe.SAFARI||!t.osVersion)&&Number(t.version)>=e}function YF(e,t,n){let r=Je();if(r.os!==Sn.IOS||!r.osVersion)return!1;let i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function $F(e,t,n){let r=Je();if(r.os!==Sn.IOS||!r.osVersion)return!1;let i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function xb(e,t,n){let r=Je();if(r.name!==Qe.SAFARI||!r.osVersion||!r.browserVersion)return!1;let i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function Rd(e){let t=Je();return!(t.name!==Qe.OPERA||!t.osVersion)&&Number(t.version)>=e}function XF(){let e=Je();if(e.os!==Sn.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function xu(){let e=Je();if(e.os!==Sn.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function Ub(){let e=Je();if(e.os!==Sn.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function JF(){let e=Je();if(e.os!==Sn.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function _o(){return An()&&navigator.maxTouchPoints>0}function ZF(){return Je().name===Qe.WECHAT}function QF(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function e2(){let e=LE();return(function(){let{deviceType:t}=Je();return t==="mobile"||t==="tablet"})()||e===Sn.ANDROID||e===Sn.IOS||e===Sn.HARMONY_OS}function Ns(){let e=Je();return e.name!==Qe.EDGE&&e.name!==Qe.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Tf(){return LE()===Sn.ANDROID}function Cf(){let e=Je();return Tf()&&(e.name===Qe.CHROME||e.name===Qe.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function we(e,t,n){return(t=(function(r){var i=(function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?t2(Object(n),!0).forEach(function(r){we(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let P=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),z=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),we(this,"code",void 0),we(this,"message",void 0),we(this,"data",void 0),we(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Eo(e,t){if(typeof e!="boolean")throw new z(P.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function an(e,t,n){if(!J(n).call(n,e))throw new z(P.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function yt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(i){return typeof i=="number"&&i%1==0})(e))throw new z(P.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function Fb(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new z(P.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&yt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&yt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&yt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&yt(e.ideal,"".concat(t,".ideal"),1,1/0)}else yt(e,t,1,1/0)}function Un(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new z(P.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!n2(e,n,r,i))throw new z(P.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function ya(e,t){if(!Array.isArray(e))throw new z(P.INVALID_PARAMS,"".concat(t," should be an array"))}function qt(e){return e==null}function n2(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||(function(i){if(typeof i!="string")return!1;for(let c=0;c<i.length;c+=1){let l=i.charCodeAt(c);if(l<0||l>255)return!1}return!0})(e))}function r2(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);let r=e.getUint32(t,n),i=e.getUint32(t+4,n),c=+!!n,l=+!n;return BigInt(r*l+i*c)<<BigInt(32)|BigInt(r*c+i*l)}function i2(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);let i=Number(n>>BigInt(32)),c=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,i,r),e.setUint32(t,c,r)):(e.setUint32(t,i,r),e.setUint32(t+4,c,r))}var Rf=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(Rf||{}),Vb=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(Vb||{});let o2=new class{constructor(){we(this,"_clientSize",null),we(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),we(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),we(this,"getStyle",e=>window.getComputedStyle(e,null)),we(this,"checkCssVisibleProperty",e=>{var t;let n=!0,r=this.getStyle(e),{display:i,visibility:c,opacity:l,filter:u}=r;return(i==="none"||J(t=["hidden","collapse"]).call(t,c)||Number(l)<.1)&&(n=!1),!!n&&(u&&u.split(" ").filter(h=>{var f;let m=h.split("(")[0];return J(f=["brightness","blur","opacity"]).call(f,m)}).map(h=>{let[f,m]=h.split(/\(|\)/);return[f,Number(m.match(/^[0-9\.]+/))]}).forEach(h=>{let[f,m]=h;switch(f){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),we(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0,i=l=>t(l),c=e;for(;c&&r;)i(c)||(n=!1,r=!1),c=c.parentElement,c||(r=!1);return n}),we(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),we(this,"getSizeAboutClient",e=>{let{width:t,height:n,left:r,right:i,top:c,bottom:l}=e.getBoundingClientRect(),u=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:c,bottom:l,clientWidth:u,clientHeight:h,clientMin:Math.min(u,h)}}),we(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),we(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),we(this,"checkCoverForAPoint",(e,t,n)=>{let r=this.elementFromPoint(e,t);return r!==null&&r!==n}),we(this,"getPointPositionList",()=>{let{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,c=t/6,l=[],u=10**6;for(let h=0;h<5;h++)for(let f=0;f<5;f++){let m=(n*u+(h===0?.1:h===4?(i*h*u-1e5)/u:i*h)*u)/u,E=(r*u+(f===0?.1:f===4?(c*f*u-1e5)/u:c*f)*u)/u;l.push({x:m,y:E})}return[...l]}),we(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),we(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),we(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:c,clientMin:l}=this._clientSize,u,h,f,m;if(e<0)u=0;else{if(!(e<c))return!1;u=e}if(t<0)return!1;if(h=t<c?t:c,n<0)f=0;else{if(!(n<i))return!1;f=n}if(r<0)return!1;m=r<i?r:i;let E=h-u,_=m-f;return this.checkSizeIsVisible(E,_,l)}),we(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),we(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Rf.COVERED);{let t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Rf.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Rf.SIZE)}}return this.returnHiddenResult(Rf.STYLE)}return this.returnHiddenResult(Vb.UNMOUNTED)}return this.returnHiddenResult(Vb.INVALID_HTML_ELEMENT)}),we(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function jb(e){return new TextEncoder().encode(e)}let s2=function(e,t){let n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Bb=e=>O(null,null,function*(){return(function(t,n){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r})(yield crypto.subtle.digest("SHA-256",jb(e)),16)}),jt=class{constructor(){we(this,"_events",{}),we(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let n=this._events[e],r=this._indexOfListener(n,t);r!==-1&&n.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(c=>c);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let c=0;c<t.length;c+=1){let l=t[c];l.once&&this.off(e,l.listener),l.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(i=>{i.once&&this.off(e,i.listener);try{i.listener.apply(this,n)}catch(c){console.error("safeEmit event:".concat(e," error ").concat(c?.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},If=null;function a2(){if(If)return If;if(window.electron)return If=window.electron;if(!window.require)return null;try{return If=window.require("electron"),If}catch{return null}}let Mt=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e})({}),St=(function(e){return e.TRACER="tracer",e})({});function c2(e){return yt(e.timeout,"config.timeout",0,1e5),yt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),yt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),yt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let eae=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),He=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e})({});function Id(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function d2(e){return Un(e.turnServerURL,"turnServerURL"),Un(e.username,"username"),Un(e.password,"password"),e.udpport&&yt(e.udpport,"udpport",1,99999,!0),e.forceturn&&Eo(e.forceturn,"forceturn"),e.security&&Eo(e.security,"security"),e.tcpport&&yt(e.tcpport,"tcpport",1,99999,!0),!0}let Uu=(function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e})({});function Hb(e){return e.level!==void 0&&an(e.level,"level",[1,2,3]),e.delay!==void 0&&yt(e.delay,"delay",0,3e3,!0),!0}let Ue=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e})({}),Gb=(function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e})({}),Gn=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),Sr=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),bd=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function hn(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?ie.reject(new z(P.UNEXPECTED_ERROR,"can not emit promise")):new ie((c,l)=>{e.emit(t,...r,c,l)})}function Rt(e,t){if(e.getListeners(t).length===0)return ie.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return hn(e,t,...r)}function li(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return wd(e,t,...r)}function wd(e,t){let n=null,r=null;for(var i=arguments.length,c=new Array(i>2?i-2:0),l=2;l<i;l++)c[l-2]=arguments[l];if(e.emit(t,...c,u=>{n=u},u=>{r=u}),r!==null)throw r;if(n===null)throw new z(P.UNEXPECTED_ERROR,"handler is not sync");return n}let zt=new class extends jt{set networkState(e){this.emit(bd.NETWORK_STATE_CHANGE,e,this._networkState),e===Sr.ONLINE?this.emit(bd.ONLINE):e===Sr.OFFLINE&&(this.onlineWaiter=new ie(t=>{this.once(bd.ONLINE,()=>{this.onlineWaiter=void 0,t(Sr.ONLINE)})}),this.emit(bd.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Sr.ONLINE}constructor(){super(),we(this,"_moduleName","network-indicator"),we(this,"_networkState",Sr.ONLINE),we(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Sr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Sr.OFFLINE})}},kr=[];for(let e=0;e<256;++e)kr.push((e+256).toString(16).slice(1));let l2=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Wb,tae=new Uint8Array(16);function nae(){return l2?l2():(function(n,r,i){var c,l,u,h;let f=(c=(l=(n=n||{}).random)!==null&&l!==void 0?l:(u=(h=n).rng)===null||u===void 0?void 0:u.call(h))!==null&&c!==void 0?c:(function(){if(!Wb){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Wb=crypto.getRandomValues.bind(crypto)}return Wb(tae)})();if(f.length<16)throw new Error("Random bytes length must be >= 16");if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,r){if((i=i||0)<0||i+16>r.length)throw new RangeError("UUID byte range ".concat(i,":").concat(i+15," is out of buffer bounds"));for(let m=0;m<16;++m)r[i+m]=f[m];return r}return(function(m){let E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(kr[m[E+0]]+kr[m[E+1]]+kr[m[E+2]]+kr[m[E+3]]+"-"+kr[m[E+4]]+kr[m[E+5]]+"-"+kr[m[E+6]]+kr[m[E+7]]+"-"+kr[m[E+8]]+kr[m[E+9]]+"-"+kr[m[E+10]]+kr[m[E+11]]+kr[m[E+12]]+kr[m[E+13]]+kr[m[E+14]]+kr[m[E+15]]).toLowerCase()})(f)})(e,t,void 0);var e,t}function ME(e,t){let n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Fu(e){let t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function xE(e){ie!==void 0?ie.resolve().then(e):setTimeout(e,0)}function Pt(e){return JSON.parse(JSON.stringify(e))}function Ad(e){try{return Pt(e)}catch{return e}}let u2={};function Ec(e,t){u2[t]||(u2[t]=!0,e())}function Dd(e){let t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function vc(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function h2(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){let r=new Uint8Array(t);r.set(n),n=r}return n}function p2(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=Ui(t).call(t,(l,u)=>l+u.length,0),i=new Uint8Array(new ArrayBuffer(r)),c=0;return t.forEach(l=>{i.set(l,c),c+=l.length}),i}function Ps(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function f2(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Ps(n):n.size}),t+138}function rae(e){let t=new z(P.TIMEOUT,"timeout");return new ie((n,r)=>{window.setTimeout(()=>r(t),e)})}function Tn(e){return new ie(t=>{window.setTimeout(t,e)})}function at(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+at(e-n.length,"")}function Od(){let e,t=!1;try{var n;e=kre(n=nae()).call(n,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=at(32,"")),e.toUpperCase()}let bf=()=>{},m2=new class{constructor(){we(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,c=new Array(i>4?i-4:0),l=4;l<i;l++)c[l-4]=arguments[l];if(this.fnMap.has(t)){let u=this.fnMap.get(t);if(u.threshold!==n){u.fn(...u.args),clearTimeout(u.timer);let h=window.setTimeout(()=>{let f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:c,skipFn:r})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,te(te({},u),{},{fn:e,args:c,skipFn:r}))}else{let u=window.setTimeout(()=>{let h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:c,skipFn:r})}}},g2=m2.throttleByKey.bind(m2);function _2(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function qb(e,t){if(!_2(e)||!_2(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let n=[...e];for(let r=0;r<t.length;r++)n[r]=qb(e[r],t[r]);return n}{let n=te({},e);for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=qb(e[r],t[r]):n[r]=t[r]);return n}}function E2(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function Vu(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function zb(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function Kb(e){return Ui(e).call(e,(t,n)=>t+n,0)}function v2(e){let t="0123456789abcdef";function n(M){let V,j="";for(V=0;V<=3;V++)j+=t.charAt(M>>8*V+4&15)+t.charAt(M>>8*V&15);return j}function r(M,V){let j=(65535&M)+(65535&V);return(M>>16)+(V>>16)+(j>>16)<<16|65535&j}function i(M,V,j,U,H,K){return r((function(Y,ae){return Y<<ae|Y>>>32-ae})(r(r(V,M),r(U,K)),H),j)}function c(M,V,j,U,H,K,Y){return i(V&j|~V&U,M,V,H,K,Y)}function l(M,V,j,U,H,K,Y){return i(V&U|j&~U,M,V,H,K,Y)}function u(M,V,j,U,H,K,Y){return i(V^j^U,M,V,H,K,Y)}function h(M,V,j,U,H,K,Y){return i(j^(V|~U),M,V,H,K,Y)}let f=(function(M){let V,j=1+(M.length+8>>6),U=new Array(16*j);for(V=0;V<16*j;V++)U[V]=0;for(V=0;V<M.length;V++)U[V>>2]|=M.charCodeAt(V)<<V%4*8;return U[V>>2]|=128<<V%4*8,U[16*j-2]=8*M.length,U})(e),m,E,_,y,A,C=1732584193,I=-271733879,N=-1732584194,L=271733878;for(m=0;m<f.length;m+=16)E=C,_=I,y=N,A=L,C=c(C,I,N,L,f[m+0],7,-680876936),L=c(L,C,I,N,f[m+1],12,-389564586),N=c(N,L,C,I,f[m+2],17,606105819),I=c(I,N,L,C,f[m+3],22,-1044525330),C=c(C,I,N,L,f[m+4],7,-176418897),L=c(L,C,I,N,f[m+5],12,1200080426),N=c(N,L,C,I,f[m+6],17,-1473231341),I=c(I,N,L,C,f[m+7],22,-45705983),C=c(C,I,N,L,f[m+8],7,1770035416),L=c(L,C,I,N,f[m+9],12,-1958414417),N=c(N,L,C,I,f[m+10],17,-42063),I=c(I,N,L,C,f[m+11],22,-1990404162),C=c(C,I,N,L,f[m+12],7,1804603682),L=c(L,C,I,N,f[m+13],12,-40341101),N=c(N,L,C,I,f[m+14],17,-1502002290),I=c(I,N,L,C,f[m+15],22,1236535329),C=l(C,I,N,L,f[m+1],5,-165796510),L=l(L,C,I,N,f[m+6],9,-1069501632),N=l(N,L,C,I,f[m+11],14,643717713),I=l(I,N,L,C,f[m+0],20,-373897302),C=l(C,I,N,L,f[m+5],5,-701558691),L=l(L,C,I,N,f[m+10],9,38016083),N=l(N,L,C,I,f[m+15],14,-660478335),I=l(I,N,L,C,f[m+4],20,-405537848),C=l(C,I,N,L,f[m+9],5,568446438),L=l(L,C,I,N,f[m+14],9,-1019803690),N=l(N,L,C,I,f[m+3],14,-187363961),I=l(I,N,L,C,f[m+8],20,1163531501),C=l(C,I,N,L,f[m+13],5,-1444681467),L=l(L,C,I,N,f[m+2],9,-51403784),N=l(N,L,C,I,f[m+7],14,1735328473),I=l(I,N,L,C,f[m+12],20,-1926607734),C=u(C,I,N,L,f[m+5],4,-378558),L=u(L,C,I,N,f[m+8],11,-2022574463),N=u(N,L,C,I,f[m+11],16,1839030562),I=u(I,N,L,C,f[m+14],23,-35309556),C=u(C,I,N,L,f[m+1],4,-1530992060),L=u(L,C,I,N,f[m+4],11,1272893353),N=u(N,L,C,I,f[m+7],16,-155497632),I=u(I,N,L,C,f[m+10],23,-1094730640),C=u(C,I,N,L,f[m+13],4,681279174),L=u(L,C,I,N,f[m+0],11,-358537222),N=u(N,L,C,I,f[m+3],16,-722521979),I=u(I,N,L,C,f[m+6],23,76029189),C=u(C,I,N,L,f[m+9],4,-640364487),L=u(L,C,I,N,f[m+12],11,-421815835),N=u(N,L,C,I,f[m+15],16,530742520),I=u(I,N,L,C,f[m+2],23,-995338651),C=h(C,I,N,L,f[m+0],6,-198630844),L=h(L,C,I,N,f[m+7],10,1126891415),N=h(N,L,C,I,f[m+14],15,-1416354905),I=h(I,N,L,C,f[m+5],21,-57434055),C=h(C,I,N,L,f[m+12],6,1700485571),L=h(L,C,I,N,f[m+3],10,-1894986606),N=h(N,L,C,I,f[m+10],15,-1051523),I=h(I,N,L,C,f[m+1],21,-2054922799),C=h(C,I,N,L,f[m+8],6,1873313359),L=h(L,C,I,N,f[m+15],10,-30611744),N=h(N,L,C,I,f[m+6],15,-1560198380),I=h(I,N,L,C,f[m+13],21,1309151649),C=h(C,I,N,L,f[m+4],6,-145523070),L=h(L,C,I,N,f[m+11],10,-1120210379),N=h(N,L,C,I,f[m+2],15,718787259),I=h(I,N,L,C,f[m+9],21,-343485551),C=r(C,E),I=r(I,_),N=r(N,y),L=r(L,A);return n(C)+n(I)+n(N)+n(L)}let iae=1,y2=console,Dn=class{static setLogger(e){y2=e}constructor(e,t){we(this,"id",void 0),we(this,"lockingPromise",ie.resolve()),we(this,"locks",0),we(this,"name",""),we(this,"lockId",void 0),this.lockId=iae++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");y2.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let n=new ie(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function ju(e,t){return function(n,r,i){let c=i.value;if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return i.value=function(){return O(this,arguments,function*(){let l=this[t];if(!l)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let u=yield l.lock("From ".concat(e,".").concat(r));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield c.apply(this,f)}finally{u()}})},i}}let cn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function UE(e,t){let n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Yo(e,t,n,r){let i=Object.assign({},cn,r),c=i.timeout,l=()=>O(null,null,function*(){yield(function(f){return new ie(m=>{window.setTimeout(m,f)})})(c),c*=i.timeoutFactor,c=Math.min(i.maxRetryTimeout,c)}),u=!1,h=new ie((f,m)=>O(null,null,function*(){t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<i.maxRetryCount;E+=1){if(u)return m(new z(P.OPERATION_ABORTED));try{let _=yield e();if(!t(_,E)||E+1===i.maxRetryCount)return f(_);yield l()}catch(_){if(!n(_,E)||E+1===i.maxRetryCount)return m(_);yield l()}}}));return h.cancel=()=>u=!0,h}let FE,Yb=class{constructor(e){we(this,"input",[]),we(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ui(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},VE=0,$b=0;function Xb(e,t,n,r){return new ie((i,c)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),VE+=Ps(t.data)):n&&(t.data.size?VE+=t.data.size:t.data instanceof FormData?VE+=f2(t.data):VE+=Ps(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Lr.request(t).then(l=>{typeof l.data=="string"?$b+=Ps(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?$b+=l.data.byteLength:$b+=Ps(JSON.stringify(l.data)),r&&i({data:l.data,headers:l.headers}),i(l.data)}).catch(l=>{Lr.isCancel(l)?c(new z(P.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?c(new z(P.NETWORK_TIMEOUT,l.message)):l.response?c(new z(P.NETWORK_RESPONSE_ERROR,l.response.status)):c(new z(P.NETWORK_ERROR,l.message))})})}function oae(e,t){return O(this,null,function*(){let n=new Blob([t.data],{type:"buffer"});return yield Xb(e,te(te({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)})}let S2=()=>window.isSecureContext!==void 0;function vo(e){if(Array.isArray(e))return e.map(n=>n);if(!T2(e))return e;let t={};for(let n in e){let r=e[n];T2(r)||Array.isArray(r)?t[n]=vo(r):t[n]=r}return t}function T2(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Jb=class{constructor(e){we(this,"input",[]),we(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},yo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},wf={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:yo,remoteCandidate:yo},updateInterval:0},C2={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},R2={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},I2={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},b2={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},Zb=class{constructor(e,t){we(this,"onFirstVideoReceived",void 0),we(this,"onFirstVideoDecoded",void 0),we(this,"onFirstAudioReceived",void 0),we(this,"onFirstVideoDecodedTimeout",void 0),we(this,"onFirstAudioDecoded",void 0),we(this,"onSelectedLocalCandidateChanged",void 0),we(this,"onSelectedRemoteCandidateChanged",void 0),we(this,"videoIsReady",!1),we(this,"videoIsReady2",{}),we(this,"pc",void 0),we(this,"options",void 0),we(this,"intervalTimer",void 0),we(this,"stats",vo(wf)),we(this,"isFirstVideoReceived",{}),we(this,"isFirstVideoDecoded",{}),we(this,"isFirstAudioReceived",{}),we(this,"isFirstAudioDecoded",{}),we(this,"isFirstVideoDecodedTimeout",{}),we(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(()=>O(this,null,function*(){this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ie(e=>{e({local:te({},yo),remote:te({},yo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"],r=0,i=0,c=0,l=0;for(let u of n)e[u].forEach((h,f)=>{if(!this.lossRateWindowStats[t-1][u][f]||!this.lossRateWindowStats[0][u][f])return;let m=this.lossRateWindowStats[t-1][u][f].packets-this.lossRateWindowStats[0][u][f].packets,E=this.lossRateWindowStats[t-1][u][f].packetsLost-this.lossRateWindowStats[0][u][f].packetsLost;u==="videoSend"||u==="audioSend"?(r+=m,c+=E):(i+=m,l+=E),Number.isNaN(m)||Number.isNaN(m)?h.packetLostRate=0:h.packetLostRate=m<=0||E<=0?0:E/(m+E)});e.sendPacketLossRate=r<=0||c<=0?0:c/(r+c),e.recvPacketLossRate=i<=0||l<=0?0:l/(i+l)}},sae=class extends Zb{constructor(){super(...arguments),we(this,"_stats",wf),we(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){return O(this,null,function*(){let e=yield this._getStats(),t=this.statsResponsesToObjects(e);this._stats=vo(wf);let n=t.filter(i=>i.type==="ssrc");this.processSSRCStats(n);let r=t.find(i=>i.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats})}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;let r=J(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{let i=vo(R2);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{let i=vo(C2),c=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),c){let l=c.stats,u=Date.now()-c.lts;i.framesDecodeFreezeTime=l.framesDecodeFreezeTime,i.framesDecodeInterval=l.framesDecodeInterval,i.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(c.lts=Date.now(),i.framesDecodeInterval=u,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<c.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:te({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{let i=vo(b2);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{let i=vo(I2);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new ie((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(n=>{let r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(i=>{r[i]=n.stat(i)}),t.push(r)}),t}},Bu=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),jE=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),Qb=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),vi=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var Hu=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(Hu||{});function Af(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Hu.kNone;if(!t)return;let c=Number(t[n]);if(typeof c!="number")return;let l=Number(t[r]);if(typeof l!="number")return;if(!e)return l?c/l*i:void 0;let u=Number(e[n]);if(typeof u!="number")return;let h=Number(e[r]);if(typeof h!="number")return;let f=l-h;return f?(c-u)/f*i:void 0}let w2=class extends Zb{constructor(){super(...arguments),we(this,"_stats",wf),we(this,"report",void 0),we(this,"lastDecodeVideoReceiverStats",new Map),we(this,"lastVideoFramesRecv",new Map),we(this,"lastVideoFramesSent",new Map),we(this,"lastVideoFramesDecode",new Map),we(this,"lastVideoFramesOutput",new Map),we(this,"lastVideoJBDelay",new Map),we(this,"lastAudioJBDelay",new Map),we(this,"mediaBytesSent",new Map),we(this,"mediaBytesRetransmit",new Map),we(this,"mediaBytesTargetEncode",new Map),we(this,"lastDecodeAudioReceiverStats",new Map),we(this,"lastAudioConcealment",new Map),we(this,"lastEncoderMs",new Map)}updateStats(){return O(this,null,function*(){this.report=yield this.pc.getStats(),this._stats=vo(wf),this.report.forEach(e=>{switch(e.type){case vi.OUTBOUND:case vi.INBOUND:{let t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===vi.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===vi.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case vi.TRANSPORT:{this.processTransportStats(e);let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case vi.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats})}getSelectedCandidatePair(){return O(this,null,function*(){let e=yield this.pc.getStats(),t={local:te({},yo),remote:te({},yo)};return e.forEach(n=>{let r;if(n.type===vi.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===vi.CANDIDATE_PAIR&&n.selected&&(r=n),r){let i=(c,l)=>{c.type=l.type,c.id=l.id,l.address&&(c.address=l.address),l.candidateType&&(c.candidateType=l.candidateType),l.port&&(c.port=l.port),l.priority&&(c.priority=l.priority),l.protocol&&(c.protocol=l.protocol),l.relayProtocol&&(c.relayProtocol=l.relayProtocol)};if(r.localCandidateId){let c=e.get(r.localCandidateId);c&&i(t.local,c)}if(r.remoteCandidateId){let c=e.get(r.remoteCandidateId);c&&i(t.remote,c)}}}),t})}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===vi.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===vi.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===vi.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(te({},t),te({},this.stats.selectedCandidatePair.localCandidate)),e.type===vi.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(te({},t),te({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=vo(b2),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;let n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Af(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Hu.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,te({},t))}calculateAudioFreeze(e,t,n){let r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){let i=r.lts,c=n.timestamp,l=c-i;if(l<=0)return;let u=e.concealedSamples-t.concealedSamples-0,h=r.nonSilent+u,f=e.totalSamplesReceived-t.totalSamplesReceived;if(f<=0)return;let m=80*f/l,E=200*f/l,_=l/f,y=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,h>m&&(r.plc80>0?(e.freezeSamples80+=u,e.freezeMs80+=Math.round(u*_)):(e.freezeSamples80+=h,e.freezeMs80+=Math.round(h*_)),y=r.plc80+1);let A=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,h>E&&(r.plc200>0?(e.freezeSamples200+=u,e.freezeMs200+=Math.round(u*_)):(e.freezeSamples200+=h,e.freezeMs200+=Math.round(h*_)),A=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:u,lts:c,plc80:y,plc200:A})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(l=>l.ssrc===e.ssrc);t||(t=vo(C2),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;let n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),c=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let l=t.decodedFrame?t.decodedFrame.width:0,u=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,l,u),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){let l=n.stats,u=c-n.lts;t.framesDecodeFreezeTime=l.framesDecodeFreezeTime,t.framesDecodeInterval=l.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=u,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<l.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Af(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Af(n?.stats,t,"totalProcessingDelay","framesDecodeCount",Hu.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Af(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Hu.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Af(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",Hu.kMillisecondsFromSeconds),r&&c-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((c-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&c-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((c-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:te({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=vo(R2),this._stats.videoSend.push(t));let n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{let r=new Jb(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){let r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{let i=new Jb(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){let r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{let i=new Jb(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){let r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let i=e.framesEncoded-r.lastFrameCount,c=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*c/i}}if(e.framesEncoded&&e.qpSum){let r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,vi.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=vo(I2),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,vi.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var n;let r=Array.from(ai(n=this.report).call(n)).find(i=>i.type===t&&i.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){let n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){let n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,c,l;let u=t?this.report.get(t):void 0,h=(r=u?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof h!="number")return;let f=(i=u?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,m=(c=u?.frameHeight)!==null&&c!==void 0?c:e.frameHeight,E=(l=u?.framesPerSecond)!==null&&l!==void 0?l:e.framesPerSecond;if(typeof f=="number"&&typeof m=="number"||(f=0,m=0),E==null){let _=Date.now(),y=this.lastVideoFramesSent.get(n.ssrc);y&&_-y.lts>=800?(E=Math.round((h-y.count)/((_-y.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:_,rate:E})):y?E=y.rate:this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:_,rate:0})}n.sentFrame={width:f,height:m,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,n){var r,i,c,l,u;let h=t?this.report.get(t):void 0,f=(r=h?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,m=(i=h?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,E=(c=h?.frameHeight)!==null&&c!==void 0?c:e.frameHeight,_=(l=h?.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,y=(u=h?.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount;if(typeof f=="number"){let A=this.lastVideoFramesRecv.get(n.ssrc),C=Date.now();n.framesReceivedCount=f;let I=0;A&&C-A.lts>=800?(I=Math.round((f-A.count)/((C-A.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:C,rate:I})):A?I=A.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:C,rate:0}),n.receivedFrame={width:m||0,height:E||0,frameRate:I||0},n.decodedFrame={width:m||0,height:E||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:E||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(_&&y){let A=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},C=A.jitterBufferMs,I=y-A.jitterBufferEmittedCount;I>0&&(C=1e3*(_-A.jitterBufferDelay)/I),n.jitterBufferMs=C,n.currentDelayMs=Math.round(C),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:y,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,c,l;let u=t?this.report.get(t):void 0,h=(r=(i=u?.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,f=(c=(l=u?.echoReturnLossEnhancement)!==null&&l!==void 0?l:e.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;n.aecReturnLoss=h,n.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(e,t,n){var r,i,c,l,u,h,f,m,E;let _=t?this.report.get(t):void 0,y=(r=_?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,A=(i=_?.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,C=(c=_?.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,I=(l=_?.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount,N=(u=_?.audioLevel)!==null&&u!==void 0?u:e?.audioLevel,L=(h=_?.totalSamplesDuration)!==null&&h!==void 0?h:e?.totalSamplesDuration,M=(f=_?.concealedSamples)!==null&&f!==void 0?f:e.concealedSamples,V=(m=_?.silentConcealedSamples)!==null&&m!==void 0?m:e.silentConcealedSamples,j=(E=_?.concealmentEvents)!==null&&E!==void 0?E:e.concealmentEvents;if(typeof A=="number"&&(n.totalSamplesReceived=A),typeof V=="number"&&(n.silentConcealedSamples=V),typeof j=="number"&&(n.concealmentEvents=j),typeof M=="number"&&(n.concealedSamples=M),y&&A&&(n.accelerateRate=y/A),C&&I){let H=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},K=H.jitterBufferMs,Y=I-H.jitterBufferEmittedCount;Y>0&&(K=1e3*(C-H.jitterBufferDelay)/Y),n.jitterBufferMs=Math.round(K),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:I,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=N;let U=1920;L&&A&&(U=A/L/50,n.receivedFrames=Math.round(A/U)),M&&(n.droppedFrames=Math.round(M/U))}processRemoteInboundStats(e,t){let n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{n=n===null?i.diffMean():n+i.diffMean()});let r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},aae=class extends Zb{updateStats(){return ie.resolve()}};function BE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,c=(function(){let l=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return l&&l[0]?Number(l[0].split("/")[1]):null})();return c?c<76?new sae(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new w2(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):(function(l){if(!window.RTCStatsReport)return!1;let u=l.getStats();return!!(u instanceof ie||(function(h){return!!h&&(typeof h=="object"||typeof h=="function")&&typeof h.then=="function"})(u))})(e)?new w2(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new aae(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}let A2="websdk_ng_install_id";function ew(){try{if(D("INSTALL_ID"))return D("INSTALL_ID");let e=window.localStorage.getItem(A2);return e||(e=Od(),window.localStorage.setItem(A2,e)),ft("INSTALL_ID",e),e}catch{return}}let Vi=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"})("4.24.1"),tw=(function(){try{return JSON.parse("true")===!0}catch{return!0}})(),Nd=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({}),Wn=(function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");let r=n.join(""),i=[];for(let u=0;u<6;u++)i.push("1");let c=i.join(""),l={};return l[e]=r,l[t]=c,Object.assign(l,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Wn;let HE={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},nw={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},rw="v4.24.1-0-g2cff7c6c-dirty(11/18/2025, 5:40:47 PM)",iw={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},ct=te(te(te(te({},iw),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:nw,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},HE),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1});function ft(e,t,n){var r,i,c;J(r=Object.keys(ct)).call(r,e)&&(!n&&J(i=Object.keys(yi)).call(i,e)||(ct[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(ct.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(c=!!t,ct.USE_NEW_NETWORK_CONFIG=c,c&&(ct.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],ct.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],ct.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ct.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],ct.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",ct.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",ct.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(ct.ENABLE_INSTANT_VIDEO=!0,ct.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(ct.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(ct.NEW_TURN_MODE||(ct.NEW_TURN_MODE=4))))}function D(e){if(e==="TURN_DOMAINS"){let t=ct.TURN_DOMAINS;return J(t).call(t,D("TURN_DOMAIN"))?t:[D("TURN_DOMAIN")].concat(t)}return ct[e]}tw||(ct.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ct.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ct.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ct.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ct.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ct.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ct.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ct.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ct.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ct.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ct.AREAS=["NORTH_AMERICA","OVERSEA"]);let D2=(function(e){return e[e.REALTIME=1]="REALTIME",e})({}),yi={};var Re=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(Re||{});let Pd=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let O2=128,cae=96,N2=1e3,Gu=10,dae=0;var P2=(()=>{var e={8:(r,i,c)=>{c.r(i),c.d(i,{Parser:()=>Y,Printer:()=>De,parse:()=>ne,print:()=>le});let l=`
`,u="".concat("\r").concat(l),h=" ",f;function m(X){return X>="0"&&X<="9"}function E(X){return X>="!"&&X<="~"}function _(X){return E(X)||X>="\x80"&&X<="\xFF"}function y(X){return X==="!"||X>="#"&&X<="'"||X>="*"&&X<="+"||X>="-"&&X<="."||X>="0"&&X<="9"||X>="A"&&X<="Z"||X>="^"&&X<="~"}function A(X){return X>="1"&&X<="9"}function C(X){return X>="A"&&X<="Z"||X>="a"&&X<="z"}function I(X){return X==="d"||X==="h"||X==="m"||X==="s"}function N(X){return X>""&&X<"	"||X>"\v"&&X<"\f"||X>""&&X<"\xFF"}function L(X){return C(X)||m(X)||X==="+"||X==="/"}function M(X){return m(X)||C(X)||X==="+"||X==="/"||X==="-"||X==="_"}function V(X){return C(X)||m(X)||X==="+"||X==="/"}function j(X,R){var k=Object.keys(X);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(X);R&&(F=F.filter(function(Q){return Object.getOwnPropertyDescriptor(X,Q).enumerable})),k.push.apply(k,F)}return k}function U(X){for(var R=1;R<arguments.length;R++){var k=arguments[R]!=null?arguments[R]:{};R%2?j(Object(k),!0).forEach(function(F){H(X,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(k)):j(Object(k)).forEach(function(F){Object.defineProperty(X,F,Object.getOwnPropertyDescriptor(k,F))})}return X}function H(X,R,k){return R in X?Object.defineProperty(X,R,{value:k,enumerable:!0,configurable:!0,writable:!0}):X[R]=k,X}(function(X){X.VERSION="v",X.ORIGIN="o",X.SESSION_NAME="s",X.INFORMATION="i",X.URI="u",X.EMAIL="e",X.PHONE="p",X.CONNECTION="c",X.BANDWIDTH="b",X.TIME="t",X.REPEAT="r",X.ZONE_ADJUSTMENTS="z",X.KEY="k",X.ATTRIBUTE="a",X.MEDIA="m"})(f||(f={}));class K{consumeText(R,k){let F=k;for(;F<R.length;){let Q=R[F];if(Q==="\0"||Q==="\r"||Q===l)break;F+=1}if(F-k==0)throw new Error("Invalid text, at ".concat(R));return F}consumeUnicastAddress(R,k,F){return this.consumeTill(R,k,h)}consumeOneOrMore(R,k,F){let Q=k;for(;F(R[Q]);)Q++;if(Q-k==0)throw new Error("Invalid rule at ".concat(k,"."));return Q}consumeSpace(R,k){if(R[k]===h)return k+1;throw new Error("Invalid space at ".concat(k,"."))}consumeIP4Address(R,k){let F=k;for(let Q=0;Q<4;Q++)if(F=this.consumeDecimalUChar(R,F),Q!==3){if(R[F]!==".")throw new Error("Invalid IP4 address.");F++}return F}consumeDecimalUChar(R,k){let F=k;for(let be=0;be<3&&m(R[F]);be++,F++);if(F-k==0)throw new Error("Invalid decimal uchar.");let Q=parseInt(R.slice(k,F));if(Q>=0&&Q<=255)return F;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,k){let F=this.consumeHexpart(R,k);return R[F]===":"&&(F+=1,F=this.consumeIP4Address(R,F)),F}consumeHexpart(R,k){let F=k;if(R[F]===":"&&R[F+1]===":"){F+=2;try{F=this.consumeHexseq(R,F)}catch{}return F}if(F=this.consumeHexseq(R,F),R[F]===":"&&R[F+1]===":"){F+=2;try{F=this.consumeHexseq(R,F)}catch{}return F}return F}consumeHexseq(R,k){let F=k;for(;F=this.consumeHex4(R,F),R[F]===":"&&R[F+1]!==":";)F+=1;return F}consumeHex4(R,k){let F=0;for(;F<4;F++)if(!((Q=R[k+F])>="0"&&Q<="9"||Q>="a"&&Q<="f"||Q>="A"&&Q<="F")){if(F===0)throw new Error("Invalid hex 4");break}var Q;return k+F}consumeFQDN(R,k){let F=k;for(;m(R[F])||C(R[F])||R[F]==="-"||R[F]===".";)F+=1;if(F-k<4)throw new Error("Invalid FQDN");return F}consumeExtnAddr(R,k){return this.consumeOneOrMore(R,k,_)}consumeMulticastAddress(R,k,F){switch(F){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,k);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,k);default:try{return this.consumeFQDN(R,k)}catch{return this.consumeExtnAddr(R,k)}}}consumeIP6MulticastAddress(R,k){let F=this.consumeHexpart(R,k);return R[F]==="/"?this.consumeInteger(R,F+1):F}consumeIP4MulticastAddress(R,k){let F=k+3,Q=R.slice(k,F),be=parseInt(Q);if(be<224||be>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let bt=0;bt<3;bt++){if(R[F]!==".")throw new Error("Invalid IP4 multicast address.");F+=1,F=this.consumeDecimalUChar(R,F)}return R[F]==="/"&&(F+=1),F=this.consumeTTL(R,F),R[F]==="/"&&(F=this.consumeInteger(R,F)),F}consumeInteger(R,k){if(!A(R[k]))throw new Error("Invalid integer.");for(k+=1;m(R[k]);)k+=1;return k}consumeTTL(R,k){if(R[k]==="0")return k+1;if(!A(R[k]))throw new Error("Invalid TTL.");k+=1;for(let F=0;F<2&&m(R[k]);F++)k+=1;return k}consumeToken(R,k){return this.consumeOneOrMore(R,k,y)}consumeTime(R,k){let F=k;if(R[F]==="0")return F+1;for(A(R[F])&&(F+=1);m(R[F]);)F++;if(F-k<10)throw new Error("Invalid time");return F}consumeAddress(R,k){return this.consumeTill(R,k,h)}consumeTypedTime(R,k){let F=k;return F=this.consumeOneOrMore(R,F,m),I(R[F])?F+1:F}consumeRepeatInterval(R,k){if(!A(R[k]))throw new Error("Invalid repeat interval");for(k+=1;m(R[k]);)k+=1;return I(R[k])&&(k+=1),k}consumePort(R,k){return this.consumeOneOrMore(R,k,m)}consume(R,k,F){for(let Q=0;Q<F.length;Q++){if(k+Q>=R.length)throw new Error("consume exceeding value length");if(R[k+Q]!==F[Q])throw new Error("consume ".concat(F," failed at ").concat(Q))}return k+F.length}consumeTill(R,k,F){let Q=k;for(;Q<R.length&&(typeof F!="string"||R[Q]!==F)&&(typeof F!="function"||!F(R[Q]));)Q++;return Q}}class Y extends K{constructor(){super(),H(this,"records",[]),H(this,"currentLine",0)}parse(R){let k=this.probeEOL(R);this.records=R.split(k).filter(Uc=>!!vr(Uc).call(Uc)).map(this.parseLine),this.currentLine=0;let F=this.parseVersion(),Q=this.parseOrigin(),be=this.parseSessionName(),bt=this.parseInformation(),bn=this.parseUri(),Yi=this.parseEmail(),xc=this.parsePhone(),ey=this.parseConnection(),Rh=this.parseBandWidth(),ty=this.parseTimeFields(),nl=this.parseKey(),pm=this.parseSessionAttribute(),rl=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:F,origin:Q,sessionName:be,information:bt,uri:bn,emails:Yi,phones:xc,connection:ey,bandwidths:Rh,timeFields:ty,key:nl,attributes:pm,mediaDescriptions:rl}}getCurrentRecord(){let R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let k=0;k<R.length;k++)if(R[k]===l)return R[k-1]==="\r"?u:l;throw new Error("Invalid newline character.")}parseLine(R,k){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let F=R[0];if(R[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:F,value:R.slice(2),line:k,cur:0}}parseSessionAttribute(){let R=new Ce;for(;this.currentLine<this.records.length;){let k=this.getCurrentRecord();if(k.type!==f.ATTRIBUTE)break;let F={attField:this.extractOneOrMore(k,Q=>y(Q)&&Q!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,F.attValue=this.extractOneOrMore(k,N)),R.parse(F),this.currentLine++}return R.digest()}parseMediaAttributes(R){let k=new Te(R);for(;this.currentLine<this.records.length;){let F=this.getCurrentRecord();if(F.type!==f.ATTRIBUTE)break;let Q={attField:this.extractOneOrMore(F,be=>y(be)&&be!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,Q.attValue=this.extractOneOrMore(F,N)),k.parse(Q),this.currentLine++}return k.digest()}parseKey(){let R=this.getCurrentRecord();if(R.type===f.KEY){if(R.value==="prompt"||R.value==="clear:"||R.value==="base64:"||R.value==="uri:")return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let R=this.getCurrentRecord();if(R.type===f.ZONE_ADJUSTMENTS){let k=[];for(;;)try{let F=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let Q=!1;R.value[R.cur]==="-"&&(Q=!0,R.cur+=1);let be=this.extract(R,this.consumeTypedTime);k.push({time:F,typedTime:be,back:Q})}catch{break}if(k.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,k}return[]}parseRepeat(){let R=[];for(;;){let k=this.getCurrentRecord();if(k.type!==f.REPEAT)break;{let F=this.extract(k,this.consumeRepeatInterval),Q=this.parseTypedTime(k);R.push({repeatInterval:F,typedTimes:Q}),this.currentLine++}}return R}parseTypedTime(R){let k=[];for(;;)try{this.consumeSpaceForRecord(R),k.push(this.extract(R,this.consumeTypedTime))}catch{break}if(k.length===0)throw new Error("Invalid typed time.");return k}parseTime(){let R=this.getCurrentRecord(),k=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let F=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:k,stopTime:F}}parseBandWidth(){let R=[];for(;this.currentLine<this.records.length;){let k=this.getCurrentRecord();if(k.type!==f.BANDWIDTH)break;{let F=this.extractOneOrMore(k,y);if(k.value[k.cur]!==":")throw new Error("Invalid bandwidth field.");k.cur++;let Q=this.extractOneOrMore(k,m);R.push({bwtype:F,bandwidth:Q}),this.currentLine++}}return R}parseVersion(){let R=this.getCurrentRecord();if(R.type!==f.VERSION)throw new Error("first sdp record must be version");let k=R.value.slice(0,this.consumeOneOrMore(R.value,0,m));if(k.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,k}parseOrigin(){let R=this.getCurrentRecord();if(R.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");let k=this.extractOneOrMore(R,_);this.consumeSpaceForRecord(R);let F=this.extractOneOrMore(R,m);this.consumeSpaceForRecord(R);let Q=this.extractOneOrMore(R,m);this.consumeSpaceForRecord(R);let be=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);let bt=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);let bn=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:k,sessId:F,sessVersion:Q,nettype:be,addrtype:bt,unicastAddress:bn}}parseSessionName(){let R=this.getCurrentRecord();if(R.type===f.SESSION_NAME){let k=this.extract(R,this.consumeText);return this.currentLine++,k}}parseInformation(){let R=this.getCurrentRecord();if(R.type!==f.INFORMATION)return;let k=this.extract(R,this.consumeText);return this.currentLine++,k}parseUri(){let R=this.getCurrentRecord();if(R.type===f.URI)return this.currentLine++,R.value}parseEmail(){let R=[];for(;;){let k=this.getCurrentRecord();if(k.type!==f.EMAIL)break;R.push(k.value),this.currentLine++}return R}parsePhone(){let R=[];for(;;){let k=this.getCurrentRecord();if(k.type!==f.PHONE)break;R.push(k.value),this.currentLine++}return R}parseConnection(){let R=this.getCurrentRecord();if(R.type===f.CONNECTION){let k=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);let F=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);let Q=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:k,addrtype:F,address:Q}}}parseMedia(){let R=this.getCurrentRecord(),k=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let F=this.extract(R,this.consumePort);R.value[R.cur]==="/"&&(R.cur+=1,F+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);let Q=[];for(Q.push(this.extract(R,this.consumeToken));R.value[R.cur]==="/";)R.cur+=1,Q.push(this.extract(R,this.consumeToken));if(Q.length===0)throw new Error("Invalid proto");let be=this.parseFmt(R);return this.currentLine++,{mediaType:k,port:F,protos:Q,fmts:be}}parseTimeFields(){let R=[];for(;this.getCurrentRecord().type===f.TIME;){let k=this.parseTime(),F=this.parseRepeat(),Q=this.parseZone();R.push({time:k,repeats:F,zones:Q})}return R}parseMediaDescription(){let R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){let k=this.parseMedia(),F=this.parseInformation(),Q=this.parseConnections(),be=this.parseBandWidth(),bt=this.parseKey(),bn=this.parseMediaAttributes(k);R.push({media:k,information:F,connections:Q,bandwidths:be,key:bt,attributes:bn})}return R}parseConnections(){let R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){let k=[];for(;;)try{this.consumeSpaceForRecord(R),k.push(this.extract(R,this.consumeToken))}catch{break}if(k.length===0)throw new Error("Invalid fmts");return k}extract(R,k){for(var F=arguments.length,Q=new Array(F>2?F-2:0),be=2;be<F;be++)Q[be-2]=arguments[be];let bt=k.call(this,R.value,R.cur,...Q),bn=R.value.slice(R.cur,bt);return R.cur=bt,bn}extractOneOrMore(R,k){let F=this.consumeOneOrMore(R.value,R.cur,k),Q=R.value.slice(R.cur,F);return R.cur=F,Q}consumeSpaceForRecord(R){if(R.value[R.cur]!==h)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class ae extends K{constructor(){super(...arguments),H(this,"attributes",void 0),H(this,"digested",!1)}extractOneOrMore(R,k,F){let Q=this.consumeOneOrMore(R.attValue,R._cur,k),be=R.attValue.slice(R._cur,Q),[bt,bn]=F||[];if(typeof bt=="number"&&be.length<bt)throw new Error("error in length, should be more or equal than ".concat(bt," characters."));if(typeof bn=="number"&&be.length>bn)throw new Error("error in length, should be less or equal than ".concat(bn," characters."));return R._cur=Q,be}consumeAttributeSpace(R){if(R.attValue[R._cur]!==h)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,k){if(!R.attValue)throw new Error("Nothing to extract from attValue.");for(var F=arguments.length,Q=new Array(F>2?F-2:0),be=2;be<F;be++)Q[be-2]=arguments[be];let bt=k.call(this,R.attValue,R._cur,...Q),bn=R.attValue.slice(R._cur,bt);return R._cur=bt,bn}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,k){if(!R.attValue)throw new Error;for(let F=0;F<k.length;F++)if(k[F]!==R.attValue[R._cur+F])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,L,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,L,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let k=[];for(;!this.atEnd(R);){k.push(this.extractOneOrMore(R,L));try{this.consumeAttributeSpace(R)}catch(F){if(this.atEnd(R))break;throw F}}this.attributes.iceOptions=k}parseFingerprint(R){let k=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);let F=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:k,fingerprint:F})}parseExtmap(R){let k=this.extractOneOrMore(R,m),F;this.peekChar(R)==="/"&&(this.extract(R,this.consume,"/"),F=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);let Q=this.extract(R,this.consumeTill,h),be=U(U({entry:parseInt(k,10)},F&&{direction:F}),{},{extensionName:Q});this.peekChar(R)===h&&(this.consumeAttributeSpace(R),be.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(be)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let k=this.extract(R,this.consumeTill);if(k!=="active"&&k!=="passive"&&k!=="actpass"&&k!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=k}}class Ce extends ae{constructor(){super(...arguments),H(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(k){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),k}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){let k=this.extract(R,this.consumeToken),F=[];for(;!this.atEnd(R)&&this.peekChar(R)===h;)this.consumeAttributeSpace(R),F.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:k,identificationTag:F})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,M)}parseIdentity(R){let k=this.extractOneOrMore(R,V),F=[];for(;!this.atEnd(R)&&this.peekChar(R)===h;){this.consumeAttributeSpace(R);let Q=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");let be=this.extractOneOrMore(R,bt=>bt!==h&&N(bt));F.push({name:Q,value:be})}this.attributes.identities.push({assertionValue:k,extensions:F})}parseMsidSemantic(R){this.peekChar(R)===h&&this.consumeAttributeSpace(R);let k={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if(this.peekChar(R)==="*"){this.extract(R,this.consume,"*"),k.applyForAll=!0;break}{let F=this.extract(R,this.consumeTill,h);k.identifierList.push(F)}}this.attributes.msidSemantic=k}}class Te extends ae{constructor(R){super(),H(this,"attributes",void 0),R.protos.indexOf("RTP")!==-1||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(k){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),k}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){let k=this.extractOneOrMore(R,L,[1,32]);this.consumeAttributeSpace(R);let F=this.extractOneOrMore(R,m,[1,5]);this.consumeAttributeSpace(R);let Q=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);let be=this.extractOneOrMore(R,m,[1,10]);this.consumeAttributeSpace(R);let bt=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);let bn=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);let Yi={foundation:k,componentId:F,transport:Q,priority:be,connectionAddress:bt,port:bn,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),Yi.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),Yi.relPort=this.extract(R,this.consumePort));this.peekChar(R)===h;){this.consumeAttributeSpace(R);let xc=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),Yi.extension[xc]=this.extractOneOrMore(R,E)}this.attributes.candidates.push(Yi)}parseRemoteCandidate(R){let k=[];for(;;){let F=this.extractOneOrMore(R,m,[1,5]);this.consumeAttributeSpace(R);let Q=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);let be=this.extract(R,this.consumePort);k.push({componentId:F,connectionAddress:Q,port:be});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(k)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){let k=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);let F=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");let Q={encodingName:F,clockRate:this.extractOneOrMore(R,m)};this.atEnd(R)||this.peekChar(R)!=="/"||(this.extract(R,this.consume,"/"),Q.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));let be=this.attributes.payloads.find(bt=>bt.payloadType===parseInt(k,10));be?be.rtpMap=Q:this.attributes.payloads.push({payloadType:parseInt(k,10),rtpMap:Q,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){let k=this.extractOneOrMore(R,m);this.consumeAttributeSpace(R);let F=this.extract(R,this.consumeTill,":"),Q;this.peekChar(R)===":"&&(this.extract(R,this.consume,":"),Q=this.extract(R,this.consumeTill));let be=this.attributes.ssrcs.find(bt=>bt.ssrcId===parseInt(k,10));be?be.attributes[F]=Q:this.attributes.ssrcs.push({ssrcId:parseInt(k,10),attributes:{[F]:Q}})}parseFmtp(R){let k=this.extract(R,this.consumeTill,h);this.consumeAttributeSpace(R);let F=this.extract(R,this.consumeTill),Q={};F.split(";").forEach(bt=>{let[bn,Yi]=bt.split("=");bn=vr(bn).call(bn);let xc=typeof Yi=="string"?vr(Yi).call(Yi):null;typeof bn=="string"&&bn.length>0&&(Q[bn]=xc)});let be=this.attributes.payloads.find(bt=>bt.payloadType===parseInt(k,10));be?be.fmtp={parameters:Q}:this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[],fmtp:{parameters:Q}})}parseFmtParameters(R){let k={},F=this.extract(R,this.consumeTill,"=");R._cur++;let Q=this.extract(R,this.consumeTill,";");for(k[F]=Q;R.attValue[R._cur]===";";){let be=this.extract(R,this.consumeTill,"=");R._cur++;let bt=this.extract(R,this.consumeTill,";");k[be]=bt}return k}parseRtcpFb(R){let k="";k=this.peekChar(R)==="*"?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,h),this.consumeAttributeSpace(R);let F=this.extract(R,this.consumeTill,h),Q;if(F==="trr-int")Q={type:F,interval:this.extract(R,this.consumeTill)};else{let be={type:F};this.peekChar(R)===h&&(this.consumeAttributeSpace(R),be.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===h&&(be.additional=this.extract(R,this.consumeTill))),Q=be}if(k==="*")this.attributes.rtcpFeedbackWildcards.push(Q);else{let be=this.attributes.payloads.find(bt=>bt.payloadType===parseInt(k,10));be?be.rtcpFeedbacks.push(Q):this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[Q]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let k={port:this.extract(R,this.consumePort)};this.peekChar(R)===h&&(this.consumeAttributeSpace(R),k.netType=this.extractOneOrMore(R,y),this.consumeAttributeSpace(R),k.addressType=this.extractOneOrMore(R,y),this.consumeAttributeSpace(R),k.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=k}parseMsid(R){let k={id:this.extractOneOrMore(R,y,[1,64])};this.peekChar(R)===h&&(this.consumeAttributeSpace(R),k.appdata=this.extractOneOrMore(R,y,[1,64])),this.attributes.msids.push(k)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){let k=this.extractOneOrMore(R,Q=>C(Q)||m(Q)||Q==="_"||Q==="-");this.consumeAttributeSpace(R);let F={id:k,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===h){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");let Q=[];for(;;){let be=this.extract(R,this.consumeToken);Q.push(be);try{this.extract(R,this.consume,",")}catch{break}}F.payloads=Q,this.peekChar(R)===h&&this.extract(R,this.consume,h)}for(;;){let Q=this.extract(R,this.consumeToken);switch(Q){case"depend":{let be={type:Q,rids:this.extract(R,this.consume,"=").split(",")};F.params.push(be);break}default:{let be={type:Q};this.peekChar(R)==="="&&(this.extract(R,this.consume,"="),be.val=this.extract(R,this.consumeTill,";")),F.params.push(be)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(F)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,m,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){let k=this.extract(R,this.consumeToken),F=[];for(;;)try{this.consumeAttributeSpace(R);let Q=this.extract(R,this.consumeInteger);F.push(parseInt(Q,10))}catch{break}this.attributes.ssrcGroups.push({semantic:k,ssrcIds:F})}}function Le(X,R,k){return R in X?Object.defineProperty(X,R,{value:k,enumerable:!0,configurable:!0,writable:!0}):X[R]=k,X}class De{constructor(){Le(this,"eol",u)}print(R,k){let F="";return k&&(this.eol=k),F+=this.printVersion(R.version),F+=this.printOrigin(R.origin),F+=this.printSessionName(R.sessionName),F+=this.printInformation(R.information),F+=this.printUri(R.uri),F+=this.printEmail(R.emails),F+=this.printPhone(R.phones),F+=this.printConnection(R.connection),F+=this.printBandwidth(R.bandwidths),F+=this.printTimeFields(R.timeFields),F+=this.printKey(R.key),F+=this.printSessionAttributes(R.attributes),F+=this.printMediaDescription(R.mediaDescriptions),F}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let k="";for(let F of R)k+="e=".concat(F).concat(this.eol);return k}printPhone(R){let k="";for(let F of R)k+="e=".concat(F).concat(this.eol);return k}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let k="";for(let F of R)k+="b=".concat(F.bwtype,":").concat(F.bandwidth).concat(this.eol);return k}printTimeFields(R){let k="";for(let F of R){k+="t=".concat(F.time.startTime," ").concat(F.time.startTime).concat(this.eol);for(let Q of F.repeats)k+="r=".concat(Q.repeatInterval," ").concat(Q.typedTimes.join(" ")).concat(this.eol);F.zoneAdjustments&&(k+="z=",k+="z=".concat(F.zoneAdjustments.map(Q=>"".concat(Q.time," ").concat(Q.back?"-":""," ").concat(Q.typedTime)).join(" ")).concat(this.eol),k+=this.eol)}return k}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let k="";for(let F of R)k+="a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol);return k}printMediaDescription(R){let k="";for(let F of R)k+=this.printMedia(F.media),k+=this.printInformation(F.information),k+=this.printConnections(F.connections),k+=this.printBandwidth(F.bandwidths),k+=this.printKey(F.key),k+=this.printMediaAttributes(F);return k}printConnections(R){let k="";for(let F of R)k+=this.printConnection(F);return k}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new Ut(this.eol).print(R)}printMediaAttributes(R){return new $(this.eol).print(R)}}class tt{constructor(R){Le(this,"eol",void 0),this.eol=R}printIceUfrag(R){return R===void 0?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return R===void 0?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return R===void 0?"":"a=ice-options:".concat(R.join(h)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(k=>"a=fingerprint:".concat(k.hashFunction).concat(h).concat(k.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(k=>"a=extmap:".concat(k.entry).concat(k.direction?"/".concat(k.direction):"").concat(h).concat(k.extensionName).concat(k.extensionAttributes?"".concat(h).concat(k.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return R===void 0?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(k=>"a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol)).join("")}}class Ut extends tt{print(R){let k="";return k+=this.printGroups(R.groups),k+=this.printMsidSemantic(R.msidSemantic),k+=this.printIceLite(R.iceLite),k+=this.printIceUfrag(R.iceUfrag),k+=this.printIcePwd(R.icePwd),k+=this.printIceOptions(R.iceOptions),k+=this.printFingerprints(R.fingerprints),k+=this.printSetup(R.setup),k+=this.printTlsId(R.tlsId),k+=this.printIdentity(R.identities),k+=this.printExtmap(R.extmaps),k+=this.printUnrecognized(R.unrecognized),k}printGroups(R){let k="";return R.length>0&&(k+=R.map(F=>"a=group:".concat(F.semantic).concat(F.identificationTag.map(Q=>"".concat(h).concat(Q)).join("")).concat(this.eol)).join("")),k}printIceLite(R){return R===void 0?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return R.length===0?"":R.map(k=>"a=identity:".concat(k.assertionValue).concat(k.extensions.map(F=>"".concat(h).concat(F.name).concat(F.value?"=".concat(F.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let k="a=msid-semantic:".concat(R.semantic);return R.applyForAll?k+="".concat(h,"*"):R.identifierList.length>0&&(k+=R.identifierList.map(F=>"".concat(h).concat(F))),k+this.eol}}class $ extends tt{print(R){let k=R.attributes,F="";return F+=this.printRTCP(k.rtcp),F+=this.printIceUfrag(k.iceUfrag),F+=this.printIcePwd(k.icePwd),F+=this.printIceOptions(k.iceOptions),F+=this.printCandidates(k.candidates),F+=this.printRemoteCandidatesList(k.remoteCandidatesList),F+=this.printEndOfCandidates(k.endOfCandidates),F+=this.printFingerprints(k.fingerprints),F+=this.printSetup(k.setup),F+=this.printMid(k.mid),F+=this.printExtmap(k.extmaps),F+=this.printRTPRelated(k),F+=this.printPtime(k.ptime),F+=this.printMaxPtime(k.maxPtime),F+=this.printDirection(k.direction),F+=this.printSSRCGroups(k.ssrcGroups),F+=this.printSSRC(k.ssrcs),F+=this.printRTCPMux(k.rtcpMux),F+=this.printRTCPMuxOnly(k.rtcpMuxOnly),F+=this.printRTCPRsize(k.rtcpRsize),F+=this.printMSId(k.msids),F+=this.printImageattr(k.imageattr),F+=this.printRid(k.rids),F+=this.printSimulcast(k.simulcast),F+=this.printSCTPPort(k.sctpPort),F+=this.printMaxMessageSize(k.maxMessageSize),F+=this.printUnrecognized(k.unrecognized),F}printCandidates(R){return R.map(k=>"a=candidate:".concat(k.foundation).concat(h).concat(k.componentId).concat(h).concat(k.transport).concat(h).concat(k.priority).concat(h).concat(k.connectionAddress).concat(h).concat(k.port).concat(h,"typ").concat(h).concat(k.type).concat(k.relAddr?"".concat(h,"raddr").concat(h).concat(k.relAddr):"").concat(k.relPort?"".concat(h,"rport").concat(h).concat(k.relPort):"").concat(Object.keys(k.extension).map(F=>"".concat(h).concat(F).concat(h).concat(k.extension[F])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(k=>"a=remote-candidates:".concat(k.join(h)).concat(this.eol)).join("")}printEndOfCandidates(R){return R===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";let k=R.payloads,F="";F+=R.rtcpFeedbackWildcards.map(Q=>this.printRTCPFeedback("*",Q)).join("");for(let Q of k)F+=this.printRtpMap(Q.payloadType,Q.rtpMap),F+=this.printFmtp(Q.payloadType,Q.fmtp),F+=Q.rtcpFeedbacks.map(be=>this.printRTCPFeedback(Q.payloadType,be)).join("");return F}printFmtp(R,k){if(!k)return"";let F=Object.keys(k.parameters);return F.length===1&&k.parameters[F[0]]===null?"a=fmtp:".concat(R).concat(h).concat(F[0]).concat(this.eol):"a=fmtp:".concat(R).concat(h).concat(Object.keys(k.parameters).map(Q=>"".concat(Q,"=").concat(k.parameters[Q])).join(";")).concat(this.eol)}printRtpMap(R,k){return k?"a=rtpmap:".concat(R).concat(h).concat(k.encodingName,"/").concat(k.clockRate).concat(k.encodingParameters?"/".concat(k.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,k){let F="a=rtcp-fb:".concat(R).concat(h),Q=k;return Q.type==="trr-int"?F+="ttr-int".concat(h).concat(Q.interval):(F+="".concat(Q.type),Q.parameter&&(F+="".concat(h).concat(Q.parameter),Q.additional&&(F+="".concat(h).concat(Q.additional)))),F+this.eol}printPtime(R){return R===void 0?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return R===void 0?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return R===void 0?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(k=>Object.keys(k.attributes).map(F=>"a=ssrc:".concat(k.ssrcId.toString(10)).concat(h).concat(F).concat(k.attributes[F]?":".concat(k.attributes[F]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return R===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return R===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return R===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(R===void 0)return"";let k="a=rtcp:".concat(R.port);return R.netType&&(k+="".concat(h).concat(R.netType)),R.addressType&&(k+="".concat(h).concat(R.addressType)),R.address&&(k+="".concat(h).concat(R.address)),k+this.eol}printMSId(R){return R.map(k=>"a=msid:".concat(k.id).concat(k.appdata?"".concat(h).concat(k.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(k=>"a=imageattr:".concat(k).concat(this.eol)).join("")}printRid(R){return R.map(k=>{let F="a=rid:".concat(k.id).concat(h).concat(k.direction);return k.payloads&&(F+="".concat(h,"pt=").concat(k.payloads.join(","))),k.params.length>0&&(F+="".concat(h).concat(k.params.map(Q=>Q.type==="depend"?"depend=".concat(Q.rids.join(",")):"".concat(Q.type,"=").concat(Q.val)).join(";"))),F+this.eol}).join("")}printSimulcast(R){return R===void 0?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return R===void 0?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return R===void 0?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return R===void 0?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(k=>"a=ssrc-group:".concat(k.semantic).concat(k.ssrcIds.map(F=>"".concat(h).concat(F.toString(10))).join("")).concat(this.eol)).join("")}}function ne(X){return new Y().parse(X)}function le(X,R){return new De().print(X,R)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var c in i)n.o(i,c)&&!n.o(r,c)&&Object.defineProperty(r,c,{enumerable:!0,get:i[c]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function Tr(e){return P2.parse(e)}function Sa(e,t){return P2.print(e,t)}var lae=xi("Array","keys"),uae=cc,hae=Qn,pae=B,fae=lae,ow=Array.prototype,mae={DOMTokenList:!0,NodeList:!0},gae=function(e){var t=e.keys;return e===ow||pae(ow,e)&&t===ow.keys||hae(mae,uae(e))?fae:t},nr=a(gae);function Kt(e,t,n){return(t=(function(r){var i=(function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?L2(Object(n),!0).forEach(function(r){Kt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function GE(e,t){return GE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},GE(e,t)}function sw(){sw=function(i,c){return new n(i,void 0,c)};var e=RegExp.prototype,t=new WeakMap;function n(i,c,l){var u=RegExp(i,c);return t.set(u,l||t.get(i)),GE(u,n.prototype)}function r(i,c){var l,u=t.get(c);return Ui(l=Object.keys(u)).call(l,function(h,f){var m=u[f];if(typeof m=="number")h[f]=i[m];else{for(var E=0;i[m[E]]===void 0&&E+1<m.length;)E++;h[f]=i[m[E]]}return h},Object.create(null))}return(function(i,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(c&&c.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),c&&GE(i,c)})(n,RegExp),n.prototype.exec=function(i){var c=e.exec.call(this,i);if(c){c.groups=r(c,this);var l=c.indices;l&&(l.groups=r(l,this))}return c},n.prototype[Symbol.replace]=function(i,c){if(typeof c=="string"){var l=t.get(this);return e[Symbol.replace].call(this,i,c.replace(/\$<([^>]+)(>|$)/g,function(h,f,m){if(m==="")return h;var E=l[f];return Array.isArray(E)?"$"+E.join("$"):typeof E=="number"?"$"+E:""}))}if(typeof c=="function"){var u=this;return e[Symbol.replace].call(this,i,function(){var h=arguments;return typeof h[h.length-1]!="object"&&(h=[].slice.call(h)).push(r(h,u)),c.apply(this,h)})}return e[Symbol.replace].call(this,i,c)},sw.apply(this,arguments)}let k2=new class extends jt{constructor(){super(...arguments),Kt(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class _ae{constructor(t){Kt(this,"logger",void 0),Kt(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function aw(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function M2(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let ji={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},WE=Date.now(),Df=e=>{for(let t in ji)if(Object.prototype.hasOwnProperty.call(ji,t)&&ji[t]===e)return t;return"DEFAULT"},S=new class{constructor(){Kt(this,"proxyServerURL",void 0),Kt(this,"logLevel",ji.DEBUG),Kt(this,"uploadState","collecting"),Kt(this,"uploadLogWaitingList",[]),Kt(this,"uploadLogUploadingList",[]),Kt(this,"uploadErrorCount",0),Kt(this,"currentLogID",0),Kt(this,"url",void 0),Kt(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[ji.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[ji.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[ji.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[ji.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[ji.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){ft("UPLOAD_LOG",!0)}disableLogUpload(){ft("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new _ae(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-WE<100)return void setTimeout(()=>{this.log(...t)},Date.now()-WE);let r=Math.max(0,Math.min(4,t[0]));if(t[0]=aw()+" Agora-SDK [".concat(Df(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;let i=aw()+" %cAgora-SDK [".concat(Df(r),"]:"),c=[];if(!D("USE_NEW_LOG"))switch(r){case ji.DEBUG:c=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,c);break;case ji.INFO:c=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,c);break;case ji.WARNING:c=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,c);break;case ji.ERROR:c=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,c)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-WE<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-WE);let r=Math.max(0,Math.min(4,t[0]));t[0]=aw()+" Agora-SDK [".concat(Df(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!D("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=M2()+" Agora-SDK [".concat(Df(e),"]:"):n[0]=M2()+" Agora-SDK [".concat(Df(e),"]:");let i="";n.forEach(c=>{typeof c=="object"&&(c=JSON.stringify(c)),i+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}uploadLogs(){return O(this,null,function*(){let e=this.uploadLogUploadingList,t={sdk_version:Vi,process_id:D("PROCESS_ID"),payload:JSON.stringify(e)};return Yo(()=>O(this,null,function*(){let n=yield Lr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(D("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(D("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){let r=new Error("unexpected upload log response");throw r.response=n,r}}),()=>(this.uploadLogUploadingList=[],!1),n=>{let r={status:-1,message:n.message,errorRange:e.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),k2.reportLogUploadError(r),!0},{timeout:D("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:D("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,D("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),D("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var x2;function Eae(e){return Un(e.reportId,"params.reportId",0,100,!1),Un(e.category,"params.category",0,100,!1),Un(e.event,"params.event",0,100,!1),Un(e.label,"params.label",0,100,!1),yt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(x2={}).FREE="free",x2.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});let vae={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},mn=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),xt=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let yae=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function ve(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){let i=r.value;if(typeof i=="function"){let c=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var l,u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];let m=h;if(e.argsMap)try{m=e.argsMap(this,...h)}catch(_){S.warning(_),m=[]}try{JSON.stringify(m)}catch{S.warning("arguments for method ".concat(c,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}let E=(e.report||ue).reportApiInvoke(this._sessionId||null,{id:this._clientId||((l=this.store)===null||l===void 0?void 0:l.clientId)||this._ID,name:"".concat(c,".").concat(String(n)),options:m,tag:St.TRACER,reportResult:e.reportResult},e.throttleTime);try{let _=i.apply(this,h);return _ instanceof ie?_.then(y=>(E.onSuccess(e.reportResult&&y),y)).catch(y=>{throw E.onError(y),y}):(E.onSuccess(e.reportResult&&_),_)}catch(_){throw E.onError(_),_}}}return r}}let ue=new class{constructor(){Kt(this,"baseInfoMap",new Map),Kt(this,"proxyServer",void 0),Kt(this,"eventUploadTimer",void 0),Kt(this,"setSessionIdTimer",void 0),Kt(this,"url",void 0),Kt(this,"sids",new Set),Kt(this,"backupUrl",void 0),Kt(this,"_appId",void 0),Kt(this,"_aid",0),Kt(this,"keyEventUploadPendingItems",[]),Kt(this,"normalEventUploadPendingItems",[]),Kt(this,"apiInvokeUploadPendingItems",[]),Kt(this,"apiInvokeCount",0),Kt(this,"apiInvokeLoggedCount",0),Kt(this,"ltsList",[]),Kt(this,"lastSendNormalEventTime",Date.now()),Kt(this,"customReportCounterTimer",void 0),Kt(this,"customReportCount",0),Kt(this,"extApiInvoke",e=>O(this,null,function*(){for(let t of e){let n=Pe(Pe({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:St.TRACER});this.sendApiInvoke(n)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),D("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),D("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let r=Date.now();this.apiInvokeCount+=1;let i=this.apiInvokeCount,c=!!D("SHOW_REPORT_INVOKER_LOG"),l=!!D("SHOW_REPORT_USER_INVOKER_LOG"),u=c||l&&t.id;u&&(this.apiInvokeLoggedCount+=1);let h=this.apiInvokeLoggedCount;function f(y,A){if(u){let C="[apiInvoke-".concat(h,"]");if(t.id&&(C+="[".concat(t.id,"]")),t.name&&(C+="[".concat(t.name,"]"),t.name===Mt.JOIN))return S.info("".concat(C," ").concat(y));S.info("".concat(C," ").concat(y),y==="start"?t.options:A||"")}}let m=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});f("start");let E=!1;Tn(t.timeout).then(()=>{E||(this.sendApiInvoke(Pe(Pe({},m()),{},{error:P.API_INVOKE_TIMEOUT,success:!1})),f("timeout"))});let _=new z(P.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:y=>{let A=()=>{if(E)throw _;return E=!0,this.sendApiInvoke(Pe(Pe({},m()),{},{success:!0},t.reportResult&&{result:y})),f("onSuccess"),y};return n?g2(A,t.name+"Success",n,()=>E=!0):A()},onError:y=>{let A=()=>{if(E)throw y;E=!0,this.sendApiInvoke(Pe(Pe({},m()),{},{success:!1,error:y})),f("onFailure",y.toString())};return n?g2(A,t.name+"Error",n,()=>E=!0):A()}}}_send(e,t,n){this.send({type:e,data:t},n)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname,r.rteUrl=t.rteUrl;let i=Object.assign({},{willUploadConsoleLog:D("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:tw?"global":"oversea",areas:D("AREAS")&&D("AREAS").join(",")},t.extend),{stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:f,clientRole:m}=t,E=Date.now(),_=Pe(Pe({},r),{},{eventType:mn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:rw,lts:E,elapse:E-n,extend:JSON.stringify(i),mode:t.mode,process:D("PROCESS_ID"),appType:D("APP_TYPE"),success:!0,version:Vi,stringUid:c,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:f,clientType:J(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:m,serviceId:D("PROCESS_ID"),extensionID:D("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var y;this.send({type:xt.SESSION,data:_},!0)}reportRteDetail(e){let t=this.baseInfoMap.get(e);if(!t)return;let n=t.info,r=Date.now(),i=Pe(Pe({},n),{},{eventType:mn.RTE_DETAIL,lts:r,success:!0,elapse:r-t.startTime,vid:n.vid===void 0?0:Number(n.vid),ua:navigator.userAgent});this.send({type:xt.RTE_DETAIL,data:i},!0)}joinChooseServer(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info;t.vid&&(r.vid=t.vid);let i=Date.now(),c=Pe(Pe({},r),{},{role:t.role,eventType:mn.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:xt.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe({},r),{},{eventType:mn.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:xt.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;let i=Date.now(),{firstSuccess:c,addr:l,isProxy:u}=t,h=i-n.startTime,f=Pe(Pe({},r),{},{eventType:mn.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:h,eventElapse:i-t.lts,firstSuccess:c,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:ew(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:u?1:0}),m=f.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),l)if(f.signalChannel==="1"){let E=sw(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),_=l.match(E);f.gatewayIp=_&&_.groups?_.groups.ip:"",f.gatewayPort=_&&_.groups?_.groups.port:""}else if(u){let E=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),_=l.match(/p=[0-9]{1,6}/g);f.gatewayIp=E&&E.length?E[0].split("=")[1].replace(/-/g,"."):"",f.gatewayPort=_&&_.length?_[0].split("=")[1]:""}else{let E=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),_=l.match(/(:|p=)[0-9]{1,6}/g);f.gatewayIp=E&&E.length?E[0].split("//")[1].replace(/-/g,"."):"",f.gatewayPort=_&&_.length?_[0].split(/:|p=/g)[1]:""}if(c)this.send({type:xt.JOIN_GATEWAY,data:f},!0);else{let E={isSuccess:m,port:f.gatewayPort};delete f.success,delete f.eventType,delete f.firstSuccess,delete f.gatewayPort,f.vid=Number(f.vid);let _=Object.assign({},f,E,{eventType:mn.REJOIN_GATEWAY});this.send({type:xt.RE_JOIN_GATEWAY,data:_},!0)}}joinChannelTimeout(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=Date.now(),i=Pe(Pe({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:xt.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe({},r),{},{eventType:mn.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:xt.PUBLISH,data:c},!0)}subscribe(e,t,n){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,c=Date.now(),l=Pe(Pe({},i),{},{eventType:mn.SUBSCRIBE,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?l.peerSuid=t.peerid:l.peer=t.peerid,this.send({type:xt.SUBSCRIBE,data:l},!0)}wsCompressorInit(e){var t;let n=[...nr(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;let c=i.info,l=Date.now(),u=Pe(Pe({},c),{},{eventType:mn.WS_COMPRESSOR_INIT,lts:l,eventElapse:e.eventElapse,elapse:l-i.startTime,status:e.status?1:2});this.send({type:xt.WS_COMPRESSOR_INIT,data:u},!0)}firstXLAPeerFirstVideoFrame(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),l=Pe(Pe({},r),{},{elapse:i-n.startTime,eventType:mn.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:c,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>c?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:xt.XLA_PEER_FIRST_VIDEO_FRAME,data:l},!0)}firstRemoteVideoDecode(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let c=i.info,l=Date.now(),u=Pe(Pe(Pe({},c),r),{},{elapse:l-i.startTime,eventType:t,lts:l,firstDecodeFrame:Math.max((r.firstFrame||l)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:u},!0)}firstRemoteFrame(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let c=i.info,l=Date.now(),u=Pe(Pe(Pe({},c),r),{},{elapse:l-i.startTime,eventType:t,lts:l});this.send({type:n,data:u},!0)}abTest(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe(Pe({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:mn.AB_TEST,lts:i});this.send({type:xt.AB_TEST,data:c},!0)}pcStats(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe(Pe({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:mn.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:xt.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(e,t){if(e){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe(Pe({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:mn.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:xt.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let c=i.info,l=Date.now(),u=Pe(Pe(Pe({},c),r),{},{eventType:t,lts:l});this.send({type:n,data:u},!0)}streamSwitch(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe({},r),{},{eventType:mn.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:xt.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe({},r),{},{eventType:mn.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:xt.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe({},r),{},{eventType:mn.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:xt.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(e){this.proxyServer=e,e?S.debug("reportProxyServerurl: ".concat(e)):S.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:xt.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now();(function(c,l,u){let h=c[l];if(!h||typeof h!="string")return[c];c[l]="";let f=Ps(JSON.stringify(c)),m=0,E=[],_=0;for(let y=0;y<h.length;y++)_+=h.charCodeAt(y)<=127?1:3,_<=u-f||(E[E.length]=te(te({},c),{},{[l]:h.substring(m,y)}),m=y,_=h.charCodeAt(y)<=127?1:3);return m!==h.length-1&&(E[E.length]=te(te({},c),{},{[l]:h.substring(m)})),E})(Pe(Pe(Pe({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:xt.WORKER_EVENT,data:c},!0))}apworkerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe(Pe({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:xt.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe(Pe({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:xt.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),c=Pe(Pe(Pe({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:xt.WEBSOCKET_QUIT,data:c},!0)}sendCustomReportMessage(e,t){return O(this,null,function*(){if(this.customReportCount+=t.length,this.customReportCount>D("CUSTOM_REPORT_LIMIT"))throw new z(P.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let n=Date.now(),r=t.map(i=>({type:xt.USER_ANALYTICS,data:Pe(Pe({sid:e},i),{},{lts:n})}));try{D("NEW_REPORT_SERVER")?yield this.postDataToStatsCollector2(r):yield this.postDataToStatsCollector(r)}catch(i){throw S.error("send custom report message failed",i.toString()),new z(P.CUSTOM_REPORT_SEND_FAILED,i.message)}})}sendApiInvoke(e){let t=D("NOT_REPORT_EVENT");if(e.tag&&J(t)&&J(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:r,uid:i,cid:c}=n.info,l;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof z){let{code:h,message:f}=e.error;l=h||f||e.error.toString()}else l=e.error.toString();let u={invokeId:e.invokeId,sid:e.sid,cname:r,cid:c,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?l:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:xt.API_INVOKE,data:u},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>D("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let n=[],r=[];for(;e.length;){let c=e.shift();n.length<20?n.push(c):r.push(c)}e.push(...r);for(let c of[...n]){var i;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),fd(i=this.ltsList).call(i,(l,u)=>l-u))}return t||(this.lastSendNormalEventTime=Date.now()),D("ENABLE_EVENT_REPORT")&&n.length&&(D("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((c=>l=>{D("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>D("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-D("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(n)),e}postDataToStatsCollector2(e){return O(this,null,function*(){zt.networkState===Sr.OFFLINE&&(yield ie.race([zt.onlineWaiter,Tn(2*cn.maxRetryTimeout)]));let t=i=>{let c=new Uint8Array;return i.forEach(l=>{let u=jb(JSON.stringify(l.data)),h=new ArrayBuffer(5),f=(E=>{let _=0;return Object.entries(xt).forEach(y=>{let[A,C]=y;C===E.type&&(_=yae[A])}),_})(l),m=new DataView(h);m.setUint16(0,u.byteLength,!0),m.setUint8(2,255&f),m.setUint8(3,f>>>8&255),m.setUint8(4,f>>>16&255),c=s2(c,new Uint8Array(h)),c=s2(c,u)}),c},n="event",r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(D("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(D("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{yield Xb(r,{timeout:1e4,data:t(e),headers:Pe(Pe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(i===1)throw c;continue}return}})}postDataToStatsCollector(t){return O(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=(h=>{let f=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return f&&f.info.vid&&+f.info.vid||0})(e[0]),i=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(h=>JSON.stringify(h)),vid:r,aid:i};zt.networkState===Sr.OFFLINE&&(yield ie.race([zt.onlineWaiter,Tn(2*cn.maxRetryTimeout)]));let l=n?"/events/proto-raws":"/events/messages",u=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("EVENT_REPORT_DOMAIN"),"&p=").concat(D("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(D("EVENT_REPORT_DOMAIN"),":").concat(D("STATS_COLLECTOR_PORT")).concat(l));for(let h=0;h<2;h+=1){h===1&&(u=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(D("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(D("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(D("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(D("STATS_COLLECTOR_PORT")).concat(l)));try{n?yield oae(u,{timeout:1e4,data:c}):yield Xb(u,{timeout:1e4,data:c})}catch(f){if(h===1)throw f;continue}return}})}createBaseInfo(e,t){let n=Object.assign({},vae);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){let n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:St.TRACER}).onSuccess()}};k2.on("REPORT_LOG_UPLOAD",e=>{e.networkState=zt.networkState,ue.reportApiInvoke(null,{name:"logUploadError",options:e,tag:St.TRACER}).onSuccess("logUploadError")});let G=class extends z{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Kt(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,S)}throw(){super.throw(S)}},Cn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function Ve(){return Cn}function U2(){return"setSinkId"in HTMLAudioElement.prototype&&(!D("RESTRICTION_SET_PLAYBACK_DEVICE")||(va()||qF())&&!e2())}function qE(){return!Cn.supportUnifiedPlan||D("CHROME_FORCE_PLAN_B")&&Ns()}function Of(e){return!(Nt()||zF(87)||qE()||!D("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||D("FORCE_DISABLE_AUTO_SUB")))}function F2(e){return D("ENABLE_INSTANT_VIDEO")?D("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||D("FORCE_DISABLE_AUTO_SUB"))}function V2(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function j2(){if(V2()){let e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return Os(141)||Cd(141)||Rd(141)}function B2(){if(V2()){let e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return Os(141)||Cd(141)||Rd(125)}let Fn=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function Wu(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Ze(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function So(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function cw(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let Sae={"90p":Ze(160,90),"90p_1":Ze(160,90),"120p":Ze(160,120,15,30,65),"120p_1":Ze(160,120,15,30,65),"120p_3":Ze(120,120,15,30,50),"120p_4":Ze(212,120),"180p":Ze(320,180,15,30,140),"180p_1":Ze(320,180,15,30,140),"180p_3":Ze(180,180,15,30,100),"180p_4":Ze(240,180,15,30,120),"240p":Ze(320,240,15,40,200),"240p_1":Ze(320,240,15,40,200),"240p_3":Ze(240,240,15,40,140),"240p_4":Ze(424,240,15,40,220),"360p":Ze(640,360,15,80,400),"360p_1":Ze(640,360,15,80,400),"360p_3":Ze(360,360,15,80,260),"360p_4":Ze(640,360,30,80,600),"360p_6":Ze(360,360,30,80,400),"360p_7":Ze(480,360,15,80,320),"360p_8":Ze(480,360,30,80,490),"360p_9":Ze(640,360,15,80,800),"360p_10":Ze(640,360,24,80,800),"360p_11":Ze(640,360,24,80,1e3),"480p":Ze(640,480,15,100,500),"480p_1":Ze(640,480,15,100,500),"480p_2":Ze(640,480,30,100,1e3),"480p_3":Ze(480,480,15,100,400),"480p_4":Ze(640,480,30,100,750),"480p_6":Ze(480,480,30,100,600),"480p_8":Ze(848,480,15,100,610),"480p_9":Ze(848,480,30,100,930),"480p_10":Ze(640,480,10,100,400),"720p":Ze(1280,720,15,120,1130),"720p_auto":Ze(1280,720,30,900,3e3),"720p_1":Ze(1280,720,15,120,1130),"720p_2":Ze(1280,720,30,120,2e3),"720p_3":Ze(1280,720,30,120,1710),"720p_5":Ze(960,720,15,120,910),"720p_6":Ze(960,720,30,120,1380),"1080p":Ze(1920,1080,15,120,2080),"1080p_1":Ze(1920,1080,15,120,2080),"1080p_2":Ze(1920,1080,30,120,3e3),"1080p_3":Ze(1920,1080,30,120,3150),"1080p_5":Ze(1920,1080,60,120,4780),"1440p":Ze(2560,1440,30,120,4850),"1440p_1":Ze(2560,1440,30,120,4850),"1440p_2":Ze(2560,1440,60,120,7350),"4k":Ze(3840,2160,30,120,8910),"4k_1":Ze(3840,2160,30,120,8910),"4k_3":Ze(3840,2160,60,120,13500)},Tae={"480p":So(640,480,5),"480p_1":So(640,480,5),"480p_2":So(640,480,30),"480p_3":So(640,480,15),"720p":So(1280,720,5),"720p_auto":Ze(1280,720,30,900,3e3),"720p_1":So(1280,720,5),"720p_2":So(1280,720,30),"720p_3":So(1280,720,15),"1080p":So(1920,1080,5),"1080p_1":So(1920,1080,5),"1080p_2":So(1920,1080,30),"1080p_3":So(1920,1080,15)},Cae={"1SL1TL":cw(1,1),"3SL3TL":cw(3,3),"2SL3TL":cw(2,3)};function To(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Sae[e]):e}function dw(e){return typeof e=="string"?Object.assign({},Tae[e]):e}function zE(e){return typeof e=="string"?Object.assign({},Cae[e]):e}let Rae={speech_low_quality:Wu(16e3,!1),speech_standard:Wu(32e3,!1,18),music_standard:Wu(48e3,!1),standard_stereo:Wu(48e3,!0,56),high_quality:Wu(48e3,!1,128),high_quality_stereo:Wu(48e3,!0,192)};function KE(e){return typeof e=="string"?Object.assign({},Rae[e]):e}let Ld=[];function H2(e){return an(e,"mediaSource",["screen","window","application"]),!0}let he=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),ot=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),qu=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),Iae=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),bae=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),kd=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),zu=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),Bi=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),Ku=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),Si=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let lw={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},uw={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},G2={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},wae={uplinkNetworkQuality:0,downlinkNetworkQuality:0},W2={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Cr=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),Ti=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),Nf=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),Md=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),Yn=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),Ls=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({}),hw={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},YE=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function Ke(e,t,n,r,i){var c,l,u={};return Object.keys(r).forEach(function(h){u[h]=r[h]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Ui(c=vL(l=n.slice()).call(l)).call(c,function(h,f){return f(e,t,h)||h},u),i&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(i):void 0,u.initializer=void 0),u.initializer===void 0?(Object.defineProperty(e,t,u),null):u}function q(e,t,n){return(t=(function(r){var i=(function(c,l){if(typeof c!="object"||!c)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var h=u.call(c,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)})(r);return typeof i=="symbol"?i:i+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Dt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?q2(Object(n),!0).forEach(function(r){q(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class z2 extends jt{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(kd.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),q(this,"trackMediaType",void 0),q(this,"_ID",void 0),q(this,"_rtpTransceiver",void 0),q(this,"_lowRtpTransceiver",void 0),q(this,"_hints",[]),q(this,"_isClosed",!1),q(this,"_originMediaStreamTrack",void 0),q(this,"mediaStreamTrack",void 0),q(this,"_external",{}),this._ID=n||at(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(r){J(Ld).call(Ld,r)||Ld.push(r)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Ec(()=>{var n;ue.reportApiInvoke(null,{name:Mt.GET_MEDIA_STREAM_TRACK,options:[],tag:St.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===qu.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){let n=Ld.indexOf(t);n!==-1&&Ld.splice(n,1)})(this),this.emit(zu.CLOSED),this.removeAllListeners(kd.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===qu.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(kd.TRANSCEIVER_UPDATED,t,n)}}class Yu extends z2{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),q(this,"_enabled",!0),q(this,"_muted",!1),q(this,"_isExternalTrack",!1),q(this,"_isClosed",!1),q(this,"_enabledMutex",void 0),q(this,"processor",void 0),q(this,"_processorContext",void 0),q(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Dn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(he.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(r,i){return O(this,arguments,function*(t,n){let c=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=c,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),yield Rt(this,he.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))})}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(zu.TRACK_ENDED)}stateCheck(t,n){if(S.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Eo(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new z(P.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",S);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new z(P.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",S)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ie.resolve([])}}let K2=window.AudioContext||window.webkitAudioContext,pw,Ci=null,mt=new class extends jt{constructor(){super(...arguments),q(this,"prevState",void 0),q(this,"curState",void 0),q(this,"currentTime",void 0),q(this,"currentTimeStuckAt",void 0),q(this,"interruptDetectorTrack",void 0),q(this,"onLocalAudioTrackMute",()=>{S.info("ios15-interruption-start"),this.emit(Fn.IOS_15_16_INTERRUPTION_START)}),q(this,"onLocalAudioTrackUnmute",()=>O(this,null,function*(){S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(Ci&&(yield Ci.suspend()),this.emit(Fn.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){S.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){S.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function $u(){if(!Ci){if((function(){if(!K2)return void S.error("your browser is not support web audio");S.info("create audio context");let e=Dt({},D("WEBAUDIO_INIT_OPTIONS"));S.debug("audio context init option:",JSON.stringify(e)),Ci=new K2(e),mt.curState=Ci.state,Ci.onstatechange=()=>{mt.prevState=mt.curState,mt.curState=Ci?Ci.state:void 0;let{prevState:t,curState:n}=mt,r=n==="running",i=n==="interrupted",c=t==="running",l=t==="suspended",u=t==="interrupted",h=Je().osVersion;(tr()||_o())&&c&&i&&(S.info("ios".concat(h,"-interruption-start")),mt.emit(Fn.IOS_INTERRUPTION_START)),(tr()||_o())&&(l||u)&&r&&(S.info("ios".concat(h,"-interruption-end")),mt.emit(Fn.IOS_INTERRUPTION_END)),t!==n&&mt.emit(Fn.STATE_CHANGE,n,t)},setInterval(()=>{var t;let n=(t=Ci)===null||t===void 0?void 0:t.currentTime;mt.currentTime!==n?(mt.currentTimeStuckAt&&(S.debug("AudioContext current time resume at ".concat(n)),mt.currentTimeStuckAt=void 0),mt.currentTime=n):(n!==mt.currentTimeStuckAt&&(ue.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:St.TRACER}).onSuccess(),S.warning("AudioContext current time stuck at ".concat(n))),mt.currentTimeStuckAt=n)},5e3),(function(t){return O(this,null,function*(){let n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r,i,c=!1,l=!1,u=!1;function h(N){t.state==="running"?f(!1):tr()||_o()?t.state==="suspended"&&(f(!0),N&&t.resume().then(m,m)):t.state!=="closed"&&(f(!0),N&&t.resume().then(m,m))}function f(N){if(c!==N){c=N;for(let L=0,M=n;L<M.length;L+=1){let V=M[L];N?window.addEventListener(V,E,{capture:!0,passive:!0}):window.removeEventListener(V,E,{capture:!0,passive:!0})}}}function m(){h(!1)}function E(){h(!0)}function _(){let N;try{N=r.play(),N?N.then(C,C):(r.addEventListener("playing",C),r.addEventListener("abort",C),r.addEventListener("error",C))}catch{C()}}function y(N){u||(r.paused?N?(A(!1),u=!0,_()):A(!0):A(!1))}function A(N){if(l!==N){l=N;for(let L=0,M=n;L<M.length;L++){let V=M[L];N?window.addEventListener(V,I,{capture:!0,passive:!0}):window.removeEventListener(V,I,{capture:!0,passive:!0})}}}function C(){r.removeEventListener("playing",C),r.removeEventListener("abort",C),r.removeEventListener("error",C),u=!1,y(!1)}function I(){y(!0)}if(tr()&&D("IOS_BG_TAG")){let N=t.createMediaStreamDestination(),L=document.createElement("div");L.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=L.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=N.stream,i=()=>{if(D("IOS_AUTO_RESTART_BG_TAG")&&r&&r.srcObject&&!u&&(!r.paused||l!==!0)){r.paused||r.pause();try{u=!0,_()}catch{u=!1}return!0}},y(!0)}return mt.on(Fn.STATE_CHANGE,function(){h(!0)}),h(!1),i})})(Ci).then(t=>{pw=t})})(),!Ci)throw new z(P.NOT_SUPPORTED,"can not create audio context");return Ci}return Ci}function xd(e){if((function(){if(fw!==null)return fw;let r=$u(),i=r.createBufferSource(),c=r.createGain(),l=r.createGain();i.connect(c),i.connect(l),i.disconnect(c);let u=!1;try{i.disconnect(c)}catch{u=!0}return i.disconnect(),fw=u,u})())return;let t=e.connect,n=e.disconnect;e.connect=(r,i,c)=>{var l;return e._inputNodes||(e._inputNodes=[]),J(l=e._inputNodes).call(l,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,c)):t.call(e,r,i)),e},e.disconnect=(r,i,c)=>{n.call(e),r?ME(e._inputNodes,r):e._inputNodes=[];for(let l of e._inputNodes)t.call(e,l)}}let fw=null;function mw(e,t){let n=!1,r=1/t;if(D("DISABLE_WEBAUDIO")){let i=window.setInterval(()=>{n?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{let i=$u(),c=i.createGain();c.gain.value=0,c.connect(i.destination);let l=()=>{if(n)return void(c=null);let u=i.createOscillator();u.onended=l,u.connect(c),u.start(0),u.stop(i.currentTime+r),e(i.currentTime)};l()}return()=>{n=!0}}class Y2{constructor(){q(this,"context",void 0),q(this,"analyserNode",void 0),q(this,"sourceNode",void 0),this.context=$u(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||tr()||_o()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}let n=Ui(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{S.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class $2 extends jt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),q(this,"outputNode",void 0),q(this,"outputTrack",void 0),q(this,"isPlayed",!1),q(this,"sourceNode",void 0),q(this,"context",void 0),q(this,"audioBufferNode",void 0),q(this,"destNode",void 0),q(this,"audioOutputLevel",0),q(this,"volumeLevelAnalyser",void 0),q(this,"_processedNode",void 0),q(this,"playNode",void 0),q(this,"isDestroyed",!1),q(this,"onNoAudioInput",void 0),q(this,"isNoAudioInput",!1),q(this,"_noAudioInputCount",0),this.context=$u(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),xd(this.outputNode),this.volumeLevelAnalyser=new Y2}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Si.ON_AUDIO_BUFFER,(function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){let c=r.outputBuffer.getChannelData(i);for(let l=0;l<c.length;l+=1)c[l]=0}return r.inputBuffer})(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ve().webAudioMediaStreamDest)throw new z(P.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&xE(()=>{mt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){return O(this,arguments,function*(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;tr()||_o()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let n=this.volumeLevelAnalyser.getAnalyserNode(),r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let c=0;c<r.length;c++)r[c]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(yield Tn(200),(yield this.checkHasAudioInput(t?t+1:1))&&i)})}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class gw extends $2{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),q(this,"sourceNode",void 0),q(this,"track",void 0),q(this,"clonedTrack",void 0),q(this,"audioElement",void 0),q(this,"isCurrentTrackCloned",!1),q(this,"isRemoteTrack",!1),q(this,"originVolumeLevelAnalyser",void 0),q(this,"rebuildWebAudio",()=>O(this,null,function*(){if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&(yield this.checkHasAudioInput()),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;let h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),xd(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),xd(this.outputNode),this.emit(Si.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),t.kind!=="audio")throw new z(P.UNEXPECTED_ERROR);this.track=t;let c=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(c),xd(this.sourceNode),r){let u=r.clone();u.enabled=!0,this.clonedTrack=u,S.debug("create an unmuted track ".concat(u.id," from the original track ").concat(r.id," to get the volume"));let h=this.context.createMediaStreamSource(new MediaStream([u]));xd(h),this.originVolumeLevelAnalyser=new Y2,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;let l=Je();n&&l.os===Sn.IOS&&Number((i=l.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(mt.on(Fn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),xd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Si.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),mt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),S.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));let r=this.context.createMediaStreamSource(new MediaStream([n]));xd(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function X2(e,t,n){return O(this,null,function*(){let r=(c,l)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||l:c:l,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),yield navigator.mediaDevices.getUserMedia(i)})}function Aae(e,t){return O(this,null,function*(){let n=yield J2(e.mediaSource),{sourceId:r,audio:i}=yield(function(c){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ie((u,h)=>{let f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");let _=document.createElement("div");_.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let A=document.createElement("button");A.innerHTML="cancel",A.setAttribute("style","width: 85px;"),A.onclick=()=>{document.body.removeChild(N);let L=new Error("NotAllowedError");L.name="NotAllowedError",h(L)};let C=l,I=document.createElement("div");if(l){let L=document.createElement("input");L.setAttribute("type","checkbox");let M=document.createElement("span");L.setAttribute("style","margin-right: 6px;"),M.innerText="Share audio",L.checked=C,L.onchange=()=>{C=L.checked},I.appendChild(L),I.appendChild(M)}y.appendChild(I),y.appendChild(A),m.appendChild(E),m.appendChild(_),m.appendChild(y);let N=document.createElement("div");N.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),N.appendChild(f),N.appendChild(m),document.body.appendChild(N),c.map(L=>{if(L.id){let M=document.createElement("div");M.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let V=L.thumbnail;try{let{width:j}=V.getSize();j>1920&&(V=V.resize({width:1920}))}catch(j){throw j&&j.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),j}M.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+V.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+L.name.replace(/[\u00A0-\u9999<>\&]/g,function(j){return"&#"+j.charCodeAt(0)+";"})+"</span>",M.onclick=()=>{document.body.removeChild(N),u({sourceId:L.id,audio:C})},_.appendChild(M)}})})})(n,t);return yield X2(r,e,i)})}function J2(e){return O(this,null,function*(){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let n=a2();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new z(P.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new ie((c,l)=>{n.desktopCapturer.getSources({types:t},(u,h)=>{u?l(u):c(h)})}));try{return yield r}catch(c){throw new z(P.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}})}let _w=new Dn("safari"),Z2=!1,Q2=!1;function Ri(e,t){return O(this,null,function*(){let n=0,r=null;for(;n<2;)try{r=yield Dae(e,t,n>0);break}catch(i){if(i instanceof z)throw S.error("[".concat(t,"] ").concat(i.toString())),i;let c=$E(i.name||i.code||i,i.message);if(c.code===P.MEDIA_OPTION_INVALID){S.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,yield Tn(500);continue}throw S.error("[".concat(t,"] ").concat(c.toString())),c}if(!r)throw new z(P.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r})}function Dae(e,t,n){return O(this,null,function*(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new z(P.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let r=Ve(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return S.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(a2())e.screen.sourceId?Xu(i,yield X2(e.screen.sourceId,e.screen,!!e.screenAudio)):Xu(i,yield Aae(e.screen,!!e.screenAudio));else if(va()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new z(P.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let _=yield(l=e.screen.extensionId,u=t,new ie((y,A)=>{try{chrome.runtime.sendMessage(l,{getStream:!0},C=>{if(!C||!C.streamId)return S.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),C),void A(new z(P.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(C.streamId)})}catch(C){S.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(l,")"),C.toString()),A(new z(P.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=_,Xu(i,yield navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var c;e.screen.mediaSource&&H2(e.screen.mediaSource);let _={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(c=e.screen.displaySurface)!==null&&c!==void 0?c:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:A,systemAudio:C,preferCurrentTab:I,windowAudio:N,monitorTypeSurfaces:L}=e.screen,M={selfBrowserSurface:y,surfaceSwitching:A,systemAudio:C,preferCurrentTab:I,windowAudio:N,monitorTypeSurfaces:L};!y&&delete M.selfBrowserSurface,!A&&delete M.surfaceSwitching,!C&&delete M.systemAudio,!I&&delete M.preferCurrentTab,!N&&delete M.windowAudio,!L&&delete M.monitorTypeSurfaces,S.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:_,audio:e.screenAudio,controls:M})),Xu(i,yield navigator.mediaDevices.getDisplayMedia(Dt({video:_,audio:e.screenAudio},M)))}else{if(!Nt())throw S.error("[".concat(t,"] This browser does not support screenSharing")),new z(P.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&H2(e.screen.mediaSource);let _={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};S.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(_))),Xu(i,yield navigator.mediaDevices.getUserMedia(_))}}var l,u;if(!e.video&&!e.audio)return i;let h={video:e.video,audio:e.audio},f=D("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),h=qb(h,f)}catch{}S.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),Je();let m,E=null;(An()||tr()||kE())&&(E=yield _w.lock());try{m=yield navigator.mediaDevices.getUserMedia(h)}catch(_){throw E&&E(),_}return h.audio&&(Z2=!0),h.video&&(Q2=!0),Xu(i,m),E&&E(),i})}function $E(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new z(P.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new z(P.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new z(P.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new z(P.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new z(P.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new z(P.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return S.error("getUserMedia unexpected error",e),new z(P.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Xu(e,t){let n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],c=t.getAudioTracks()[0];c&&(r&&e.removeTrack(r),e.addTrack(c)),i&&(n&&e.removeTrack(n),e.addTrack(i))}let Ii=new class extends jt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Md.STATE_CHANGE,e),this._state=e)}constructor(){super(),q(this,"_state",Nf.IDLE),q(this,"isAccessMicrophonePermission",!1),q(this,"isAccessCameraPermission",!1),q(this,"lastAccessMicrophonePermission",!1),q(this,"lastAccessCameraPermission",!1),q(this,"checkdeviceMatched",!1),q(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(D("ENUMERATE_DEVICES_INTERVAL")||(Tf()||LE()===Sn.HARMONY_OS)&&Ns())&&this.updateDevicesInfo()},D("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>S.error(e.toString()))}enumerateDevices(n,r){return O(this,arguments,function*(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new z(P.NOT_SUPPORTED,"enumerateDevices() not supported.");let c=yield navigator.mediaDevices.enumerateDevices(),l=this.checkMediaDeviceInfoIsOk(c),u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;l.audio&&(u=!1),l.video&&(h=!1);let f=null,m=null,E=null;if(!i&&(u||h)){if(_w.isLocked&&(S.debug("[device manager] wait GUM lock"),(yield _w.lock())(),S.debug("[device manager] GUM unlock")),Z2&&(u=!1,this.isAccessMicrophonePermission=!0),Q2&&(h=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",e,t,u,h),u&&h){try{E=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){let y=$E(_.name||_.code||_,_.message);if(y.code===P.PERMISSION_DENIED)throw y;S.warning("getUserMedia failed in getDevices",y)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{f=yield navigator.mediaDevices.getUserMedia({audio:e})}catch(_){let y=$E(_.name||_.code||_,_.message);if(y.code===P.PERMISSION_DENIED)throw y;S.warning("getUserMedia failed in getDevices",y)}this.isAccessMicrophonePermission=!0}else if(h){try{m=yield navigator.mediaDevices.getUserMedia({video:t})}catch(_){let y=$E(_.name||_.code||_,_.message);if(y.code===P.PERMISSION_DENIED)throw y;S.warning("getUserMedia failed in getDevices",y)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",e,"cam permission",t)}try{let _=yield navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(y=>y.stop()),m&&m.getTracks().forEach(y=>y.stop()),E&&E.getTracks().forEach(y=>y.stop()),f=null,m=null,E=null,_}catch(_){return f&&f.getTracks().forEach(y=>y.stop()),m&&m.getTracks().forEach(y=>y.stop()),E&&E.getTracks().forEach(y=>y.stop()),f=null,m=null,E=null,new z(P.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}})}getRecordingDevices(){return O(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(yield this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")})}getCamerasDevices(){return O(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(yield this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")})}getSpeakers(){return O(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(yield this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")})}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}getDeviceById(e){return O(this,null,function*(){let t=(yield this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new z(P.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t})}init(){return O(this,null,function*(){this.state=Nf.INITING;try{yield this.updateDevicesInfo(),this.state=Nf.INITEND}catch(e){throw this.state=Nf.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(S.warning("Device Detection functionality cannot start properly.",e.toString()),e):new z(P.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}})}updateDevicesInfo(){return O(this,null,function*(){let e=yield this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let i=e.find(l=>l.kind==="audioinput"&&l.deviceId==="default"),c=e.find(l=>l.kind==="audiooutput"&&l.deviceId==="default");i&&c?c.groupId===i.groupId?S.debug("[device-check] default input ".concat(i.label," and output ").concat(c.label," is the same group")):S.debug("[device-check] default input ".concat(i.label," and output ").concat(c.label," is not the same group")):S.debug("[device-check] default input or output not found")}let r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;let c=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((c?c.state:"INACTIVE")!=="ACTIVE"){let l={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),l),n.push(l)}c&&(c.updateAt=t)}),this.deviceInfoMap.forEach((i,c)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))}),this.state!==Nf.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Md.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Md.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Md.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)})}checkMediaDeviceInfoIsOk(e){let t=e.filter(i=>i.kind==="audioinput"),n=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(let i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(let i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}},Ew=!1,Mr=new class extends jt{constructor(){super(...arguments),q(this,"onAutoplayFailed",void 0),q(this,"onAudioAutoplayFailed",void 0)}};function eV(){if(Ew)return D("FLS_AUTOPLAY_EMITS")?(Mr.onAutoplayFailed&&Mr.onAutoplayFailed(),Mr.emit("autoplay-failed")):void 0;{let e=t=>{t.preventDefault(),Ew=!1,Cf()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Ew=!0,Cf()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Mr.onAutoplayFailed?Mr.onAutoplayFailed():Mr.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Mr.emit("autoplay-failed")}}function tV(e,t,n,r){if(!e)return;let i=ue.getBaseInfoBySessionId(e);if(!i)return;let c=i.info,l=Date.now(),u=Dt(Dt({},c),{},{vid:c.vid===void 0?0:Number(c.vid),lts:l,elapse:l-i.startTime,cbRegistered:Mr.onAutoplayFailed||Mr.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});ue.send({type:xt.AUTOPLAY_FAILED,data:u},!0)}let Oae=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],cr=new class{constructor(){q(this,"onAutoplayFailed",void 0),q(this,"elementMap",new Map),q(this,"elementStateMap",new Map),q(this,"elementsNeedToResume",[]),q(this,"sinkIdMap",new Map),q(this,"autoResumeAfterInterruption",e=>ie.all(Array.from(this.elementMap.entries()).map(t=>O(this,null,function*(){let[n,r]=t,i=this.elementStateMap.get(n),c=r.srcObject.getAudioTracks()[0],l=c&&c.readyState;if(S.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(l," ").concat(e)),l==="live"){if(e)return r.pause(),r.play();if(mt.curState==="running")return xu()?(r.pause(),r.play()):i&&i==="paused"?r.play():void 0}})))),q(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e,r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),mt.on(Fn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mt.on(Fn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),mt.on(Fn.STATE_CHANGE,()=>{tr()&&mt.prevState==="suspended"&&mt.curState==="running"&&this.autoResumeAfterInterruption()})}setSinkID(e,t){return O(this,null,function*(){let n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{yield n.setSinkId(t)}catch(r){throw new z(P.PERMISSION_DENIED,"can not set sink id: "+r.toString())}})}play(e,t,n,r){if(this.elementMap.has(t))return;let i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Yn.INIT),this.setVolume(t,n);let c=this.sinkIdMap.get(t);if(c)try{i.setSinkId(c).catch(u=>{S.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){S.warning("[".concat(t,"] set sink id failed"),u.toString())}let l=i.play();l&&l.then&&l.catch(u=>{r&&tV(r,"audio",u.message,t),S.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),xE(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),eV()}))})}updateTrack(e,t){let n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}getVolume(e){let t=this.elementMap.get(e);return t?t.volume:0}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Oae.forEach(n=>{t.addEventListener(n,r=>{let i=this.elementStateMap.get(e),c=r.type==="pause"?"paused":r.type;if(S.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(c)),r.type==="error"){let l=t?.error;l&&S.error("[".concat(e,"] media error, code: ").concat(l.code,", message: ").concat(l.message))}this.elementStateMap.set(e,c)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{S.debug("Auto resume audio element success")}).catch(n=>{S.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ie(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Cf()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Yt(){return function(e,t,n){let r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new z(P.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",S);for(var i=arguments.length,c=new Array(i),l=0;l<i;l++)c[l]=arguments[l];let u=r.apply(this,c);return u instanceof ie?new ie((h,f)=>{u.then(h).catch(f)}):u}),n}}class nV extends jt{constructor(t){super(),q(this,"name","VideoProcessorDestination"),q(this,"ID","0"),q(this,"_source",void 0),q(this,"videoContext",void 0),q(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new z(P.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new z(P.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Cr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Cr.ON_TRACK,void 0)}}class rV extends jt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),q(this,"constraintsMap",new Map),q(this,"statsRegistry",[]),q(this,"usageRegistry",[]),q(this,"trackId",void 0),q(this,"direction",void 0),q(this,"_chained",!1),this.trackId=t,this.direction=n}getConstraints(){return O(this,null,function*(){return yield hn(this,Ti.REQUEST_CONSTRAINTS)})}requestApplyConstraints(t,n){return O(this,null,function*(){var r;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Rt(this,Ti.REQUEST_UPDATE_CONSTRAINTS,Array.from(ai(r=this.constraintsMap).call(r)))})}requestRevertConstraints(t){return O(this,null,function*(){var n;if(this.constraintsMap.has(t))return S.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Rt(this,Ti.REQUEST_UPDATE_CONSTRAINTS,Array.from(ai(n=this.constraintsMap).call(n)))})}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){let r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let t=[];for(let{processorID:n,processorName:r,type:i,cb:c}of this.statsRegistry)try{let l=c();t.push({processorID:n,processorName:r,type:i,stats:l})}catch(l){S.error(new z(P.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){let n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}gatherUsage(){return O(this,null,function*(){let t=[];if(!this.chained)return[];for(let{cb:n}of this.usageRegistry)try{let r=n();r instanceof ie&&(r=yield r),t.push(Dt(Dt({},r),{},{direction:this.direction}))}catch(r){S.error("gather extension usage error",r)}return t})}getDirection(){return this.direction}}class iV extends jt{constructor(t){super(),q(this,"name","AudioProcessorDestination"),q(this,"ID","0"),q(this,"inputTrack",void 0),q(this,"inputNode",void 0),q(this,"audioProcessorContext",void 0),q(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new z(P.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new z(P.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Cr.ON_TRACK,void 0),this.emit(Cr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Cr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Cr.ON_NODE,this.inputNode))}}class oV extends jt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),q(this,"constraintsMap",new Map),q(this,"statsRegistry",[]),q(this,"audioContext",void 0),q(this,"trackId",void 0),q(this,"direction",void 0),q(this,"usageRegistry",[]),q(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}getConstraints(){return O(this,null,function*(){return hn(this,Ti.REQUEST_CONSTRAINTS)})}getAudioContext(){return this.audioContext}requestApplyConstraints(t,n){return O(this,null,function*(){var r;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Rt(this,Ti.REQUEST_UPDATE_CONSTRAINTS,Array.from(ai(r=this.constraintsMap).call(r)))})}requestRevertConstraints(t){return O(this,null,function*(){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Rt(this,Ti.REQUEST_UPDATE_CONSTRAINTS,Array.from(ai(n=this.constraintsMap).call(n)))})}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){let r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let t=[];for(let{processorID:n,processorName:r,type:i,cb:c}of this.statsRegistry)try{let l=c();t.push({processorID:n,processorName:r,type:i,stats:l})}catch(l){S.error(new z(P.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){let n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}gatherUsage(){return O(this,null,function*(){let t=[];if(!this.chained)return[];for(let{cb:n}of this.usageRegistry)try{let r=n();r instanceof ie&&(r=yield r),t.push(Dt(Dt({},r),{},{direction:this.direction}))}catch(r){S.error("gather extension usage error",r)}return t})}getDirection(){return this.direction}}class vw extends jt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),q(this,"context",void 0),q(this,"processSourceNode",void 0),q(this,"outputTrack",void 0),q(this,"processedNode",void 0),q(this,"clonedTrack",void 0),q(this,"outputNode",void 0),this.outputNode=new Nae}setVolume(){}createOutputTrack(){throw new z(P.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Nae{disconnect(){}connect(){}}function sV(e){return new ie((t,n)=>{let r=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);let c=tr()?"canplay":"playing";i.addEventListener(c,()=>{let l=i.videoWidth,u=i.videoHeight;!l&&Nt()||(r=!0,i.srcObject=null,i.remove(),t([l,u]))}),i.srcObject=new MediaStream([e]),i.play().catch(bf),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function XE(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let n=To(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!QF()&&n.frameRate&&(t.frameRate=n.frameRate),qF()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Nt()&&(t.frameRate={ideal:30,max:30}),t}function aV(e){let t={};return QF()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,va()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function cV(e){let t=aV(e);if(e.encoderConfig){let n=KE(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Tf()&&(t.sampleRate=void 0),t}let dV=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings(),{frameRate:c=n,width:l=r,height:u=i}=t;if(!c||!l||!u)return;l=Vu(l),u=Vu(u),c=Vu(c);let{max:h,min:f}=(function(y,A,C){let I=200*Math.pow(C/15,.6)*Math.pow(y*A/640/360,.75);return{min:Math.floor(I),max:Math.floor(4*I)}})(l,u,c),{bitrateMax:m,bitrateMin:E}=t||{};m||S.debug("calculate bitrate: [w: ".concat(l,", h: ").concat(u,", fps: ").concat(c,"] => [brMax: ").concat(m,", brMin: ").concat(E,"]"));let{maxFramerate:_}=D("ENCODER_CONFIG_LIMIT");return _&&typeof _=="number"&&(c=Math.min(c,_)),{frameRate:c,bitrateMax:m||h,bitrateMin:E||f,scaleResolutionDownBy:1,scale:0}},lV=(e,t,n)=>O(null,null,function*(){return yield((r,i,c)=>O(null,null,function*(){let l=(function(f){let m=[];for(let E=0;E<f.length;E+=2)m.push(parseInt(f.slice(E,E+2),16));return Uint8Array.from(m)})(v2(""+i+c)).slice(0,16),u=l.slice(0,12),h=yield window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},h,r))}))(e.buffer,t,n)}),yw=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new ie((n,r)=>{t.toBlob(i=>O(null,null,function*(){if(t.remove(),i){let c=yield uV(i);n({buffer:c,width:t.width,height:t.height})}else r(new z(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)})},uV=e=>O(null,null,function*(){let t=yield e.arrayBuffer();return new Uint8Array(t)});var hV,pV,fV,mV,gV,_V,EV,vV,yV,SV,TV,CV,RV,IV,bV,wV,AV,DV,Gt,OV,NV,PV,LV,kV,MV,ks,xV,UV,FV,VV,jV,BV,HV,GV,WV,qV,zV,KV,YV,qn;let $t=(hV=ve({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),pV=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),fV=Yt(),mV=ju("LocalAudioTrack","_enabledMutex"),gV=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),_V=Yt(),EV=ju("LocalAudioTrack","_enabledMutex"),vV=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),yV=Yt(),SV=Yt(),TV=Yt(),CV=ve({argsMap:e=>[e.getTrackId()]}),RV=Yt(),IV=ve({argsMap:e=>[e.getTrackId()]}),bV=Yt(),wV=ve({argsMap:e=>[e.getTrackId()]}),AV=ve({argsMap:(e,t)=>[e.getTrackId(),t.name]}),DV=ve({argsMap:e=>[e.getTrackId()]}),Ke((Gt=class extends Yu{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?cr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),q(this,"trackMediaType",Ku.AUDIO),q(this,"_encoderConfig",void 0),q(this,"_trackSource",void 0),q(this,"metadata",[]),q(this,"_enabled",!0),q(this,"_volume",100),q(this,"_useAudioElement",!0),q(this,"_bypassWebAudio",!1),q(this,"processor",void 0),q(this,"_processorContext",void 0),q(this,"_processorDestination",void 0),q(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new vw,D("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),D("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),An()&&!Ci?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){yt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&cr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Rt(this,he.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(e){return O(this,null,function*(){if(!this._useAudioElement||!U2())throw new z(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield cr.setSinkID(this.getTrackId(),e)})}setEnabled(e,t,n){return O(this,null,function*(){return this._setEnabled(e,t,n)})}_setEnabled(e,t,n){return O(this,null,function*(){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),yield Rt(this,he.NEED_ENABLE_TRACK,this),S.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{yield Rt(this,he.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}})}setMuted(e){return O(this,null,function*(){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?yield Rt(this,he.NEED_MUTE_TRACK,this):yield Rt(this,he.NEED_UNMUTE_TRACK,this))})}getStats(){return Ec(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),li(this,he.GET_STATS)||Dt({},lw)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Si.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Si.ON_AUDIO_BUFFER),this._source.on(Si.ON_AUDIO_BUFFER,n=>e(n))}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),cr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?cr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&cr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(e,t){return O(this,null,function*(){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),yield Rt(this,he.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))})}renewMediaStreamTrack(e){return ie.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new z(P.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new z(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Cr.ON_TRACK,t=>O(this,null,function*(){t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),yield Rt(this,he.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),yield Rt(this,he.NEED_REPLACE_TRACK,this))})),e.on(Cr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Cr.ON_TRACK),e.removeAllListeners(Cr.ON_NODE)}bindProcessorContextEvents(e){e.on(Ti.REQUEST_CONSTRAINTS,t=>O(this,null,function*(){t(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(Ti.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof vw&&(this._trackSource=new gw(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new oV(this._source.context,this.getTrackId(),"local"),t=new iV(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Si.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(cr.stop(this.getTrackId()),this._source.play()),Rt(this,he.NEED_REPLACE_MIXING_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[hV],Object.getOwnPropertyDescriptor(Gt.prototype,"setVolume"),Gt.prototype),Ke(Gt.prototype,"setPlaybackDevice",[pV,fV],Object.getOwnPropertyDescriptor(Gt.prototype,"setPlaybackDevice"),Gt.prototype),Ke(Gt.prototype,"setEnabled",[mV,gV,_V],Object.getOwnPropertyDescriptor(Gt.prototype,"setEnabled"),Gt.prototype),Ke(Gt.prototype,"setMuted",[EV,vV,yV],Object.getOwnPropertyDescriptor(Gt.prototype,"setMuted"),Gt.prototype),Ke(Gt.prototype,"getStats",[SV],Object.getOwnPropertyDescriptor(Gt.prototype,"getStats"),Gt.prototype),Ke(Gt.prototype,"setAudioFrameCallback",[TV],Object.getOwnPropertyDescriptor(Gt.prototype,"setAudioFrameCallback"),Gt.prototype),Ke(Gt.prototype,"play",[CV,RV],Object.getOwnPropertyDescriptor(Gt.prototype,"play"),Gt.prototype),Ke(Gt.prototype,"stop",[IV,bV],Object.getOwnPropertyDescriptor(Gt.prototype,"stop"),Gt.prototype),Ke(Gt.prototype,"close",[wV],Object.getOwnPropertyDescriptor(Gt.prototype,"close"),Gt.prototype),Ke(Gt.prototype,"pipe",[AV],Object.getOwnPropertyDescriptor(Gt.prototype,"pipe"),Gt.prototype),Ke(Gt.prototype,"unpipe",[DV],Object.getOwnPropertyDescriptor(Gt.prototype,"unpipe"),Gt.prototype),Gt),Pf=(OV=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),NV=Yt(),PV=ju("MicrophoneAudioTrack","_enabledMutex"),LV=ve({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),kV=Yt(),MV=ve({argsMap:e=>[e.getTrackId()]}),Ke((ks=class e extends $t{get __className__(){return"MicrophoneAudioTrack"}constructor(t,n,r,i){super(t,n.encoderConfig?KE(n.encoderConfig):{},i,D("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),q(this,"_config",void 0),q(this,"_deviceName","default"),q(this,"_constraints",void 0),q(this,"_originalConstraints",void 0),q(this,"_enabled",!0),this._config=n,this._constraints=r,this._originalConstraints=r,this._deviceName=t.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),(xu()||Ub())&&mt.bindInterruptDetectorTrack(this)}setDevice(t){return O(this,null,function*(){if(S.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{let n=yield Ii.getDeviceById(t),r={};r.audio=Dt({},this._constraints),r.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=yield Ri(r,this.getTrackId())}catch(c){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),i=yield Ri({audio:this._constraints},this.getTrackId()),yield this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),c}yield this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{let n=yield Ii.getDeviceById(t);this._deviceName=n.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}S.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))})}setEnabled(t,n,r){return O(this,null,function*(){if(n)return S.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),yield aA(e.prototype,this,"_setEnabled").call(this,t);if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),D("AUTO_RESET_AUDIO_ROUTE")&&(tr()||_o())){let u=navigator.audioSession;u&&(t||(u.type="playback"),u.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),r||(this._enabled=!1);try{yield Rt(this,he.NEED_DISABLE_TRACK,this)}catch(u){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),u}return}let c=Dt({},this._constraints),l=Ii.searchDeviceIdByName(this._deviceName);l&&!c.deviceId&&(c.deviceId=l);try{r||(this._enabled=!0);let u=yield Ri({audio:this._constraints},this.getTrackId());yield this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),yield Rt(this,he.NEED_ENABLE_TRACK,this)}catch(u){throw r||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),u}S.info("[".concat(this.getTrackId(),"] setEnabled success"))})}close(){super.close(),(xu()||Ub())&&mt.unbindInterruptDetectorTrack(this),Ld.some(t=>(function(n){return"__className__"in n&&n.__className__==="MicrophoneAudioTrack"})(t))||pw&&pw()&&(ue.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:St.TRACER}).onSuccess(),S.debug("restart background audio tag success"))}onTrackEnded(){if((tr()||_o())&&this._enabled&&!this._isClosed&&mt.duringInterruption){let t=()=>O(this,null,function*(){mt.off(Fn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield this.setEnabled(!1),yield this.setEnabled(!0))});mt.on(Fn.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(zu.TRACK_ENDED)}renewMediaStreamTrack(t){return O(this,null,function*(){let n=t||this._constraints,r=Ii.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId=r),this._constraints=n,this._enabled){this._originMediaStreamTrack.stop();let i=yield Ri({audio:this._constraints},this.getTrackId());yield this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}})}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Ti.REQUEST_UPDATE_CONSTRAINTS,(n,r,i)=>O(this,null,function*(){try{let c=Object.assign({},this._originalConstraints,...n);yield this.renewMediaStreamTrack(c),r()}catch(c){i(c)}}))}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Ti.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[OV,NV],Object.getOwnPropertyDescriptor(ks.prototype,"setDevice"),ks.prototype),Ke(ks.prototype,"setEnabled",[PV,LV,kV],Object.getOwnPropertyDescriptor(ks.prototype,"setEnabled"),ks.prototype),Ke(ks.prototype,"close",[MV],Object.getOwnPropertyDescriptor(ks.prototype,"close"),ks.prototype),ks),Pae=(xV=ve({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),UV=Yt(),FV=ve({argsMap:e=>[e.getTrackId()]}),VV=Yt(),jV=ve({argsMap:e=>[e.getTrackId()]}),BV=Yt(),HV=ve({argsMap:e=>[e.getTrackId()]}),GV=Yt(),WV=ve({argsMap:e=>[e.getTrackId()]}),qV=Yt(),zV=ve({argsMap:e=>[e.getTrackId()]}),KV=ve({argsMap:e=>[e.getTrackId()]}),YV=Yt(),Ke((qn=class extends $t{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),q(this,"source",void 0),q(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Si.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(zu.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){yt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[xV,UV],Object.getOwnPropertyDescriptor(qn.prototype,"startProcessAudioBuffer"),qn.prototype),Ke(qn.prototype,"pauseProcessAudioBuffer",[FV,VV],Object.getOwnPropertyDescriptor(qn.prototype,"pauseProcessAudioBuffer"),qn.prototype),Ke(qn.prototype,"seekAudioBuffer",[jV,BV],Object.getOwnPropertyDescriptor(qn.prototype,"seekAudioBuffer"),qn.prototype),Ke(qn.prototype,"resumeProcessAudioBuffer",[HV,GV],Object.getOwnPropertyDescriptor(qn.prototype,"resumeProcessAudioBuffer"),qn.prototype),Ke(qn.prototype,"stopProcessAudioBuffer",[WV,qV],Object.getOwnPropertyDescriptor(qn.prototype,"stopProcessAudioBuffer"),qn.prototype),Ke(qn.prototype,"close",[zV],Object.getOwnPropertyDescriptor(qn.prototype,"close"),qn.prototype),Ke(qn.prototype,"setAudioBufferPlaybackSpeed",[KV,YV],Object.getOwnPropertyDescriptor(qn.prototype,"setAudioBufferPlaybackSpeed"),qn.prototype),qn);class gn extends $t{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=$u().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,at(8,"track-mix-")),q(this,"trackList",void 0),q(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(S.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):S.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){S.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}ME(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof gn?n.emit(kd.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class Lae extends $2{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Si.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),q(this,"audioBuffer",void 0),q(this,"sourceNode",void 0),q(this,"startPlayTime",0),q(this,"startPlayOffset",0),q(this,"pausePlayTime",0),q(this,"options",void 0),q(this,"currentLoopCount",0),q(this,"currentPlaybackSpeed",100),q(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let $V=new Map;function XV(e,t){if(e.length===0||t.length===0)return 1/0;let n=Kb(e),r=Kb(t);return Math.floor(r/n)}class Sw{get rendFrameRate(){let t=Math.max(1,XV(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Yn.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(S.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){q(this,"trackId",void 0),q(this,"config",void 0),q(this,"onFirstVideoFrameDecoded",void 0),q(this,"onFirstVideoFrameRender",void 0),q(this,"onVideoBufferReady",void 0),q(this,"onVideoStateChanged",void 0),q(this,"freezeTimeCounterList",[]),q(this,"renderFreezeAccTime",0),q(this,"renderFreezeAccTime2",0),q(this,"isKeepLastFrame",!1),q(this,"isDestroyed",!1),q(this,"timeUpdatedCount",0),q(this,"freezeTime",0),q(this,"playbackTime",0),q(this,"lastTimeUpdatedTime",0),q(this,"autoplayFailed",!1),q(this,"videoTrack",void 0),q(this,"videoElement",void 0),q(this,"cacheVideoElement",void 0),q(this,"cancelRVFId",void 0),q(this,"internal",!1),q(this,"_render_interframe_delays",[]),q(this,"_render_interframe_delays_sizes",[]),q(this,"_videoState",Ls.VideoStateStopped),q(this,"videoElementCheckInterval",void 0),q(this,"videoElementFreezeTimeout",void 0),q(this,"_videoElementStatus",Yn.NONE),q(this,"_isInPage",!0),q(this,"isGettingVideoDimensions",!1),q(this,"startGetVideoDimensions",()=>{let n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),q(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&mt.curState==="running"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(GF())),JF()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),q(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&S.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Yn.PLAYING;break;case"loadeddata":if(this.videoState=Ls.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Yn.CANPLAY;break;case"stalled":this.videoElementStatus=Yn.STALLED;break;case"suspend":this.videoElementStatus=Yn.SUSPEND;break;case"pause":this.videoElementStatus=Yn.PAUSED,tr()||_o()||An()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Yn.WAITING;break;case"abort":this.videoElementStatus=Yn.ABORT;break;case"ended":this.videoElementStatus=Yn.ENDED;break;case"emptied":this.videoElementStatus=Yn.EMPTIED;break;case"error":{let r=this.videoElement.error;r&&(this.videoElementStatus=Yn.ERROR,S.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{let r=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>D("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);let i=r-this.lastTimeUpdatedTime,c=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,ui.lastVisibleTime<ui.lastHiddenTime||c<ui.lastHiddenTime||c<ui.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>D("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;let l=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(l),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),q(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(GF())),JF()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),mt.on(Fn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mt.on(Fn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let n=this.videoElement.play();n&&n.catch&&n.catch(i=>{t&&tV(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),i)});let r=Je();if((r.name==="Safari"&&Number(r.version)===15||xu())&&n&&n.then){let i=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let n=t.getContext("2d");if(!n)return S.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);let r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}getCurrentFrameToUint8Array(n){return O(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;let c=i.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,i.width,i.height),new ie((l,u)=>{i.toBlob(h=>O(this,null,function*(){if(i.remove(),h){let f=yield uV(h);l({buffer:f,width:i.width,height:i.height})}else u(new z(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,r<0?.1:r>1?1:r)})):yield yw(t)})}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,mt.off(Fn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),mt.off(Fn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Ls.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Yn.INIT,!this.videoElementCheckInterval&&(JV.forEach(c=>{this.videoElement.addEventListener(c,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=(function(c){return c!==document.body&&document.body.contains(c)})(this.videoElement)},1e3),D("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let c,l=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",l),this.videoElementFreezeTimeout=window.setTimeout(u,D("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Ls.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Ls.VideoStateFrozen:document.addEventListener("visibilitychange",l))},h=(f,m)=>{if(this.videoElementStatus===Yn.PLAYING){if(c){let y=m.presentationTime-c.presentationTime,A=m.presentedFrames-c.presentedFrames;this._render_interframe_delays_sizes.push(A),this._render_interframe_delays.push(y);let C=Kb(this._render_interframe_delays_sizes),I=C-this._render_interframe_delays_sizes[0];if(C>30&&I>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Ls.VideoStateStarting&&(this.videoState=Ls.VideoStateDecoding),this.videoState===Ls.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,D("VIDEO_FREEZE_DURATION"))),y<D("VIDEO_FREEZE_DURATION")&&this.videoState===Ls.VideoStateFrozen&&(this.videoState=Ls.VideoStateDecoding),y>D("VIDEO_FREEZE_DURATION")&&ui.lastVisibleTime>=ui.lastHiddenTime&&c.timestamp>ui.lastVisibleTime&&c.timestamp>ui.lastHiddenTime){let N=Math.min(66,XV(this._render_interframe_delays_sizes,this._render_interframe_delays)),L=Math.max(0,y-(A-1)*N);this.renderFreezeAccTime2+=L>N?L:0,this.renderFreezeAccTime+=y}}c=Dt(Dt({},m),{},{timestamp:f})}else this.isSkipCalcRenderFreezeTime()&&(c=Dt(Dt({},m),{},{timestamp:f}));var E,_;D("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(E=(_=this.videoElement).requestVideoFrameCallback)===null||E===void 0?void 0:E.call(_,h))};this.cancelRVFId=(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(n,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Tf()&&!D("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let r=Je();this.config.noStyle||(r.name==="Safari"&&Number(r.version)===15||xu()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nt()&&this.videoElement.load());let i=this.videoElement.play();i!==void 0&&i.catch(c=>{S.debug("[".concat(this.trackId,"] playback interrupted"),c.toString())})}resetVideoElement(){var t,n;JV.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(n=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(n,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Yn.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Yn.DESTROYED||this.internal}handleAutoPlayFailed(){let t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{S.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{S.error(r)}),this.autoplayFailed=!1,Cf()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Cf()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),eV()}}let JV=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Ju extends Sw{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),q(this,"container",void 0),q(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let n=t.element;var r;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(n){return O(this,arguments,function*(t){var r;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?yield aA(Ju.prototype,this,"getCurrentFrameToUint8Array").call(this,t,i):yield yw(t)})}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",D("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var ZV,QV,ej,tj,nj,rj,ij,oj,sj,aj,cj,dj,lj,uj,hj,pj,fj,mj,gj,_j,Ej,vj,yj,Sj,Tj,Cj,Rj,Ij,je,bj,wj,Aj,Dj,Oj,Nj,Pj,Lj,bi;let Tt=(ZV=ve({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),QV=Yt(),ej=ve({argsMap:e=>[e.getTrackId()]}),tj=ju("LocalVideoTrack","_enabledMutex"),nj=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),rj=Yt(),ij=ju("LocalVideoTrack","_enabledMutex"),oj=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),sj=Yt(),aj=ve({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),cj=Yt(),dj=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),lj=Yt(),uj=Yt(),hj=ve({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),pj=Yt(),fj=Yt(),mj=Yt(),gj=ve({argsMap:e=>[e.getTrackId()]}),_j=Yt(),Ej=Yt(),vj=Yt(),yj=Yt(),Sj=Yt(),Tj=ve({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Cj=ve({argsMap:e=>[e.getTrackId()]}),Rj=ve({argsMap:e=>[e.getTrackId()]}),Ij=ve({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),je=class jY extends Yu{get videoHeight(){if(An()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(An()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Yn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,c,l){if(super(t,c),q(this,"trackMediaType",Ku.VIDEO),q(this,"_player",void 0),q(this,"isUseScaleResolutionDownBy",!1),q(this,"_videoVisibleTimer",null),q(this,"_previousVideoVisibleStatus",void 0),q(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),q(this,"_encoderConfig",void 0),q(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),q(this,"_optimizationMode",void 0),q(this,"_saveEncodeBitrateRatio",1),q(this,"_videoHeight",void 0),q(this,"_videoWidth",void 0),q(this,"_forceBitrateLimit",void 0),q(this,"_enabled",!0),q(this,"_processorDestination",void 0),q(this,"_processorContext",void 0),An()){let{width:u,height:h}=t.getSettings();this._videoWidth=u,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=l||[],n&&this._hints.indexOf(ot.CUSTOM_TRACK)!==-1?this._encoderConfig=Pt(n):this._encoderConfig=n,this._hints.indexOf(ot.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(kb(Qe.CHROME,115)&&LE().indexOf("Windows")!==-1){let u=(function(h,f){if("VideoFrame"in window&&"TransformStream"in window&&Ve().supportWebRTCInsertableStream){let m=new MediaStreamTrackProcessor(h),E=new MediaStreamTrackGenerator({kind:"video"}),_,y,A=Date.now(),C=()=>{I&&(clearInterval(I),I=void 0),_&&(_.close(),_=void 0),h.stop(),y=void 0,E.removeEventListener("ended",C)},I=window.setInterval(()=>{if(y&&_&&Date.now()-A>(f??1e3))try{E.readyState==="live"?y.enqueue(_.clone()):C()}catch{C()}},f??1e3),N=new TransformStream({transform:(L,M)=>{E.readyState==="live"?(y=M,A=Date.now(),_===void 0?(_=L,M.enqueue(L.clone())):(M.enqueue(_),_=L)):L.close()}});return E.addEventListener("ended",C),m.readable.pipeThrough(N).pipeTo(E.writable),E}})(t);u&&(S.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}n&&this._hints.indexOf(ot.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new rV(this.getTrackId(),"local"),this._processorDestination=new nV(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let i=document.getElementById(t);i?t=i:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));let r=Dt(Dt(Dt({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new Sw(r):this._player=new Ju(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i=this.getVideoElementVisibleStatus();this.safeEmit(zu.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},D("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(t,n){return O(this,null,function*(){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{yield Rt(this,he.NEED_DISABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{yield Rt(this,he.NEED_ENABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)})}setMuted(t){return O(this,null,function*(){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?yield Rt(this,he.NEED_MUTE_TRACK,this):yield Rt(this,he.NEED_UNMUTE_TRACK,this))})}setSaveEncodeBitrateRatio(){return O(this,arguments,function*(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),S.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{yield Rt(this,he.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}})}setEncoderConfiguration(t,n){return O(this,null,function*(){if(!this._enabled)throw new z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=To(t),D("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let r=XE({encoderConfig:t});(An()||tr()||_o())&&(r.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{yield this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){let c=new z(P.UNEXPECTED_ERROR,i.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}}this._encoderConfig=t,this._hints.indexOf(ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{yield Rt(this,he.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(S)}})}getStats(){return Ec(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),li(this,he.GET_STATS)||Dt({},uw)}setBeautyEffect(t){return O(this,null,function*(){S.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(n){return O(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):yield yw(t)})}findClosestProfile(){return O(this,null,function*(){let{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:c,frameRate:l}=this._encoderConfig||{},u=Vu(this._videoWidth||t||i||0),h=Vu(this._videoHeight||n||c||0),f=(function(m,E,_){if(!Array.isArray(D("VIDEO_ENCODER_CONFIG_LIST"))||D("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let y=Math.min(m,E);return!(y>=480)&&Dt(Dt({},D("VIDEO_ENCODER_CONFIG_LIST").find(A=>A.height>y)),{},{frameRate:_})})(u,h,Vu(r||l||15));if(f)return S.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(u,"x").concat(h," => ").concat(JSON.stringify(f))),this.setEncoderConfiguration(f)})}setBitrateLimit(t){return O(this,null,function*(){S.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))})}setOptimizationMode(t){return O(this,null,function*(){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void S.error(P.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let n=this._optimizationMode;try{this._optimizationMode=t,yield Rt(this,he.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))})}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return S.error(P.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,S.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){sV(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(bf)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(t){return O(this,null,function*(){if(!this._enabled)throw new z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");S.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=To(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{yield Rt(this,he.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}})}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;let{bitrateMax:i,bitrateMin:c}=this._encoderConfig;if(c==null||i==null){let{max:l,min:u}=(function(h,f,m,E,_){let y=D("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:E,max:_};if(_===void 0){let A=Math.floor(200*Math.pow(m/15,.6)*Math.pow(h*f/640/360,.75));_=y==="STANDARD_BITRATE"?4*A:2*A,E=E??A}else E=E??Math.floor(_/10);return{min:E,max:_}})(t,n,r,c,i);if(this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=l,D("VIDEO_STANDARD_BITRATE_VERSION")&&c==null&&i==null){let[h,f]=(function(m,E,_){let y=4*Math.floor(2e5*Math.pow(_/15,.6)*Math.pow(m*E/230400,.75)),A=m*E,C=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),I=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),N=ai(C).call(C).next().value,L=1;if(C.has(A))N=C.get(A);else{var M;let ae=fd(M=Array.from(C.entries())).call(M,(Te,Le)=>{let[De]=Te,[tt]=Le;return De-tt}),Ce=ae.find(Te=>{let[Le]=Te;return Le>A});if(Ce){let Te=ae.indexOf(Ce);if(Te>0){let Le=ae[Te-1],De=(A-Le[0])/(Ce[0]-Le[0]);N=Le[1]+De*(Ce[1]-Le[1])}else N=Ce[1]}else N=ae[ae.length-1][1]}if(I.has(A))L=I.get(A);else{var V;let ae=fd(V=Array.from(I.entries())).call(V,(Te,Le)=>{let[De]=Te,[tt]=Le;return De-tt}),Ce=ae.find(Te=>{let[Le]=Te;return Le>A});if(Ce){let Te=ae.indexOf(Ce);if(Te>0){let Le=ae[Te-1],De=(A-Le[0])/(Ce[0]-Le[0]);L=Le[1]+De*(Ce[1]-Le[1])}else L=Ce[1]}else L=ae[ae.length-1][1]}let j=D("VIDEO_NEW_BITRATE_RATIO");j&&j>0&&(N=j/100);let U=Math.floor(y*N),H=Math.floor(65e4*Math.pow(m*E/230400,.5)*Math.pow(_/15,.69)),K=U,Y=D("VIDEO_STANDARD_BITRATE_VERSION");return Y&&Y>0&&(Y===1?K=y:Y===2?K=U:Y===3&&(K=H)),[Math.floor(K/1e3),L]})(t,n,r);this._encoderConfig.bitrateMax=h,this._encoderConfig.bitrateMin=u?Math.min(u,h):h,this._saveEncodeBitrateRatio=f,S.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else S.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;let r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r?.parentElement},{element:c,slot:l}=i;if(this.isPlaying&&c instanceof HTMLVideoElement&&l instanceof HTMLElement){let u=o2.checkOneElementVisible(c),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;let f=ue.reportApiInvoke(null,{tag:St.TRACER,name:Mt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(r){throw new z(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}renewMediaStreamTrack(t){return O(this,null,function*(){})}pipe(t){if(this.processor===t)return t;if(t._source)throw new z(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Dt(Dt({},r),To(t))),r=Ad(r);let i=at(8,"track-video-cloned-"),c=new jY(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Ad(this._scalabilityMode),this._optimizationMode,i,Ad(this._hints));return t&&r&&c.setEncoderConfiguration(r),S.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),c}replaceTrack(t,n){return O(this,null,function*(){if(!(t instanceof MediaStreamTrack))throw new z(P.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new z(P.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()})}sendSeiData(t){if(Ec(()=>{ue.reportApiInvoke(null,{name:Mt.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:St.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!D("ENABLE_VIDEO_SEI")||!D("ENABLE_ENCODED_TRANSFORM"))return void S.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new z(P.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let n=this.getRTCRtpTransceiver();if(!n)return void S.warning("Video track is not published, SEI can not be send");let r=n.sender.getParameters();if(r.codecs.length===0)return;let i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):S.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(Cr.ON_TRACK,t=>O(this,null,function*(){t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),yield Rt(this,he.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),yield Rt(this,he.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ti.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ti.REQUEST_CONSTRAINTS)}},Ke(je.prototype,"play",[ZV,QV],Object.getOwnPropertyDescriptor(je.prototype,"play"),je.prototype),Ke(je.prototype,"stop",[ej],Object.getOwnPropertyDescriptor(je.prototype,"stop"),je.prototype),Ke(je.prototype,"setEnabled",[tj,nj,rj],Object.getOwnPropertyDescriptor(je.prototype,"setEnabled"),je.prototype),Ke(je.prototype,"setMuted",[ij,oj,sj],Object.getOwnPropertyDescriptor(je.prototype,"setMuted"),je.prototype),Ke(je.prototype,"setSaveEncodeBitrateRatio",[aj,cj],Object.getOwnPropertyDescriptor(je.prototype,"setSaveEncodeBitrateRatio"),je.prototype),Ke(je.prototype,"setEncoderConfiguration",[dj,lj],Object.getOwnPropertyDescriptor(je.prototype,"setEncoderConfiguration"),je.prototype),Ke(je.prototype,"getStats",[uj],Object.getOwnPropertyDescriptor(je.prototype,"getStats"),je.prototype),Ke(je.prototype,"setBeautyEffect",[hj,pj],Object.getOwnPropertyDescriptor(je.prototype,"setBeautyEffect"),je.prototype),Ke(je.prototype,"getCurrentFrameData",[fj],Object.getOwnPropertyDescriptor(je.prototype,"getCurrentFrameData"),je.prototype),Ke(je.prototype,"getCurrentFrameImage",[mj],Object.getOwnPropertyDescriptor(je.prototype,"getCurrentFrameImage"),je.prototype),Ke(je.prototype,"findClosestProfile",[gj,_j],Object.getOwnPropertyDescriptor(je.prototype,"findClosestProfile"),je.prototype),Ke(je.prototype,"setBitrateLimit",[Ej],Object.getOwnPropertyDescriptor(je.prototype,"setBitrateLimit"),je.prototype),Ke(je.prototype,"setOptimizationMode",[vj],Object.getOwnPropertyDescriptor(je.prototype,"setOptimizationMode"),je.prototype),Ke(je.prototype,"setScalabiltyMode",[yj],Object.getOwnPropertyDescriptor(je.prototype,"setScalabiltyMode"),je.prototype),Ke(je.prototype,"updateMediaStreamTrackResolution",[Sj],Object.getOwnPropertyDescriptor(je.prototype,"updateMediaStreamTrackResolution"),je.prototype),Ke(je.prototype,"pipe",[Tj],Object.getOwnPropertyDescriptor(je.prototype,"pipe"),je.prototype),Ke(je.prototype,"unpipe",[Cj],Object.getOwnPropertyDescriptor(je.prototype,"unpipe"),je.prototype),Ke(je.prototype,"close",[Rj],Object.getOwnPropertyDescriptor(je.prototype,"close"),je.prototype),Ke(je.prototype,"replaceTrack",[Ij],Object.getOwnPropertyDescriptor(je.prototype,"replaceTrack"),je.prototype),je),JE=(bj=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),wj=Yt(),Aj=ju("CameraVideoTrack","_enabledMutex"),Dj=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),Oj=Yt(),Nj=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),Pj=Yt(),Lj=ve({argsMap:e=>[e.getTrackId()]}),bi=class BY extends Tt{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,c,l){super(t,To(n.encoderConfig),i,c,l),q(this,"_config",void 0),q(this,"_originalConstraints",void 0),q(this,"_constraints",void 0),q(this,"_enabled",!0),q(this,"_deviceName","default"),q(this,"tryResumeVideoForIOS15_16WeChat",()=>O(this,null,function*(){(xu()||Ub())&&!(function(){let u=Je();if(u.os!==Sn.IOS||!u.osVersion)return!1;let h=u.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2})()&&ZF()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield this.renewMediaStreamTrack())})),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=To(this._config.encoderConfig),mt.on(Fn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mt.on(Fn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(t){return O(this,null,function*(){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0})}_setDeviceById(t){return O(this,null,function*(){if(S.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let n=yield Ii.getDeviceById(t),r={};r.video=Dt({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=yield Ri(r,this.getTrackId())}catch(c){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),i=yield Ri({video:this._constraints},this.getTrackId()),yield this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),c}yield this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{let n=yield Ii.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}S.info("[".concat(this.getTrackId(),"] setDevice success"))})}_setDeviceByFacingModel(t){return O(this,null,function*(){S.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let n={video:Dt(Dt({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=yield Ri(n,this.getTrackId())}catch(i){throw S.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=yield Ri({video:this._constraints},this.getTrackId()),yield this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}yield this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Dt({},n.video),S.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))})}setEnabled(t,n){return O(this,null,function*(){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let r=yield Ri({video:this._constraints},this.getTrackId());yield this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}yield Rt(this,he.NEED_ENABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{yield Rt(this,he.NEED_DISABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}})}setEncoderConfiguration(t,n){return O(this,null,function*(){if(!this._enabled)throw new z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=To(t),D("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let r=Pt(this._config);r.encoderConfig=t;let i=XE(r);(An()||tr()||_o())&&(i.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{yield this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(c){let l=new z(P.UNEXPECTED_ERROR,c.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(ot.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{yield Rt(this,he.NEED_UPDATE_VIDEO_ENCODER,this)}catch(c){return c.throw(S)}})}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((tr()||_o())&&this._enabled&&!this._isClosed&&mt.duringInterruption){let t=()=>O(this,null,function*(){mt.off(Fn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield this.setEnabled(!1),yield this.setEnabled(!0))});mt.on(Fn.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(zu.TRACK_ENDED)}renewMediaStreamTrack(t){return O(this,null,function*(){let n=t||this._constraints,r=Ii.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){let i=yield Ri({video:n},this.getTrackId());this._constraints=n,yield this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}})}close(){super.close(),mt.off(Fn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),mt.off(Fn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Dt(Dt({},r),To(t))),r=Ad(r);let i=at(8,"track-cam-cloned-"),c=new BY(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ad(Dt(Dt({},this._config),{},{encoderConfig:r})),Ad(this._constraints),Ad(this._scalabilityMode),this._optimizationMode,i);return t&&r&&c.setEncoderConfiguration(r),S.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),c}bindProcessorContextEvents(){this.processorContext.on(Ti.REQUEST_UPDATE_CONSTRAINTS,(t,n,r)=>O(this,null,function*(){try{let i=Object.assign({},this._originalConstraints,...t);yield this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})),this.processorContext.on(Ti.REQUEST_CONSTRAINTS,t=>O(this,null,function*(){t(this._originMediaStreamTrack.getSettings())}))}},Ke(bi.prototype,"setDevice",[bj,wj],Object.getOwnPropertyDescriptor(bi.prototype,"setDevice"),bi.prototype),Ke(bi.prototype,"setEnabled",[Aj,Dj,Oj],Object.getOwnPropertyDescriptor(bi.prototype,"setEnabled"),bi.prototype),Ke(bi.prototype,"setEncoderConfiguration",[Nj,Pj],Object.getOwnPropertyDescriptor(bi.prototype,"setEncoderConfiguration"),bi.prototype),Ke(bi.prototype,"close",[Lj],Object.getOwnPropertyDescriptor(bi.prototype,"close"),bi.prototype),bi);function kj(e){let t=at(8,"track-cus-"),n=ue.reportApiInvoke(null,{id:t,tag:St.TRACER,name:Mt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new $t(e.mediaStreamTrack,e.encoderConfig?KE(e.encoderConfig):{},t,!1);return S.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r}function Tw(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=Dt(Dt({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?S.debug("[".concat(e,"] set content hint to"),n.optimizationMode):S.debug("[".concat(e,"] set content hint failed")))):S.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Mj,xj,Uj,Fj,Hi,Vj,jj,Bj,Hj,Gj,Wj,qj,zn;class zj extends z2{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(at(5,""))),q(this,"_userId",void 0),q(this,"_uintId",void 0),q(this,"_isDestroyed",!1),q(this,"store",void 0),q(this,"processor",void 0),q(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Zu=(Mj=ve({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),xj=ve({argsMap:e=>[e.getTrackId()]}),Uj=ve({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Fj=ve({argsMap:e=>[e.getTrackId()]}),Ke((Hi=class extends zj{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Yn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),q(this,"_videoVisibleTimer",null),q(this,"_previousVideoVisibleStatus",void 0),q(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),q(this,"trackMediaType",Ku.VIDEO),q(this,"_videoWidth",void 0),q(this,"_videoHeight",void 0),q(this,"_player",void 0),q(this,"_prePlayer",void 0),q(this,"processorDestination",void 0),q(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new rV(this.getTrackId(),"remote"),this.processorDestination=new nV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Ec(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),li(this,he.GET_STATS)||Dt({},W2)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Bi.PLAY_START),typeof e=="string"){let r=document.getElementById(e);r?e=r:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let n=Dt(Dt({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new Sw(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(n)):this._player=new Ju(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Bi.FIRST_FRAME_DECODED),i&&this.safeEmit(Bi.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=c=>{this.safeEmit(Bi.VIDEO_STATE_CHANGED,c)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let r=this.getVideoElementVisibleStatus();this.safeEmit(Bi.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},D("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Bi.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){sV(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(bf)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:i,slot:c}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&c instanceof HTMLElement){let l=o2.checkOneElementVisible(i),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;let h=ue.reportApiInvoke(null,{tag:St.TRACER,name:Mt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(n){throw new z(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new z(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Cr.ON_TRACK,e=>O(this,null,function*(){e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cr.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(kd.SEI_RECEIVED,e)}}).prototype,"play",[Mj],Object.getOwnPropertyDescriptor(Hi.prototype,"play"),Hi.prototype),Ke(Hi.prototype,"stop",[xj],Object.getOwnPropertyDescriptor(Hi.prototype,"stop"),Hi.prototype),Ke(Hi.prototype,"pipe",[Uj],Object.getOwnPropertyDescriptor(Hi.prototype,"pipe"),Hi.prototype),Ke(Hi.prototype,"unpipe",[Fj],Object.getOwnPropertyDescriptor(Hi.prototype,"unpipe"),Hi.prototype),Hi),Qu=(Vj=ve({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),jj=ve({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Bj=ve({argsMap:(e,t)=>[e.getTrackId(),t]}),Hj=ve({argsMap:e=>[e.getTrackId()]}),Gj=ve({argsMap:e=>[e.getTrackId()]}),Wj=ve({argsMap:(e,t)=>[e.getTrackId(),t.name]}),qj=ve({argsMap:e=>[e.getTrackId()]}),Ke((zn=class extends zj{get isPlaying(){return this._useAudioElement?cr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),q(this,"trackMediaType",Ku.AUDIO),q(this,"_source",void 0),q(this,"_useAudioElement",!0),q(this,"_volume",100),q(this,"processorContext",void 0),q(this,"processorDestination",void 0),q(this,"_played",!1),q(this,"_bypassWebAudio",!1),D("DISABLE_WEBAUDIO")?(this._source=new vw,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new gw(e,!0),D("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Si.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Bi.FIRST_FRAME_DECODED)}),this.processorContext=new oV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new iV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Si.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Si.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Si.ON_AUDIO_BUFFER),this._source.on(Si.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?cr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(cr.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,D("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}setPlaybackDevice(e){return O(this,null,function*(){if(!this._useAudioElement||!U2())throw new z(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield cr.setSinkID(this.getTrackId(),e)})}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?cr.getVolume(this.getTrackId()):this._source instanceof gw?this._source.getAudioVolume():0}getStats(){return Ec(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),li(this,he.GET_STATS)||Dt({},G2)}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),cr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(S.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?cr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&cr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new z(P.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new z(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new z(P.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Cr.ON_TRACK,e=>O(this,null,function*(){e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(Cr.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Cr.ON_TRACK),this.processorDestination.removeAllListeners(Cr.ON_NODE)}}).prototype,"setVolume",[Vj],Object.getOwnPropertyDescriptor(zn.prototype,"setVolume"),zn.prototype),Ke(zn.prototype,"setAmplifiedVolume",[jj],Object.getOwnPropertyDescriptor(zn.prototype,"setAmplifiedVolume"),zn.prototype),Ke(zn.prototype,"setPlaybackDevice",[Bj],Object.getOwnPropertyDescriptor(zn.prototype,"setPlaybackDevice"),zn.prototype),Ke(zn.prototype,"play",[Hj],Object.getOwnPropertyDescriptor(zn.prototype,"play"),zn.prototype),Ke(zn.prototype,"stop",[Gj],Object.getOwnPropertyDescriptor(zn.prototype,"stop"),zn.prototype),Ke(zn.prototype,"pipe",[Wj],Object.getOwnPropertyDescriptor(zn.prototype,"pipe"),zn.prototype),Ke(zn.prototype,"unpipe",[qj],Object.getOwnPropertyDescriptor(zn.prototype,"unpipe"),zn.prototype),zn),ui=new class extends jt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),q(this,"_lastHiddenTime",0),q(this,"_lastVisibleTime",0),q(this,"needUploadStats",[]),q(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),S.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class Kj extends jt{constructor(t,n){super(),q(this,"trackMediaType",Ku.DATA),q(this,"_version",1),q(this,"_type",3),q(this,"_config",void 0),q(this,"_originDataChannel",void 0),q(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),q(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),q(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return D("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){return O(this,null,function*(){return new ie((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let r=setTimeout(()=>{var i;n(new z(P.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new z(P.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new z(P.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[YE.OPEN,YE.CLOSE,YE.ERROR].forEach(n=>{let r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class kae extends Kj{constructor(t){super(t),q(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(D("SHOW_DATASTREAM2_LOG")&&S.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let c=n.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(YE.MESSAGE,c)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Mae extends Kj{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);let r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function ZE(){let e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Z_.revokeObjectURL(e),0),new Worker(Z_.createObjectURL(e))}let Yj=71,Cw=1,Rw=2,Iw=1,$j=2;var yc=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(yc||{});function bw(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=e.getUint8(0);if(n!==Yj)return;let r=e.getUint16(1),i=Cw+Rw+r,c=new Uint8Array(e.byteLength-i);c.set(new Uint8Array(e.buffer,i,e.byteLength-i));let l={m:n,tlvLen:r,tlv:[],frame:c},u=Cw+Rw;for(;u<i;){let h=e.getUint8(u),f=e.getUint16(u+Iw),m=Iw+$j;if(h===yc.AUDIO_LEVEL){let E=e.getUint8(u+m);for(let _=1;_<f;_++)E=E<<8|e.getUint8(u+m+_);l.tlv.push({tag:h,length:f,value:t?127^E>>1:127&E})}else if(h===yc.METADATA||h===yc.AUDIO_64_BIT_PTS){let E=new Uint8Array(f);for(let _=0;_<f;_++)E[_]=e.getUint8(u+m+_);l.tlv.push({tag:h,length:f,value:E})}u+=m+f}return l}let QE=new Map,ev=127,Ud=1e-10,ww=139/13,tv=new Map;function Aw(e,t,n){let r="".concat(e,"-").concat(t,"-").concat(n),i=0;return tv.has(r)?i=tv.get(r):(i=Math.log((function(l,u){let h=l-u;u<h&&(u=h);let f=1;for(let m=l,E=1;m>u;m--,E++)f=f*m/E;return f})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,tv.set(r,i)),i<Ud&&(i=Ud),i}function Xj(e,t,n){let r=t.length,i=e.length/r,c=!1;for(let l=0,u=0;l<r;l++){let h=0;for(let f=u+i;u<f;u++)e[u]>n&&h++;t[l]!==h&&(t[l]=h,c=!0)}return c}window.cache=tv;let xae=0;class Jj{constructor(t){q(this,"id",void 0),q(this,"immediates",[]),q(this,"lastNonSilence",-1),q(this,"immediateSpeechActivityScore",Ud),q(this,"lastLevelChangedTime",Date.now()),q(this,"levels",[]),q(this,"longs",[]),q(this,"longSpeechActivityScore",Ud),q(this,"mediums",[]),q(this,"mediumSpeechActivityScore",Ud),q(this,"minLevel",0),q(this,"nextMinLevel",0),q(this,"nextMinLevelWindowLength",0),q(this,"energyScore",0),this.id=t||"".concat(xae++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,n=this.levels,r=this.minLevel+ww,i=!1;for(let c=0;c<t.length;++c){let l=n[c];l<r&&(l=0);let u=Math.floor(l/ww);t[c]!==u&&(t[c]=u,i=!0)}return i}computeLongs(){return Xj(this.mediums,this.longs,4)}computeMediums(){return Xj(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Aw(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=Aw(this.longs[0],10,47),this.longSpeechActivityScore>Ud&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Aw(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(vL(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>ev&&(r=ev),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+ww?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>ev&&(n=ev),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Uae{constructor(t){q(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Dw{constructor(t,n,r){q(this,"isDominant",void 0),q(this,"energyRanking",void 0),q(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class Fae extends jt{constructor(t){super(),q(this,"dominantId",null),q(this,"lastDecisionTime",0),q(this,"lastLevelChangedTime",0),q(this,"lastLevelIdleTime",0),q(this,"relativeSpeechActivities",[]),q(this,"speakers",new Map),q(this,"enableSilence",!1),q(this,"timeoutToSilenceInterval",0),q(this,"decisionMaker",null),q(this,"loudest",[]),q(this,"numLoudestToTrack",3),q(this,"energyExpireTimeMs",250),q(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){let r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());let c=i.levelChanged(n,r);return this.updateLoudestList(i,c,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new Jj(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){let i=t.id===this.dominantId;if(n<0){let h=0;for(;h<this.loudest.length&&this.loudest[h]!==t;)++h;return new Dw(i,h,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new Dw(i,0,t.energyScore);let c=r-this.energyExpireTimeMs,l=0;for(;l<this.loudest.length;){let h=this.loudest[l];if(h.getLastLevelChangedTime()<c&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(l,1);else if(h.id!==t.id)++l;else if(this.loudest.splice(l,1),this.loudest.length<this.numLoudestToTrack)break}let u=0;for(;u<this.loudest.length&&!(this.loudest[u].energyScore<t.energyScore);)++u;return u<this.numLoudestToTrack&&(this.loudest.splice(u,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Dw(i,u,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Uae(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null,i=this.speakers.size,c=null;if(i===0)c=null;else if(i===1){var l;let u=ai(l=this.speakers).call(l).next().value;this.enableSilence&&u&&(c=u.id,u.evaluateSpeechActivityScores(t),t-u.lastNonSilence>this.timeoutToSilenceInterval&&(c=null))}else{let u=this.dominantId==null?null:this.speakers.get(this.dominantId);if(u==null){let m=this.speakers.entries().next();m.value&&(c=m.value[0],u=m.value[1])}else c=u.id;u?.evaluateSpeechActivityScores(t);let h=this.relativeSpeechActivities,f=2;for(let m of this.speakers.entries()){let[E,_]=m;if(_===u)continue;_.evaluateSpeechActivityScores(t);for(let I=0;I<h.length;++I){let N=u==null?Ud:u.getSpeechActivityScore(I);h[I]=Math.log(_.getSpeechActivityScore(I)/N)}let y=h[0],A=h[1],C=h[2];y>3&&A>2&&C>0&&A>f&&(f=A,c=E)}this.enableSilence&&u!=null&&c===u.id&&t-u.lastNonSilence>this.timeoutToSilenceInterval&&(c=null)}c==null&&!this.enableSilence||c===this.dominantId||(n=this.dominantId,this.dominantId=c,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){let t=Date.now(),n=300-(t-this.lastLevelIdleTime),r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){let n=[];for(let i of ai(r=this.speakers).call(r)){var r;let c=t-i.getLastLevelChangedTime();36e5<c&&(this.dominantId==null||i.id!==this.dominantId)?n.push(i.id):300<c&&i.levelTimedOut()}n.forEach(i=>this.speakers.delete(i))}}let eh=new Map,$o=null,nv=null,Zj=3,Fd=[],Xo=new Map,rv=new Map;class Vae{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){q(this,"id",void 0),q(this,"track",void 0),q(this,"score",0),q(this,"active",!0),q(this,"muted",!1),q(this,"timer",0),q(this,"actives",0),q(this,"inactives",0),this.id=t,this.track=n,this.setActive(Xo.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:n,inactives:r}=(function(){let i=[],c=[];return Array.from(ai(Xo).call(Xo)).forEach(l=>{l.active?i.push(l):c.push(l)}),{actives:i,inactives:c}})();if(n.length>3){let i;n.forEach(c=>{(!i||i.score>c.score)&&(i=c)}),i&&i.setActive(!1)}if(n.length<3&&r.length>0){let i;r.forEach(c=>{(!i||i.score<c.score)&&c.id!==this.id&&(i=c)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=(function(n){let r;return Array.from(ai(Xo).call(Xo)).forEach(i=>{!i.active||i.id===n||i.samples<40||(!r||i.score<r.score)&&(r=i)}),r})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=(function(n){let r;return Array.from(ai(Xo).call(Xo)).forEach(i=>{i.active||i.id===n||i.samples<40||(!r||i.score>r.score)&&(r=i)}),r})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let iv;function Qj(e){let t=Xo.get(e);t&&(Xo.delete(e),t.clearTimer())}let ov=new Map,jae=new Map,Ow="video/h264",Nw="video/h265";function eB(e,t,n){let r=new Uint8Array(e,t,n),i=[],c=0;for(;i.length<n;)c+3<n&&r[c]===0&&r[c+1]===0&&r[c+2]===3&&(r[c+3]===0||r[c+3]===1||r[c+3]===2||r[c+3]===3)?(i.push(r[c],r[c+1],r[c+3]),c+=4):(i.push(r[c]),c++);return new Uint8Array(i)}function tB(e){let t=e.length,n=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function nB(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";let n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";let r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&(248&e[n+1])==0?Nw:(31&r)<=31?Ow:""}let sv=new Map,Lf=new Map;(function(){let e=Je();Cn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Cn.getStreamFromExtension=e.name===Qe.CHROME&&Number(e.version)>34,Cn.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n})(),Cn.supportMinBitrate=e.name===Qe.CHROME||e.name===Qe.EDGE,Cn.supportSetRtpSenderParameters=(function(){let t=Je();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ns()||!(!An()&&!kE())||t.name===Qe.FIREFOX&&Number(t.version)>=64)})(),e.name===Qe.SAFARI&&(Number(e.version)>=14?Cn.supportDualStream=!0:Cn.supportDualStream=!1),Cn.webAudioMediaStreamDest=(function(){let t=Je();return!(t.name===Qe.SAFARI&&Number(t.version)<12)})(),Cn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Cn.supportWebGL=typeof WebGLRenderingContext<"u",Cn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ns()||(Cn.webAudioWithAEC=!0),Cn.supportShareAudio=(function(){let t=Je();return(t.os===Sn.WIN_10||t.os===Sn.WIN_81||t.os===Sn.WIN_7||t.os===Sn.LINUX||t.os===Sn.MAC_OS||t.os===Sn.CHROMIUM_OS)&&t.name===Qe.CHROME&&Number(t.version)>=74})(),Cn.supportDataChannel=!!(Os(76)||Mb(68)||KF(14)),Cn.supportPCSetConfiguration=(function(){let t=window.RTCPeerConnection;return!Nt()&&!!t&&t.prototype.setConfiguration instanceof Function})(),Cn.supportWebRTCEncodedTransform=Os(87)||WF()||Mb(117),Cn.supportWebRTCInsertableStream=(function(){let t=Je();return(t.name===Qe.CHROME||t.name===Qe.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),Cn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Cn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Cn.supportSuppressLocalAudioPlayback=j2(),Cn.supportRestrictOwnAudio=B2(),xE(()=>{Cn.supportDualStreamEncoding=(function(){let t=Je();return!!D("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&D("CHROME_DUAL_STREAM_USE_ENCODING"))})(),S.debug("browser ua: ",navigator.userAgent),S.info("browser info: ",e),S.info("browser compatibility: ",Cn)})})();let Bae=["CHINA","GLOBAL"],rB=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Vd=[],th=[];function jd(e,t){return!!t&&Vd.some(n=>n.uid===e&&n.channelName===t)}function Pw(){return th.length>0}var Hae=uU.forEach,iB=l_("forEach")?[].forEach:function(e){return Hae(this,e,arguments.length>1?arguments[1]:void 0)};st({target:"Array",proto:!0,forced:[].forEach!==iB},{forEach:iB});var Gae=xi("Array","forEach"),Wae=cc,qae=Qn,zae=B,Kae=Gae,Lw=Array.prototype,Yae={DOMTokenList:!0,NodeList:!0},$ae=function(e){var t=e.forEach;return e===Lw||zae(Lw,e)&&t===Lw.forEach||qae(Yae,Wae(e))?Kae:t},Xae=a($ae),Jae=jo,oB=g_;st({target:"Object",stat:!0,forced:d(function(){oB(1)})},{keys:function(e){return oB(Jae(e))}});var Zae=a(mi.Object.keys),Qae=a(gL),ece=a(EL),tce=st,sB=Wp,nce=O_,rce=Er,aB=GC,ice=ac,oce=oc,sce=dI,ace=un,cce=lc,dce=tU("slice"),lce=ace("species"),kw=Array,uce=Math.max;tce({target:"Array",proto:!0,forced:!dce},{slice:function(e,t){var n,r,i,c=oce(this),l=ice(c),u=aB(e,l),h=aB(t===void 0?l:t,l);if(sB(c)&&(n=c.constructor,(nce(n)&&(n===kw||sB(n.prototype))||rce(n)&&(n=n[lce])===null)&&(n=void 0),n===kw||n===void 0))return cce(c,u,h);for(r=new(n===void 0?kw:n)(uce(h-u,0)),i=0;u<h;u++,i++)u in c&&sce(r,i,c[u]);return r.length=i,r}});var hce=xi("Array","slice"),pce=B,fce=hce,Mw=Array.prototype,mce=function(e){var t=e.slice;return e===Mw||pce(Mw,e)&&t===Mw.slice?fce:t},gce=a(mce);function oe(e,t,n,r,i){var c,l,u,h={};return Xae(c=Zae(r)).call(c,function(f){h[f]=r[f]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=Qae(l=ece(u=gce(n).call(n)).call(u)).call(l,function(f,m){return m(e,t,f)||f},h),i&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(i):void 0,h.initializer=void 0),h.initializer===void 0?(Jx(e,t,h),null):h}let av=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),xw=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),Gi=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e})({}),Rr=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),_e=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),Ge=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),pe=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e})({}),fe=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),Bd=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),Ie=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e})({}),Ir=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),Ne=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e})({});function cv(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw S.error("Invalid Channel Name ".concat(e)),new G(P.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function dv(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||n2(e,1,255)))throw new G(P.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&S.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Ms=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({}),_ce={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Uw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Fw(e,t){Un(e.url,"".concat(t,".url"),1,1e3,!1),qt(e.x)||yt(e.x,"".concat(t,".x"),0,1e4),qt(e.y)||yt(e.y,"".concat(t,".y"),0,1e4),qt(e.width)||yt(e.width,"".concat(t,".width"),0,1e4),qt(e.height)||yt(e.height,"".concat(t,".height"),0,1e4),qt(e.zOrder)||yt(e.zOrder,"".concat(t,".zOrder"),0,255),qt(e.alpha)||yt(e.alpha,"".concat(t,".alpha"),0,1,!1)}let Ece={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Sc=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),Vw=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),_n=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function cB(e){if(!e.channelName)throw new G(P.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new G(P.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Un(e.token,"info.token",1,2047),dv(e.uid),cv(e.channelName),!0}let xr=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),Ta=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),Yr=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),nh=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),dt=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),tn=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e})({}),lv=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),Rn=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),nt=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({}),dB=[nt.AFRICA,nt.ASIA,nt.CHINA,nt.EUROPE,nt.GLOBAL,nt.INDIA,nt.JAPAN,nt.NORTH_AMERICA,nt.OCEANIA,nt.OVERSEA,nt.SOUTH_AMERICA],$n=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({}),uv={CHINA:{},ASIA:{CODE:$n.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:$n.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:$n.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:$n.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:$n.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:$n.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:$n.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:$n.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:$n.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:$n.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:$n.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:$n.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:$n.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};tw&&(uv.CHINA={CODE:$n.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Jo=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e})({});function lB(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class uB extends jt{constructor(t,n){super(),w(this,"onICEConnectionStateChange",void 0),w(this,"onConnectionStateChange",void 0),w(this,"onDTLSTransportStateChange",void 0),w(this,"onDTLSTransportError",void 0),w(this,"onICETransportStateChange",void 0),w(this,"onFirstAudioReceived",void 0),w(this,"onFirstVideoReceived",void 0),w(this,"onFirstAudioDecoded",void 0),w(this,"onFirstVideoDecoded",void 0),w(this,"onFirstVideoRender",void 0),w(this,"onFirstVideoBufferReady",void 0),w(this,"onFirstVideoDecodedTimeout",void 0),w(this,"onSelectedLocalCandidateChanged",void 0),w(this,"onSelectedRemoteCandidateChanged",void 0),w(this,"onICECandidateError",void 0),w(this,"getLocalVideoStats",void 0)}}class hv extends uB{constructor(t,n){super(t,n),w(this,"establishPromise",void 0)}}let de=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),On=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),Ca=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({}),hB=["disconnected","failed"],Z=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),it=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),me=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e})({}),Co=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Ro=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Nn=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),Tc=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e})({}),En=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),xs=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),Wi=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Zo=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),rh=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),nn=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),ih=(function(e){return e.ABORT="abort",e})({}),Cc=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),vce=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({}),yce={[av.ACCESS_POINT]:{[Rr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Rr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Rr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Rr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Rr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Rr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Rr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[av.UNILBS]:{[Gi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Gi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Gi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Gi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Gi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Gi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Gi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Gi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Gi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Gi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Gi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Gi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[Gi.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[av.STRING_UID_ALLOCATOR]:{[xw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[xw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[xw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function oh(e){let t=yce[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===av.ACCESS_POINT){let r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}let Sce={[_e.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[_e.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[_e.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[_e.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[_e.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[_e.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[_e.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[_e.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[_e.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[_e.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[_e.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[_e.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[_e.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[_e.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[_e.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[_e.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[_e.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[_e.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[_e.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[_e.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[_e.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[_e.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[_e.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[_e.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[_e.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[_e.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[_e.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[_e.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[_e.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[_e.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[_e.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[_e.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[_e.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[_e.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[_e.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[_e.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[_e.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[_e.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[_e.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[_e.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[_e.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[_e.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[_e.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[_e.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[_e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[_e.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[_e.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[_e.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[_e.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[_e.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[_e.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[_e.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[_e.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[_e.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[_e.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[_e.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[_e.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[_e.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[_e.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[_e.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[_e.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[_e.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[_e.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[_e.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[_e.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Hd(e){return Sce[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function pB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function jw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pB(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Bw(e,t){if(typeof e=="string")return e;let{proxy:n,host:r,port:i}=e;if(t){let c=D("JOIN_GATEWAY_FALLBACK_PORT")||443;return c===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(c,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}let Tce=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Cce=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Rce=/wss:\/\/(.+):([0-9]+)\/?/,Ice=/wss:\/\/(.[^\/]+)\/?/,bce=0;class wce{constructor(t,n){w(this,"id",0),w(this,"store",void 0),w(this,"recordIndex",void 0),w(this,"websockets",[]),w(this,"try443PortDuration",2e3),w(this,"forceCloseWSDuration",5e3),w(this,"try443PortTimeout",null),w(this,"forceCloseTimeout",null),w(this,"isTry443PortFailed",!1),w(this,"isNormalPortFailed",!1),w(this,"useDoubleDomain",!1),w(this,"useProxy",!1),w(this,"startTime",Date.now()),this.id=++bce,this.try443PortDuration=D("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];S.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});let i=D("GATEWAY_DOMAINS"),c=Date.now(),l=[],u=i.find(_=>{var y;return J(y=t.host).call(y,_)});u||(this.useDoubleDomain=!1);let h=[];if(this.useDoubleDomain)i.forEach(_=>{h.push(Bw(jw(jw({},t),{},{host:t.host.replace(u,_)}),n))});else{let _=jw({},t);if(n&&u){let y=i.find(A=>A!==u);y&&(_.host=_.host.replace(u,y))}h.push(Bw(_,n))}try{h.forEach(_=>{let y=new WebSocket(_);y.binaryType="arraybuffer",l.push(y),this.logger("ws is connecting:",y.url)})}catch(_){if(this.logger("ws create failed"),l.forEach(y=>y.close()),l.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new G(P.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}let f=Sf();this.store&&this.store.recordJoinChannelService({urls:l.map(_=>_.url),service:"gateway"},this.recordIndex),l.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-c,"ms")),this.websockets.forEach(y=>{y!==_&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,f.resolve(_)},_.onclose=y=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-c,"ms state: ").concat(_.readyState));let A=l.every(C=>C.readyState===WebSocket.CLOSED||C.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(A)),A&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),f.reject({code:y.code,reason:lv.A_ROUND_WS_FAILED})):!n&&A&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),n?this.isTry443PortFailed=A:this.isNormalPortFailed=A},_.onmessage=y=>this.logger("".concat(_.url," onmessage: ").concat(y.data))}),this.websockets.push(...l);let m=()=>{this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())},E=()=>{if(f.isResolved)return m();Je().os===Sn.MAC_OS&&Nt()&&m(),this.createWebSocket(t,!0,!0).then(_=>{f.resolve(_)}).catch(_=>{this.isNormalPortFailed&&f.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.forceCloseTimeout=null,m()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,m()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",f.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=(function(c){let l,u,h;return[,l,u,h]=c.match(Tce)||[],l||([,u,h]=c.match(Cce)||[]),u&&h||([,u,h]=c.match(Rce)||[]),u&&h||([,u]=c.match(Ice)||[]),u||S.warning("un-destructible url: ",c),{proxy:l,host:u,port:h||"443"}})(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(S.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function fB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class mB extends jt{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;J(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ne.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ne.CONNECTED):this._state==="closed"?this.emit(Ne.CLOSED):this._state==="failed"&&this.emit(Ne.FAILED))}resetReconnectCount(t){S.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],c=arguments.length>4&&arguments[4]!==void 0&&arguments[4],l=arguments.length>5?arguments[5]:void 0;super(),w(this,"_websocketUrl",null),w(this,"connectionID",0),w(this,"currentURLIndex",0),w(this,"urls",[]),w(this,"_reconnectMode","tryNext"),w(this,"reconnectReason",void 0),w(this,"_initMutex",void 0),w(this,"name",void 0),w(this,"_state","closed"),w(this,"reconnectInterrupter",void 0),w(this,"websocket",void 0),w(this,"retryConfig",void 0),w(this,"reconnectCount",0),w(this,"forceCloseTimeout",5e3),w(this,"onlineReconnectListener",void 0),w(this,"useCompress",void 0),w(this,"tryDoubleDomain",!1),w(this,"use443PortOnly",!1),w(this,"wsInflateLength",0),w(this,"wsDeflateLength",0),w(this,"closeEstablishingWs",()=>{}),w(this,"store",void 0),w(this,"joinGatewayRecordIndex",void 0),this.store=l,this.name=t,this.retryConfig=(function(E){for(var _=1;_<arguments.length;_++){var y=arguments[_]!=null?arguments[_]:{};_%2?fB(Object(y),!0).forEach(function(A){w(E,A,y[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(y)):fB(Object(y)).forEach(function(A){Object.defineProperty(E,A,Object.getOwnPropertyDescriptor(y,A))})}return E})({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=c,this._initMutex=new Dn("websocket",l?l.clientId:void 0);let{timeout:u,timeoutFactor:h}=n,f=Math.max(300,Math.floor(3*u/5)),m=Math.max(1.2,Math.floor(8*h)/10);Sr.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m),zt.on(bd.NETWORK_STATE_CHANGE,(E,_)=>{E!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(E)),E===Sr.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}init(n){return O(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=yield this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{var c;let l=Sf(),u=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),(function(h){return!(qE()||D("USE_NEW_TOKEN")||!D("ENABLE_PREALLOC_PC")&&(h==null||!h.autoSubscribe||D("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(En.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(l.resolve).catch(l.reject),this.once(Ne.CLOSED,()=>{l.reject(new z(P.WS_DISCONNECT))}),this.once(Ne.CONNECTED,l.resolve),yield l.promise}catch{}finally{i()}})}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);let r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new z(P.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new z(P.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(t){return O(this,null,function*(){var n;let r=Sf();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let i=m=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),S.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},c=m=>O(this,null,function*(){var E;if(S.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new z(P.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");let _=li(this,Ne.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,y=yield this.reconnectWithAction(_);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return r.reject(new z(P.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);r.resolve()}}),l=m=>{this.emit(Ne.ON_MESSAGE,m)},u=m=>{S.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),D("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=D("GATEWAY_WSS_ADDRESS")),S.debug("[".concat(this.name,"] start connect, url:"),t);let h=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;this._websocketUrl=Bw(t);let m=yield this.chooseBestWebsocketConnection(t);this.websocket=m,i&&i(this.websocket.url),this.websocket.onclose=c,this.websocket.onmessage=l,this.websocket.onerror=u,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(m){let E=this.state==="closed",_=m instanceof z,y=_&&m.code===P.WS_ABORT,A=_&&m.code===P.WS_ERR,C=_?m.message:m&&(m.reason||m.toString());S.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(C)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[m]},h),E||A?(r.reject(E?new z(P.WS_DISCONNECT,"websocket is closed: ".concat(C)):new z(P.WS_ERR,"init websocket failed: ".concat(C))),A&&S.error("[".concat(this.name,"] init websocket failed: ").concat(C))):c&&c(m)}return r.promise})}reconnectWithAction(n){return O(this,arguments,function*(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;S.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||zt.isOnline||!zt.onlineWaiter||(this.onlineReconnectListener=zt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,r){let u=UE(this.reconnectCount,this.retryConfig);S.debug("[".concat(this.name,"] wait ").concat(u,"ms to reconnect websocket, mode: ").concat(t)),yield ie.race([Tn(u),this.onlineReconnectListener||new ie(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;let c=(u,h)=>O(this,null,function*(){this.emit(Ne.RECONNECT_CREATE_CONNECTION,h),yield this.createWebSocketConnection(u)});try{if(t==="retry")yield c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);S.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),yield c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(S.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=yield hn(this,Ne.REQUEST_NEW_URLS),this.currentURLIndex=0,yield c(this.urls[this.currentURLIndex],t))}catch(u){var l;S.error("[".concat(this.name,"] reconnect failed ").concat(u&&u.toString()));let h=u==null||(l=u.data)===null||l===void 0?void 0:l.desc;if(Array.isArray(h)){if(J(h).call(h,"dynamic key expired"))return this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(J(h).call(h,"request downgrade fallback"))return this.emit(Ne.ON_FALLBACK),!1}return this.reconnectWithAction(t,r)}return!0})}}class Hw extends mB{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(t,n){return O(this,null,function*(){let r=Sf(),i=(function(l,u){return new wce(l,u)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new z(P.WS_ABORT,"choose best websocket aborted"))};let c=D("GATEWAY_DOMAINS");return S.debug("[choose-best-ws] currentDomain: ",t,", domains: ",c,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})})}}class kf extends mB{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(t,n){return O(this,null,function*(){return new ie((r,i)=>{let c=!1,l=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),l.forEach(A=>{A.onclose=null,A.onopen=null,A.onmessage=null,A.close()}),i(new z(P.WS_ABORT,"choose best websocket aborted"))};let u=D("GATEWAY_DOMAINS"),h,f=t.indexOf("?h="),m=u.find(A=>f!==-1?J(t).call(t,A,f):J(t).call(t,A));S.debug("[choose-best-ws] currentDomain: ",m,", domains: ",u);let E=!this.tryDoubleDomain||!m;if(!E&&m){var _;let A=Date.now();try{u.forEach(C=>{let I=f===-1?t.replace(m,C):t.substr(0,f)+t.substr(f).replace(m,C),N=new WebSocket(I);N.binaryType="arraybuffer",l.push(N),S.debug("[choose-best-ws] ws is connecting:",N.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(I=>I.close());l.length;)l.pop();E=!0}(_=this.store)===null||_===void 0||_.recordJoinChannelService({urls:l.map(C=>C.url),service:"gateway"},n),l.forEach(C=>{C.onopen=()=>{if(c)return;let I=Date.now()-A;S.debug("[choose-best-ws] ws open cost ".concat(I,"ms")),l.filter(N=>N!==C).forEach(N=>{S.debug("[choose-best-ws]close backup websocket: ".concat(N.url)),N.close()}),c=!0,r(C)},C.onclose=I=>{h=I,!c&&(l.find(N=>!(N.readyState===WebSocket.CLOSED||N.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),c=!0,i(h)))},C.onmessage=I=>{S.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(I.data))}}),Tn(this.forceCloseTimeout).then(()=>{l.forEach(C=>{C.readyState!==WebSocket.OPEN&&C.close()})})}if(E){var y;let A;S.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},n);try{A=new WebSocket(t),l.push(A),A.binaryType="arraybuffer"}catch(C){let I=new z(P.WS_ERR,"init websocket failed! Error: ".concat(C.toString()));return S.error("[".concat(this.name,"]").concat(I)),void i(I)}A.onopen=()=>{r(A)},A.onclose=C=>{i(C)},A.onmessage=C=>{S.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(C.data))},Tn(this.forceCloseTimeout).then(()=>{A&&A.readyState!==WebSocket.OPEN&&A.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})})}}class gB extends jt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ge.CONNECTED?this.emit(pe.WS_CONNECTED):t===Ge.RECONNECTING?this.emit(pe.WS_RECONNECTING,this._websocketReconnectReason):t===Ge.CLOSED&&this.emit(pe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"__name__","AgoraRTCSignal"),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ge.CLOSED),w(this,"reconnectToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new Yb(5)),w(this,"pingpongTimer",void 0),w(this,"wsInflateDataTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"ortc",void 0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(pe.ON_BINARY_DATA,r.data);let i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let c="res-@".concat(i._id);this.emit(c,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Ie.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ie.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(He.UID_BANNED);break;case 15:this.close(He.IP_BANNED);break;case 16:this.close(He.CHANNEL_BANNED)}if(i._type===Ie.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case _e.ERR_LICENSE_MISSING:this.close(He.LICENSE_MISSING);break;case _e.ERR_LICENSE_EXPIRED:this.close(He.LICENSE_EXPIRED);break;case _e.ERR_LICENSE_MINUTES_EXCEEDED:this.close(He.LICENSE_MINUTES_EXCEEDED);break;case _e.ERR_LICENSE_PERIOD_INVALID:this.close(He.LICENSE_PERIOD_INVALID);break;case _e.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(He.LICENSE_MULTIPLE_SDK_SERVICE);break;case _e.ERR_LICENSE_ILLEGAL:this.close(He.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Hw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,D("JOIN_GATEWAY_USE_DUAL_DOMAIN"),D("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ge.CONNECTED&&this.reconnect("retry",Gn.OFFLINE)})}request(t,n,r,i){return O(this,null,function*(){let c=at(6,""),l={_id:c,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new ie((A,C)=>{if(this.connectionState===Ge.CONNECTED)return A();let I=()=>{this.off(pe.WS_CLOSED,N),A()},N=()=>{this.off(pe.WS_CONNECTED,I),C(new G(P.WS_ABORT))};this.once(pe.WS_CONNECTED,I),this.once(pe.WS_CLOSED,N),t!==fe.PUBLISH&&t!==fe.PUBLISH_DATASTREAM&&t!==fe.SUBSCRIBE&&t!==fe.SUBSCRIBE_DATASTREAM&&t!==fe.UNSUBSCRIBE&&t!==fe.UNSUBSCRIBE_DATASTREAM&&t!==fe.UNPUBLISH&&t!==fe.UNPUBLISH_DATASTREAM&&t!==fe.CONTROL&&t!==fe.RESTART_ICE||this.once(pe.DISCONNECT_P2P,()=>{C(new G(P.DISCONNECT_P2P))}),t!==fe.PUBLISH&&t!==fe.RESTART_ICE||this.once(pe.ABORT_P2P_EXECUTION,()=>{C(new G(P.DISCONNECT_P2P))})});if(this.connectionState!==Ge.CONNECTING&&this.connectionState!==Ge.RECONNECTING||t===fe.JOIN||t===fe.REJOIN||(yield h()),this.websocket.sendMessage(l,!0),i)return;let f=new ie((A,C)=>{let I=!1,N=(M,V)=>{I=!0,A({isSuccess:M==="success",message:V||{}}),this.off(pe.WS_CLOSED,L),this.off(pe.WS_RECONNECTING,L),this.emit(pe.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),N);let L=()=>{C(new G(P.WS_ABORT,"type: ".concat(t))),this.off(pe.WS_CLOSED,L),this.off(pe.WS_RECONNECTING,L),this.off("res-@".concat(c),N)};this.once(pe.WS_CLOSED,L),this.once(pe.WS_RECONNECTING,L),Tn(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||I||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(pe.REQUEST_TIMEOUT,t,n))})}),m=null;try{m=yield f}catch(A){if(this.connectionState===Ge.CLOSED||t===fe.LEAVE)throw new G(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?A.throw():t===fe.JOIN||t===fe.REJOIN?null:(yield h(),yield this.request(t,n))}if(m.isSuccess)return m.message;let E=Number(m.message.error_code||m.message.code),_=Hd(E),y=new G(P.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:_.desc});return _.action==="success"?m.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(_.desc,", action: ").concat(_.action)),E===_e.ERR_TOO_MANY_BROADCASTERS?((t===fe.JOIN||t===fe.REJOIN)&&(this.initError=y,this.close()),y.throw()):_.action==="failed"?y.throw():_.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===_e.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Gn.MULTI_IP)):this.reconnect(_.action,Gn.SERVER_ERROR),t===fe.JOIN||t===fe.REJOIN?null:yield this.request(t,n)))})}waitMessage(t,n){return new ie(r=>{let i=c=>{(!n||n(c))&&(this.off(t,i),r(c))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Bd.WRTC_STATS,n)}upload(t,n){let r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{let c=D("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ge.CONNECTED)return;let l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},D("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){let r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((n,r)=>{this.once(pe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(pe.WS_CLOSED,i=>r(this.initError||new G(P.WS_ABORT,i))),this.connectionState=Ge.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||He.LEAVE,this.connectionState=Ge.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}join(){return O(this,null,function*(){if(!this.joinResponse){this.emit(pe.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=yield hn(this,pe.REQUEST_JOIN_INFO);this.store.joinReq();let n=yield this.request(fe.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!n)return this.emit(pe.REPORT_JOIN_GATEWAY,lv.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(pe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0})}rejoin(){return O(this,null,function*(){if(!this.reconnectToken)throw new G(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=wd(this,pe.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let n=yield this.request(fe.REJOIN,t);return!!n&&(this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Ie.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ie.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ie.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ie.MUTE_AUDIO,{uid:r.uid}):this.emit(Ie.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ie.MUTE_VIDEO,{uid:r.uid}):this.emit(Ie.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ie.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ie.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ie.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ie.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ie.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)})}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}downgradeCodec(t){return O(this,null,function*(){if(!this.ortc)return!1;let n={downgrade_codec:t,ortc:this.ortc};return!!(yield this.request(fe.DOWNGRADE_CODEC,n))})}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);let n=Hd(t.code);if(t.code===28&&"detail"in t&&(S.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(pe.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===_e.ERR_REPEAT_JOIN_CHANNEL&&D("IGNORE_UID_CHECK")?void this.close(He.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(He.UID_BANNED),void this.close()):t.code===_e.K_VOS_FALLBACK&&"detail"in t?(S.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&D("ENABLE_QUALITY_FALLBACK")?void hn(this,pe.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",n.desc)}).catch(r=>{S.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),r)}):t.detail==="fallback_hls"&&D("ENABLE_FALLBACK_TO_HLS")?(this.emit(pe.VOS_FALLBACK,t.detail),void this.close(He.FALLBACK_TO_HLS)):this.reconnect(n.action,n.desc)):void this.reconnect(n.action,Gn.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=D("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>D("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Gn.TIMEOUT):this.request(fe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-n;this.rttRolling.add(r),D("REPORT_STATS")&&this.send(fe.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Bd.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ne.RECONNECT_CREATE_CONNECTION,t=>{this.emit(pe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ne.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ne.CLOSED,()=>{this.connectionState=Ge.CLOSED}),this.websocket.on(Ne.FAILED,()=>{this._disconnectedReason=He.NETWORK_ERROR,this.connectionState=Ge.CLOSED}),this.websocket.on(Ne.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ge.CONNECTED?this.connectionState=Ge.RECONNECTING:this.connectionState=Ge.CONNECTING}),this.websocket.on(Ne.WILL_RECONNECT,(t,n,r)=>{let i=wd(this,pe.IS_P2P_DISCONNECTED),c=i||t!=="retry";i&&t==="retry"&&(S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=lv.P2P_DISCONNECTED),c&&(S.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(pe.REPORT_JOIN_GATEWAY,n||lv.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(pe.DISCONNECT_P2P)),r(t)}),this.websocket.on(Ne.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Gn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(pe.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof G){if(t.code===P.UNEXPECTED_RESPONSE&&t.data.code===_e.ERR_NO_AUTHORIZED)return this.initError=new G(P.TOKEN_EXPIRE,"dynamic key expired"),void this.close(He.TOKEN_EXPIRE);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Gn.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Ne.REQUEST_NEW_URLS,(t,n)=>{hn(this,pe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ie.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(En.PRE_CONNECT_PC,()=>{this.emit(pe.PRE_CONNECT_PC)}),this.websocket.on(Ne.ON_FALLBACK,()=>{D("ENABLE_FALLBACK_TO_HLS")&&this.emit(pe.VOS_FALLBACK,"fallback_hls")})}}let Ace=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),dn=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function _B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function pv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_B(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_B(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Gw=0;function Io(e){let t=D("TURN_DOMAINS");Gw=(Gw+1)%t.length;let n=t[Gw]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(n):(S.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function fv(e){try{let t=D("TURN_DOMAINS"),n=D("GATEWAY_DOMAINS").concat(t).find(r=>J(e).call(e,r));return n?e.split(".".concat(n))[0].replace(/-/g,"."):e}catch{return S.debug("serverUrlToIp error, fallback to url",e),e}}function Ww(e,t){e.addresses||(e.addresses=[]);let n=(function(u,h){if(D("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return u.map(E=>{let{ip:_,port:y}=E;return{address:"".concat(_,":").concat(y)}});let f=D("GATEWAY_DOMAINS"),m=f[1]&&J(h).call(h,f[1])?1:0;return u.map(E=>{let{domain_prefix:_,port:y,ip:A}=E;if(_)return{address:"".concat(_,".").concat(f[m++%f.length],":").concat(y)};let C=/^[\.\:\d]+$/.test(A),I=C?"".concat(A.replace(/[^\d]/g,"-"),".").concat(f[m++%f.length],":").concat(y):"".concat(A,":").concat(y);return C||S.debug("Cannot recognized as ip address: ".concat(A,", use as host3")),{ip:A,port:y,address:I}})})(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){let u=r.split(";");for(let h=0;h<u.length;h++){var i;let f=vr(i=u[h]).call(i);n[h]&&f&&(n[h].ip6=f)}}let c=e.detail&&e.detail.candidate,l;if(c){let[u,h]=c.split(":");u&&h&&(l={port:Number(h),ip:u,address:"".concat(u,":").concat(h)})}return{gatewayAddrs:n,apGatewayAddress:l,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ur(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function EB(e){let t=e._encoderConfig;if(!t)return{};let n={resolution:t.width&&t.height?"".concat(Ur(t.width),"x").concat(Ur(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function mv(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Mf(e,t){let n,r,i;switch(t){case dn.CHOOSE_SERVER:r=4096,i="choose server";break;case dn.CLOUD_PROXY:r=1048576,i="proxy";break;case dn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case dn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new G(P.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(c=>{c.buffer&&c.buffer.flag===r&&(n={code:c.buffer.code,addresses:(c.buffer.edges_services||[]).map(l=>pv(pv({},l),{},{ticket:c.buffer.cert})),server_ts:e.enter_ts,uid:c.buffer.uid,cid:c.buffer.cid,cname:c.buffer.cname,detail:pv(pv({},c.buffer.detail),e.detail),flag:c.buffer.flag,opid:e.opid,cert:c.buffer.cert})}),!n)throw new G(P.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}function vB(e,t){return O(this,null,function*(){return yield ie.all(e.addresses.map(n=>O(null,null,function*(){return{address:Io(n.ip),tcpport:n.port,udpport:n.port,username:t&&D("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Wn.username,password:t&&D("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield Bb(t.toString()):Wn.password}})))})}function qw(e,t){let n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Ur(e.height),Ur(e.width)),1):(S.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Rc(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:c,protocol:l}=e,u={candidateType:t,relayProtocol:n,protocol:l};if(r!=="local-candidate"){let h=i.split(".");h.length>=4&&(h[1]="*",h[2]="*"),u.address=h.join("."),u.port=c}return u}function Us(e){let t=e.split(":"),n=e.split(/[-.]/),r=J(e).call(e,"-")?"-":".",i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function yB(e,t){return e.getTransceivers().find(n=>n.sender.track===t||n.receiver.track===t)}function xf(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D("SVC_MODE");if(D("ENABLE_SVC"))return(function(t){return t in jE})(e)?e:jE.L1T3}let SB={[de.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[de.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function TB(e){e.send&&(sh(de.VIDEO,e.send.videoExtensions),sh(de.AUDIO,e.send.audioExtensions)),e.recv&&(sh(de.VIDEO,e.recv.videoExtensions),sh(de.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(sh(de.VIDEO,e.sendrecv.videoExtensions),sh(de.AUDIO,e.sendrecv.audioExtensions))}function CB(e,t){e.send&&(gv(de.VIDEO,e.send.videoExtensions,t.send.videoExtensions),gv(de.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(gv(de.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),gv(de.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function gv(e,t,n){t.forEach(r=>{var i;let c=SB[e].find(u=>{var h;let{key:f}=u;return J(h=r.extensionName).call(h,f)});if(!c)return;let l=n.find(u=>{let{extensionName:h}=u;return J(h).call(h,c.key)});l&&J(i=l.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=l.extensionName)})}function sh(e,t){t.forEach(n=>{var r;let i=SB[e].find(c=>{var l;let{key:u}=c;return J(l=n.extensionName).call(l,u)});J(r=n.extensionName).call(r,"gdpr_forbidden")&&i&&(n.extensionName=i.extensionName)})}function RB(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||J(e).call(e,"abs-send-time")}function _v(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||J(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function IB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function bB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?IB(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Uf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,{filterRTX:i,filterVideoFec:c,filterAudioFec:l,filterAudioCodec:u,filterVideoCodec:h,unsupportedVideoUplinkCodec:f,unsupportedVideoDownlinkCodec:m}=t,{useXR:E}=n,_=[],y=[],A=[],C=[],I=!1,N=!1;if(Tr(e).mediaDescriptions.forEach(M=>{r&&r!==M.attributes.direction||(M.media.mediaType!=="video"||I||(y=M.attributes.payloads,C=M.attributes.extmaps,I=!0),M.media.mediaType!=="audio"||N||(_=M.attributes.payloads,A=M.attributes.extmaps,N=!0))}),!C||y.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!A||_.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(M=>{var V;(V=M.rtpMap)!==null&&V!==void 0&&V.clockRate&&(M.rtpMap.clockRate=parseInt(M.rtpMap.clockRate)),E&&M.rtcpFeedbacks.push({type:"rrtr"})}),_.forEach(M=>{var V;(V=M.rtpMap)!==null&&V!==void 0&&V.clockRate&&(M.rtpMap.clockRate=parseInt(M.rtpMap.clockRate)),E&&M.rtcpFeedbacks.push({type:"rrtr"})}),i&&(_=_.filter(M=>{var V;return((V=M.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())!=="rtx"}),y=y.filter(M=>{var V;return((V=M.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())!=="rtx"})),c){let M=y.filter(U=>{var H;return/(red)|(ulpfec)|(flexfec)/i.test(((H=U.rtpMap)===null||H===void 0?void 0:H.encodingName)||"")}),V=Ic(M,y).map(U=>U.payloadType),j=[...M.map(U=>U.payloadType),...V];y=y.filter(U=>!J(j).call(j,U.payloadType))}if(l&&(_=_.filter(M=>{var V;return!/(red)|(ulpfec)|(flexfec)/i.test(((V=M.rtpMap)===null||V===void 0?void 0:V.encodingName)||"")})),u&&u?.length>0&&(_=_.filter(M=>{var V;return J(u).call(u,((V=M.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"")})),h&&h?.length>0){let M=y.filter(V=>{var j;return J(h).call(h,((j=V.rtpMap)===null||j===void 0?void 0:j.encodingName.toLowerCase())||"")});y=M.concat(i?[]:Ic(M,y))}let L=D("UNSUPPORTED_VIDEO_CODEC");if(L&&L.length>0){let M=y.filter(U=>U.rtpMap&&J(L).call(L,U.rtpMap.encodingName.toLowerCase())),V=Ic(M,y),j=M.concat(V).map(U=>U.payloadType);y=y.filter(U=>!J(j).call(j,U.payloadType)),S.debug("unsupportedVideoCodec: ".concat(L,", toBeRemoved: ").concat(j))}if(f&&f.length>0&&r==="sendonly"){let M=y.filter(U=>U.rtpMap&&J(f).call(f,U.rtpMap.encodingName.toLowerCase())),V=Ic(M,y),j=M.concat(V).map(U=>U.payloadType);y=y.filter(U=>!J(j).call(j,U.payloadType)),S.debug("unsupportedVideoUplinkCodec: ".concat(f,", toBeRemoved: ").concat(j))}if(m&&m.length>0&&r==="recvonly"){let M=y.filter(U=>U.rtpMap&&J(m).call(m,U.rtpMap.encodingName.toLowerCase())),V=Ic(M,y),j=M.concat(V).map(U=>U.payloadType);y=y.filter(U=>!J(j).call(j,U.payloadType)),S.debug("unsupportedVideoDownlinkCodec: ".concat(m,", toBeRemoved: ").concat(j))}return{audioCodecs:_,videoCodecs:y,audioExtensions:A,videoExtensions:C}}function Fs(e){let t=Tr(e),n,r;for(let i of t.mediaDescriptions){if(!n){let c=i.attributes.iceUfrag,l=i.attributes.icePwd;if(!c||!l)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:c,icePwd:l}}if(!r){let c=i.attributes.fingerprints;c.length>0&&(r={fingerprints:c})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function zw(e,t){let n=[],r=e.attributes.ssrcGroups.filter(l=>l.semantic==="FID"),i=e.attributes.ssrcGroups.find(l=>l.semantic==="SIM"),c=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(l=>{var u;let h=(u=r.find(f=>f.ssrcIds[0]===l))===null||u===void 0?void 0:u.ssrcIds[1];n.push({ssrcId:l,rtx:t?h:void 0})});else if(r.length>0){let l=r[0].ssrcIds[0],u=r[0].ssrcIds[1];n.push({ssrcId:l,rtx:t?u:void 0})}else{if(c.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:c[0].ssrcId})}return n}function wB(e,t,n){let{cname:r}=e,i=[];t&&(i=AB(t)),i.length===0&&(i=e.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),S.debug("Using candidates from gateway."));let c={fingerprints:e.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},l={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},u;switch(e.dtlsParameters.role){case"server":u="passive";break;case"client":u="active";break;case"auto":u="actpass"}let h=Vf(e.rtpCapabilities),f=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{f.push({kind:de.VIDEO,ssrcMsg:[{ssrcId:m.v,rtx:m.v_rtx}],mslabel:"".concat(m.v,"_").concat(m.a)},{kind:de.AUDIO,ssrcMsg:[{ssrcId:m.a}],mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:c,iceParameters:l,candidates:i,rtpCapabilities:h,setup:u,cname:r,preSSRCs:f}}function AB(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(Us(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(Us(e.ip6),":").concat(e.port)))),t}function Ff(e,t,n){let r=[],i=[];return e.forEach(c=>{let{ssrcId:l,rtx:u}=c,h=at(8,"track-"),f={ssrcId:l,attributes:bB({label:h,mslabel:n=n||at(10,""),msid:"".concat(n," ").concat(h)},t&&{cname:t})};if(r.push(f),u!==void 0){let m={ssrcId:u,attributes:bB({label:h,mslabel:n,msid:"".concat(n," ").concat(h)},t&&{cname:t})};r.push(m),i.push({semantic:"FID",ssrcIds:[l,u]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(c=>{let{ssrcId:l}=c;return l})}),{ssrcs:r,ssrcGroups:i}}function Gd(e,t){t instanceof $t&&e.attributes.payloads.forEach(n=>{var r;let i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),i==="opus"&&typeof D("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=D("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";let c=t._encoderConfig;c&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(c.bitrate&&!Nt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*c.bitrate))),c.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(c.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(c.sampleRate)),c.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Pf&&i==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function Kw(e){let t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function Yw(e,t){var n;if(e.attributes.payloads.forEach(i=>{var c;((c=i.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())==="h264"&&i.fmtp&&i.fmtp.parameters&&D("ENABLE_UP_SPS_PPS")&&(i.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof Tt&&t._encoderConfig&&t._hints.indexOf(ot.SCREEN_TRACK)===-1))return;let r=t._encoderConfig;Ve().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var c,l;J(c=["h264","h265","vp8","vp9","av1"]).call(c,((l=i.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ve().supportMinBitrate&&!J(n=t._hints).call(n,ot.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var c,l;J(c=["h264","h265","vp8","vp9","av1"]).call(c,((l=i.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(D("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function DB(e){if(e.media.mediaType!=="video")return;let t=Je();if(t.name!==Qe.SAFARI&&t.os!==Sn.IOS)return;let n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Ev(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){let c=r.find(l=>_v(l.extensionName));if(c){let l=c.extensionName;e.attributes.extmaps.find(h=>_v(h.extensionName))||e.attributes.extmaps.push({entry:c.entry,extensionName:l}),(function(h,f){return f.filter(m=>!!h.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(_=>_.type==="transport-cc")))})(i,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>f.type==="transport-cc")||h.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let c=e.attributes.extmaps.findIndex(l=>_v(l.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(l=>{let u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){let c=r.find(l=>RB(l.extensionName));if(c){let l=c.extensionName;e.attributes.extmaps.find(h=>h.extensionName===l)||e.attributes.extmaps.push({entry:c.entry,extensionName:l}),(function(h,f){return f.filter(m=>!!h.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(_=>_.type==="goog-remb")))})(i,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>f.type==="goog-remb")||h.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let c=e.attributes.extmaps.findIndex(l=>RB(l.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(l=>{let u=l.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}}function $w(e,t,n){if(Nt()||e.media.mediaType!=="video"||!(t instanceof Tt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!D("SIMULCAST")||n==="vp9"&&D("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],c=e.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===i.ssrcId),l={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let u=1;u<r;u++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+u,attributes:Pt(i.attributes)}),l.ssrcIds.push(i.ssrcId+u),c&&(e.attributes.ssrcs.push({ssrcId:c.ssrcIds[1]+u,attributes:Pt(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+u,c.ssrcIds[1]+u]}));e.attributes.ssrcGroups.unshift(l)}function OB(){return O(this,null,function*(){try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:jE.L1T3}]});let t=yield e.createOffer();if(!t.sdp)return void e.close();let n=Tr(t.sdp).mediaDescriptions[0];if(!n)return;let r=n.attributes.extmaps.find(i=>i.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),r}catch{return}})}function Xw(){return O(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});let r=(yield n.createOffer()).sdp,{send:i,recv:c,sendrecv:l}=(function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0,m=Uf(f,u,h,"sendonly"),E=Uf(f,u,h,"recvonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bo(m,E,"videoExtensions",_,y,A),bo(m,E,"videoCodecs",_,y,A),bo(m,E,"audioExtensions",_,y,A),bo(m,E,"audioCodecs",_,y,A),D("RAISE_H264_BASELINE_PRIORITY")){let C=[],I=[];if(A.videoCodecs.forEach((N,L)=>{var M;if(((M=N.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"){var V,j;let U=A.videoCodecs[L+1],H=U&&kB(N,U),K=(V=N.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"],Y=(j=N.fmtp)===null||j===void 0?void 0:j.parameters["packetization-mode"];!K||K!==D("FIRST_H264_PROFILE_LEVEL_ID")||D("FIRST_PACKETIZATION_MODE")&&Y!==D("FIRST_PACKETIZATION_MODE")?H?I.push([N,U]):I.push([N]):H?C.push([N,U]):C.push([N])}}),C.length>0&&I.length>0){S.debug("raising H264 baseline profile priority"),A.videoCodecs.forEach((L,M)=>{var V;if(((V=L.rtpMap)===null||V===void 0?void 0:V.encodingName.toLocaleLowerCase())==="h264"){let j=kB(L,A.videoCodecs[M+1]),U=C.shift()||I.shift()||[];U.length>0&&(j?A.videoCodecs.splice(M,2,...U):A.videoCodecs.splice(M,1,...U))}});let N=y.videoCodecs.filter(L=>{var M,V;return((M=L.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"&&((V=L.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==D("FIRST_H264_PROFILE_LEVEL_ID")});if(N.length>0){let L=Ic(N,y.videoCodecs).map(V=>V.payloadType),M=[...N.map(V=>V.payloadType),...L];y.videoCodecs=y.videoCodecs.filter(V=>!J(M).call(M,V.payloadType))}D("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(L=>{var M,V;return!(((M=L.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"&&((V=L.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==D("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:_,recv:y,sendrecv:A}}return{send:_,recv:y,sendrecv:A}})(e,t,r);try{n.close()}catch{}return{send:i,recv:c,sendrecv:l}})}function NB(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Uf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bo(e,t,"videoExtensions",n,r,i),bo(e,t,"videoCodecs",n,r,i),bo(e,t,"audioExtensions",n,r,i),bo(e,t,"audioCodecs",n,r,i),D("RAISE_H264_BASELINE_PRIORITY")){let c=i.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]==="42001f");if(c!==-1){let l=i.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(l<c){S.debug("raising H264 baseline profile priority");let u=i.videoCodecs[c];i.videoCodecs.splice(c,1),i.videoCodecs.splice(l,0,u)}l!==-1&&(r.videoCodecs=r.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function bo(e,t,n,r,i,c){if(n==="videoExtensions"||n==="audioExtensions"){let l=[];return e[n].forEach(u=>{t[n].some((h,f)=>{if(u.entry===h.entry&&u.extensionName===h.extensionName)return l.push(f),!0})?c[n].push(u):r[n].push(u)}),void t[n].forEach((u,h)=>{l.indexOf(h)===-1&&i[n].push(u)})}if(n==="videoCodecs"||n==="audioCodecs"){let l=[];return e[n].forEach(u=>{t[n].some((h,f)=>{if(u.payloadType===h.payloadType&&JSON.stringify(u)===JSON.stringify(h))return l.push(f),!0})?c[n].push(u):r[n].push(u)}),void t[n].forEach((u,h)=>{l.indexOf(h)===-1&&i[n].push(u)})}}function Vf(e){let{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,c;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=Pt(r),n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...r.audioCodecs],c.videoCodecs=[...n.videoCodecs,...r.videoCodecs],c.audioExtensions=[...n.audioExtensions,...r.audioExtensions],c.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):c=Pt(r),{send:i,recv:c}}function ah(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function jf(e,t,n,r){let i=[];if(e===de.VIDEO){if(D("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(c=>{var l;return J(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,r)&&c&&c.fmtp&&c.fmtp.parameters["profile-level-id"]===D("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let c=[],l=[],u=[],h=[];if(n.videoCodecs.forEach(f=>{let m=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";J(m).call(m,r)?c.push(f):J(m).call(m,"vp9")?l.push(f):J(m).call(m,"vp8")?u.push(f):J(m).call(m,"h264")&&h.push(f)}),c.length===0){let f="";l.length!==0?(c=l,f="vp9"):u.length!==0?(c=u,f="vp8"):h.length!==0&&(c=h,f="h264"),S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}c.length!==0&&(i=t.videoCodecs.filter(f=>c.some(m=>m.payloadType===f.payloadType)))}if(i.length===0&&(S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),D("USE_PUB_RTX")||D("USE_SUB_RTX")){let c=Ic(i,t.videoCodecs);i=[...i,...c]}}else{i=t.audioCodecs.filter(l=>{var u;return J(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,r)});let c=t.audioCodecs.filter(l=>{var u;return J(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"red")});i.length===0&&(S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(l=>{var u;return J(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"opus")})),D("ENABLE_AUDIO_RED")&&c.length!==0&&(i=[...c,...i])}return i}function Ic(e,t){let n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&J(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}function $r(e,t,n){return O(this,null,function*(){let r=t.toString(),i=PB(r,"offer","remote","exchangeSDP");yield e.setRemoteDescription({type:"offer",sdp:r});let c=yield e.createAnswer();if(!c.sdp)throw new Error("cannot get answer sdp");let l=c.sdp;l=Jw(l,n||{}),i?.(l||""),yield e.setLocalDescription({type:"answer",sdp:l})})}function Jw(e,t,n){let r=Tr(e),{useXR:i}=t;return r.mediaDescriptions.forEach(c=>{var l;c.attributes.mid&&(Array.isArray(n)&&!J(n).call(n,c.attributes.mid)||(c.media.mediaType==="audio"&&ah(c),c.media.mediaType==="video"&&(function(u){u.media.mediaType==="video"&&D("ENABLE_DOWN_SPS_PPS")&&u.attributes.payloads.filter(h=>{var f;return((f=h.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())==="h264"}).forEach(h=>{h.fmtp||(h.fmtp={parameters:{}}),h.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})})(c),i&&J(l=["audio","video"]).call(l,c.media.mediaType)&&c.attributes.payloads.forEach(u=>{u.rtcpFeedbacks.findIndex(h=>h.type==="rrtr")===-1&&u.rtcpFeedbacks.push({type:"rrtr"})})))}),Sa(r)}function PB(e,t,n,r){if(D("SDP_LOGGING"))return S.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{PB(i,"answer",n==="local"?"remote":"local",r)}:void 0}function LB(e,t,n){return O(this,null,function*(){try{var r;if(!Ve().supportSetRtpSenderParameters||!(function(h){return h==="vp9"||h==="av1"})(e)||!D("ENABLE_SVC"))return;let i={},c={},l=t.getParameters(),u=(r=l.encodings)===null||r===void 0?void 0:r[0];c.scalabilityMode=xf(n),u&&Object.assign(u,c),Object.assign(l,i),yield t.setParameters(l),S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(l.encodings)))}catch(i){S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",i)}})}function vv(e){let t=D("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>J(e).call(e,n))}function kB(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function MB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function hi(e,t){return typeof D(e)===t?D(e):void 0}function Dce(){try{let e=D("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?MB(Object(r),!0).forEach(function(i){w(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):MB(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t})({},e)}catch(e){return S.debug("handle gateway attributes failed: ",e),{}}}let xB={};function Vs(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&S.debug("install service ".concat(e.name)),xB[e.name]=e}function Qo(e){let t=xB[e];if(!t)throw new z(P.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function UB(e,t){return Qo("DataStream").create(e,t)}function yv(){return Qo("InterceptFrame").create()}function FB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Pn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FB(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Zw=new Map;class Oce extends jt{get state(){return this._state}set state(t){if(t===this._state)return;let n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(tn.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(tn.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){S.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,i,c;super(),w(this,"store",void 0),w(this,"joinInfo",void 0),w(this,"key",void 0),w(this,"ntpOffset",0),w(this,"usingProxy",!1),w(this,"signal",void 0),w(this,"role",void 0),w(this,"isPreallocation",void 0),w(this,"isPreSub",void 0),w(this,"inChannelInfo",{joinAt:null,duration:0}),w(this,"spec",void 0),w(this,"_state","DISCONNECTED"),w(this,"_statsCollector",void 0),w(this,"_disconnectedReason",void 0),w(this,"isSignalRecover",!1),w(this,"hasChangeBGPAddress",!1),w(this,"trafficStatsInterval",void 0),w(this,"networkQualityInterval",void 0),w(this,"_joinGatewayStartTime",0),w(this,"_signalTimeout",!1),w(this,"_clientRoleOptions",void 0),w(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:Pn(Pn({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(i=(c=Qo("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(c,r)):this.store.useDcSignal?(function(l){return Qo("DataChannelSignal").create(l)})({spec:Pn(Pn({},n),{},{retryConfig:n.websocketRetryConfig}),store:t}):new gB(Pn(Pn({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}join(t,n,r){return O(this,null,function*(){if(this.store.useDcSignal){let m=!1;t.cloudProxyServer!=="disabled"?(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),m=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),m=!0):t.apResponse.addresses.some(E=>E.fingerprint)||D("FINGERPRINT")||(S.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),m=!0),m&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let i=Date.now(),c=Zw.get(t.cname);if(c||(c=new Map,Zw.set(t.cname,c)),this._isProactiveJoin=!0,c.has(t.uid)){let m=new G(P.UID_CONFLICT);throw ue.joinGateway(t.sid,{lts:i,succ:!1,ec:m.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),m}c.set(t.uid,!0),this.joinInfo=t,this.key=n;let l=0;this.joinGatewayStartTime=i;let u=t.proxyServer,h=this.store.useDcSignal?"datachannel":"websocket";try{S.debug("[".concat(this.store.clientId,"] use ").concat(h," join uid ").concat(l));let m=t.gatewayAddrs.map(_=>{let{address:y}=_,[A,C]=y.split(":"),I={host:A,port:C};return t.proxyServer&&(I.proxy=t.proxyServer),I}),E;E=this.store.useDcSignal?yield this.signal.init(t.apResponse.addresses):yield this.signal.init(m),l=E.uid,S.debug("[".concat(this.store.clientId,"] ").concat(h," join uid ").concat(l," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(m){var f;throw m.code===P.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||ue.joinGateway(t.sid,{lts:i,succ:!1,ec:((f=m.data)===null||f===void 0?void 0:f.desc)||m.code,errorMsg:m.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!u||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),m&&m.code===P.INIT_DATACHANNEL_TIMEOUT?(S.warning("[".concat(this.store.clientId,"] User join datachannel failed"),m.toString()),this.resetSignal(),m):(S.error("[".concat(this.store.clientId,"] User join failed"),m.toString()),c.delete(t.uid),this.signal.close(),m)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(m=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(tn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(tn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(tn.NETWORK_QUALITY,{uplinkNetworkQuality:mv(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:mv(this._statsCollector.trafficStats.B_dnq)}):this.emit(tn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),l})}leave(){return O(this,arguments,function*(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==He.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Ge.CONNECTED||(yield(function(r,i){return i===1/0?r:ie.race([r,rae(i)])})(this.signal.request(fe.LEAVE,void 0,!0),3e3))}catch(r){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==He.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}})}publish(t,n,r){return O(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:D("PUB_EXTEND"),twcc:!!D("PUBLISH_TWCC"),rtx:!!D("USE_PUB_RTX")};try{return(yield this.signal.request(fe.PUBLISH,i,!0))._message}catch(c){if(r&&c.data&&c.data.code===_e.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),c.toString()),yield this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw c}})}publishDataChannel(t,n,r){return O(this,null,function*(){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let c={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{yield this.signal.request(fe.PUBLISH_DATASTREAM,c,!0)}catch(l){if(r&&l.data&&l.data.code===_e.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),l.toString()),yield this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw l}})}unpublish(t,n){return O(this,null,function*(){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));yield this.signal.request(fe.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){S.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}})}unpublishDataChannel(t){return O(this,null,function*(){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));yield ie.all(t.map(n=>this.signal.request(fe.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){S.warning("unpublish datachannels warning: ",n)}})}presubscribe(t,n,r){return O(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!D("SUBSCRIBE_TWCC"),rtx:!!D("USE_SUB_RTX")||void 0,extend:D("SUB_EXTEND"),svc:Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0};try{return yield this.signal.request(fe.PRE_SUBSCRIBE,i,!0)}catch(c){if(r&&c.data&&c.data.code===_e.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),c.toString()),this.presubscribe(t,n,!1);throw c}})}subscribe(t,n,r){return O(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!D("SUBSCRIBE_TWCC"),rtx:!!D("USE_SUB_RTX"),extend:D("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0};try{return(yield this.signal.request(fe.SUBSCRIBE,i,!0))._message}catch(c){if(r&&c.data&&c.data.code===_e.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),c.toString()),yield this.tryUnsubBeforeResub(t,n),yield this.subscribe(t,n,!1);throw c}})}subscribeDataChannel(t,n,r){return O(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void(yield this.signal.request(fe.SUBSCRIBE_DATASTREAM,i,!0))}catch(c){if(r&&c.data&&c.data.code===_e.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),c.toString()),yield this.tryUnsubDataChannelBeforeResub(t,n),yield this.subscribeDataChannel(t,n,!1);throw c}})}subscribeAll(t,n){return O(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!D("USE_SUB_RTX"),twcc:!!D("SUBSCRIBE_TWCC"),svc:Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0};try{return yield this.signal.request(fe.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===_e.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),yield this.tryMassUnsubBeforeResub(t),yield this.subscribeAll(t,!1);throw i}})}setVideoProfile(t){return O(this,null,function*(){let n=(function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,c=r.width,l=r.height,u=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(u=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,i||(u=!1)),u?{stream_type:0,width:c,height:l,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0})(t);if(n)return this.signal.request(fe.SET_VIDEO_PROFILE,n);S.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))})}unsubscribe(t,n){return O(this,null,function*(){try{yield this.signal.request(fe.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){S.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}})}unsubscribeDataChannel(t,n){return O(this,null,function*(){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));yield ie.all(t.map(r=>this.signal.request(fe.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){S.warning("unsubscribeDataChannel warning: ",r)}})}massUnsubscribe(t){return O(this,null,function*(){try{yield this.signal.request(fe.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){S.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}})}reconnectPC(t){return O(this,null,function*(){let{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:yield this.signal.request(fe.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}})}getGatewayInfo(){return this.signal.request(fe.GATEWAY_INFO)}renewToken(t){return O(this,null,function*(){yield this.signal.request(fe.RENEW_TOKEN,t),this.key=t.token})}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),D("CLIENT_ROLE_OPTIONS")&&(S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(D("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},D("CLIENT_ROLE_OPTIONS"))),this.role=t}setClientRole(t,n){return O(this,null,function*(){if(n&&(this._clientRoleOptions=Object.assign({},n)),D("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},D("CLIENT_ROLE_OPTIONS")),S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(D("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;let c=Object.assign({},n);delete c.delay,delete c.level,yield this.signal.request(fe.SET_CLIENT_ROLE,Pn(Pn({role:t,level:i,delay:r},c),{},{client_ts:Date.now()})),this.role=t})}setDualStreamMode(t,n,r){return O(this,null,function*(){yield this.signal.request(fe.SET_DUAL_STREAM_MODE,{mode:t},r,n)})}setRemoteVideoStreamType(t,n){return O(this,null,function*(){yield this.signal.request(fe.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})})}setDefaultRemoteVideoStreamType(t){return O(this,null,function*(){yield this.signal.request(fe.DEFAULT_VIDEO_STREAM,{stream_type:t})})}setStreamFallbackOption(t,n){return O(this,null,function*(){yield this.signal.request(fe.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})})}pickSVCLayer(t,n){return O(this,null,function*(){yield this.signal.request(fe.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})})}setRTM2Flag(t){return O(this,null,function*(){yield this.signal.request(fe.SET_RTM2_FLAG,{rtm2_flag:t})})}sendExtensionMessage(t,n,r){return O(this,null,function*(){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Pn({},this.inChannelInfo)}setConfigure(t){return O(this,null,function*(){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(fe.CONFIGURE,t)})}getGatewayVersion(){return O(this,null,function*(){return(yield this.signal.request(fe.GATEWAY_INFO)).version})}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=Zw.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=(function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Wn.username,password:Wn.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Pn(Pn({},Wn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){return O(this,null,function*(){if(this.state!=="CONNECTED")return;let t=yield this.signal.request(fe.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{let r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&xE(()=>{this.emit(tn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)})}getJoinMessage(t){var n,r,i,c;if(!this.joinInfo||!this.key)throw new G(P.UNEXPECTED_ERROR,"can not generate join message, no join info");let l=Object.assign({},this.joinInfo.apResponse),u=D("REPORT_APP_SCENARIO");if(typeof u!="string")try{u=JSON.stringify(u)}catch{u=void 0}var h;u&&u.length>128&&(u=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(tn.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,J(th).call(th,h)||th.push(h);let f=Of(this.store),m=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),E=F2(this.store),_=Dce(),y=Os(87)||WF()||Mb(117),A=((function(){let L=Je();if(L.name!==Qe.SAFARI||!L.browserVersion)return!1;let M=L.browserVersion.split(".");return Number(M[0])>18||Number(M[0])===18&&Number(M[1])>=4})()||YF(18,4,!1))&&xb(18,6,!0)&&this.spec.codec==="h264"&&D("ENABLE_ABSSENDTIME_AS_SENTTS"),C=!(((r=l.detail)===null||r===void 0?void 0:r[3])!=="CN"||!D("ENABLE_QUALITY_FALLBACK"))&&D("ENABLE_QUALITY_FALLBACK"),I=!!D("ENABLE_AP_MULTI_IP")&&((i=l.detail)===null||i===void 0?void 0:i[5])==="multi-ip",N=Pn({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Vi,browser:navigator.userAgent,process_id:D("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:I||this.hasChangeBGPAddress,ap_response:l,extend:D("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:u,attributes:{userAttributes:Pn(Pn({enableEncodedTransform:(!!D("ENABLE_AUDIO_METADATA")||!!D("ENABLE_AUDIO_PTS"))&&y||!!D("ENABLE_AUDIO_TOPN")&&kb(Qe.CHROME,87,116)||void 0,enableAudioMetadata:!!D("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!D("ENABLE_AUDIO_PTS")&&y,topnSmoothLevel:D("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:D("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:D("TOPN_SWITCH_HOLD_MS"),topnAudioGain:D("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:D("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:D("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:hi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:hi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:hi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:D("USE_PUB_RTX")===!0||D("USE_SUB_RTX")===!0||void 0,disableFEC:D("DISABLE_FEC"),enableNTPReport:!!D("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:E,enableFulllinkAvSync:!!D("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:hi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!D("FORCE_ENABLE_AUT_CC")||!qE()&&(!!D("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!D("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:hi("USE_XR","boolean"),enableLossbasedBwe:hi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!D("FORCE_ENABLE_AUT_CC")||!qE()&&(!!D("ENABLE_AUT_CC")||void 0),enableCCFallback:hi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:m,preSubNum:f?hi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:hi("PUBLISH_TWCC","boolean"),enableSubTWCC:hi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:hi("USE_PUB_RTX","boolean"),enableSubRTX:hi("USE_SUB_RTX","boolean"),enableSubSVC:D("ENABLE_SVC")?D("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(D("SVC"))&&D("SVC").length!==0?D("SVC"):void 0,enableSvcExtended:D("ENABLE_SVC")&&Array.isArray(D("SVC_EXTENDED"))&&D("SVC_EXTENDED").length!==0?D("SVC_EXTENDED"):void 0,enableVosFallback:D("ENABLE_VOS_FALLBACK"),enableQualityFallback:C},_),{},{audioDuplicate:hi("ENABLE_AUDIO_RED","boolean")?(c=hi("AUDIO_DUPLICATE_NUM","number"))!==null&&c!==void 0?c:2:void 0,senttsUsesAbsSendTime:!!A||void 0,enableDualStreamFlag:hi("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(N.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(N.aes_mode=this.joinInfo.aesmode,D("ENCRYPT_AES")?(N.aes_secret=this.joinInfo.aespassword,N.aes_encrypt=!0):N.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(N.aes_salt=this.joinInfo.aessalt)),l.addresses[this.signal.websocket.currentURLIndex]&&(N.ap_response.ticket=l.addresses[this.signal.websocket.currentURLIndex].ticket,delete l.addresses),this.joinInfo.defaultVideoStream!==void 0&&(N.default_video_stream=this.joinInfo.defaultVideoStream),N}getRejoinMessage(){if(!this.joinInfo)throw new G(P.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(pe.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(pe.WS_RECONNECTING,t=>{this.joinInfo&&ue.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Gn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ue.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(pe.WS_CLOSED,t=>{let n;switch(t){case He.LEAVE:n=Gn.LEAVE;break;case He.UID_BANNED:case He.IP_BANNED:case He.CHANNEL_BANNED:case He.SERVER_ERROR:n=Gn.SERVER_ERROR;break;case He.FALLBACK:n=Gn.FALLBACK;break;case He.LICENSE_MISSING:case He.LICENSE_EXPIRED:case He.LICENSE_MINUTES_EXCEEDED:case He.LICENSE_PERIOD_INVALID:case He.LICENSE_MULTIPLE_SDK_SERVICE:case He.LICENSE_ILLEGAL:case He.TOKEN_EXPIRE:n=t;break;default:n=Gn.NETWORK_ERROR}S.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Gn.NETWORK_ERROR)),this.joinInfo&&ue.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===He.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==He.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(pe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=D("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(S.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(ue.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void S.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));ft("EVENT_REPORT_DOMAIN",t[1]),ft("EVENT_REPORT_BACKUP_DOMAIN",t[1]),ft("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Ie.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(pe.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new G(P.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,hn(this,tn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(pe.REQUEST_JOIN_INFO,(t,n,r)=>O(this,null,function*(){var i,c,l;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let u=Pt((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(D("NEW_TURN_MODE")&&u&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var h;let _=u.servers.map(C=>"turnServerURL"in C&&D("USE_TURN_IP")?Pn(Pn({},C),{},{turnServerURL:fv(C.turnServerURL)}):C),y=(h=u.serversFromGateway)===null||h===void 0?void 0:h.map(C=>D("USE_TURN_IP")?Pn(Pn({},C),{},{turnServerURL:fv(C.turnServerURL)}):C),A=this.signal.currentURLIndex;_.length>0&&(_=[_[A%_.length]],u.servers=_),Array.isArray(y)&&y.length>0&&(y=[y[0]],u.serversFromGateway=y),S.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(A))}let{iceParameters:f,dtlsParameters:m,rtpCapabilities:E}=yield hn(this,tn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u,cloudProxyServer:(l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:m,rtpCapabilities:E,version:"2"}}))}catch(_){n(_)}})),this.signal.on(pe.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(pe.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,i="";var c;t instanceof G?(r=((c=t.data)===null||c===void 0?void 0:c.desc)||t.code,i=t.message):r=t,ue.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(pe.IS_P2P_DISCONNECTED,t=>{t(wd(this,tn.IS_P2P_DISCONNECTED))}),this.signal.on(pe.DISCONNECT_P2P,()=>{this.emit(tn.DISCONNECT_P2P)}),this.signal.on(pe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(pe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(pe.JOIN_RESPONSE,t=>{let n=this.getCurrentGatewayAddress();this.emit(tn.JOIN_RESPONSE,t,n)}),this.signal.on(pe.PRE_CONNECT_PC,(t,n)=>O(this,null,function*(){if(this.joinInfo){var r,i;this.updateTurnConfigFromSignal();let l=this.getCurrentGatewayAddress(),u=Pt((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(D("NEW_TURN_MODE")&&u&&((i=this.joinInfo)===null||i===void 0?void 0:i.cloudProxyServer)==="disabled"){var c;let f=u.servers.map(_=>"turnServerURL"in _&&D("USE_TURN_IP")?Pn(Pn({},_),{},{turnServerURL:fv(_.turnServerURL)}):_),m=(c=u.serversFromGateway)===null||c===void 0?void 0:c.map(_=>D("USE_TURN_IP")?Pn(Pn({},_),{},{turnServerURL:fv(_.turnServerURL)}):_),E=this.signal.currentURLIndex;f.length>0&&(f=[f[E%f.length]],u.servers=f),Array.isArray(m)&&m.length>0&&(m=[m[0]],u.serversFromGateway=m),S.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(E,",in pre pc"))}let h=D("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(l&&h){let f=AB(l);hn(this,tn.PRE_CONNECT_PC,{candidates:f,fingerprint:h,turnServer:u}).then(m=>{t?.(m)}).catch(n||(()=>{}))}}})),this.signal.on(pe.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof D("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(D("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(pe.VOS_FALLBACK,t=>{this.emit(tn.VOS_FALLBACK,t)}),this.signal.on(pe.DATACHANNEL_FAILBACK,t=>{S.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(tn.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(t,n){return O(this,null,function*(){try{yield this.signal.request(fe.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}})}tryUnsubDataChannelBeforeResub(t,n){return O(this,null,function*(){try{yield this.signal.request(fe.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw S.warning("unsubscribe datachannel warning",r),r}})}tryUnpubBeforeRepub(t,n){return O(this,null,function*(){try{yield this.signal.request(fe.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}})}tryUnpubDataChannelBeforeRepub(t,n){return O(this,null,function*(){try{yield this.signal.request(fe.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw S.warning("unpublish datastream warning: ",r),r}})}tryMassUnsubBeforeResub(t){return O(this,null,function*(){let n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{yield this.signal.request(fe.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}})}muteLocal(t,n){return O(this,null,function*(){let r={action:t.find(i=>i.stream_type===dt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{yield this.signal.request(fe.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}})}unmuteLocal(t,n){return O(this,null,function*(){let r={action:t.find(i=>i.stream_type===dt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{yield this.signal.request(fe.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}})}muteRemote(t,n){return O(this,null,function*(){let r={action:t===de.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{yield this.signal.request(fe.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}})}unmuteRemote(t,n){return O(this,null,function*(){let r={action:t===de.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{yield this.signal.request(fe.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}})}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}restartICE(t){return O(this,null,function*(){let n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return yield this.signal.request(fe.RESTART_ICE,n,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}})}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Gn.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!D("GATEWAY_WSS_ADDRESS"))return D("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(S.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(t){return O(this,null,function*(){yield this.signal.request(fe.SET_PARAMETER,{enablePublishAudioFilter:t})})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(He.FALLBACK)),this.store.useDcSignal=!1,this.signal=new gB(Pn(Pn({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(tn.RESET_SIGNAL)}}let Sv=0,Qw=0;function es(e,t,n,r){return new ie((i,c)=>{t.timeout=t.timeout||D("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Sv+=Ps(t.data)):n&&(t.data.size?Sv+=t.data.size:t.data instanceof FormData?Sv+=f2(t.data):Sv+=Ps(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Lr.request(t).then(l=>{typeof l.data=="string"?Qw+=Ps(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?Qw+=l.data.byteLength:Qw+=Ps(JSON.stringify(l.data)),r&&i({data:l.data,headers:l.headers}),i(l.data)}).catch(l=>{Lr.isCancel(l)?c(new G(P.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?c(new G(P.NETWORK_TIMEOUT,l.message)):l.response?c(new G(P.NETWORK_RESPONSE_ERROR,l.response.status)):c(new G(P.NETWORK_ERROR,l.message))})})}(function(){var e;function t($){var ne=0;return function(){return ne<$.length?{done:!1,value:$[ne++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function($,ne,le){return $==Array.prototype||$==Object.prototype||($[ne]=le.value),$},r,i=(function($){$=[typeof globalThis=="object"&&globalThis,$,typeof window=="object"&&window,typeof self=="object"&&self,typeof s=="object"&&s];for(var ne=0;ne<$.length;++ne){var le=$[ne];if(le&&le.Math==Math)return le}throw Error("Cannot find global object")})(this);function c($,ne){if(ne)e:{var le=i;$=$.split(".");for(var X=0;X<$.length-1;X++){var R=$[X];if(!(R in le))break e;le=le[R]}(ne=ne(X=le[$=$[$.length-1]]))!=X&&ne!=null&&n(le,$,{configurable:!0,writable:!0,value:ne})}}function l($){return($={next:$})[Symbol.iterator]=function(){return this},$}function u($){var ne=typeof Symbol<"u"&&Symbol.iterator&&$[Symbol.iterator];return ne?ne.call($):{next:t($)}}if(c("Symbol",function($){function ne(R,k){this.A=R,n(this,"description",{configurable:!0,writable:!0,value:k})}if($)return $;ne.prototype.toString=function(){return this.A};var le="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",X=0;return function R(k){if(this instanceof R)throw new TypeError("Symbol is not a constructor");return new ne(le+(k||"")+"_"+X++,k)}}),c("Symbol.iterator",function($){if($)return $;$=Symbol("Symbol.iterator");for(var ne="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),le=0;le<ne.length;le++){var X=i[ne[le]];typeof X=="function"&&typeof X.prototype[$]!="function"&&n(X.prototype,$,{configurable:!0,writable:!0,value:function(){return l(t(this))}})}return $}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var h;e:{var f={};try{f.__proto__={a:!0},h=f.a;break e}catch{}h=!1}r=h?function($,ne){if($.__proto__=ne,$.__proto__!==ne)throw new TypeError($+" is not extensible");return $}:null}var m=r;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _($){if($.m)throw new TypeError("Generator is already running");$.m=!0}function y($,ne){return $.h=3,{value:ne}}function A($){this.g=new E,this.G=$}function C($,ne,le,X){try{var R=ne.call($.g.j,le);if(!(R instanceof Object))throw new TypeError("Iterator result "+R+" is not an object");if(!R.done)return $.g.m=!1,R;var k=R.value}catch(F){return $.g.j=null,$.g.s(F),I($)}return $.g.j=null,X.call($.g,k),I($)}function I($){for(;$.g.h;)try{var ne=$.G($.g);if(ne)return $.g.m=!1,{value:ne.value,done:!1}}catch(le){$.g.v=void 0,$.g.s(le)}if($.g.m=!1,$.g.l){if(ne=$.g.l,$.g.l=null,ne.F)throw ne.D;return{value:ne.return,done:!0}}return{value:void 0,done:!0}}function N($){this.next=function(ne){return $.o(ne)},this.throw=function(ne){return $.s(ne)},this.return=function(ne){return(function(le,X){_(le.g);var R=le.g.j;return R?C(le,"return"in R?R.return:function(k){return{value:k,done:!0}},X,le.g.return):(le.g.return(X),I(le))})($,ne)},this[Symbol.iterator]=function(){return this}}function L($,ne){return ne=new N(new A(ne)),m&&$.prototype&&m(ne,$.prototype),ne}if(E.prototype.o=function($){this.v=$},E.prototype.s=function($){this.l={D:$,F:!0},this.h=this.C||this.u},E.prototype.return=function($){this.l={return:$},this.h=this.u},A.prototype.o=function($){return _(this.g),this.g.j?C(this,this.g.j.next,$,this.g.o):(this.g.o($),I(this))},A.prototype.s=function($){return _(this.g),this.g.j?C(this,this.g.j.throw,$,this.g.o):(this.g.s($),I(this))},c("Array.prototype.entries",function($){return $||function(){return(function(ne,le){ne instanceof String&&(ne+="");var X=0,R=!1,k={next:function(){if(!R&&X<ne.length){var F=X++;return{value:le(F,ne[F]),done:!1}}return R=!0,{done:!0,value:void 0}}};return k[Symbol.iterator]=function(){return k},k})(this,function(ne,le){return[ne,le]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var M=function($,ne){for(var le=0;le<$.length;le++)ne($[le])},V=function($){return $.replace(/\r?\n|\r/g,`\r
`)},j=function($,ne,le){return ne instanceof Blob?(le=le!==void 0?le+"":typeof ne.name=="string"?ne.name:"blob",ne.name===le&&Object.prototype.toString.call(ne)!=="[object Blob]"||(ne=new File([ne],le)),[String($),ne]):[String($),String(ne)]},U=function($,ne){if($.length<ne)throw new TypeError(ne+" argument required, but only "+$.length+" present.")},H=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,K=H.FormData,Y=H.XMLHttpRequest&&H.XMLHttpRequest.prototype.send,ae=H.Request&&H.fetch,Ce=H.navigator&&H.navigator.sendBeacon,Te=H.Element&&H.Element.prototype,Le=H.Symbol&&Symbol.toStringTag;Le&&(Blob.prototype[Le]||(Blob.prototype[Le]="Blob"),"File"in H&&!File.prototype[Le]&&(File.prototype[Le]="File"));try{new File([],"")}catch{H.File=function(ne,le,X){return ne=new Blob(ne,X||{}),Object.defineProperties(ne,{name:{value:le},lastModified:{value:+(X&&X.lastModified!==void 0?new Date(X.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Le&&Object.defineProperty(ne,Le,{value:"File"}),ne}}var De=function($){return $.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},tt=function($){this.i=[];var ne=this;$&&M($.elements,function(le){if(le.name&&!le.disabled&&le.type!=="submit"&&le.type!=="button"&&!le.matches("form fieldset[disabled] *"))if(le.type==="file"){var X=le.files&&le.files.length?le.files:[new File([],"",{type:"application/octet-stream"})];M(X,function(R){ne.append(le.name,R)})}else le.type==="select-multiple"||le.type==="select-one"?M(le.options,function(R){!R.disabled&&R.selected&&ne.append(le.name,R.value)}):le.type==="checkbox"||le.type==="radio"?le.checked&&ne.append(le.name,le.value):(X=le.type==="textarea"?V(le.value):le.value,ne.append(le.name,X))})};if((e=tt.prototype).append=function($,ne,le){U(arguments,2),this.i.push(j($,ne,le))},e.delete=function($){U(arguments,1);var ne=[];$=String($),M(this.i,function(le){le[0]!==$&&ne.push(le)}),this.i=ne},e.entries=function $(){var ne,le=this;return L($,function(X){if(X.h==1&&(ne=0),X.h!=3)return ne<le.i.length?X=y(X,le.i[ne]):(X.h=0,X=void 0),X;ne++,X.h=2})},e.forEach=function($,ne){U(arguments,1);for(var le=u(this),X=le.next();!X.done;X=le.next()){var R=u(X.value);X=R.next().value,R=R.next().value,$.call(ne,R,X,this)}},e.get=function($){U(arguments,1);var ne=this.i;$=String($);for(var le=0;le<ne.length;le++)if(ne[le][0]===$)return ne[le][1];return null},e.getAll=function($){U(arguments,1);var ne=[];return $=String($),M(this.i,function(le){le[0]===$&&ne.push(le[1])}),ne},e.has=function($){U(arguments,1),$=String($);for(var ne=0;ne<this.i.length;ne++)if(this.i[ne][0]===$)return!0;return!1},e.keys=function $(){var ne,le,X,R,k=this;return L($,function(F){if(F.h==1&&(ne=u(k),le=ne.next()),F.h!=3)return le.done?void(F.h=0):(X=le.value,R=u(X),y(F,R.next().value));le=ne.next(),F.h=2})},e.set=function($,ne,le){U(arguments,2),$=String($);var X=[],R=j($,ne,le),k=!0;M(this.i,function(F){F[0]===$?k&&(k=!X.push(R)):X.push(F)}),k&&X.push(R),this.i=X},e.values=function $(){var ne,le,X,R,k=this;return L($,function(F){if(F.h==1&&(ne=u(k),le=ne.next()),F.h!=3)return le.done?void(F.h=0):(X=le.value,(R=u(X)).next(),y(F,R.next().value));le=ne.next(),F.h=2})},tt.prototype._asNative=function(){for(var $=new K,ne=u(this),le=ne.next();!le.done;le=ne.next()){var X=u(le.value);le=X.next().value,X=X.next().value,$.append(le,X)}return $},tt.prototype._blob=function(){var $="----formdata-polyfill-"+Math.random(),ne=[],le="--"+$+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(X,R){return typeof X=="string"?ne.push(le+De(V(R))+`"\r
\r
`+V(X)+`\r
`):ne.push(le+De(V(R))+'"; filename="'+De(X.name)+`"\r
Content-Type: `+(X.type||"application/octet-stream")+`\r
\r
`,X,`\r
`)}),ne.push("--"+$+"--"),new Blob(ne,{type:"multipart/form-data; boundary="+$})},tt.prototype[Symbol.iterator]=function(){return this.entries()},tt.prototype.toString=function(){return"[object FormData]"},Te&&!Te.matches&&(Te.matches=Te.matchesSelector||Te.mozMatchesSelector||Te.msMatchesSelector||Te.oMatchesSelector||Te.webkitMatchesSelector||function($){for(var ne=($=(this.document||this.ownerDocument).querySelectorAll($)).length;0<=--ne&&$.item(ne)!==this;);return-1<ne}),Le&&(tt.prototype[Le]="FormData"),Y){var Ut=H.XMLHttpRequest.prototype.setRequestHeader;H.XMLHttpRequest.prototype.setRequestHeader=function($,ne){Ut.call(this,$,ne),$.toLowerCase()==="content-type"&&(this.B=!0)},H.XMLHttpRequest.prototype.send=function($){$ instanceof tt?($=$._blob(),this.B||this.setRequestHeader("Content-Type",$.type),Y.call(this,$)):Y.call(this,$)}}ae&&(H.fetch=function($,ne){return ne&&ne.body&&ne.body instanceof tt&&(ne.body=ne.body._blob()),ae.call(this,$,ne)}),Ce&&(H.navigator.sendBeacon=function($,ne){return ne instanceof tt&&(ne=ne._asNative()),Ce.call(this,$,ne)}),H.FormData=tt}})();let Bf=()=>{let e=D("AREAS");return e.length===0&&e.push(nt.GLOBAL),Ui(e).call(e,(t,n,r)=>{let i=VB(n);return i?r===0?i:"".concat(t,",").concat(i):t},"")},VB=e=>e===nt.OVERSEA?"".concat($n.ASIA,",").concat($n.EUROPE,",").concat($n.AFRICA,",").concat($n.NORTH_AMERICA,",").concat($n.SOUTH_AMERICA,",").concat($n.OCEANIA):$n[e],Nce=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{let r=uv[n],i=Object.keys(r);i&&i.map(c=>{c!=="CODE"&&(t[c]=t[c].concat(r[c]))})}),t},Tv={GLOBAL:{ASIA:[nt.CHINA,nt.JAPAN,nt.INDIA,nt.KOREA,nt.HKMC],EUROPE:[],NORTH_AMERICA:[nt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Cv=Object.keys(Tv[nt.GLOBAL]),e0=[nt.CHINA,nt.NORTH_AMERICA,nt.EUROPE,nt.ASIA,nt.JAPAN,nt.INDIA,nt.OCEANIA,nt.SOUTH_AMERICA,nt.AFRICA,nt.KOREA,nt.HKMC,nt.US],Pce=function(e,t){let n=[];if(J(e).call(e,nt.GLOBAL)){let c=[nt.GLOBAL,nt.OVERSEA],l=Object.keys(uv);if(t===nt.GLOBAL)throw new G(P.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===nt.CHINA)n=[nt.OVERSEA];else if(i=t,J(Cv).call(Cv,i)){let u=(r=t,Tv[nt.GLOBAL][r]||[]),h=[...c,t,...u];n=l.filter(f=>!J(h).call(h,f))}else if((function(u){let h=!1;return Cv.forEach(f=>{var m;J(m=Tv[nt.GLOBAL][f]).call(m,u)&&(h=!0)}),h})(t)){let u=(function(f){let m;return Cv.forEach(E=>{var _;J(_=Tv[nt.GLOBAL][E]).call(_,f)&&(m=E)}),m})(t),h=[...c,u,t];n=l.filter(f=>!J(h).call(h,f))}else n=e;n=(function(u){let h=[];return e0.forEach(f=>{J(u).call(u,f)&&h.push(f)}),h.concat(u.filter(f=>!J(e0).call(e0,f)))})(n)}else n=e;var r,i;return n};function jB(e){var t,n;if(!e&&J(t=D("AREAS")).call(t,nt.EXTENSIONS))return S.debug("update area from ap : reset"),void t0(Bae,!0);if(!J(n=D("AREAS")).call(n,nt.GLOBAL)||!e)return;let r=uv.EXTENSIONS;r&&(r={CODE:VB(nt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},S.debug("update area from ap success: ".concat(e,",config is "),r),ft("AREAS",[nt.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?ft(i,r[i][0]):ft(i,r[i])}))}function t0(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=ue.reportApiInvoke(null,{name:Mt.SET_AREA,options:e,tag:St.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(c=>{if(!J(dB).call(dB,c))throw new G(P.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:c,excludedArea:l}=e;if(!c)throw new G(P.INVALID_PARAMS,"area code is needed");let u=c;typeof c=="string"&&(u=[c]),r=l?Pce(u,l):u}if(!t){if(yi.AREAS){let c=new G(P.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(c),void S.warning("setArea is prohibited because of config-distribute")}if(J(r).call(r,nt.GLOBAL)&&D("AREAS")===nt.EXTENSIONS){let c=new G(P.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void S.warning("setArea is prohibited because of ap extensions")}}ft("AREAS",r,t);let i=Nce(r);Object.keys(i).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?ft(c,i[c][0]):ft(c,i[c])}),S.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function BB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function js(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BB(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let n0=1;function Lce(e,t,n,r,i){n0+=1;let c={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:n0,requestId:n0,version:Vi,cname:n.cname},l={service_name:t,json_body:JSON.stringify(c)},u,h,f=e[0];return Yo(()=>O(null,null,function*(){u=Date.now();let m=yield es(f,{data:l,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-u,m.code!==0){let y=new G(P.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:h});throw S.error(y.toString()),y}let E=JSON.parse(m.json_body);if(E.code!==200){let y=new G(P.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:h});throw S.error(y.toString()),y}if(!E.servers||E.servers.length===0){let y=new G(P.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:h});throw S.error(y.toString()),y}let _=(function(y,A){return{addressList:y.servers.map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(D("WORKER_DOMAIN"),":").concat(C.wss,"?serviceName=").concat(encodeURIComponent(A))),workerToken:y.workerToken,vid:y.vid}})(E,t);return D("LIVE_STREAMING_ADDRESS")&&(_.addressList=D("LIVE_STREAMING_ADDRESS")instanceof Array?D("LIVE_STREAMING_ADDRESS"):[D("LIVE_STREAMING_ADDRESS")]),js(js({},_),{},{responseTime:h})}),(m,E)=>(ue.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:E===0,responseTime:h,serverIp:e[E%e.length]}),!1),(m,E)=>(ue.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:h,serverIp:e[E%e.length]}),!!(m.code!==P.OPERATION_ABORTED&&m.code!==P.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(f=e[(E+1)%e.length],!0)),i)}let r0=1;function HB(e,t,n,r){let{url:i,areaCode:c}=e,{clientId:l,sid:u}=t,h=Date.now(),f,m=t.role,[E,_]=o0(t,c,[dn.CHOOSE_SERVER]),y=zt.networkState;return Yo(()=>O(null,null,function*(){y&&zt.networkState===Sr.OFFLINE&&zt.onlineWaiter&&(yield ie.race([zt.onlineWaiter,Tn(r&&r.maxRetryTimeout||cn.maxRetryTimeout)])),y=zt.networkState;let{data:A,headers:C}=yield es(i,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=C.http3==="1"?1:-1,ue.reportResourceTiming(i,u),WB(A,i,t,h,[dn.CHOOSE_SERVER],f);let I=Mf(A,dn.CHOOSE_SERVER);return i0(I),Ww(I,i)}),A=>(A&&ue.joinChooseServer(u,{role:m,lts:h,succ:!0,csAddr:i,opid:_,serverList:A.gatewayAddrs.map(C=>C.address),ec:null,cid:A.cid.toString(),uid:A.uid.toString(),csIp:A.csIp,unilbsServerIds:[dn.CHOOSE_SERVER].toString(),isHttp3:f,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:A.res.detail&&A.res.detail[38],vid:A.vid}),!1),A=>A.code!==P.OPERATION_ABORTED&&(A.code===P.CAN_NOT_GET_GATEWAY_SERVER?A.data.retry:(ue.joinChooseServer(u,{role:m,lts:h,succ:!1,csAddr:i,serverList:null,opid:_,ec:A.code,csIp:A.data&&A.data.csIp,unilbsServerIds:[dn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:f,corssRegionTagReq:t.apRequestDetail}),S.warning("[".concat(l||"sid-".concat(u.slice(0,6)),"] Choose server network error, retry"),A),!0)),r)}function GB(e,t,n,r){let i,{url:c,areaCode:l,serviceIds:u}=e,h=Date.now(),f=t.role,[m,E]=o0(t,l,u),_;return Yo(()=>O(null,null,function*(){_&&zt.networkState===Sr.OFFLINE&&zt.onlineWaiter&&(yield ie.race([zt.onlineWaiter,Tn(r&&r.maxRetryTimeout||cn.maxRetryTimeout)])),_=zt.networkState;let{data:y,headers:A}=yield es(c,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=A.http3==="1"?1:-1,ue.reportResourceTiming(c,t.sid),WB(y,c,t,h,u,i);let C=Mf(y,dn.CHOOSE_SERVER),I=Mf(y,t.cloudProxyServer==="proxy5"?dn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?dn.CLOUD_PROXY:dn.CLOUD_PROXY_FALLBACK),N=performance.getEntriesByName(c),L=N[N.length-1],M;return L&&(M={name:L.name,protocol:"nextHopProtocol"in L?L.nextHopProtocol:"",dnscost:"domainLookupEnd"in L&&"domainLookupStart"in L&&typeof L.domainLookupEnd=="number"&&typeof L.domainLookupStart=="number"?L.domainLookupEnd-L.domainLookupStart:-1,tcpTlsCost:"connectEnd"in L&&"connectStart"in L&&typeof L.connectEnd=="number"&&typeof L.connectStart=="number"?L.connectEnd-L.connectStart:-1,reqCost:"requestStart"in L&&typeof L.requestStart=="number"&&"responseEnd"in L&&typeof L.responseEnd=="number"?L.responseEnd-L.requestStart:-1,handleCost:"leave_ts"in y&&"enter_ts"in y&&typeof y.leave_ts=="number"&&typeof y.enter_ts=="number"?y.leave_ts-y.enter_ts:-1}),i0(C),{gatewayInfo:Ww(C,c),proxyInfo:I,url:c,resourceTimingInfo:M}}),y=>{var A;return y.gatewayInfo&&ue.joinChooseServer(t.sid,{role:f,lts:h,succ:!0,csAddr:c,serverList:y.gatewayInfo.gatewayAddrs.map(C=>C.address),ec:null,opid:E,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38],vid:(A=y.gatewayInfo)===null||A===void 0?void 0:A.vid,resourceTimingInfo:y.resourceTimingInfo?JSON.stringify(y.resourceTimingInfo):void 0}),y.proxyInfo&&ue.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:c,turnServerAddrList:y.proxyInfo.addresses.map(C=>C.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1},y=>y.code!==P.OPERATION_ABORTED&&(y.code===P.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(ue.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:c,turnServerAddrList:null,errorCode:y.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:_})}),S.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),y),!0)),r)}let WB=(e,t,n,r,i,c)=>{let{sid:l,clientId:u,cloudProxyServer:h}=n,f=[],m=E=>{E.flag===4096?ue.joinChooseServer(l,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||ue.joinWebProxyAP(l,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:h,unilbsServerIds:i.toString()})};if(e.response_body.forEach(E=>{let _=E.buffer.code;if(E.uri===23&&_===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{let y={error:new G(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:D("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:E.buffer.flag};f.push(y),m(y)}if(_!==0){let y=oh(_),A={error:new G(P.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?S.warning(A.error.toString()):f.push(A),m(A)}}),f.length)throw S.warning("[".concat(u||"sid-".concat(l.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(f.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new G(P.CAN_NOT_GET_GATEWAY_SERVER,f.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!f.find(E=>E.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(E=>{var _;return E==null||(_=E.error)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.desc}).filter(E=>!!E))]})},i0=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new G(P.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(D("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?jB(e.detail[23].toLowerCase()):jB()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){let l=e.detail[19],u=l?.split(";");for(let h=0;h<u.length;h++){var c;let f=vr(c=u[h]).call(c);e.addresses[h]&&u&&(e.addresses[h].fingerprint=f)}}if(D("GATEWAY_ADDRESS")&&D("GATEWAY_ADDRESS").length>0){S.debug("assign gateway address to",D("GATEWAY_ADDRESS"));let l=D("GATEWAY_ADDRESS").map(u=>{var h,f;let m=(h=(f=e.addresses.find(E=>E.ip===u.ip&&E.port===u.port))===null||f===void 0?void 0:f.fingerprint)!==null&&h!==void 0?h:"";return{ip:u.ip,port:u.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:u.fingerprint||m}});e.addresses=l}},kce=(e,t)=>{if(e.response_body&&e.response_body.length){let n=e.response_body[0];if(n.buffer.code!==0){let r=oh(n.buffer.code);throw new G(P.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",t),new G(P.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},o0=(e,t,n)=>{let r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,c={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:js(js(js({6:e.stringUid,11:t,12:D("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};c.request_bodies.forEach(u=>{e.multiIP&&e.multiIP.gateway_ip&&(u.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let l=new FormData;return l.append("request",JSON.stringify(c)),[l,r]},Mce=(e,t)=>{let n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(c=>({ip:c.ip,port:c.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]},ch=0;function dh(e){return ie.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}let Hf=e=>O(null,null,function*(){let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:c}=e,l=0,u=t,h,f=0,m=()=>O(null,null,function*(){let E=(()=>{let _=l*u,y=_+u;return n.slice(_,y).map(r)})();c&&c.push(...E);try{h=yield dh(E)}catch(_){if(f+=u,l++,!(f>=n.length))return void(yield m());i(_)}E.forEach(_=>_.cancel())});return yield m(),h}),qB=e=>O(null,null,function*(){let{referenceList:t,asyncMapHandler:n,closeFn:r}=e,i=t.length,c=0,l=()=>O(null,null,function*(){let u=n(t.shift());try{return yield u}catch(h){if(c++,c>=i||r!=null&&r(h))throw h;return l()}});return l()});function xce(){return O(this,null,function*(){if(typeof VideoDecoder>"u")return!0;let e,t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],c=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],l=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return yield new ie((h,f)=>{let m;(function(){return O(this,null,function*(){e&&e.state!=="closed"||(yield(function(){return O(this,null,function*(){e=new VideoDecoder({output:_=>{_.close(),clearTimeout(m),h(!0)},error:_=>{clearTimeout(m),h(!1)}}),yield e.configure({codec:"av01.0.05M.08",width:160,height:90})})})());let E=[t,n,r,i,c,l];for(let _=0;_<E.length;_++){let y=new EncodedVideoChunk({type:_==0?"key":"delta",timestamp:33333*_,duration:33333,data:new Uint8Array(E[_])});try{yield e.decode(y)}catch{return void h(!1)}}})})(),m=setTimeout(()=>{h(!1)},5e3)})})}function Rv(e,t,n,r){return O(this,null,function*(){return{gatewayInfo:yield(function(c,l,u,h){return O(this,null,function*(){let f=null,m=[],E=()=>O(null,null,function*(){let y=D("WEBCS_DOMAIN").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(I=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Bf()})),A=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(I=>I.url)}),C=yield Hf({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:I=>(S.debug("[".concat(c.clientId,"] Connect to choose_server:"),I.url),HB(I,c,l,u)),allFailedhandler:I=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},A),I[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C}),_=()=>O(null,null,function*(){if(yield Tn(1e3),f!==null)return f;let y=D("WEBCS_DOMAIN_BACKUP_LIST").map(I=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Bf()})),A=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(I=>I.url)}),C=yield Hf({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:I=>(S.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),I.url),HB(I,c,l,u)),allFailedhandler:I=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},A),I[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C});try{return f=yield dh([E(),_()]),m.length&&m.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),f}catch(y){throw y[0]}})})(e,t,n,r)}})}function zB(e,t,n,r,i){return O(this,null,function*(){let c=e.cloudProxyServer;if(c==="disabled"){if(!r)return;if(e.useLocalAccessPoint)return yield Rv(e,t,n,i);if(D("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:_,proxyInfo:y}=yield $B(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:_};let A=y.map(C=>({turnServerURL:C.address,tcpport:C.tcpport||Wn.tcpport,udpport:C.udpport||Wn.udpport,username:C.username||Wn.username,password:C.password||Wn.password,forceturn:!1,security:!0}));if(i.useP2P){var l;let C=(l=e.uid)!==null&&l!==void 0?l:_.uid,I="glb:".concat(C.toString()),N=yield Bb(I),L=y.map(M=>({turnServerURL:M.address,tcpport:M.tcpport||Wn.tcpport,udpport:M.udpport||Wn.udpport,username:I,password:N,forceturn:!1,security:!0}));A.push(...L)}return e.turnServer={mode:"manual",servers:A},{gatewayInfo:_}}return yield Rv(e,t,n,i)}let{proxyInfo:u,gatewayInfo:h}=yield $B(e,t,n,i),f={gatewayInfo:h},m=u.map(_=>({turnServerURL:_.address,tcpport:c==="proxy3"?void 0:_.tcpport?_.tcpport:Wn.tcpport,udpport:c==="proxy4"?void 0:_.udpport?_.udpport:Wn.udpport,username:_.username||Wn.username,password:_.password||Wn.password,forceturn:c!=="proxy4",security:c==="proxy5"}));if(i.useP2P){var E;let _=(E=e.uid)!==null&&E!==void 0?E:h.uid,y="glb:".concat(_.toString()),A=yield Bb(y),C=u.map(I=>({turnServerURL:I.address,tcpport:c==="proxy3"?void 0:I.tcpport||Wn.tcpport,udpport:c==="proxy4"?void 0:I.udpport||Wn.udpport,username:y,password:A,forceturn:c!=="proxy4",security:c==="proxy5"}));m.push(...C)}return e.turnServer={mode:"manual",servers:m},S.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(c)),f})}function KB(e,t,n,r,i){return O(this,null,function*(){let c=D("ACCOUNT_REGISTER").slice(0,D("AJAX_REQUEST_CONCURRENT")),l=[];l=t.proxyServer?c.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):c.map(h=>"https://".concat(h,"/api/v1"));let u=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:l});try{let h=yield(function(f,m,E,_,y){return O(this,null,function*(){let A=Date.now(),C={sid:E.sid,opid:10,appid:E.appId,string_uid:m},I=f[0],N=yield Yo(()=>es(I+"".concat(I.indexOf("?")===-1?"?":"&","action=stringuid"),{data:C,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(L,M)=>{if(L.code===0){if(L.uid<=0||L.uid>=Math.pow(2,32))throw S.error("Invalid Uint Uid ".concat(m," => ").concat(L.uid),L),ue.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:I,stringUid:C.string_uid,uid:L.uid,errorCode:P.INVALID_UINT_UID_FROM_STRING_UID,extend:C}),new G(P.INVALID_UINT_UID_FROM_STRING_UID);return ue.reqUserAccount(C.sid,{lts:A,success:!0,serverAddr:I,stringUid:C.string_uid,uid:L.uid,errorCode:null,extend:C}),!1}let V=oh(L.code);return V.retry&&(I=f[(M+1)%f.length]),ue.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:I,stringUid:C.string_uid,uid:L.uid,errorCode:V.desc,extend:C}),V.retry},(L,M)=>L.code!==P.OPERATION_ABORTED&&(ue.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:I,stringUid:C.string_uid,uid:null,errorCode:L.code,extend:C}),I=f[(M+1)%f.length],!0),y);if(N.code!==0){let L=oh(N.code);throw new G(P.UNEXPECTED_RESPONSE,L.desc)}return N})})(l,e,t,n,r);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},u),h.uid}catch(h){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},u),h}})}function Uce(e,t,n){return O(this,null,function*(){let r=D("ACCOUNT_REGISTER"),i=[];i=t.proxyServer?r.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):r.map(c=>"https://".concat(c,"/api/v1"));try{return yield qB({referenceList:i,asyncMapHandler:l=>(function(u,h,f,m){return O(this,null,function*(){let E=Date.now(),_={sid:f.sid,opid:10,appid:f.appId,string_uid:h};try{let y=yield es(u+"".concat(u.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){let A=oh(y.code);throw new G(P.UNEXPECTED_RESPONSE,"preload sua error:".concat(A.desc),A)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new G(P.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:u,req:_,uid:y.uid,elapse:Date.now()-E}}catch(y){throw y}})})(l,e,t,n),closeFn:l=>l.code===P.OPERATION_ABORTED||l.code===P.UNEXPECTED_RESPONSE&&!l.data.retry})}catch(c){throw c}})}function Fce(e,t,n){return O(this,null,function*(){let r=D("CDS_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),i=r.map(h=>(function(f,m,E,_){let y=Je(),A={flag:64,cipher_method:0,features:js(js(js(js(js({install_id:ew(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:Vi,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:Ace.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return Yo(()=>es(f,{data:A,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,C=>C.code!==P.OPERATION_ABORTED,_)})(h,e,t,n)),c=null,l=null,u={};try{c=yield dh(i)}catch(h){if(h.code===P.OPERATION_ABORTED)throw h;l=h}if(i.forEach(h=>h.cancel()),ue.reportApiInvoke(e.sid,{name:Mt.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:c}}).onSuccess(),c&&c.test_tags)try{u=(function(h){if(!h.test_tags)return{};let f=h.test_tags,m=Object.keys(f),E={};return m.forEach(_=>{var y;let A=vr(y=_.slice(4)).call(y),C=JSON.parse(f[_]),I=C[1];E[A]={tag:C[0]||"",value:I}}),E})(c)}catch{}return u})}function YB(e,t){return O(this,null,function*(){let n=D("WEBCS_DOMAIN").concat(D("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Bf(),serviceIds:[dn.CHOOSE_SERVER,dn.CLOUD_PROXY_FALLBACK]}));try{return yield qB({referenceList:n,asyncMapHandler:i=>(function(c,l,u){return O(this,null,function*(){let h,{url:f,areaCode:m,serviceIds:E}=c,_=Date.now(),[y,A]=o0(l,m,E),C=zt.networkState;try{C&&zt.networkState===Sr.OFFLINE&&zt.onlineWaiter&&(yield ie.race([zt.onlineWaiter,Tn(cn.maxRetryTimeout)])),C=zt.networkState;let{data:I,headers:N}=yield es(f,{data:y,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=N.http3==="1"?1:-1,(j=>{let U=[];if(j.response_body.forEach(H=>{let K=H.buffer.code;if(H.uri===23&&K===0&&!H.buffer.edges_services)if(H.buffer.flag===4194310)H.buffer.edges_services=[];else{let Y={error:new G(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:D("NO_EDGES_RETRY"),csIp:j.detail[502]}),flag:H.buffer.flag};U.push(Y)}if(K!==0){let Y=oh(K),ae={error:new G(P.CAN_NOT_GET_GATEWAY_SERVER,Y.desc,{desc:Y.desc,retry:Y.retry,csIp:j.detail[502]}),flag:H.buffer.flag};H.buffer.flag===4194310?S.warning(ae.error.toString()):U.push(ae)}}),U.length)throw new G(P.CAN_NOT_GET_GATEWAY_SERVER,U.map(H=>"flag: ".concat(H.flag,", message: ").concat(H.error.message)).join(" | "),{retry:!!U.find(H=>H.error.data.retry),csIp:j.detail[502],desc:[...new Set(U.map(H=>{var K;return H==null||(K=H.error)===null||K===void 0||(K=K.data)===null||K===void 0?void 0:K.desc}).filter(H=>!!H))]})})(I);let M=Mf(I,dn.CHOOSE_SERVER),V=Mf(I,dn.CLOUD_PROXY_FALLBACK);return i0(M),{gatewayInfo:Ww(M,f),proxyInfo:V,opid:A,requestTime:_,url:f,isHttp3:h,elapse:Date.now()-_}}catch(I){throw I}})})(i,e,t),closeFn:i=>i.code===P.OPERATION_ABORTED||i.code===P.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}})}function $B(e,t,n,r){return O(this,null,function*(){let i=D("PROXY_SERVER_TYPE3"),c=(y,A,C)=>{let I=C||i;return Array.isArray(I)&&(I=A%2==0&&i[1]||i[0]),"https://".concat(I,"/ap/?url=").concat(y)},l=null,u=[],h=()=>O(null,null,function*(){let y=D("WEBCS_DOMAIN").slice(0,D("AJAX_REQUEST_CONCURRENT")).map((I,N)=>{let L;return L=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(I,"/api/v2/transpond/webrtc?v=2"),N,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):c("".concat(I,"/api/v2/transpond/webrtc?v=2"),N),{url:L,areaCode:Bf(),serviceIds:[dn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?dn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?dn.CLOUD_PROXY:dn.CLOUD_PROXY_FALLBACK]}}),A=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(I=>I.url)}),C=yield Hf({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:I=>(S.debug("[".concat(e.clientId,"] Connect to choose_server:"),I.url),GB(I,e,t,n)),allFailedhandler:I=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},A),I[0]},promisesCollector:u});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C}),f=()=>O(null,null,function*(){if(yield Tn(1e3),l!==null)return l;let y=D("WEBCS_DOMAIN_BACKUP_LIST").map((I,N)=>{let L;return L=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(I,"/api/v2/transpond/webrtc?v=2"),N,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):c("".concat(I,"/api/v2/transpond/webrtc?v=2"),N),{url:L,areaCode:Bf(),serviceIds:[dn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?dn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?dn.CLOUD_PROXY:dn.CLOUD_PROXY_FALLBACK]}}),A=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(I=>I.url)}),C=yield Hf({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:I=>(S.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),I.url),GB(I,e,t,n)),allFailedhandler:I=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},A),I[0]},promisesCollector:u});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C}),m,E,_;try{({gatewayInfo:m,proxyInfo:E,url:_}=yield dh([h(),f()]))}catch(y){throw y[0]}if(u.length&&u.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!m||!E)throw new G(P.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=_,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&_){let y=/^https?:\/\/(.+?)(\/.*)?$/.exec(_)[1];J(i).call(i,y)&&(e.proxyServer=y,S.setProxyServer(y),ue.setProxyServer(y))}return l={gatewayInfo:m,proxyInfo:yield vB(E,m.uid)},l})}function Vce(e,t,n){return O(this,null,function*(){let r=D("UAP_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")),i=r.map(c=>(function(l,u,h,f){let m={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:Vi,cname:u.cname,uid:u.uid.toString(),requestId:r0,seq:r0};r0+=1;let E={service_name:"tele_channel",json_body:JSON.stringify(m)};return Yo(()=>O(null,null,function*(){let _=yield es(l,{data:E,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_.code!==0){let A=new G(P.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_.code,{retry:!0});throw S.error(A.toString()),A}let y=JSON.parse(_.json_body);if(y.code!==200){let A=new G(P.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw S.error(A.toString()),A}if(!y.servers||y.servers.length===0){let A=new G(P.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(A.toString()),A}return{vid:y.vid,workerToken:y.workerToken,addressList:(D("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(D("WORKER_DOMAIN"),":").concat(A.wss))}}),void 0,_=>!!(_.code!==P.OPERATION_ABORTED&&_.code!==P.UNEXPECTED_RESPONSE||_.data&&_.data.retry),f)})(c,e,t,n));try{let c=yield dh(i);return i.forEach(l=>l.cancel()),c}catch(c){throw c[0]}})}function jce(e,t,n){return O(this,null,function*(){let r=null,i=[],c=l=>O(null,null,function*(){let u=D(l?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return l&&(yield Tn(1e3),r!==null)?r:yield Hf({fragementLength:D("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:h=>(S.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(l?"backup":""," choose_server:"),h),(function(f,m,E,_){let[y]=Mce(m,[dn.CHOOSE_SERVER]),A=zt.networkState;return Yo(()=>O(null,null,function*(){A&&zt.networkState===Sr.OFFLINE&&zt.onlineWaiter&&(yield ie.race([zt.onlineWaiter,Tn(_&&_.maxRetryTimeout||cn.maxRetryTimeout)])),A=zt.networkState;let C=yield es(f,{data:y,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return kce(C,f)}),()=>!1,C=>C.code!==P.OPERATION_ABORTED&&(C.code===P.UPDATE_TICKET_FAILED?C.data.retry:(S.warning("[".concat(m.clientId,"] update ticket network error, retry"),C),!0)),_)})(h,e,t,n)),allFailedhandler:h=>{throw h[0]},promisesCollector:i})});try{return r=yield dh([c(!1),c(!0)]),i.length&&i.forEach(l=>l.cancel&&typeof l.cancel=="function"&&l.cancel()),r}catch(l){throw l[0]}})}function XB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function s0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XB(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Bce extends jt{get isSuccess(){return!!this.configs}constructor(t,n){super(),w(this,"configs",void 0),w(this,"store",void 0),w(this,"joinInfo",void 0),w(this,"cancelToken",void 0),w(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),w(this,"interval",void 0),w(this,"mutex",void 0),w(this,"mutableParamsRead",!1),w(this,"configCache",{}),w(this,"limit_bitrate",void 0),this.mutex=new Dn("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),D("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},D("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}awaitConfigDistributeComplete(){return O(this,null,function*(){this.mutex.isLocked&&(yield this.mutex.lock())()})}updateConfigDistribute(){return O(this,null,function*(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ue.reportApiInvoke(null,{options:void 0,name:Mt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:St.TRACER}).onSuccess(JSON.stringify(yi))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,n=yield this.mutex.lock();try{t=yield Fce(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",JSON.stringify(t));let r=(function(i){var c;let l=fd(c=Object.keys(i).filter(f=>/^webrtc_ng_global_parameter/.test(f))).call(c);for(let f=0;f<l.length;f++)for(let m=l.length-1;m>f;m--){let E=l[m],_=i[E].value;if(typeof _.__priority=="number"){let y=_.__priority,A=l[m-1],C=i[A].value;if(typeof C.__priority=="number"){if(!(y>C.__priority))continue;{let I=E;l[m]=l[m-1],l[m-1]=I}}else{let I=E;l[m]=l[m-1],l[m-1]=I}}}let u=Date.now(),h={};return l.forEach(f=>{let m=i[f].value.__expires;m&&m<=u||(h[f]=i[f])}),h})(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){let i=new G(P.NETWORK_RESPONSE_ERROR,r);S.warning("[config-distribute] ".concat(i.toString()))}finally{n()}})}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){lB(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Jo.UPDATE_BITRATE_LIMIT,t):this.emit(Jo.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&s0({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let n={},r=Object.keys(t),i=[];r.forEach(c=>{let l=t[c].value;n[c]=l;let u=l.__id;if(u&&this.configCache[c]&&this.configCache[c].__id===u)return;let h=l.__type,f=t[c].value,m=t[c].tag,E=0;h?h===D2.REALTIME&&(E=1):Object.keys(f).some(_=>Object.prototype.hasOwnProperty.call(iw,_)||!Pw()&&Object.prototype.hasOwnProperty.call(HE,_)?(E=1,!0):void 0),i.push({tag:m,isApplied:E,feature:c,params:JSON.stringify(l)})}),i.forEach(c=>{let{tag:l,feature:u,params:h,isApplied:f}=c;this.store.sessionId&&ue.abTest(this.store.sessionId,{intSucc:1,isApplied:f,tag:l,feature:u,params:h,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){S.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){let n=(function(i){let c={};return Object.keys(i).forEach(l=>{let u=i[l].value,h=u.__expires,f=u.__type;Object.keys(u).forEach(m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(c,m)||(c[m]=s0(s0({value:u[m]},h&&{expires:h}),f&&{type:f}))})}),c})(t);try{var r;let i=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,i&&lB(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),(function(u){try{let h=Date.now();Object.keys(u).forEach(f=>{let{value:m,type:E,expires:_}=u[f];_&&_<=h||((E===D2.REALTIME||Object.prototype.hasOwnProperty.call(iw,f))&&(yi[f]=m,ct[f]=m,S.debug("Update realtime parameters from config distribute",f,m)),E||Pw()||!Object.prototype.hasOwnProperty.call(HE,f)||(yi[f]=m,ct[f]=m,S.debug("Update gateway parameters from config distribute",f,m)))})}catch(h){S.error("Error update config immediately: ".concat(u),h.message)}})(n);let c=JSON.stringify(n),l=window.btoa(c);window.localStorage.setItem("websdk_ng_global_parameter",l),S.debug("Caching global parameters ".concat(c))}catch(i){S.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{let n=Date.now();Object.keys(t).forEach(r=>{switch(r){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(ct,r)){let{value:c,expires:l}=t[r];if(l&&l<=n)return;zb(ct[r],c)||(yi[r]=c,ct[r]=c,this.emit(Jo.UPDATE_CLIENT_ROLE_OPTIONS,c),S.debug("Updating client role options: ".concat(JSON.stringify(c))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(ct,r)){var i;let{value:c,expires:l}=t[r];if(l&&l<=n)return;typeof c=="number"&&J(i=[0,1,4,5,6,7,8,9]).call(i,c)&&(yi[r]={value:c},ct[r]=c,this.emit(Jo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,c),S.debug("Updating client remote stream type: ".concat(JSON.stringify(c))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(ct,r)){let{value:c,expires:l}=t[r];if(l&&l<=n)return;zb(ct[r],c)||(yi[r]=c,ct[r]=c,this.emit(Jo.FALLBACK_TO_HLS,c),S.debug("Updating enable force hls: ".concat(JSON.stringify(c))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(ct,r)){let{value:c,expires:l}=t[r];if(l&&l<=n)return;zb(ct[r],c)||(yi[r]=c,ct[r]=c,this.emit(Jo.UPDATE_VOS_CONFIGURE,c),S.debug("Updating vos configure: ".concat(JSON.stringify(c))))}}})}catch(n){S.error("Error handling global parameter config:",n.message)}}}class Hce extends jt{constructor(){super(...arguments),w(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,n){let r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){let r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(D("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let i=this.resultStorage.get(t);if(!i)return;i.result.push(r);let c=t==="VIDEO_ENCODE_FAILED"?D("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=c){var l;let u=J(l=i.result).call(l,!0);i.isPrevNormal&&!u&&this.emit("exception",a0[t],t,n),!i.isPrevNormal&&u&&this.emit("exception",a0[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=u,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof gn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=Ur(n._encoderConfig.frameRate));let i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||J(n=D("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof gn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let a0={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Xn=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){let r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){let r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function JB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Wd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JB(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Gf{constructor(t){w(this,"store",void 0),w(this,"onStatsException",void 0),w(this,"onUploadPublishDuration",void 0),w(this,"onStatsChanged",void 0),w(this,"onVideoCodecChanged",void 0),w(this,"localStats",new Map),w(this,"remoteStats",new Map),w(this,"updateStatsInterval",void 0),w(this,"trafficStats",void 0),w(this,"trafficStatsPeerList",[]),w(this,"uplinkStats",void 0),w(this,"exceptionMonitor",void 0),w(this,"p2pChannel",void 0),w(this,"scalabilityMode",jE.L1T1),w(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Hce,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Z.LocalAudioTrack)||Wd({},lw)}getLocalVideoTrackStats(){return this.localStats.get(Z.LocalVideoTrack)||Wd({},uw)}getRemoteAudioTrackStats(t){let n=(c,l)=>{if(!this.trafficStats)return l;let u=this.trafficStats.peer_delay.find(h=>h.peer_uid===c);return u&&(l.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),l},r={};if(t){var i;let c=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;c&&(r[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{audioStats:u}]=c;u&&(r[l]=n(l,u))});return r}getRemoteNetworkQualityStats(t){let n={};if(t){var r;let i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[c,{networkStats:l}]=i;l&&(n[c]=l)});return n}getNetworkQuality(){let t=0,n=0;return this.trafficStats&&(t=mv(this.trafficStats.B_unq),n=mv(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:n}}getRemoteVideoTrackStats(t){let n=(c,l)=>{if(!this.trafficStats)return l;let u=this.trafficStats.peer_delay.find(h=>h.peer_uid===c);return u&&(l.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),l},r={};if(t){var i;let c=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;c&&(r[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[l,{videoStats:u}]=c;u&&(r[l]=n(l,u))});return r}getRTCStats(){let t=0,n=0,r=0,i=0,c=this.localStats.get(Z.LocalAudioTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);let l=this.localStats.get(Z.LocalVideoTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);let u=this.localStats.get(Z.LocalVideoLowTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:m,videoStats:E}=f;m&&(r+=m.receiveBytes,i+=m.receiveBitrate),E&&(r+=E.receiveBytes,i+=E.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;let i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),c=i!=null&&i.videoSSRC?Xn.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,l=i!=null&&i.audioSSRC?Xn.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,c>l?c:l),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&S.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;let i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,c=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!c}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case Z.LocalVideoTrack:case Z.LocalVideoLowTrack:{let u=i,h=Wd({},uw),f=t.getStats(),m=t.getLocalMedia(r);if(f){let E=f.videoSend.find(_=>_.ssrc===m?.ssrcs[0].ssrcId);if(E){let _=t.getLocalVideoSize(),y=t.getEncoderConfig(Z.LocalVideoTrack);var c;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(h.codecType=E.codec,u?.codecType!==E.codec&&((c=this.onVideoCodecChanged)===null||c===void 0||c.call(this,E.codec.toLocaleLowerCase()))),h.sendBytes=E.bytes,h.sendBitrate=u?8*Math.max(0,h.sendBytes-u.sendBytes):0,E.inputFrame?(h.captureFrameRate=E.inputFrame.frameRate,h.captureResolutionHeight=E.inputFrame.height,h.captureResolutionWidth=E.inputFrame.width):_&&(h.captureResolutionWidth=_.width,h.captureResolutionHeight=_.height),E.sentFrame?(h.sendFrameRate=E.sentFrame.frameRate,h.sendResolutionHeight=E.sentFrame.height,h.sendResolutionWidth=E.sentFrame.width):_&&(h.sendResolutionWidth=_.width,h.sendResolutionHeight=_.height),E.avgEncodeMs&&(h.encodeDelay=E.avgEncodeMs),y&&y.bitrateMax?h.targetSendBitrate=1e3*y.bitrateMax:E.targetBitrate&&(h.targetSendBitrate=E.targetBitrate),h.sendPackets=E.packets,h.sendPacketsLost=E.packetsLost,h.sendJitterMs=E.jitterMs,h.sendRttMs=E.rttMs,h.totalDuration=u?u.totalDuration+1:1,h.totalFreezeTime=u?u.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(h.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(S.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(r,h),(u?.sendResolutionWidth!==h.sendResolutionWidth||u?.sendResolutionHeight!==h.sendResolutionHeight)&&((l=this.onStatsChanged)===null||l===void 0||l.call(this,"resolution",{width:h.sendResolutionWidth,height:h.sendResolutionHeight})),h&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,h);break}case Z.LocalAudioTrack:{let u=i,h=Wd({},lw),f=t.getStats(),m=t.getLocalMedia(r);if(f){let E=f.audioSend.find(_=>_.ssrc===m?.ssrcs[0].ssrcId);if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(h.codecType=E.codec),E.inputLevel)h.sendVolumeLevel=Math.round(32767*E.inputLevel);else{let _=t.getLocalAudioVolume();_&&(h.sendVolumeLevel=Math.round(32767*_))}h.sendBytes=E.bytes,h.sendPackets=E.packets,h.sendPacketsLost=E.packetsLost,h.sendJitterMs=E.jitterMs,h.sendRttMs=E.rttMs,h.sendBitrate=u?8*Math.max(0,h.sendBytes-u.sendBytes):0}}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Z.LocalAudioTrack,h),h&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,h);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[c,{videoStats:l,audioStats:u,videoPcStats:h}]=n,f=u,m=l,E=h,_=Wd({},G2),y=Wd({},W2),A=Wd({},wae),{audioTrack:C,videoTrack:I,audioSSRC:N,videoSSRC:L}=t.getRemoteMedia(c),M;M=this.store.useP2P?t.getStats(!0):t.getStats();let V=(r=M)===null||r===void 0?void 0:r.audioRecv.find(K=>K.ssrc===N),j=(i=M)===null||i===void 0?void 0:i.videoRecv.find(K=>K.ssrc===L),U=this.trafficStats&&this.trafficStats.peer_delay.find(K=>K.peer_uid===c);if(V&&(V.codec!=="opus"&&V.codec!=="aac"&&V.codec!=="PCMU"&&V.codec!=="PCMA"&&V.codec!=="G722"||(_.codecType=V.codec),V.outputLevel?_.receiveLevel=Math.round(32767*V.outputLevel):C&&(_.receiveLevel=Math.round(32767*C.getVolumeLevel())),_.receiveBytes=V.bytes,_.receivePackets=V.packets,_.receivePacketsLost=V.packetsLost,_.receivePacketsDiscarded=V.packetsDiscarded,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=f?8*Math.max(0,_.receiveBytes-f.receiveBytes):0,_.totalDuration=f?f.totalDuration+1:1,_.totalFreezeTime=f?f.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=V.jitterBufferMs,_.totalDuration>10&&Gf.isRemoteAudioFreeze(C)&&(_.totalFreezeTime+=1)),j){var H;j.codec!=="H264"&&j.codec!=="H265"&&j.codec!=="VP8"&&j.codec!=="VP9"&&j.codec!=="AV1X"&&j.codec!=="AV1"||(y.codecType=j.codec),y.receiveBytes=j.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=j.decodeFrameRate<0?0:j.decodeFrameRate,y.renderFrameRate=j.decodeFrameRate<0?0:j.decodeFrameRate,j.outputFrame&&(y.renderFrameRate=j.outputFrame.frameRate),j.receivedFrame?(y.receiveFrameRate=j.receivedFrame.frameRate,y.receiveResolutionHeight=j.receivedFrame.height,y.receiveResolutionWidth=j.receivedFrame.width):I&&(y.receiveResolutionHeight=I._videoHeight||0,y.receiveResolutionWidth=I._videoWidth||0),j.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(j.framesRateFirefox)),y.receivePackets=j.packets,y.receivePacketsLost=j.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);let K=m?m.totalFreezeTime:0,Y=m?m.totalDuration:0;y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=(H=j.totalFreezesDuration)!==null&&H!==void 0?H:K||0,y.receiveDelay=j.jitterBufferMs||0;let ae=!!L&&t.getRemoteVideoIsReady(L);j.totalFreezesDuration===void 0&&I&&ae&&Gf.isRemoteVideoFreeze(I,j,E)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-K)/(y.totalDuration-Y),1))}U&&(_.end2EndDelay=U.B_ad,y.end2EndDelay=U.B_vd,_.transportDelay=U.B_ed,y.transportDelay=U.B_ed,_.currentPacketLossRate=U.B_ealr4/100,y.currentPacketLossRate=U.B_evlr4/100,A.uplinkNetworkQuality=U.B_punq?U.B_punq:0,A.downlinkNetworkQuality=U.B_pdnq?U.B_pdnq:0),this.remoteStats.set(c,{audioStats:_,videoStats:y,videoPcStats:j,networkStats:A}),C&&this.exceptionMonitor.setRemoteAudioStats(C,_),I&&this.exceptionMonitor.setRemoteVideoStats(I,y)})}}class ZB{constructor(){w(this,"destChannelMediaInfos",new Map),w(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){cB(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){cB(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){cv(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QB(e){if(!(e instanceof ZB))return new G(P.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new G(P.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new G(P.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class bc{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){w(this,"uid",void 0),w(this,"_uintid",void 0),w(this,"_trust_in_room_",!0),w(this,"_trust_audio_enabled_state_",!0),w(this,"_trust_video_enabled_state_",!0),w(this,"_trust_audio_mute_state_",!0),w(this,"_trust_video_mute_state_",!0),w(this,"_audio_muted_",!1),w(this,"_video_muted_",!1),w(this,"_audio_enabled_",!0),w(this,"_video_enabled_",!0),w(this,"_audio_added_",!1),w(this,"_video_added_",!1),w(this,"_is_pre_created",!1),w(this,"_video_pre_subscribed",!1),w(this,"_audio_pre_subscribed",!1),w(this,"_trust_video_stream_added_state_",!0),w(this,"_trust_audio_stream_added_state_",!0),w(this,"_audioTrack",void 0),w(this,"_videoTrack",void 0),w(this,"_dataChannels",[]),w(this,"_audioSSRC",void 0),w(this,"_videoSSRC",void 0),w(this,"_audioOrtc",void 0),w(this,"_videoOrtc",void 0),w(this,"_cname",void 0),w(this,"_rtxSsrcId",void 0),w(this,"_videoMid",void 0),w(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function eH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function c0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eH(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Gce=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),Iv="9",d0=2e4,bv=4e4,tH=class{get localCapabilities(){return Pt(this._localCapabilities)}get rtpCapabilities(){return Pt(this._rtpCapabilities)}get candidates(){return Pt(this._candidates)}get iceParameters(){return Pt(this._iceParameters)}get dtlsParameters(){return Pt(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_originCandidates",void 0),w(this,"_iceParameters",void 0),w(this,"_isUseExtmapAllowMixed",void 0),w(this,"_isUseLocalCodecs",void 0),w(this,"_isUseDataChannel",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),w(this,"useLocalCodecsMids",[]),w(this,"preloadSsrcs",[]),w(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,this._isUseDataChannel=r,e=Pt(e);let{iceParameters:i,dtlsParameters:c,candidates:l,rtpCapabilities:u,setup:h,localCapabilities:f,cname:m}=e;this._rtpCapabilities=u,this._candidates=l,this._originCandidates=Pt(l),this._iceParameters=i,this._dtlsParameters=c,this._localCapabilities=f,this.setup=h,this.cname=m,[this.sessionDesc]=this.updateRemoteRTPCapabilities(u),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var n;return J(n=this.preloadSsrcs).call(n,t)})}preloadRemoteMedia(e){let t=0,n=[],r=[];for(;e>0;){let i=[c0({ssrcId:bv+t},D("USE_SUB_RTX")?{rtx:bv+t+1}:{})],c="".concat(bv+t,"_").concat(d0+t),{ssrcs:l,ssrcGroups:u}=Ff(i,this.cname,D("SYNC_GROUP")?c:void 0),h=this.preCreateOrRecycleSendMedia("video",l,u,void 0),f=[{ssrcId:d0+t}],m="".concat(bv+t,"_").concat(d0+t),{ssrcs:E,ssrcGroups:_}=Ff(f,this.cname,D("SYNC_GROUP")?m:void 0),y=this.preCreateOrRecycleSendMedia("audio",E,_,void 0);e--,t+=2,n.push(h,y),r.push(l[0].ssrcId,E[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=r,{mids:n,preSSRCs:r,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,r){let i=this.rtpCapabilities.send.videoCodecs,c=this._isUseLocalCodecs||i.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;S.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);let l=e===de.VIDEO?c.videoCodecs:c.audioCodecs,u=e===de.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;let h="".concat(this.currentMidIndex),f={media:{mediaType:e,port:Iv,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};return f=this.mungSendMediaDesc(f,r),this.sessionDesc.mediaDescriptions.push(f),this.updateBundleMids(),h}toString(){return Sa(this.sessionDesc)}send(e,t,n,r){let{ssrcs:i,ssrcGroups:c}=Ff(t,this.cname,D("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(i);if(l){if(Nt()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){let u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{let u=this.findAvailableMediaIndex(e,i),h;return u===-1||u===1&&(An()||(function(){let f=Je();return!(f.name!==Qe.CHROME||!f.osVersion)&&Number(f.version)<=90})()||D("ENABLE_ENCODED_TRANSFORM")&&va())||u===0&&!(function(f){let m=Je();return!(m.name!==Qe.FIREFOX||!m.osVersion)&&Number(m.version)===f})(138)&&D("USE_SUB_RTX")||XF()?(h=this.createOrRecycleSendMedia(e,i,c,"sendonly",r),this.updateBundleMids()):(h=Pt(this.sessionDesc.mediaDescriptions[u]),h.attributes.direction="sendonly",h.attributes.ssrcs=i,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(h,r)),Nt()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,h.attributes.mid),{mid:h.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(i=>{let{kind:c,ssrcMsg:l,mslabel:u}=i;return this.send(c,l,u)}),n=[],r=!1;return t.forEach(i=>{let{mid:c,needExchangeSDP:l}=i;l&&(r=!0),n.push(c)}),{mids:n,needExchangeSDP:r}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||Nt()||XF()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>J(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>J(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,r){e.forEach((i,c)=>{this.createOrRecycleRecvMedia(i,[],"recvonly",t,n,r[c])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let t=this.sessionDesc||Tr((n=this._isUseExtmapAllowMixed,this._isUseDataChannel?Gce(n):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;let r=!1,i=this.rtpCapabilities.send,c=this.localCapabilities.send,l=this.localCapabilities.recv,u=l.videoCodecs,h=l.audioCodecs,f=l.videoExtensions,m=l.audioExtensions;for(let A of t.mediaDescriptions){var E;if(A.attributes.direction!=="sendonly"||typeof A.attributes.mid!="string"||!J(E=this.useLocalCodecsMids).call(E,A.attributes.mid)){if(r=!0,A.attributes.iceUfrag=this._iceParameters.iceUfrag,A.attributes.icePwd=this._iceParameters.icePwd,A.attributes.fingerprints=this._dtlsParameters.fingerprints,A.attributes.candidates=this._candidates,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video")if(this._isUseLocalCodecs&&A.attributes.direction==="sendonly"){var _;A.media.fmts=u.map(I=>I.payloadType.toString(10)),A.attributes.payloads=u,A.attributes.extmaps=f;let C=A.attributes.mid;typeof C!="string"||J(_=this.useLocalCodecsMids).call(_,C)||this.useLocalCodecsMids.push(C)}else if(i.videoCodecs.length===0){let C=c.videoCodecs.filter(I=>{var N,L;return(N=I.rtpMap)===null||N===void 0?void 0:J(L=N.encodingName.toLowerCase()).call(L,"vp8")});C.length===0&&C.push(c.videoCodecs[0]),A.media.fmts=C.map(I=>I.payloadType.toString(10)),A.attributes.payloads=C,A.attributes.extmaps=[]}else A.media.fmts=i.videoCodecs.map(C=>C.payloadType.toString(10)),A.attributes.payloads=i.videoCodecs,A.attributes.extmaps=i.videoExtensions;if(A.media.mediaType==="audio")if(this._isUseLocalCodecs&&A.attributes.direction==="sendonly"){var y;A.media.fmts=h.map(I=>I.payloadType.toString(10)),A.attributes.payloads=h,A.attributes.extmaps=m;let C=A.attributes.mid;typeof C!="string"||J(y=this.useLocalCodecsMids).call(y,C)||this.useLocalCodecsMids.push(C)}else if(i.audioCodecs.length===0){let C=c.audioCodecs.filter(I=>{var N,L;return(N=I.rtpMap)===null||N===void 0?void 0:J(L=N.encodingName.toLowerCase()).call(L,"opus")})||[c.audioCodecs[0]];A.media.fmts=C.map(I=>I.payloadType.toString(10)),A.attributes.payloads=C,A.attributes.extmaps=[]}else A.media.fmts=i.audioCodecs.map(C=>C.payloadType.toString(10)),A.attributes.payloads=i.audioCodecs,A.attributes.extmaps=i.audioExtensions,ah(A)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,r]}updateCandidates(e){let t=this._originCandidates.filter(r=>r.transport==="udp"),n=[];if(t.forEach(r=>{n.push(c0(c0({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),t.length!==0){switch(e){case On.TCP_RELAY:this._candidates=n;break;case On.UDP_TCP_RELAY:case On.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(let r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Pt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{let r=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(Nt()){if(r){let i=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(i||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!i||i!==n.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(let n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:Iv,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,c){let l=e._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,h=jf(l,u,this.localCapabilities.send,l===de.VIDEO?r:i),f=l===de.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;let m="".concat(this.currentMidIndex),E={media:{mediaType:l,port:Iv,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};E=this.mungRecvMediaDsec(E,e,c);let _=this.findFirstClosedMedia(l);if(_){let y=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[y]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateRemoteDtlsParameters(e){let t=new Set(this._dtlsParameters.fingerprints.map(i=>i.fingerprint)),n=new Set(e.map(i=>i.fingerprint)),r=!1;t.size!==n.size&&(r=!0);for(let i of t)n.has(i)||(r=!0);return r}updateRemoteCodec(e,t,n){let r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").filter(E=>{var _;return J(_=Object.keys(Pd)).call(_,E)}))],i=new Set(t);if(r.every(E=>i.has(E)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let c=this._rtpCapabilities.recv.videoCodecs.filter(E=>t.some(_=>{var y;return J(y=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").call(y,_)}));if(c.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;let l=[...new Set(c.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||""))],u;if(S.debug("updateRemoteCodec, from ".concat(r," to ").concat(l)),e.length===0)u=this.sessionDesc.mediaDescriptions.filter(E=>E.media.mediaType==="video"&&E.attributes.direction==="recvonly");else if(u=this.sessionDesc.mediaDescriptions.filter(E=>E.attributes.mid&&E.media.mediaType==="video"&&J(e).call(e,E.attributes.mid)&&E.attributes.direction==="recvonly"),u.length!==e.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(D("USE_PUB_RTX")||D("USE_SUB_RTX")){let E=Ic(c,this.rtpCapabilities.recv.videoCodecs);c.push(...E)}this._rtpCapabilities.recv.videoCodecs=c;let h=this.localCapabilities.send,f=this.rtpCapabilities.recv,m=jf(de.VIDEO,f,h,n);return u.forEach(E=>{let _=m.map(y=>y.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(E.attributes.mid,", from"),E.attributes.payloads,"to",m),E.attributes.payloads=m,E.media.fmts=_}),S.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,n,r,i){let c=this.rtpCapabilities.send.videoCodecs,l=this._isUseLocalCodecs||c.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,u=e===de.VIDEO?l.videoCodecs:l.audioCodecs,h=e===de.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;let f="".concat(this.currentMidIndex),m={media:{mediaType:e,port:Iv,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungSendMediaDesc(m,i);let E=this.findFirstClosedMedia(e);if(E){let _=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[_]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){let r=Pt(e);return Kw(r),Gd(r,t),Yw(r,t),DB(r),Ev(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=Pt(e);return n.attributes&&n.attributes.payloads&&Array.isArray(n.attributes.payloads)&&n.attributes.payloads.length>0&&n.attributes.payloads.forEach(r=>{r.rtpMap&&r.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&D("ENABLE_DOWN_SPS_PPS")&&(r.fmtp&&r.fmtp.parameters||(r.fmtp={parameters:{}}),r.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),Ev(n,t,this.localCapabilities.recv),ah(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Nt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function nH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nH(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var lh=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(lh||{});let wv=new Map;function rH(e,t,n,r){let{scale:i}=e;if(i===0&&r===lh.UP||i>=t.length-1&&r===lh.DOWN)return e;let c=Ra(Ra({},e),{},{scale:r===lh.DOWN?++i:--i});switch(n){case"maintain-framerate":c=Ra(Ra({},c),t[i].motion);break;case"maintain-resolution":c=Ra(Ra({},c),t[i].detail);break;case"balanced":c=Ra(Ra({},c),t[i].balanced)}return c}function iH(e,t){if(t){let n={overUse:0,underUse:0,adaptationList:oH(t)};wv.set(e,n)}else wv.delete(e)}function oH(e){let t=Ra({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:c}=t,{MIN_FRAME_RATE:l,MAX_THRESHOLD_FRAMERATE:u,MAX_SCALE:h,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:_,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:A,BALANCE_BITRATE_FACTOR:C,BALANCE_FRAMERATE_FACTOR:I,BALANCE_RESOLUTION_FACTOR:N,MOTION_RESOLUTION_FACTOR:L,MOTION_BITRATE_FACTOR:M,DETAIL_FRAMERATE_FACTOR:V,DETAIL_BITRATE_FACTOR:j}=nw,U=Math.min(t.frameRate,u),H=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(_,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(y,1)*U),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:c},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:c},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:c}}];for(let K=1;K<=h;K++){let Y={bwe_up:Math.round(Math.pow(E,K)*n),bwe_down:Math.round(Math.pow(_,K+1)*n),fps_up:Math.round(Math.pow(A,K)*U),fps_down:Math.round(Math.pow(y,K+1)*U)},ae={scaleResolutionDownBy:i/Math.pow(N,K),frameRate:Math.max(Math.round(Math.pow(I,K)*r),l),bitrateMax:Math.max(Math.round(Math.pow(C,K)*n),m),bitrateMin:Math.max(Math.round(Math.pow(C,K)*c),f)},Ce={scaleResolutionDownBy:i/Math.pow(L,K),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(M,K)*n),m),bitrateMin:Math.max(Math.round(Math.pow(M,K)*c),f)},Te={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(V,K)*r),l),bitrateMax:Math.max(Math.round(Math.pow(j,K)*n),m),bitrateMin:Math.max(Math.round(Math.pow(j,K)*c),f)};H.push({scale:K,threshold:Y,balanced:ae,motion:Ce,detail:Te})}return H}function Wce(e,t,n,r,i,c){let l=wv.get(e)||{overUse:0,underUse:0,adaptationList:oH(i)},{adaptationList:u}=l;wv.set(e,l);let{OVERUSE_TIMES_THRESHOLD:h,UNDERUSE_TIMES_THRESHOLD:f}=nw,{scale:m}=r,E,_;return typeof t=="number"&&t>0&&(function(y,A,C,I){if(A>=C.length)return!1;let{threshold:{fps_down:N}}=C[A];return D("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(N=C[0].threshold.fps_down),y<N})(t,m,u,c)&&(l.overUse++,_=Bu.CPU,l.overUse>h)||typeof n=="number"&&n>0&&(function(y,A,C){if(A>=C.length)return!1;let{threshold:{bwe_down:I}}=C[A];return y<I})(n,m,u)&&(l.overUse++,_=Bu.BANDWIDTH,l.overUse>h)?(l.overUse=0,l.underUse=0,E=rH(r,u,c,lh.DOWN),[E,_]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&(function(y,A,C,I){if(A===0)return;let{threshold:{fps_up:N}}=C[A];return D("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(N=C[1].threshold.fps_up),y>N})(t,m,u,c)&&(function(y,A,C){if(A===0)return;let{threshold:{bwe_up:I}}=C[A];return y>I})(n,m,u)&&(l.underUse++,l.underUse>f&&(l.overUse=0,l.underUse=0,E=rH(r,u,c,lh.UP),E.scale===0&&(_=Bu.NONE))),[E,_])}function sH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function l0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sH(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function aH(e){var t;return!!D("ENABLE_AG_ADAPTATION")&&!!(e instanceof JE||J(t=e._hints).call(t,ot.CUSTOM_TRACK))&&(!!D("FORCE_SUPPORT_AG_ADAPTATION")||!!(YF(14,0,!1)&&$F(17,4,!0)||KF(14)&&xb(17,4,!0)))}let Av=new Map;function cH(e,t,n,r,i,c){if(uh(e,n),i(t),r!=="balanced"&&r!=="maintain-framerate"&&r!=="maintain-resolution")return;let l=-1;iH(e,t);let u=window.setInterval(()=>{let f=Av.get(e);if(!D("ENABLE_AG_ADAPTATION")||!f)return uh(e,n),void i(t);let m=c();if(m.sendPackets>0&&m.OutgoingAvailableBandwidth>0){if(l===-1)return void(l=Date.now());if(Date.now()-l<1e3)return;let E=m.sendFrameRate,_=m.OutgoingAvailableBandwidth,[y,A]=Wce(e,E,_,f.adaptationConfig,t,r);A&&(n.qualityLimitationReason=A),y&&f.adaptationConfig.scale!==y.scale&&(S.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,`
           sendFps `).concat(E,", bwe ").concat(_,", switch from ").concat(f.adaptationConfig.scale," to ").concat(y.scale," ")),f.adaptationConfig=l0(l0({},f.adaptationConfig),y),i(y))}},D("CHECK_LOCAL_STATS_INTERVAL")),h=l0({},t);Av.set(e,{timer:u,adaptationConfig:h,originConfig:t,adaptationFunc:i}),S.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}function uh(e,t){let n=Av.get(e);if(n){let{timer:r}=n;window.clearTimeout(r),Av.delete(e)}t.qualityLimitationReason=Bu.NONE,iH(e)}function qce(e,t){var n;let r;switch(t){case Z.LocalAudioTrack:r=dt.Audio;break;case Z.LocalVideoTrack:r=J(n=e._hints).call(n,ot.SCREEN_TRACK)?dt.Screen:dt.High;break;case Z.LocalVideoLowTrack:r=dt.Low}return r}function u0(e){let t=Ve();if(e.some(n=>n._bypassWebAudio))throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function h0(e,t){u0(e);let n=t||new gn;return e.forEach(r=>n.addAudioTrack(r)),n}let zce=!Ve().supportUnifiedPlan||D("CHROME_FORCE_PLAN_B")&&Ns();function Wf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return n={spec:t,store:e},Qo("DataChannelConnection").create(n);var n;return zce?(function(i){return Qo("PlanBConnection").create(i)})({spec:t,store:e}):new wi(t,e)}function p0(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function f0(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Id(e.turnServer.servers))return!1;if(D("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Ye;function dH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dH(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let wi=(Ye=class eu extends hv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return J(n=Object.keys(Pd)).call(n,t)}))]}constructor(t,n){super(t,n),w(this,"id",at(5,"connection-")),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"forceTurn",!1),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"transportEventReceiver",void 0),w(this,"statsFilter",void 0),w(this,"extension",{useXR:D("USE_XR")}),w(this,"localCapabilities",void 0),w(this,"remoteCodecs",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"isPreallocation",!1),w(this,"isPreRender",!1),w(this,"preMediaMap",new Map),w(this,"dataStreamChannelMap",new Map),w(this,"establishPromise",void 0),w(this,"recoveredDataChannelIds",[]),w(this,"currentDataChannelId",1),w(this,"supportAV1RtpSpec",!1),w(this,"mutex",void 0),w(this,"qualityLimitationReason",Bu.NONE),w(this,"isFirstConnected",!1),this.store=n,this.forceTurn=f0(t),this.mutex=new Dn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(eu.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=BE(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,Nt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}updateRemoteRTPCapabilities(t,n){return O(this,null,function*(){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){let r=yield this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield this.peerConnection.setLocalDescription(r);let c=this.remoteSDP.toString();i?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")})}establish(){return O(this,null,function*(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let n=yield this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=Fs(n.sdp),i=yield Xw({filterRTX:!D("USE_PUB_RTX")&&!D("USE_SUB_RTX"),filterVideoFec:D("FILTER_VIDEO_FEC"),filterAudioFec:D("FILTER_AUDIO_FEC"),filterVideoCodec:D("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:D("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:D("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Vf(i),this.initialOffer=n,D("ENABLE_SVC")&&this.store.codec=="av1"){let l=yield OB();var t;l&&(this.supportAV1RtpSpec=!0,(t=i.send)===null||t===void 0||t.videoExtensions.push(l))}let c;return n.sdp&&vv(n.sdp)&&(c=Pt(i),TB(c)),ts(ts({},r),{},{rtpCapabilities:c||i,offerSDP:n.sdp})}catch(n){throw new z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}})}connect(t){return O(this,null,function*(){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&vv(this.initialOffer.sdp)&&CB(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new tH(ts(ts({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!D("ENABLE_PRE_SUB_WITH_PRE_PC")||!D("PRE_USE_LOCAL_CODECS"))&&Of(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let n=this.remoteSDP.toString(),r=Jw(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),yield this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i?.(n),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:n});let c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),Of(this.store))if(t.preallocation&&D("ENABLE_PRE_SUB_WITH_PRE_PC")){let l=D("PRE_SUB_NUM"),{mids:u,preSSRCs:h}=this.remoteSDP.preloadRemoteMedia(l);yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(h)),this.presetMedia(u,h)}else{let{preSSRCs:l=[]}=t,u=l.map(f=>f.ssrcMsg[0].ssrcId);if(l.length===0)return;let{mids:h}=this.remoteSDP.batchSend(l.map(f=>Object.assign({},f)));yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(h,u)}}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}})}presetMedia(t,n){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(c=>{if(c.mid!=null&&r===c.mid&&c.receiver.track){let l=c.receiver.track,u;l.kind==="video"&&D("ENABLE_PRE_RENDER")&&(u=new Ju({trackId:"track-".concat(l.kind,"-unknown-").concat(this.store.clientId,"_").concat(at(5,""))},!0),u.updateVideoTrack(l),u.onFirstVideoFrameRender=()=>{var h;let f=this.preMediaMap.get(n[i]);f&&(f.firstVideoRender=Date.now()),(h=this.onFirstVideoRender)===null||h===void 0||h.call(this,n[i])},u.onVideoBufferReady=()=>{var h;(h=this.onFirstVideoBufferReady)===null||h===void 0||h.call(this,n[i])},u.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(n[i],{mid:r,track:l,player:u,transceiver:c})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}updateRemoteConnect(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1,{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let l=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||l}let{preSSRCs:i=[]}=t,c=i.map(l=>l.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(c)){let l=[],u=[];if(Array.from(this.preMediaMap.entries()).every(h=>{let[f,{mid:m,player:E,track:_}]=h;return l.push(m),u.push(f),this.preMediaMap.delete(f),E&&E.destroy(),!0}),l.length>0&&(this.remoteSDP.stopSending(l),yield $r(this.peerConnection,this.remoteSDP,this.extension),S.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),ue.reportApiInvoke(this.store.sessionId,{name:Mt.PRELOAD_MEDIA_FAILED,options:[i,u],tag:St.TRACER}).onSuccess()),i.length>0){let{mids:h}=this.remoteSDP.batchSend(i.map(f=>Object.assign({},f)));yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(c)),this.presetMedia(h,c)}}n?(yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):S.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}})}send(t,n,r){var i=this;return Pr(function*(){let c=yield ke(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let l=[],u=xf();t.forEach(I=>{let N=i.peerConnection.addTransceiver(I._mediaStreamTrack,ts({direction:"sendonly"},I.trackMediaType==="video"&&i.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));l.push(N),I._updateRtpTransceiver(N)}),Nt()&&D("SIMULCAST")===!0&&(yield ke(i.applySimulcastForFirefox(l,t)));let h=yield ke(i.peerConnection.createOffer()),f=i.remoteSDP.predictReceivingMids(t.length),m=i.mungSendOfferSDP(h.sdp,t,f),E=Tr(m),_=f.map(I=>{let N=E.mediaDescriptions.find(L=>L.attributes.mid===I);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return zw(N,D("USE_PUB_RTX"))}),y;try{y=yield _}catch(I){y=[],i.remoteSDP.receive(t,n,r,y);let N=i.remoteSDP.toString();throw yield ke(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ke(i.peerConnection.setRemoteDescription({type:"answer",sdp:N})),yield ke(i.stopSending(f,!0)),I}i.remoteSDP.receive(t,n,r,y);let A=i.remoteSDP.toString(),C=i.logSDPExchange(m,"offer","local","send");return yield ke(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ke(i.applySimulcastEncodings(l,t)),yield ke(i.applySendEncodings(l,t)),C?.(A),yield ke(i.peerConnection.setRemoteDescription({type:"answer",sdp:A})),l.map((I,N)=>{let L=f[N];return{localSSRC:_[N],id:L,transceiver:I}})}catch(l){throw l instanceof z?l:new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}createDataChannels(t,n){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")S.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:D("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(c=>{c._updateOriginDataChannel(r)});let{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){let c=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:c});let l=yield this.peerConnection.createAnswer();yield this.peerConnection.setLocalDescription(l),S.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else S.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof z?r:new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}})}stopDataChannels(t){return O(this,null,function*(){try{let n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof z?n:new z(P.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}})}stopSending(t,n){return O(this,null,function*(){let r=n?void 0:yield this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(h=>{var f;uh(this.id+h.mid,this),h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});let c=yield this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");yield this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);let u=this.remoteSDP.toString();l?.(u),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}})}receive(t,n,r,i){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,n,r,i);l&&(yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}}catch(c){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}})}batchReceive(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{let c=this.peerConnection.getTransceivers().find(l=>l.mid===i);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:i,transceiver:c}})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}})}stopReceiving(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(c=>{Array.from(this.preMediaMap.entries()).some(l=>{let[u,{mid:h,player:f}]=l;if(h===c)return this.preMediaMap.delete(u),f&&f.destroy(),!0})}),this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=yield this.peerConnection.createAnswer();r?.(i.sdp||""),yield this.peerConnection.setLocalDescription(i)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}})}muteRemote(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=yield this.peerConnection.createAnswer();r?.(i.sdp||""),yield this.peerConnection.setLocalDescription(i)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}})}unmuteRemote(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=yield this.peerConnection.createAnswer();r?.(i.sdp||""),yield this.peerConnection.setLocalDescription(i)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}})}muteLocal(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});let r=yield this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let c=this.remoteSDP.toString();i?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}})}unmuteLocal(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((l,u)=>O(this,null,function*(){l.direction="sendonly"}));let r=yield this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let c=this.remoteSDP.toString();i?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}})}restartICE(t){var n=this;return Pr(function*(){let r=yield ke(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let i=Ve().supportPCSetConfiguration,c=D("FORCE_TURN_TCP")||n.forceTurn;if(t===On.RELAY&&!i)return;if(i&&!c){let E=t===On.RELAY?"relay":"all",_=n.peerConnection.getConfiguration();_.iceTransportPolicy!==E&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,n.peerConnection.setConfiguration(_))}n.remoteSDP.updateCandidates(t);let l=yield ke(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let u=Fs(l.sdp),{remoteIceParameters:h}=yield u.iceParameters;n.remoteSDP.restartICE(h);let f=n.remoteSDP.toString(),m=n.logSDPExchange(l.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ke(n.peerConnection.setLocalDescription(l)),m?.(f),yield ke(n.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(i){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}extendCandidate(){return O(this,null,function*(){if(!this.remoteSDP||this.isFirstConnected)return;let t=yield this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(On.TCP_RELAY),yield $r(this.peerConnection,this.remoteSDP,this.extension)}catch(n){S.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}})}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{uh(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:r}=n;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return ts(ts({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=yield this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);let c=this.remoteSDP.toString(),l=this.logSDPExchange(i,"offer","local","updateEncoderConfig");yield this.peerConnection.setLocalDescription({type:"offer",sdp:i}),l?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new z(P.EXCHANGE_SDP_FAILED,r.toString())}})}updateSendParameters(t,n){return O(this,null,function*(){let r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nt()||(yield this.applySimulcastEncodings(r,[n])):yield this.applySendEncodings(r,[n]))})}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){return O(this,null,function*(){let r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&(yield r.sender.replaceTrack(t._mediaStreamTrack))})}getSelectedCandidatePair(){return O(this,null,function*(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:ts(ts({},yo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:ts(ts({},yo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;let r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",c=Us(t.url||"");S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(c||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Id(t.turnServer.servers)?n.iceServers=t.turnServer.servers:D("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(D("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...eu.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...eu.newTurnServerConfigToIceServers(t.turnServer.servers)),D("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...eu.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...eu.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&Ve().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Io(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){let n=[];return t.forEach(r=>{let i=D("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Io(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Io(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){let n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in i?i.error:i)};let r=n.iceTransport;r&&(r.onstatechange=()=>{let i=n?.iceTransport.state;var c;i&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:i,remote:c}=r.getSelectedCandidatePair()||{};if(i&&c){let l=i.address+":"+i.port,u=c.address+":"+c.port;S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Us(l)),", remote ").concat(JSON.stringify(Us(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(t,n){return O(this,null,function*(){var r,i;if(n||(n=this.peerConnection.getSenders().find(I=>I.track===t._mediaStreamTrack)),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ve().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let c={},l={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}let u=yB(this.peerConnection,t._mediaStreamTrack),h=dV(t);if(aH(t)&&u&&n&&h&&this.getLocalVideoStats&&J(r=["vp8","vp9"]).call(r,this.store.codec)){var f;let C=c.degradationPreference||(J(f=t._hints).call(f,ot.CUSTOM_TRACK)?D("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");cH(this.id+u.mid,h,this,C,I=>{n&&this.updateAdaptation(n,I)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;let{bitrateMax:C,frameRate:I,scaleResolutionDownBy:N}=t._encoderConfig;C&&(l.maxBitrate=1e3*C),(J(m=t._hints).call(m,ot.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(I&&(l.maxFramerate=Ur(I)),N&&N>=1&&(l.scaleResolutionDownBy=N))}let{maxFramerate:E}=D("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(l.maxFramerate=l.maxFramerate?Math.min(l.maxFramerate,E):E),D("DSCP_TYPE")&&Ns()){var _;let C=D("DSCP_TYPE");J(_=["very-low","low","medium","high"]).call(_,C)&&(l.networkPriority=C)}let y=n.getParameters(),A=(i=y.encodings)===null||i===void 0?void 0:i[0];Nt()&&!A&&(c.encodings=[l]),A&&Object.assign(A,l),Object.assign(y,c),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),yield n.setParameters(y),yield LB(this.store.codec,n,D("SVC_MODE"))})}updateAdaptation(t,n){return O(this,null,function*(){var r,i;if(!t)return S.debug("[updateAdaptation] no rtpSender found");if(!Ve().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let c={},{bitrateMax:l,frameRate:u,scaleResolutionDownBy:h}=n;l&&(c.maxBitrate=1e3*l),u&&(c.maxFramerate=Ur(u)),h&&h>=1&&J(r=["vp8","vp9"]).call(r,this.store.codec)&&(c.scaleResolutionDownBy=h);let f=t.getParameters(),m=(i=f.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,c),Object.assign(f,{});try{yield t.setParameters(f),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):S.debug("[updateAdaptation] rtpSender transport not connected}")}})}applySendEncodings(t,n){return O(this,null,function*(){try{if(!Ve().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){let i=t[r],c=n[r];c instanceof Tt&&!this.isVP8Simulcast(c)&&(yield this.updateRtpSenderEncodings(c,i.sender))}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}})}mungSendOfferSDP(t,n,r){let i=Tr(t);return n.forEach((c,l)=>{let u=r[l],h=i.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(Gd(h,c),$w(h,c,this.store.codec))}),Sa(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(t,n){return O(this,null,function*(){if(t.length===n.length)for(let h=0;h<t.length;h++){var r,i,c,l,u;let f=t[h],m=n[h];if(m instanceof Tt&&!J(r=m._hints).call(r,ot.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},_={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];let y=f.sender.getParameters();yield f.sender.setParameters(Object.assign(y,E))}}})}applySimulcastEncodings(t,n){return O(this,null,function*(){if(!Nt()&&t.length===n.length)for(let r=0;r<t.length;r++){let i=n[r];if(i instanceof Tt&&this.isVP8Simulcast(i)){let c=t[r],l={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];let h=c.sender.getParameters();yield c.sender.setParameters(Object.assign(h,l))}}})}isVP8Simulcast(t){var n,r,i,c,l;return!!(t instanceof Tt&&D("SIMULCAST")&&this.store.codec==="vp8"&&!J(n=t._hints).call(n,ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(D("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",r==="local"?"remote":"local",i)}:void 0}getRemoteSSRC(t){return O(this,null,function*(){if(!this.remoteSDP)return;let n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0})}setConfiguration(t){if(Ve().supportPCSetConfiguration){let n=eu.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},oe(Ye.prototype,"updateRemoteRTPCapabilities",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"updateRemoteRTPCapabilities"),Ye.prototype),oe(Ye.prototype,"connect",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"connect"),Ye.prototype),oe(Ye.prototype,"updateRemoteConnect",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"updateRemoteConnect"),Ye.prototype),oe(Ye.prototype,"createDataChannels",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"createDataChannels"),Ye.prototype),oe(Ye.prototype,"receive",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"receive"),Ye.prototype),oe(Ye.prototype,"batchReceive",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"batchReceive"),Ye.prototype),oe(Ye.prototype,"stopReceiving",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"stopReceiving"),Ye.prototype),oe(Ye.prototype,"muteRemote",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"muteRemote"),Ye.prototype),oe(Ye.prototype,"unmuteRemote",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"unmuteRemote"),Ye.prototype),oe(Ye.prototype,"muteLocal",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"muteLocal"),Ye.prototype),oe(Ye.prototype,"unmuteLocal",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"unmuteLocal"),Ye.prototype),oe(Ye.prototype,"close",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"close"),Ye.prototype),oe(Ye.prototype,"updateEncoderConfig",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"updateEncoderConfig"),Ye.prototype),oe(Ye.prototype,"updateSendParameters",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"updateSendParameters"),Ye.prototype),oe(Ye.prototype,"replaceTrack",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"replaceTrack"),Ye.prototype),oe(Ye.prototype,"updateAdaptation",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"updateAdaptation"),Ye.prototype),oe(Ye.prototype,"getRemoteSSRC",[Fr],Object.getOwnPropertyDescriptor(Ye.prototype,"getRemoteSSRC"),Ye.prototype),Ye);function Fr(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return O(this,arguments,function*(){let i=this.mutex,c=yield i.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return yield r.apply(this,u)}finally{c()}})},n}function m0(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Ur(t.width),r.height=Ur(t.height);let i=Ur(t.framerate||15);document.body.append(n),document.body.append(r);let c=e._mediaStreamTrack;n.srcObject=new MediaStream([c]),n.play().catch(bf);let l=r.getContext("2d");if(!l)throw new G(P.UNEXPECTED_ERROR,"can not get canvas context");let u=Ve(),h=r.captureStream(u.supportRequestFrame?0:i).getVideoTracks()[0];h.canvas||(h.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){let m=n.videoWidth,E=n.videoHeight/m,_=r.width*E;Math.abs(_-r.height)>=2&&(S.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(_)),r.height=_)}l.drawImage(n,0,0,r.width,r.height),h.requestFrame&&h.requestFrame(),c!==e._mediaStreamTrack&&(c=e._mediaStreamTrack,n.srcObject=new MediaStream([c]))},r.stopCapture=mw(()=>r.startCapture&&r.startCapture(),i);let f=h.stop;return h.stop=()=>{f.call(h),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),S.debug("clean low stream renderer")},h}var lH=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(lH||{}),ns=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(ns||{}),Ae=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(Ae||{}),In=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e})(In||{}),Vn=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(Vn||{}),hh=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e})(hh||{}),g0=(function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e})(g0||{});let qd=1e3,Dv=6,qf=3,Kce=Math.max(Dv,qf,60);function ye(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function uH(e){let t={[Vn.CONN_TYPE]:0,[Vn.RTT]:e.rtt,[Vn.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Vn.CONN_TYPE]=1),n==="tcp"&&(t[Vn.CONN_TYPE]=3),n==="tls"&&(t[Vn.CONN_TYPE]=4);break}case"srflx":t[Vn.CONN_TYPE]=2;break;case"unknown":t[Vn.CONN_TYPE]=5;break;default:t[Vn.CONN_TYPE]=0}return t}function hH(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class pH extends jt{constructor(t){super(),w(this,"store",void 0),w(this,"uploadWRTCStatsTimer",void 0),w(this,"uploadOutboundDenoiserStatsTimer",void 0),w(this,"uploadExtStatsTimer",void 0),w(this,"uploadExtUsageStatsTimer",void 0),w(this,"uploadInboundExtStatsTimer",void 0),w(this,"requestStats",void 0),w(this,"requestTransportStats",void 0),w(this,"requestLocalMedia",void 0),w(this,"requestRemoteMedia",void 0),w(this,"requestAllTracks",void 0),w(this,"requestVideoIsReady",void 0),w(this,"requestUploadStats",void 0),w(this,"requestUpload",void 0),w(this,"uploadOutboundStarted",!1),w(this,"uploadInboundStarted",!1),w(this,"uploadTransportStarted",!1),w(this,"uploadBaseStatsStarted",!1),w(this,"uploadExtensionUsageStarted",!1),w(this,"lastRecvStats",void 0),w(this,"lastSendStats",void 0),w(this,"lastRefRecvStats",void 0),w(this,"lastRefSendStats",void 0),w(this,"lastNormalRecvStats",void 0),w(this,"lastNormalSendStats",void 0),w(this,"lastExtendStats",{}),w(this,"needUploadStats",{}),w(this,"needUploadRenderFreezeTime",!0),w(this,"lastUploadCompensateTime",-1),w(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let n=t%qf==0,r=t%Dv==0,i=t%60==0,c,l;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(l=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!l&&this.uploadInboundStarted&&(l=this.requestStats(!0)),c||l){var u;let h={};if(this.uploadTransportStarted&&c){let m=this.getTransportStats(c,n?this.lastRefSendStats:void 0,l,n);m&&(h.misc=[m])}if(this.uploadOutboundStarted&&c){let m=this.getOutboundStats(c,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,i);m&&(h.outbound=[m])}if(this.uploadInboundStarted&&l){this.uploadCompensateStats(t);let m=this.getInboundStats(l,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);m&&(h.inbound=m)}let f=(u=this.requestTransportStats)===null||u===void 0?void 0:u.call(this).connectState;if(f&&(Array.isArray(h.misc)?h.misc[0]&&h.misc[0].addition&&(h.misc[0].addition[hh.RTC_PEER_CONNECTION_STATE]=Qb[f]):h.misc=[{addition:{[hh.RTC_PEER_CONNECTION_STATE]:Qb[f]}}]),ui.needUploadStats.length>0||r){let m=ui.needUploadStats.shift()||(ui.visibility==="visible"?1:0);Array.isArray(h.misc)?h.misc[0]&&h.misc[0].addition&&(h.misc[0].addition[hh.PAGE_VISIBILITY]=m):h.misc=[{addition:{[hh.PAGE_VISIBILITY]:m}}]}this.needUploadStats.sendType&&(Array.isArray(h.outbound)&&h.outbound[0]&&h.outbound[0].high&&(h.outbound[0].high[lH.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(h)}this.lastRecvStats=l,this.lastSendStats=c,r&&(this.lastNormalRecvStats=l,this.lastNormalSendStats=c),n&&(this.lastRefRecvStats=l,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,ui.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;let i=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[hh.RTC_PEER_CONNECTION_STATE]:Qb[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Kce+1&&(t=1)},qd)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let n=t%qf==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;let c=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let l={};if(this.uploadInboundStarted&&c){let u=this.requestRemoteMedia()||[],h=[];u.forEach(f=>{let[m,E]=f,_={peer:m.uid};if(m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)&&E.has(de.VIDEO)&&m.videoTrack){let y=(function(A,C,I){if(!C.videoRecv.find(L=>L.ssrc===A))return;let N={};if(I&&I._player){let L=I._player,{renderFreezeAccTime2:M,videoElementStatus:V}=L;if(ui.visibility==="visible"&&V===Yn.PLAYING&&Ve().supportRequestVideoFrameCallback){let j=Math.min(6e3,M);L.renderFreezeAccTime2=Math.max(0,M-j),ye(N,ns.Video_Render_Freeze_Time_Render2,j),D("USE_NEW_RENDER_FREEZE_TIME")&&ye(N,ns.Video_Render_Freeze_Time_Render,j)}}return N})(m._videoSSRC,c,m.videoTrack);y&&(_.video=y)}_.video&&h.push(_)}),h.length>0&&(l.inbound=h,this.requestUploadStats(l))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[Vn.RTT]:t.rtt,[Vn.CONN_TYPE]:void 0,[Vn.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let c=uH(t);if(this.store.useP2P){if(r){let l=uH(r);c[Vn.CONN_TYPE]&&l[Vn.CONN_TYPE]&&(c[Vn.CONN_TYPE]+=l[Vn.CONN_TYPE]<<3)}c[Vn.CONN_TYPE]?c[Vn.CONN_TYPE]+=110:c[Vn.CONN_TYPE]=110}else{c[Vn.CONN_TYPE]?c[Vn.CONN_TYPE]+=100:c[Vn.CONN_TYPE]=100;let l=(function(u,h){return h?[Math.ceil(8*(u.transport.bytesSent-h.transport.bytesSent)/(u.timestamp-h.timestamp)),Math.ceil(8*(u.transport.bytesReceived-h.transport.bytesReceived)/(u.timestamp-h.timestamp))]:[0,0]})(t,n);c[g0.Transport_Send_Bitrate]=l[0],c[g0.Transport_Recv_Bitrate]=l[1]}return{addition:c}}getOutboundStats(t,n,r,i,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;let l=this.requestLocalMedia();if(!l||l.length===0)return;let u,h,f;return l.forEach(m=>{let[E,{track:_,ssrcs:y}]=m;switch(E){case Z.LocalVideoLowTrack:case Z.LocalVideoTrack:if(E===Z.LocalVideoTrack){var A;let C=(function(M,V,j,U,H,K){let Y=V.videoSend.find(Le=>Le.ssrc===M);if(!Y)return;let ae={},{sentFrame:Ce,inputFrame:Te}=Y;if(U&&(ye(ae,ns.Video_Send_Qp_Sum,Y.qpSumPerFrame),Te&&Ce)){let Le=Te.frameRate,De=Ce.frameRate;ae[ns.Video_Send_Freeze]=(function(tt,Ut){let $=!0;return $=!(tt<=5)&&(tt<=10?Ut<3:tt<=20?Ut<4:Ut<5),$})(Le,De)?1:0}if(H){switch(Ce&&(ye(ae,Ae.Video_Send_Height,Ce.height),ye(ae,Ae.Video_Send_Width,Ce.width),ye(ae,Ae.Video_Send_Frame_Rate,Ce.frameRate)),ae[Ae.Video_Send_Disabled]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0,Y.adaptionChangeReason){case"none":ae[Ae.Video_Send_Adaptation]=0;break;case"cpu":ae[Ae.Video_Send_Adaptation]=1;break;case"bandwidth":ae[Ae.Video_Send_Adaptation]=2;break;case"other":ae[Ae.Video_Send_Adaptation]=3}let Le=0;Y.adaptionChangeReason&&(Le+=hH(Y.adaptionChangeReason)),V.qualityLimitationReason&&(Le+=hH(V.qualityLimitationReason)<<3),ae[Ae.Video_Send_Adaptation]=Le,ae[Ae.Video_Send_Player_Status]=hw[j._player?j._player.videoElementStatus:"uninit"],ye(ae,Ae.Video_Send_Nacks,Y.nacksCount),ye(ae,Ae.Video_Send_Plis,Y.plisCount),ye(ae,Ae.Video_Send_Firs,Y.firsCount),ye(ae,Ae.Video_Send_Avg_Encode,Y.avgEncodeMs),ye(ae,Ae.Video_Send_Huge_Frame_Sent,Y.hugeFramesSent),ye(ae,Ae.Video_Send_Bytes_Retransmit,Y.retransmittedBytesSent),ye(ae,Ae.Video_Send_Packages_Retransmit,Y.retransmittedPacketsSent),ye(ae,Ae.Video_Send_Key_Frames_Encoded,Y.keyFramesEncoded);let De=H.videoSend.find(tt=>tt.ssrc===M);if(De){let tt=qd*qf;De.timestamp&&Y.timestamp&&(tt=Y.timestamp-De.timestamp),De.packets!=null&&Y.packets!=null&&ye(ae,Ae.Video_Send_Package_Rate,1e3*(Y.packets-De.packets)/tt),Y.packetsLost!=null&&De.packetsLost!=null&&ye(ae,Ae.Video_Send_Package_Lost,Y.packetsLost-De.packetsLost),De.bytes!=null&&Y.bytes!=null&&ye(ae,Ae.Video_Send_Bitrate,8*(Y.bytes-De.bytes)/tt)}}return ae})(y[0].ssrcId,t,_,n,r),I=_.__className__==="CameraVideoTrack"?3:J(A=_._hints).call(A,ot.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==I||c)&&(this.needUploadStats={sendType:I},this.lastExtendStats.sendType=I);let N=_&&(function(M,V,j,U){let H=V.videoSend.find(Y=>Y.ssrc===M);if(!H)return null;let K={};if(U){let Y=H.inputFrame,ae=Y&&Y.height||j.videoHeight||0,Ce=Y&&Y.width||j.videoWidth||0,Te=Y&&Y.frameRate||0;ye(K,Ae.Video_Capture_Height,ae),ye(K,Ae.Video_Capture_Width,Ce),ye(K,Ae.Video_Capture_Frame_Rate,Te)}return K})(y[0].ssrcId,t,_,!!r),L=(function(M,V){let j={};return V&&(ye(j,Ae.Video_Send_Retransmit,M.bitrate.retransmit),ye(j,Ae.Video_Send_Target_Encoded,M.bitrate.targetEncoded),ye(j,Ae.Video_Send_Actual_Encoded,M.bitrate.actualEncoded),ye(j,Ae.Video_Send_Transmit,M.bitrate.transmit),ye(j,Ae.Video_Send_Bandwidth,M.sendBandwidth)),j})(t,!!r);h=Object.assign({},C,N,L)}else f=(function(C,I,N,L,M){let V=I.videoSend.find(U=>U.ssrc===C);if(!V)return;let j={};if(L){let U=V.sentFrame;U&&(ye(j,Ae.Video_Send_Low_Height,U.height),ye(j,Ae.Video_Send_Low_Width,U.width),ye(j,Ae.Video_Send_Low_Frame_Rate,U.frameRate));let H=L.videoSend.find(K=>K.ssrc===C);if(H){let K=qd*Dv;H.timestamp&&V.timestamp&&(K=V.timestamp-H.timestamp),H.packets!=null&&V.packets!=null&&ye(j,Ae.Video_Send_Low_Package_Rate,1e3*(V.packets-H.packets)/K),V.packetsLost!=null&&H.packetsLost!=null&&ye(j,Ae.Video_Send_Low_Package_Lost,V.packetsLost-H.packetsLost),H.bytes!=null&&V.bytes!=null&&ye(j,Ae.Video_Send_Low_Bitrate,8*(V.bytes-H.bytes)/K)}}return j})(y[0].ssrcId,t,0,r);break;case Z.LocalAudioTrack:u=_&&(function(C,I,N,L,M,V){let j=I.audioSend.find(H=>H.ssrc===C);if(!j)return;let U={};if(M){U[Ae.Audio_Send_Disabled]=N._originMediaStreamTrack&&!N._originMediaStreamTrack.enabled||N._mediaStreamTrack&&!N._mediaStreamTrack.enabled?1:0;let H=100*N._source.getAccurateVolumeLevel(),K=j.inputLevel;if(K!=null){let ae=Math.ceil(50*Math.log10(100*K+1));ye(U,Ae.Audio_Send_Level,ae)}ye(U,Ae.Audio_Capture_PCM_Level,H),ye(U,Ae.Audio_Send_AEC_Return_Loss,j.aecReturnLoss),ye(U,Ae.Audio_Send_AEC_Return_Loss_Enhancement,j.aecReturnLossEnhancement),ye(U,Ae.Audio_Send_Bytes_Retransmit,j.retransmittedBytesSent),ye(U,Ae.Audio_Send_Packages_Retransmit,j.retransmittedPacketsSent),U[Ae.Audio_Send_Freeze]=0;let Y=M.audioSend.find(ae=>ae.ssrc===C);if(Y){let ae=qd*Dv;Y.timestamp&&j.timestamp&&(ae=j.timestamp-Y.timestamp),Y.bytes!=null&&j.bytes!=null&&ye(U,Ae.Audio_Send_Bitrate,8*(j.bytes-Y.bytes)/ae),Y.packets!=null&&j.packets!=null&&ye(U,Ae.Audio_Send_Package_Rate,1e3*(j.packets-Y.packets)/ae)}}return U})(y[0].ssrcId,t,_,0,r)}}),{high:h,low:f,audio:u}}getInboundStats(t,n,r,i){if(!this.requestRemoteMedia)return;let c=this.requestRemoteMedia()||[],l=[];return c.forEach(u=>{let[h,f]=u,m={peer:h.uid},E;if(f.has(de.VIDEO)&&h.videoTrack){let _=h._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(h._videoSSRC)||!1,y=h.videoTrack?(function(A,C,I,N,L,M,V,j){let U=C.videoRecv.find(De=>De.ssrc===A);if(!U)return;let H={},{receivedFrame:K,outputFrame:Y,decodeFrameRate:ae}=U;ye(H,In.Video_Render_Frame_Rate_Decode,ae),U.framesRateFirefox&&ye(H,In.Video_Recv_Frame_Rate,U.framesRateFirefox),K&&ye(H,In.Video_Recv_Frame_Rate,K.frameRate),ye(H,In.Video_Recv_Frame_Dropped,U.framesDroppedCount),ye(H,In.Video_Recv_Bytes_Retransmit,U.retransmittedBytesReceived),ye(H,In.Video_Recv_Packages_Retransmit,U.retransmittedPacketsReceived),ye(H,In.Video_Recv_Packages_Discarded,U.packetsDiscarded),ye(H,In.Video_Recv_Avg_Decode,U.avgDecodeMs),ye(H,In.Video_Recv_Avg_Processing_Delay,U.avgProcessingDelayMs),ye(H,In.Video_Recv_Avg_Assembly_Time,U.avgFramesAssembledFromMultiplePacketsMs),ye(H,In.Video_Recv_Avg_Inter_Frame_Delay,U.avgInterFrameDelayMs),ye(H,In.Video_Recv_Key_Frames_Decoded,U.keyFramesDecoded);let Ce=j&&j.videoRecv.find(De=>De.ssrc===A);if(Ce){let De=C.timestamp-j.timestamp||qd;U.packetsLost!=null&&Ce.packetsLost!=null&&ye(H,In.Video_Recv_Package_Lost,U.packetsLost-Ce.packetsLost),Ce.bytes!=null&&U.bytes!=null&&ye(H,In.Video_Recv_Bitrate,8*(U.bytes-Ce.bytes)/De),Ce.packets!=null&&U.packets!=null&&ye(H,In.Video_Recv_Package_Rate,1e3*(U.packets-Ce.packets)/De)}let Te=M&&M.videoRecv.find(De=>De.ssrc===A);if(Te&&(ye(H,ns.Video_Recv_Qp_Sum,U.qpSumPerFrame),H[ns.Video_Recv_Freeze]=N&&Gf.isRemoteVideoFreeze(I,U,Te)?1:0),V){var Le;let De=V.videoRecv.find(Ut=>Ut.ssrc===A);K?(ye(H,Ae.Video_Recv_Height,K.height),ye(H,Ae.Video_Recv_Width,K.width)):I&&(ye(H,Ae.Video_Recv_Height,I._videoHeight||0),ye(H,Ae.Video_Recv_Width,I._videoWidth||0)),Y&&ye(H,Ae.Video_Recv_Frame_Rate_Output,Y.frameRate);let tt=(Le=I._player)===null||Le===void 0?void 0:Le.rendFrameRate.toFixed(0);if(tt&&ye(H,Ae.Video_Render_Frame_Rate_Render,+tt),ye(H,Ae.Video_Recv_Jitter_Buffer,U.jitterBufferMs),ye(H,Ae.Video_Recv_Current_Delay,U.currentDelayMs),ye(H,Ae.Video_Recv_Firs,U.firsCount),ye(H,Ae.Video_Recv_Nacks,U.nacksCount),ye(H,Ae.Video_Recv_Plis,U.plisCount),I){H[Ae.Video_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1;let Ut=I._player;if(Ut){let{freezeTimeCounterList:$,renderFreezeAccTime:ne,renderFreezeAccTime2:le,videoElementStatus:X}=Ut;if($&&$.length>0&&ye(H,ns.Video_Render_Freeze_Time,$.splice(0,1)[0]),L&&ui.visibility==="visible"&&X===Yn.PLAYING&&Ve().supportRequestVideoFrameCallback){let R=Math.min(6e3,le);Ut.renderFreezeAccTime2=Math.max(0,le-R),ye(H,ns.Video_Render_Freeze_Time_Render2,R);let k=Math.min(6e3,ne);Ut.renderFreezeAccTime=Math.max(0,ne-k),ye(H,ns.Video_Render_Freeze_Time_Render,D("USE_NEW_RENDER_FREEZE_TIME")?R:k)}if(typeof U.totalFreezesDuration=="number"){let R=De&&De.totalFreezesDuration?U.totalFreezesDuration-De.totalFreezesDuration:U.totalFreezesDuration;ye(H,Ae.Video_Render_Freeze_Duration,1e3*R)}}}if(H[Ae.Video_Recv_Player_Status]=hw[I._player?I._player.videoElementStatus:"uninit"],De&&U.totalInterFrameDelay!==void 0&&U.totalSquaredInterFrameDelay!==void 0&&De.totalInterFrameDelay!==void 0&&De.totalSquaredInterFrameDelay!==void 0){let Ut=U.totalInterFrameDelay-De.totalInterFrameDelay,$=U.totalSquaredInterFrameDelay-De.totalSquaredInterFrameDelay,ne=U.framesDecodeCount-De.framesDecodeCount,le=Ut/ne*1e3,X=Math.round(1e3*Math.sqrt(($-Math.pow(Ut,2)/ne)/ne));!isNaN(X)&&le+X>Math.max(3*le,le+150)&&(H[Ae.Video_Recv_I_Frame_Delay]=X)}}return H})(h._videoSSRC,t,h.videoTrack,_===!0,this.needUploadRenderFreezeTime,n,r,i):void 0;if(y&&(m.video=y),h.videoTrack){let A=t.videoRecv.find(C=>C.ssrc===h._videoSSRC);A&&A.estimatedPlayoutTimestamp&&(E=A.estimatedPlayoutTimestamp)}}if(f.has(de.AUDIO)&&h.audioTrack){let _=h.audioTrack?(function(y,A,C,I,N,L){let M=A.audioRecv.find(H=>H.ssrc===y);if(!M)return;let V={};ye(V,In.Audio_Recv_Jitter,M.jitterMs),ye(V,In.Audio_Recv_Bytes_Retransmit,M.retransmittedBytesReceived),ye(V,In.Audio_Recv_Packages_Retransmit,M.retransmittedPacketsReceived),ye(V,In.Audio_Recv_Packages_Discarded,M.packetsDiscarded),ye(V,In.Audio_Recv_Avg_Processing_Delay,M.avgProcessingDelayMs);let j=L&&L.audioRecv.find(H=>H.ssrc===y);if(j){let H=qd;M.packets!=null&&j.packets!=null&&ye(V,In.Audio_Recv_Package_Rate,1e3*(M.packets-j.packets)/H),M.packetsLost!=null&&j.packetsLost!=null&&ye(V,In.Audio_Recv_Package_Lost,M.packetsLost-j.packetsLost)}if(I){let{receivedFrames:H,droppedFrames:K}=M;H!=null&&K!=null&&(V[ns.Audio_Recv_Freeze]=(U=H)===0||100*K/U>20?1:0)}var U;if(N){let H=100*C._source.getAccurateVolumeLevel(),K=M.outputLevel;if(K!=null){let ae=Math.ceil(50*Math.log10(100*K+1));ye(V,Ae.Audio_Render_Level,ae)}ye(V,Ae.Audio_Recv_PCM_Level,H),C&&(V[Ae.Audio_Recv_Disabled]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1),ye(V,Ae.Audio_Recv_Jitter_Buffer,M.jitterBufferMs),ye(V,Ae.Audio_Recv_Current_Delay,M.jitterBufferMs),V[Ae.Audio_Recv_Player_Status]=hw[cr.getPlayerState(C.getTrackId())];let Y=N.audioRecv.find(ae=>ae.ssrc===y);if(Y){Y.bytes!=null&&M.bytes!=null&&ye(V,Ae.Audio_Recv_Bitrate,8*(M.bytes-Y.bytes)/(qd*qf));let ae=M.concealedSamples-Y.concealedSamples;ae>0&&ye(V,Ae.Audio_Recv_Concealed_Samples,ae);let Ce=M.totalSamplesReceived-Y.totalSamplesReceived;Ce>0&&ye(V,Ae.Audio_Recv_Total_Samples_Received,Ce);let Te=M.freezeSamples80-Y.freezeSamples80;Te>0&&ye(V,Ae.Audio_Render_Freeze_Samples_80ms,Te);let Le=M.freezeSamples200-Y.freezeSamples200;Le>0&&ye(V,Ae.Audio_Render_Freeze_Samples_200ms,Le);let De=M.freezeMs80-Y.freezeMs80;ye(V,Ae.Audio_Render_Freeze_Time_80ms,De<0?0:De);let tt=M.freezeMs200-Y.freezeMs200;ye(V,Ae.Audio_Render_Freeze_Time_200ms,tt<0?0:tt)}}return V})(h._audioSSRC,t,h.audioTrack,n,r,i):void 0;if(_&&(m.audio=_),h.audioTrack&&E){let y=t.audioRecv.find(A=>A.ssrc===h._audioSSRC);if(y&&y.estimatedPlayoutTimestamp){let A=y.estimatedPlayoutTimestamp-E;m.audio?m.audio[In.Audio_Recv_AV_Sync_TIME]=A:m.audio={[In.Audio_Recv_AV_Sync_TIME]:A}}}}(m.video||m.audio)&&l.push(m)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(n=>n instanceof Pf);if(t&&t._external.getDenoiserStats){let n=t._external.getDenoiserStats();n&&this.requestUpload(Bd.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(de.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(de.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(()=>O(this,null,function*(){let n=Date.now(),r={connectionInterval:D("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n},i=[],c=this.requestAllTracks&&this.requestAllTracks()||[];for(let f of c)!f.muted&&f.enabled&&(i=i.concat(yield f.getProcessorUsage()));let l=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[f,m]of l)m.has(de.VIDEO)&&f.videoTrack&&(i=i.concat(yield f.videoTrack.getProcessorUsage())),m.has(de.AUDIO)&&f.audioTrack&&(i=i.concat(yield f.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=(function(f,m){let E={};for(let{id:C,value:I,level:N,direction:L}of f){var _;let M=(_=m.get(C))!==null&&_!==void 0?_:0,V=I===2?M+D("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:M;var y,A;m.set(C,V),E[C]?(I===2&&(E[C].value=I),N>E[C].level&&(E[C].level=N),L==="remote"&&(E[C].remoteUidCount+=1),E[C].totalTs=(y=m.get(C))!==null&&y!==void 0?y:0):E[C]={value:I,level:N,remoteUidCount:L==="local"?0:1,totalTs:(A=m.get(C))!==null&&A!==void 0?A:0}}return Object.keys(E).map(C=>{let{level:I,value:N,totalTs:L}=E[C];return{id:C,level:I,value:N,totalTs:L}})})(i,t);let u=Date.now(),h=u>n?u:n+1;this.requestUpload&&this.requestUpload(Bd.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:h})}),D("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,ui.stopCollectStats()}}let Yce=D("ICE_RESTART_INTERVAL"),Ov=new Map,ph=new Map,wc=[On.UDP_TCP_RELAY,On.TCP_RELAY,On.RELAY],_0=D("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ve().supportPCSetConfiguration;function fH(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=Ov.get(e.id);n&&(window.clearTimeout(n),Ov.delete(e.id));let r=ph.get(e.id);t&&r&&r.index===wc.length-1&&(S.debug("[".concat(e.id,"] reset ICE restart policy")),ph.delete(e.id))}function mH(e,t,n){if(Ov.size===0&&ph.size===0&&(Array.isArray(D("RESTART_SEQUENCE"))&&D("RESTART_SEQUENCE").length>0&&!(function(u,h){if(u.length!==h.length)return!1;for(let f=0;f<u.length;f+=1){let m=u[f];if(u.filter(E=>E===m).length!==h.filter(E=>E===m).length)return!1}return!0})(wc,D("RESTART_SEQUENCE"))&&(wc=D("RESTART_SEQUENCE").filter(u=>{var h;if(J(h=Object.values(On)).call(h,u))return!0}),S.debug("use reconnection policy from config distribution, queues: ".concat(wc.join(" => ")))),_0=D("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ve().supportPCSetConfiguration),wc.length===0)return void n();let r,{index:i=0,type:c}=ph.get(e.id)||{};if(_0&&c===On.RELAY)return void n();let l=c&&i>=wc.length-1;if(_0)c=On.RELAY;else{if(l)return void n();c?(i++,c=wc[i]):(c=wc[0],i=0)}S.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(c,", index: ").concat(i)),t(c),ph.set(e.id,{index:i,type:c}),r=window.setTimeout(()=>mH(e,t,n),Yce),Ov.set(e.id,r)}var Be;function gH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Bs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gH(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function _H(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=RE,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new Nv(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Nv(e){function t(n){if(Object(n)!==n)return ie.reject(new TypeError(n+" is not an object."));var r=n.done;return ie.resolve(n.value).then(function(i){return{value:i,done:r}})}return Nv=function(n){this.s=n,this.n=n.next},Nv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ie.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ie.reject(n):t(r.apply(this.s,arguments))}},new Nv(e)}let zd=(Be=class extends jt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(me.StateChange,t,this._state)}constructor(e,t){super(),w(this,"isPlanB",void 0),w(this,"store",void 0),w(this,"statsUploader",void 0),w(this,"connection",void 0),w(this,"localTrackMap",new Map),w(this,"remoteUserMap",new Map),w(this,"localDataChannels",[]),w(this,"remoteDataChannelMap",new Map),w(this,"pendingLocalTracks",[]),w(this,"pendingRemoteTracks",[]),w(this,"pendingLocalDataChannels",[]),w(this,"pendingRemoteDataChannels",[]),w(this,"statsCollector",void 0),w(this,"shouldForwardP2PCreation",void 0),w(this,"iceFailedCount",0),w(this,"dtlsFailedCount",0),w(this,"mutex",void 0),w(this,"_state",it.Disconnected),w(this,"_pcStatsUploadType",D("NEW_ICE_RESTART")?Ca.FIRST_CONNECTION:Ca.OLD_FIRST_CONNECTION),w(this,"_isStartRestartIce",!1),w(this,"_restartTimer",void 0),w(this,"_isTryConnecting",!1),w(this,"_iceError",null),w(this,"_forceTurn",!1),w(this,"_isWaitPcToRePub",!1),w(this,"handleMuteLocalTrack",(n,r,i)=>O(this,null,function*(){let c=yield this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==it.Connected)return void i(new z(P.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let l=this.filterTobeMutedTracks(n);if(l.length===0)return void r();let u=l.find(f=>f[0]==="videoLowTrack");if(u){let f=u[1];this.store.enableInstantMuteRestore?(f.track._originMediaStreamTrack.enabled=!1,S.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):f.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?S.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):yield this.connection.muteLocal(l.map(f=>{let[,{id:m}]=f;return m}));let h=this.createMuteMessage(l);yield Rt(this,me.RequestMuteLocal,h),r()}catch(l){i(l)}finally{c()}})),w(this,"handleUnmuteLocalTrack",(n,r,i)=>O(this,null,function*(){let c=yield this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==it.Connected)return void i(new z(P.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let l=this.filterTobeUnmutedTracks(n);if(l.length===0)return void r();let u=l.find(f=>f[0]==="videoLowTrack");if(u){let f=u[1];if(this.store.enableInstantMuteRestore)f.track._originMediaStreamTrack.enabled=!0,S.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(f.track._originMediaStreamTrack.stop(),!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ve().supportDualStreamEncoding){let m=n._mediaStreamTrack.clone();f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}else{let m=m0(n,wd(this,me.RequestLowStreamParameter));f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}yield new ie((m,E)=>{this.handleReplaceTrack(f.track,m,E,!0)})}}this.store.enableInstantMuteRestore?S.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):yield this.connection.unmuteLocal(l.map(f=>{let[,{id:m}]=f;return m}));let h=this.createUnmuteMessage(l);yield Rt(this,me.RequestUnmuteLocal,h),r()}catch(l){i(l)}finally{c()}})),w(this,"handleUpdateVideoEncoder",(n,r,i,c)=>O(this,null,function*(){let l;c||(l=yield this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let h=this.localTrackMap.get(Z.LocalVideoTrack);if(!this.connection||!h||h.track!==n||this.state!==it.Connected)return void r();let{id:f,track:m}=h;yield this.connection.updateSendParameters(f,m),yield this.connection.updateEncoderConfig(f,m),this.emit(me.UpdateVideoEncoder,m),r()}catch(h){i(h)}finally{var u;(u=l)===null||u===void 0||u()}})),w(this,"handleUpdateVideoSendParameters",(n,r,i)=>O(this,null,function*(){let c=yield this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let l=this.localTrackMap.get(Z.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==it.Connected)return void r();let{id:u,track:h}=l;yield this.connection.updateSendParameters(u,h),r()}catch(l){i(l)}finally{c()}})),w(this,"handleReplaceMixingTrack",(n,r,i,c)=>O(this,null,function*(){if(!this.connection||this.state!==it.Connected)return void r();let l=h0([n]),u;S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),typeof c=="boolean"&&c||(u=yield this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{yield this.replaceTrack(n,l),r()}catch(f){i(f)}finally{var h;(h=u)===null||h===void 0||h()}})),w(this,"handleReplaceTrack",(n,r,i,c)=>O(this,null,function*(){let l;S.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(l=yield this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;let f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.connection||!f||this.state!==it.Connected)return void r();if(yield(u=this.connection)===null||u===void 0?void 0:u.replaceTrack(n,f[1].id),this.isPlanB){let m=f[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(f[0],m)}if(f[0]===Z.LocalVideoTrack&&!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ve().supportDualStreamEncoding){let m=this.localTrackMap.get(Z.LocalVideoLowTrack);if(m){let E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,yield new ie((_,y)=>{this.handleReplaceTrack(m.track,_,y,!0)})}}r()}catch(f){i(f)}finally{var h;(h=l)===null||h===void 0||h()}})),w(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),w(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),w(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),w(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),w(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new pH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Dn("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ve().supportUnifiedPlan||D("CHROME_FORCE_PLAN_B")&&Ns(),this.shouldForwardP2PCreation=D("FORWARD_P2P_CREATION")&&Ve().supportPCSetConfiguration&&e2(),this.shouldForwardP2PCreation&&(this.connection=Wf(this.store),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}startP2PConnection(e,t){return O(this,null,function*(){var n;this.state=it.New,this._forceTurn=f0(e),S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Wf(this.store,e),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new z(P.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=D("NEW_ICE_RESTART")?Ca.FIRST_CONNECTION:Ca.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise})}connect(e){return O(this,null,function*(){if(!this.connection)throw new z(P.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==it.Connected){this.store.peerConnectionStart();let t=yield this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=it.Connected,t}if(this.connection instanceof wi&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),ue.reportApiInvoke(this.store.sessionId,{name:Mt.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:St.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(me.RequestReconnect)});yield this.connection.updateRemoteConnect(e)})}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(i=>{var c;let[l]=i;return J(c=[Z.LocalVideoLowTrack,Z.LocalVideoTrack]).call(c,l)}),n=t.map(i=>{let[,{id:c}]=i;return c}),r=t.map(i=>{let[c]=i;return c});if(this.connection instanceof wi||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(ue.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!J(e).call(e,this.store.codec)){let i=["vp9","vp8","h264"].find(c=>J(e).call(e,c));i&&(this.store.codec=i,S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}getEstablishParams(){return O(this,null,function*(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof wi&&this.connection.peerConnectionState!=="closed"&&J(e=[it.New,it.Connected]).call(e,this.state)?this.connection.establishPromise:void 0})}publishDataChannel(e){return O(this,null,function*(){if(!this.connection||this.state!==it.Connected){if(this.state===it.Disconnected)throw new z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;J(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{let r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),yield this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);let r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))})}publish(e,t,n){var r=this;return Pr(function*(){let i=yield ke(r.mutex.lock("From P2PChannel.publish"));try{var c;let l=r.connection&&J(c=["disconnected","failed"]).call(c,r.connection.peerConnectionState);if(!r.connection||r.state!==it.Connected||l){if(r.state===it.Disconnected)throw new z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);let h=e.filter(f=>r.pendingLocalTracks.indexOf(f)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(h),void(l&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Xn.markPublishStart(r.store.clientId,r.store.pubId);let u=r.filterTobePublishedTracks(e,t,n);if(u.length===0)return void(yield ke(r.tryToUnmuteAudio(e)));yield*ol(Mu(_H(r.doPublish(r.connection,u))))}finally{i()}})()}doPublish(e,t){var n=this;return Pr(function*(){t.forEach(_=>{let{track:y,type:A}=_,C=Date.now();n.store.publish(y.getTrackId(),A===Z.LocalAudioTrack?"audio":"video",C)}),n.bindLocalTrackEvents(t);let r=t.map(_=>{let{track:y}=_;return y}),i=yield ke(e.send(r,n.store.codec,n.store.audioCodec)),c=(yield ke(i.next())).value,l=n.createGatewayPublishMessage(t,c),u;try{u=yield l}catch(_){throw i.throw(_),_?.code===P.WS_ABORT&&t.forEach(y=>{let{track:A}=y;n.pendingLocalTracks.indexOf(A)===-1&&n.pendingLocalTracks.push(A)}),n.unbindLocalTrackEvents(t),_}let h=n.mapPubResToRemoteConfig(l,u,r),f=(yield ke(i.next(h))).value;if(n.state===it.Disconnected)throw new z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");D("ENABLE_VIDEO_SEI");let m=D("ENABLE_ENCODED_TRANSFORM"),E=D("ENABLE_AUDIO_METADATA");r.forEach(_=>O(null,null,function*(){let y=_.getRTCRtpTransceiver();if(!y||!m)return;let{interceptLocalVideoFrame:A,interceptLocalAudioFrame:C}=yv();_.trackMediaType===de.VIDEO?yield A(y.sender,_):_.trackMediaType===de.AUDIO&&(yield C(y.sender,{metadata:E?()=>{let I=_.metadata.shift();return I&&I.value}:void 0}))})),t.forEach(_=>{let{type:y}=_;n.statsCollector.addLocalStats(y)}),n.assignLocalTracks(t,f),n.statsUploader.startUploadOutboundStats(),t.forEach(_=>{let{track:y,type:A}=_,C=Date.now();n.store.publish(y.getTrackId(),A===Z.LocalAudioTrack?"audio":"video",void 0,C)})})()}updateVideoStreamParameter(e,t){return O(this,null,function*(){let n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof Tt))return S.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:r}=n,i=(function(c,l){let u={};return c.height&&c.width&&(u.scaleResolutionDownBy=qw(c,l)),u.maxFramerate=c.framerate?Ur(c.framerate):void 0,u.maxBitrate=c.bitrate?1e3*c.bitrate:void 0,u})(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Z.LocalVideoLowTrack||!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ve().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{let c=r._originMediaStreamTrack;if(!c.canvas)return S.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(l,u){let h=l.canvas;u.width&&(h.width=Ur(u.width)),u.height&&(h.height=Ur(u.height)),u.framerate&&(h.stopCapture&&h.stopCapture(),h.stopCapture=mw(()=>{!h.startCapture&&h.stopCapture&&h.stopCapture(),h.startCapture&&h.startCapture()},Ur(u.framerate)))})(c,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),S.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),yield this.connection.updateRtpSenderEncodings(r)})}publishLowStream(e){var t=this;return Pr(function*(){if(!t.connection||t.state!==it.Connected)return;let n=yield ke(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let i=t.localTrackMap.get(Z.LocalVideoTrack);if(!i)throw new z(P.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Z.LocalVideoLowTrack))throw new z(P.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let c=[{track:t.getLowVideoTrack(i.track,e),type:Z.LocalVideoLowTrack}];if(yield*ol(Mu(_H(t.doPublish(t.connection,c)))),i.track.muted||!i.track.enabled){var r;let l=(r=t.localTrackMap.get(Z.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;l!==void 0&&(yield ke(t.connection.muteLocal([l])))}}finally{n()}})()}republish(){return O(this,null,function*(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield hn(this,me.RequestRePublish,this.pendingLocalTracks),this.emit(me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield hn(this,me.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1})}reSubscribe(e){return O(this,null,function*(){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==de.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==de.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)yield hn(this,me.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:n}of this.pendingRemoteTracks)yield this.subscribe(t,n,n===de.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(me.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]})}unpublish(e){return O(this,null,function*(){if(!this.connection||this.state!==it.Connected)return void e.forEach(r=>{let i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)})}unpublishDataChannel(e){return O(this,null,function*(){if(!this.connection||this.state!==it.Connected)return void e.forEach(n=>{let r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{let r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&(yield this.connection.stopDataChannels(this.store.uid)),t.map(n=>n.id)):void 0})}unpublishLowStream(){return O(this,null,function*(){if(!this.connection||this.state!==it.Connected)return;let e=this.localTrackMap.get(Z.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[Z.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)})}doUnpublish(e,t){return O(this,null,function*(){let n=this.createGatewayUnpublishMessage(t);return yield e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:c}]=r;return{type:i,track:c}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n})}subscribeDataChannel(e,t){return O(this,null,function*(){if(!this.connection||this.state!==it.Connected)throw new z(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let n=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return yield this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));let c=this.pendingRemoteDataChannels.findIndex(l=>{let{user:u,id:h}=l;return u.uid===e.uid&&h===r.id});c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),n.map(r=>r.id)})}subscribe(e,t,n,r,i){return O(this,null,function*(){var c;if(!this.connection||this.state!==it.Connected)throw new z(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let l,u,h,f,m=this.connection.getPreMedia(n);if(m)S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),h=m.transceiver,l=m.track,u=m.mid,f=m.player,m.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:m.firstVideoRender});else if(i){let y=i.find(C=>{let{stream_type:I}=C;return I===t});if(!y)throw new z(P.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let A=yield this.connection.receive(t,y.ssrcs,String(e._uintid),y.attributes);(this.connection instanceof wi||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(h=A.transceiver),l=A.track,u=A.id}else{let y=yield this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);(this.connection instanceof wi||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(h=y.transceiver),l=y.track,u=y.id}if(t===de.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new Qu(l,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new Zu(l,e.uid,e._uintid,this.store,f),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Bi.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Bi.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),f?e._videoTrack.once(Bi.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Bi.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack)),h&&D("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:y,interceptRemoteAudioFrame:A}=yv();t==de.VIDEO?yield y(h.receiver,{onSei:D("ENABLE_VIDEO_SEI")&&(C=>{var I;return(I=e._videoTrack)===null||I===void 0?void 0:I._onSei(C)}),onFirstFrame:C=>{var I;let N=Array.from(nr(I=this.remoteUserMap).call(I)).find(L=>L._videoSSRC===C.ssrc);N&&this.store.firstVideoFrameDecoded(N.uid,{firstReceivedEncodedFrame:Date.now(),frameType:C.type,rtpTimestamp:C.rtpTimestamp,framePayloadType:C.payloadType,frameDataLength:C.length,mimeType:C.mimeType})}}):t==de.AUDIO&&(yield A(h.receiver,{enableTopn:!!D("ENABLE_AUDIO_TOPN"),enableMetadata:!!D("ENABLE_AUDIO_METADATA"),enablePts:!!D("ENABLE_AUDIO_PTS"),onMetadata:C=>{this.safeEmit(me.AudioMetadata,C)},onPts:C=>{this.safeEmit(me.AudioPts,C)}}))}let E=this.remoteUserMap.get(e);E?E.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let _=this.pendingRemoteTracks.findIndex(y=>{let{user:A,kind:C}=y;return A.uid===e.uid&&t===C});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(me.MediaReconnectEnd,e.uid))})}massSubscribe(e){return O(this,null,function*(){return this.massSubscribeNoLock(e)})}massSubscribeNoLock(e){return O(this,null,function*(){if(!this.connection||this.state!==it.Connected)throw new z(P.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var c;let{user:l,mediaType:u}=i;return!((c=this.remoteUserMap.get(l))!==null&&c!==void 0&&c.has(u))});let t=[],n=new Map;e.forEach(i=>{if(!this.connection)return;let c=this.connection.getPreMedia(i.ssrcId);if(c){let{track:l,mid:u,transceiver:h,player:f}=c;n.set(i.ssrcId,{track:l,id:u,transceiver:h,player:f})}else t.push(i)});let r=yield this.connection.batchReceive(t.map(i=>{let{user:c,mediaType:l,ssrcId:u,rtxSsrcId:h}=i;return{kind:l,ssrcMsg:[{ssrcId:u,rtx:h}],mslabel:String(c._uintid)}}));t.forEach((i,c)=>{n.set(i.ssrcId,r[c])});for(let{user:i,mediaType:c,ssrcId:l}of e){let u=n.get(l);if(!u)return void S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(c,", ").concat(l));let{track:h,id:f,transceiver:m,player:E}=u;if(m&&D("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:C}=yv();c==de.VIDEO?yield A(m.receiver,{onSei:D("ENABLE_VIDEO_SEI")&&(I=>{var N;return(N=i._videoTrack)===null||N===void 0?void 0:N._onSei(I)}),onFirstFrame:I=>{var N;let L=Array.from(nr(N=this.remoteUserMap).call(N)).find(M=>M._videoSSRC===I.ssrc);L&&this.store.firstVideoFrameDecoded(L.uid,{firstReceivedEncodedFrame:Date.now(),frameType:I.type,rtpTimestamp:I.rtpTimestamp,framePayloadType:I.payloadType,frameDataLength:I.length,mimeType:I.mimeType})}}):c==de.AUDIO&&(yield C(m.receiver,{enableTopn:!!D("ENABLE_AUDIO_TOPN"),enableMetadata:!!D("ENABLE_AUDIO_METADATA"),enablePts:!!D("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(me.AudioMetadata,I)},onPts:I=>{this.safeEmit(me.AudioPts,I)}}))}if(c===de.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(h):(i._audioTrack=new Qu(h,i.uid,i._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),m&&i._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(h):(i._videoTrack=new Zu(h,i.uid,i._uintid,this.store,E),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),m&&i._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(i,i._videoTrack)),D("ENABLE_VIDEO_SEI")&&m){let{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:C}=yv();c==de.VIDEO?yield A(m.receiver,{onSei:I=>{var N;(N=i._videoTrack)===null||N===void 0||N._onSei(I)},onFirstFrame:I=>{var N;let L=Array.from(nr(N=this.remoteUserMap).call(N)).find(M=>M._videoSSRC===I.ssrc);L&&this.store.firstVideoFrameDecoded(L.uid,{firstReceivedEncodedFrame:Date.now(),frameType:I.type,rtpTimestamp:I.rtpTimestamp,framePayloadType:I.payloadType,frameDataLength:I.length,mimeType:I.mimeType})}}):c==de.AUDIO&&(yield C(m.receiver))}let _=this.remoteUserMap.get(i);_?_.set(c,f):this.remoteUserMap.set(i,new Map([[c,f]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();let y=this.pendingRemoteTracks.findIndex(A=>{let{user:C,kind:I}=A;return C.uid===i.uid&&c===I});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(me.MediaReconnectEnd,i.uid))}})}unsubscribe(e,t,n){return O(this,null,function*(){let r=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(r.forEach(l=>{let u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===it.Connected||n||r.forEach(l=>{let{kind:u}=l;var h;if(u===de.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===de.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==it.Connected)return;let i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;yield this.connection.stopReceiving(i.map(l=>{let[,{id:u}]=l;return u}));let c=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(l=>{let[u,{kind:h}]=l;var f,m;if(h===de.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===de.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),n||((m=u._videoTrack)===null||m===void 0||m._destroy(),u._videoTrack=void 0);else if(h===de.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),!n&&((E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0)}}),c})}unsubscribeDataChannel(e,t){return O(this,null,function*(){if(t.forEach(i=>{let c=this.pendingRemoteDataChannels.findIndex(l=>l.id===i.id);c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),!this.connection)return;let n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(i=>{i._close()});let r=this.remoteDataChannelMap.get(e);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),yield this.connection.stopDataChannels(e.uid)),n.map(i=>i.id)})}massUnsubscribe(e){return O(this,null,function*(){return this.massUnsubscribeNoLock(e)})}massUnsubscribeNoLock(e){return O(this,null,function*(){let t=[];for(let{user:i,mediaType:c}of e){let l=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:f}=u;return c!==void 0?h.uid===i.uid&&c===f:h.uid===i.uid});l.forEach(u=>{let h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),t=t.concat(l)}if(!this.connection||this.state!==it.Connected)return void t.forEach(i=>{let{user:c,kind:l}=i;var u;if(l===de.AUDIO)(u=c._audioTrack)===null||u===void 0||u._destroy(),c._audioTrack=void 0;else if(l===de.VIDEO){var h;(h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0}});let n=Ui(e).call(e,(i,c)=>{let{user:l,mediaType:u}=c,h=this.filterTobeUnSubscribedTracks(l,u);return i.concat(h)},[]);if(n.length===0)return;yield this.connection.stopReceiving(n.map(i=>{let[,{id:c}]=i;return c}));let r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[c,{kind:l}]=i;var u,h;if(l===de.VIDEO&&c._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===de.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),(h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0;else if(l===de.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),(f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0}}),r})}isPreSubScribe(e){return!this.connection||this.state!==it.Connected?!1:!!this.connection.getPreMedia(e)}muteRemote(e,t){return O(this,null,function*(){if(!this.connection)return;let n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===de.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)})}unmuteRemote(e,t){return O(this,null,function*(){return this.unmuteRemoteNoLock(e,t)})}unmuteRemoteNoLock(e,t){return O(this,null,function*(){if(!this.connection)return;let n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))})}addAudioMetadata(e){let t=this.localTrackMap.get(Z.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(Z.LocalAudioTrack);if(t?.track instanceof gn){let n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Z.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===Z.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Z.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){let l=this.localTrackMap.get(Z.LocalAudioTrack),u=r?this.localTrackMap.get(Z.LocalVideoLowTrack):this.localTrackMap.get(Z.LocalVideoTrack);ue.publish(this.store.sessionId,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l?.track.getTrackLabel(),videoName:u?.track.getTrackLabel(),screenshare:u?.track._hints.indexOf(ot.SCREEN_TRACK)!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var c;n||(n=[]);let l=n.find(h=>h instanceof $t),u=r?(c=this.localTrackMap.get(Z.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(h=>h instanceof Tt);ue.publish(this.store.sessionId,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l?.getTrackLabel(),videoName:u?.getTrackLabel(),screenshare:u?._hints.indexOf(ot.SCREEN_TRACK)!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){let i=r===de.VIDEO?n._videoSSRC:n._audioSSRC;i&&ue.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===de.VIDEO,audio:r===de.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Xn.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Dn("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Wf(this.store),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Z.LocalAudioTrack);if(e?.track instanceof gn){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=it.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Z.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Z.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof Tt||t&&t.track instanceof $t?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}hasRemoteMediaWithLock(e,t){return O(this,null,function*(){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))})}getRemoteMedia(e){var t;let n=Array.from(nr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Z.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=fd(e).call(e,(n,r)=>n.level-r.level),e}disconnectForReconnect(){return O(this,null,function*(){this.connection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=it.Reconnecting,D("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Wf(this.store),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Z.LocalVideoTrack:J(t=r._hints).call(t,ot.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Z.LocalAudioTrack:r instanceof gn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Z.LocalVideoLowTrack:}}),this.emit(me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(nr(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(nr(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})}hasPendingRemoteDataChannel(e,t){for(let n of this.pendingRemoteDataChannels){let{user:r,id:i}=n;if((e instanceof bc?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:r,kind:i}=n;if((e instanceof bc?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Pr(function*(){if(!t.connection||t.state!==it.Connected)return;let n=yield ke(t.mutex.lock("From P2PChannel.restartICE")),r;try{r=yield ke(t.connection.restartICE(e));let c=yield ke(r.next());if(c.done)return;let l=c.value,u=yield l;switch(p0(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case On.UDP_TCP_RELAY:t._pcStatsUploadType=Ca.UDP_TCP_RESTART;break;case On.TCP_RELAY:t._pcStatsUploadType=Ca.TCP_RESTART;break;case On.RELAY:t._pcStatsUploadType=Ca.RELAY_RESTART;break;default:t._pcStatsUploadType=Ca.OLD_RESTART}t._isTryConnecting=!0,r.next(u)}catch(c){var i;(i=r)===null||i===void 0||i.throw(c)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(Z.LocalVideoTrack),n=this.localTrackMap.get(Z.LocalAudioTrack),r=e.videoSend.find(y=>y.ssrc===t?.ssrcs[0].ssrcId),i=e.audioSend.find(y=>y.ssrc===n?.ssrcs[0].ssrcId);if(!r||!i)return 1;let c=li(this,me.NeedSignalRTT),l=r?r.rttMs:void 0,u=i?i.rttMs:void 0,h=l&&u?(l+u)/2:l||u,f=(h&&c?(h+c)/2:h||c)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,_=t?.track;if(_&&_._encoderConfig&&_._hints.indexOf(ot.SCREEN_TRACK)===-1){let y=_._encoderConfig.bitrateMax,A=e.bitrate.actualEncoded;if(y&&A){let C=(1e3*y-A)/(1e3*y);return rB[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n,i=r._audioSSRC,c=r._videoSSRC,l=e.audioRecv.find(A=>A.ssrc===i),u=e.videoRecv.find(A=>A.ssrc===c);if(!l&&!u)return void(t+=1);let h=li(this,me.NeedSignalRTT),f=e.rtt,m=(f&&h?(f+h)/2:f||h)||0,E=l?l.jitterMs:void 0,_=e.recvPacketLossRate,y=.7*_*100/50+.3*m/1500;E&&(y=.6*_*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}muteLocalTrack(e){return O(this,null,function*(){return new ie((t,n)=>{this.handleMuteLocalTrack(e,t,n)})})}replaceTrack(e,t){return O(this,null,function*(){var n;if(S.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==it.Connected)return;let r=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:l}]=c;return e===l});if(!r)return;let i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),yield(n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id),this.isPlanB){let c=r[1];c.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,c)}if(i===Z.LocalVideoTrack&&!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ve().supportDualStreamEncoding){let c=this.localTrackMap.get(Z.LocalVideoLowTrack);if(c){let l=e._mediaStreamTrack.clone();c.track._originMediaStreamTrack.stop(),c.track._mediaStreamTrack=l,c.track._originMediaStreamTrack=l,yield new ie((u,h)=>{this.handleReplaceTrack(c.track,u,h,!0)})}}})}filterTobePublishedTracks(e,t,n){let r=[],i=this.getAllTracks();e=Fu(e=e.filter(h=>i.indexOf(h)===-1));let c,l=!1,u=this.localTrackMap.get(Z.LocalAudioTrack);for(let h of e){if(h instanceof Tt&&(this.localTrackMap.has(Z.LocalVideoTrack)||l?new z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:h,type:Z.LocalVideoTrack}),l=!0),t)){let f=this.getLowVideoTrack(h,n);r.push({track:f,type:Z.LocalVideoLowTrack})}if(h instanceof $t)if(u){let f=u.track;if(f instanceof gn)u0([h]),f.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0);else{let m=h0([f,h]);S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(f,m)}}else c instanceof gn?(u0([h]),c.addAudioTrack(h)):c||!h._useAudioElement&&Ve().webAudioMediaStreamDest&&!h._bypassWebAudio?c=h0(c?[h,c]:[h]):c=h}return c&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(c.getTrackId(),"]")),r.push({track:c,type:Z.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=Fu(e=e.filter(r=>n.indexOf(r)!==-1));for(let r of e){if(r instanceof $t){let i=this.localTrackMap.get(Z.LocalAudioTrack);if(!i)continue;i.track instanceof gn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Z.LocalAudioTrack,i]),i.track.close())):t.push([Z.LocalAudioTrack,i])}if(r instanceof Tt){let i=this.localTrackMap.get(Z.LocalVideoTrack);if(!i)continue;t.push([Z.LocalVideoTrack,i]);let c=this.localTrackMap.get(Z.LocalVideoLowTrack);c&&t.push([Z.LocalVideoLowTrack,c])}}return t}filterTobePublishedDataChannels(e){return e=(e=Fu(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Fu(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Z.LocalVideoTrack:n.addListener(he.GET_STATS,this.handleGetLocalVideoStats),n.addListener(he.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(he.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(he.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Z.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Z.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof gn?e.trackList.forEach(n=>{n.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(he.GET_STATS,this.handleGetLocalAudioStats),n.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(he.GET_STATS,this.handleGetLocalAudioStats),e.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(he.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Z.LocalVideoTrack:n.off(he.GET_STATS,this.handleGetLocalVideoStats),n.off(he.GET_RTC_STATS,this.handleGetRTCStats),n.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(he.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(he.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Z.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Z.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof gn?e.trackList.forEach(t=>{t.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(he.GET_STATS,this.handleGetLocalAudioStats),t.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(he.GET_STATS,this.handleGetLocalAudioStats),e.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(he.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Zu&&t.addListener(he.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Qu&&t.addListener(he.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(he.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(de.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(de.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let c,l,{track:u,type:h}=n;switch(h){case Z.LocalAudioTrack:c=dt.Audio,l={dtx:u instanceof Pf&&u._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Z.LocalVideoTrack:c=J(i=u._hints).call(i,ot.SCREEN_TRACK)?dt.Screen:dt.High,l=Bs(Bs({},EB(u)),{},{codec:this.store.codec,svc_mode:xf()});break;case Z.LocalVideoLowTrack:c=dt.Low,l=Bs(Bs({},EB(u)),{},{codec:this.store.codec,svc_mode:xf()})}return{stream_type:c,attributes:l,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:c,ssrcs:l,id:u}]=t;switch(i){case Z.LocalVideoTrack:r=J(n=c._hints).call(n,ot.SCREEN_TRACK)?dt.Screen:dt.High;break;case Z.LocalAudioTrack:r=dt.Audio;break;case Z.LocalVideoLowTrack:r=dt.Low}return{stream_type:r,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:c}=n;this.localTrackMap.set(c,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=t=>O(this,null,function*(){if(S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(me.PeerConnectionStateChange,t),t==="connecting"&&e instanceof wi&&!Nt()&&D("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},D("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof wi&&fH(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Ca.DISCONNECTED_OR_FAILED,li(this,me.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let n=this.pendingLocalTracks.map(i=>i.getTrackId()),r=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));ue.reportApiInvoke(this.store.sessionId,{name:Mt.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:St.TRACER}).onSuccess(),this.republish()}if(D("NEW_ICE_RESTART")&&e instanceof wi&&!Nt()&&!this._forceTurn&&!this.store.useDcSignal){if(J(hB).call(hB,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let n=i=>{p0(e)&&(S.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),li(this,me.QueryClientConnectionState)==="CONNECTED"&&this.emit(me.RequestRestartICE,i))},r=()=>{p0(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),S.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{mH(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&D("ICE_RESTART")&&li(this,me.QueryClientConnectionState)==="CONNECTED"&&this.emit(me.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(me.P2PLost),0),this.iceFailedCount+=1,yield this.requestReconnect())}}),e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ue.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:St.TRACER}).onSuccess(),this.emit(me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;let r=Array.from(nr(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Bi.FIRST_FRAME_DECODED),ue.firstRemoteFrame(this.store.sessionId,mn.FIRST_AUDIO_DECODE,xt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;let r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&ue.firstRemoteFrame(this.store.sessionId,mn.FIRST_AUDIO_RECEIVED,xt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{var i;let c=Array.from(nr(i=this.remoteUserMap).call(i)).find(l=>l._videoSSRC===t);c&&this.store.firstVideoFrameDecoded(c.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoRender=t=>{var n;let r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r),this.emit(me.FirstVideoPreRender,r.uid,t))},e.onFirstVideoReceived=t=>{var n;let r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),ue.firstRemoteFrame(this.store.sessionId,mn.FIRST_VIDEO_RECEIVED,xt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var n;let r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&this.emit(me.FirstVideoBufferReady,r.uid,t)},e.onSelectedLocalCandidateChanged=(t,n)=>{let r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(me.ConnectionTypeChange,r),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Rc(n))," -> ").concat(JSON.stringify(Rc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Rc(n))," -> ").concat(JSON.stringify(Rc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Bs(Bs({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){S.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===it.Connected?(S.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=Wf(this.store),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof wi&&(function(t){ph.delete(t.id),fH(t)})(e),e.close(),this.emit(me.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let n=this.localTrackMap.get(Z.LocalAudioTrack);if(e instanceof $t&&n?.track instanceof gn)return n.track.isActive||t.push([Z.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:c}]=i;return e===c});if(r&&(t.push(r),r[0]===Z.LocalVideoTrack)){let i=this.localTrackMap.get(Z.LocalVideoLowTrack);i&&t.push([Z.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(Z.LocalAudioTrack);if(e instanceof $t&&n?.track instanceof gn)return n.track.isActive&&t.push([Z.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:c}]=i;return e===c});if(r)if(r[0]===Z.LocalVideoTrack){t.push(r);let i=this.localTrackMap.get(Z.LocalVideoLowTrack);i&&t.push([Z.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:c,ssrcs:l,id:u}]=t;switch(i){case Z.LocalAudioTrack:r=dt.Audio;break;case Z.LocalVideoTrack:r=J(n=c._hints).call(n,ot.SCREEN_TRACK)?dt.Screen:dt.High;break;case Z.LocalVideoLowTrack:r=dt.Low}return{stream_type:r,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:c,ssrcs:l,id:u}]=t;switch(i){case Z.LocalAudioTrack:r=dt.Audio;break;case Z.LocalVideoTrack:r=J(n=c._hints).call(n,ot.SCREEN_TRACK)?dt.Screen:dt.High;break;case Z.LocalVideoLowTrack:r=dt.Low}return{stream_type:r,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){let n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){let i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[c,l]=i;n.push([e,{kind:c,id:l}])});return n}filterTobeUnSubscribedDataChannels(e,t){let n=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){let t=[];return e.forEach(n=>{let[r,{kind:i,id:c}]=n;switch(i){case de.VIDEO:return void(r._videoSSRC&&t.push({stream_type:de.VIDEO,ssrcId:r._videoSSRC}));case de.AUDIO:return void(r._audioSSRC&&t.push({stream_type:de.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(n=>{let[r,{kind:i}]=n;if(t.has(r)){let c=t.get(r);i===de.VIDEO?c|=Rn.Video:c|=Rn.Audio,t.set(r,c)}else i===de.VIDEO?t.set(r,Rn.Video):t.set(r,Rn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t,i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}updateBitrateLimit(e){return O(this,null,function*(){let t=this.localTrackMap.get(Z.LocalVideoTrack),n=this.localTrackMap.get(Z.LocalVideoLowTrack);t&&(yield t.track.setBitrateLimit(e.uplink),yield new ie((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(yield n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),yield new ie((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof wi&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof wi)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof wi&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,n){return e.map((r,i)=>{var c;let{stream_type:l}=r,u=(c=t.find(h=>{let{stream_type:f}=h;return l===f}))===null||c===void 0?void 0:c.attributes;if(u&&D("DISABLE_SCREEN_SHARE_REMB")){let h=n[i]._hints;(J(h).call(h,ot.SCREEN_TRACK)||J(h).call(h,ot.SCREEN_LOW_TRACK))&&(u.remb=!1,S.debug("disable remb for screen share, hints:",h))}return u})}tryToUnmuteAudio(e){return O(this,null,function*(){for(let n=0;n<e.length;n++)if(e[n]instanceof $t){var t;let r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;yield(t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(c=>{let[,{id:l}]=c;return l}));let i=this.createUnmuteMessage(r);return void(yield Rt(this,me.RequestUnmuteLocal,i))}})}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(me.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(me.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){return O(this,null,function*(){this.dtlsFailedCount+=1,yield Tn(UE(this.dtlsFailedCount,cn)),this.emit(me.RequestReconnect)})}reconnectP2P(){return O(this,null,function*(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&(yield hn(this,me.RequestUnpublishForReconnectPC,t)),this.disconnectForReconnect(),this.emit(me.RequestReconnectPC)})}canPublishLowStream(){return this.localTrackMap.has(Z.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Tt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Tt).length>1)throw new z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof $t).length>1&&(e.some(t=>t instanceof $t&&t._bypassWebAudio)||!Ve().webAudioMediaStreamDest))throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof Tt&&this.pendingLocalTracks.some(n=>n instanceof Tt))throw new z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof $t&&this.pendingLocalTracks.some(n=>n instanceof $t)&&(!Ve().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof $t&&n._bypassWebAudio)))throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;let r=!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ve().supportDualStreamEncoding,i=Bs(Bs({},{width:160,height:120,framerate:15,bitrate:50}),t),c;c=r?e._mediaStreamTrack.clone():m0(e,i);let l=at(8,"track-low-"),u=new Tt(c,Bs(Bs({},r&&{scaleResolutionDownBy:qw(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,l);return u.on(kd.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,qu.LOW_STREAM)}),u._hints.push(ot.LOW_STREAM),J(n=e._hints).call(n,ot.SCREEN_TRACK)&&u._hints.push(ot.SCREEN_LOW_TRACK),e.on("sei-to-send",h=>{u.emit("sei-to-send",h)}),e.addListener(he.NEED_CLOSE,()=>{u.close()}),u}globalLock(){return O(this,null,function*(){return this.mutex.lock("From P2PChannel.globalLock")})}reportPCStats(r,i,c){return O(this,arguments,function*(e,t,n){let l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof wi){var u,h,f,m;let E=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_,dtlsTransportState:y,peerConnectionState:A}=this.connection,{local:C,remote:I}=yield this.connection.getSelectedCandidatePair();ue.pcStats(this.store.sessionId,{startTime:E,eventElapse:e-E||0,iceconnectionsate:_,dtlsstate:y,connectionstate:A,intSucc:t?1:2,error:this._iceError||l||"",selectedLocalCandidateProtocol:(u=C?.protocol)!==null&&u!==void 0?u:"",selectedLocalCandidateType:(h=C.candidateType)!==null&&h!==void 0?h:"",selectedLocalCandidateAddress:"".concat(C.address,":").concat(C.port),selectedRemoteCandidateProtocol:(f=I.protocol)!==null&&f!==void 0?f:"",selectedRemoteCandidateType:(m=I.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(I.address,":").concat(I.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}})}reportVideoFirstFrameRender(e){let t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(m=>m.userId===e.uid);if(!n)return;let{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;let{subscribeEnd:c,firstPreRender:l,peerPublishDuration:u,peerPubStatusMs:h}=n,{firstRender:f=0}=n;if(c&&(f||l)&&u&&h){n.isInternalUpload=!0;let{playEnd:m}=n;m&&(n.isExternalUpload=!0);let{firstPreRender:E=0}=n;f=E||f;let _=e.videoTrack,y={peer:e._uintid,width:_?._videoWidth||0,height:_?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:u,peerPubStatusMs:h,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:E||0,firstRender:m?Math.max(f,m):Math.max(f,c),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:F2(this.store),firstReceivedEncodedFrame:n.firstReceivedEncodedFrame||0,frameType:n.frameType||"",rtpTimestamp:n.rtpTimestamp||0,framePayloadType:n.framePayloadType||0,frameDataLength:n.frameDataLength||0,mimeType:n.mimeType||""};ue.firstXLAPeerFirstVideoFrame(this.store.sessionId,y)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;let c=Array.from(nr(i=this.remoteUserMap).call(i)).find(l=>l._videoSSRC===e);if(c){r||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());let l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===c.uid&&h.type==="video");ue.firstRemoteVideoDecode(this.store.sessionId,mn.FIRST_VIDEO_DECODE,xt.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:u?.subscribeEnd||0,subscriberStart:u?.subscribeStart||0,videoAddNotify:u?.streamAdded||0,state:r?1:0,firstFrame:u?.firstFrame||0})}}remoteMediaSsrcChanged(e,t,n){return O(this,null,function*(){if(!this.connection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let i=r.get(t);if(!i)return!1;let c=yield this.connection.getRemoteSSRC(i);return c!==void 0&&c!==n})}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Z.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,qu.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},oe(Be.prototype,"startP2PConnection",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"startP2PConnection"),Be.prototype),oe(Be.prototype,"connect",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"connect"),Be.prototype),oe(Be.prototype,"updateRemoteRTPCapabilities",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"updateRemoteRTPCapabilities"),Be.prototype),oe(Be.prototype,"publishDataChannel",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"publishDataChannel"),Be.prototype),oe(Be.prototype,"unpublish",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"unpublish"),Be.prototype),oe(Be.prototype,"unpublishDataChannel",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"unpublishDataChannel"),Be.prototype),oe(Be.prototype,"unpublishLowStream",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"unpublishLowStream"),Be.prototype),oe(Be.prototype,"subscribeDataChannel",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"subscribeDataChannel"),Be.prototype),oe(Be.prototype,"subscribe",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"subscribe"),Be.prototype),oe(Be.prototype,"massSubscribe",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"massSubscribe"),Be.prototype),oe(Be.prototype,"unsubscribe",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"unsubscribe"),Be.prototype),oe(Be.prototype,"unsubscribeDataChannel",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"unsubscribeDataChannel"),Be.prototype),oe(Be.prototype,"massUnsubscribe",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"massUnsubscribe"),Be.prototype),oe(Be.prototype,"muteRemote",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"muteRemote"),Be.prototype),oe(Be.prototype,"unmuteRemote",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"unmuteRemote"),Be.prototype),oe(Be.prototype,"hasRemoteMediaWithLock",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"hasRemoteMediaWithLock"),Be.prototype),oe(Be.prototype,"disconnectForReconnect",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"disconnectForReconnect"),Be.prototype),oe(Be.prototype,"updateBitrateLimit",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"updateBitrateLimit"),Be.prototype),oe(Be.prototype,"remoteMediaSsrcChanged",[dr],Object.getOwnPropertyDescriptor(Be.prototype,"remoteMediaSsrcChanged"),Be.prototype),Be);function dr(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return O(this,arguments,function*(){let i=this.mutex,c=yield i.lock("From P2PChannel.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return yield r.apply(this,u)}finally{c()}})},n}function EH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function vH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?EH(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let $ce=Date.now(),Xce=20,E0=new Map,Pv=new Map;function yH(e){return O(this,null,function*(){let t=E0.get(e),n=Array.isArray(t)&&t[t.length-1],r=Pv.get(e);if(!n)return void(r.isSyncing=!1);let i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);let c=n.sendTs-r.firstSendTs,l=c-(Date.now()-r.firstRecvTs);l>0&&(r.firstRecvTs=Date.now()-c);let u=n.mediaDelay+l;u<=0?(t.pop(),SH(n.context,i),u=0):u=Math.min(u,Xce),setTimeout(()=>t.length&&yH(e),u)})}function SH(e,t){e.safeEmit(Ue.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Jce(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return SH(n,{uid:e.uid,payload:e.payload});let r="".concat(n.id,"-").concat(e.uid),i=E0.get(r)||[],c=i.findIndex(f=>e.sendTs>=f.sendTs),l=vH(vH({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});c===-1?i.push(l):i.splice(c,0,l),E0.set(r,i);let u=!1;var h;Pv.has(r)?u=!((h=Pv.get(r))===null||h===void 0||!h.isSyncing):Pv.set(r,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||yH(r)}let Zce=Je().name;function TH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function CH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?TH(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let fh="websdk_ng_cache_parameter",Qce=D("MAX_PRELOAD_ASYNC_LENGTH"),ede=1e4,Kd=new Map,Yd=[],v0=null,y0=0,S0=0,Lv=new Map,RH=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),tde=(function(e,t){let n=[],r=0,i=()=>O(null,null,function*(){let c=n.shift();c&&(yield c()),n.length>0&&r<t?i():r--});return function(){return O(this,arguments,function*(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return new ie((h,f)=>O(null,null,function*(){n.push(()=>O(null,null,function*(){try{let m=yield e(...l);h(m)}catch(m){f(m)}})),r<t&&(r++,i())}))})}})(C0,Qce),T0=Lr.CancelToken.source();class nde{constructor(){w(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;let t=this._audioContext.sampleRate,n=10*t,r=this._audioContext.createBuffer(2,n,t),i=this._audioContext.createBufferSource();i.buffer=r;let c=this._audioContext.createMediaStreamDestination();return i.connect(c),i.start(),c.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}function C0(e,t,n,r,i,c,l){return O(this,null,function*(){try{if(!D("ENABLE_PRELOAD"))return;if(!Ve().supportWebCrypto)return void Ec(()=>{S.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new z(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Un(n,"token",1,2047),Un(e,"appid",1,2047),cv(t),r&&dv(r);let u=Od();S.debug("preload channel ".concat(t,", uid is ").concat(r));let h={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:u,proxyServer:i,role:l},f,m;typeof r=="string"?(h.stringUid=r,[m,f]=yield ie.all([Uce(r,{sid:u,appId:e},T0.token),YB(CH(CH({},h),{},{token:n||e,uid:0}),T0.token)]),h.uid=m.uid,f.gatewayInfo.uid=h.uid,f.gatewayInfo.res.uid=h.uid):(c&&(h.stringUid=c),f=yield YB(h,T0.token));let E={sid:u,appId:e,cname:t,token:n||e,uid:h.stringUid||r,intUid:h.uid||f.gatewayInfo.uid,stringUid:h.stringUid,ts:Date.now(),sua:m,ap:f};yield I0(E),y0++}catch(u){throw S0++,(function(h){v0||(v0=window.setTimeout(()=>{let m="";Lv.forEach((E,_)=>{m+="".concat(_,": ").concat(E," ;")}),ue.reportApiInvoke(null,{name:Mt.PRELOAD,options:{success:y0,failed:S0,err:m}}).onError(h),y0=0,S0=0,Lv.clear(),v0=null},ede));let f=Lv.get(h.code)||0;Lv.set(h.code,f+1)})(u),u}})}function R0(e){return O(this,null,function*(){try{if(D("AP_REQUEST_DETAIL")||D("ENABLE_ROLE_SELECT_EDGE"))return;let t=IH(e);if(!t||e.cloudProxyServer!=="disabled")return;let n=yield(function(r,i){return O(this,null,function*(){try{let c=yield window.crypto.subtle.importKey("raw",h2(i),"AES-GCM",!1,["decrypt"]),l=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:RH},c,Dd(r));return JSON.parse(window.atob(vc(new Uint8Array(l))))}catch{return}})})(t,e.token||e.appId);if(!n||!(function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1})(n,e))return;if(n&&Date.now()-n.ts<D("AP_CACHE_LIFETIME"))return n}catch(t){S.warn("Error get preloadInfo",t.message)}})}function IH(e){let t;try{if(t=AH(fh),!t)return;let n=JSON.parse(t),r=DH(e),i=(function(l,u){for(let h=l.length-1;h>=0;h--)if(u(l[h]))return h;return-1})(n,l=>r in l);if(i===-1)return;let c=n.splice(i,1)[0];return kv(fh,JSON.stringify(n)),c[r]}catch(n){S.warn("Error delete preload info: ".concat(t),n.message),kv(fh,"")}}function I0(e){return O(this,null,function*(){let t;try{e.uid&&IH({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});let n=DH(e),r=yield(function(c,l){return O(this,null,function*(){try{let u=yield window.crypto.subtle.importKey("raw",h2(l),"AES-GCM",!1,["encrypt"]),h=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:RH},u,Dd(window.btoa(JSON.stringify(c))));return vc(new Uint8Array(h))}catch{return}})})(e,e.token||e.appId);if(!r)return;t=AH(fh);let i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>D("AP_CACHE_NUM")&&i.shift(),kv(fh,JSON.stringify(i))}catch(n){S.warn("Error caching server parameters:",n.message),kv(fh,"")}})}function b0(e){if(e){let t=Kd.get(e);t&&(window.clearTimeout(t),t=null,Kd.delete(e)),J(Yd).call(Yd,e)||e.cloudProxyServer!=="disabled"||Yd.push(e)}if(Kd.size<D("AP_CACHE_NUM")&&Yd.length>0){let t=Yd.shift();Kd.set(t,window.setTimeout(()=>O(null,null,function*(){let{appId:n,cname:r,token:i,stringUid:c,uid:l,proxyServer:u,role:h}=t;try{yield tde(n,r,i,l,u,c,h),Kd.has(t)&&b0(t)}catch(f){S.warn("update preload failed",f.message),bH(t)}}),D("AP_UPDATE_INTERVAL")))}}function bH(e){let t=Yd.indexOf(e);t!==-1&&Yd.splice(t,1);let n=Kd.get(e);n&&(window.clearTimeout(n),n=null,Kd.delete(e),b0())}function wH(e,t){let n=e.sua,r=e.ap;t&&n&&ue.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),ue.reportResourceTiming(e.ap.url,e.sid),ue.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[dn.CHOOSE_SERVER,dn.CLOUD_PROXY_FALLBACK].toString()}),ue.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[dn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function AH(e){return window.atob(window.localStorage.getItem(e)||"")}function kv(e,t){window.localStorage.setItem(e,window.btoa(t))}function DH(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),v2(t)}function rde(e){let t=(function(){let n=sde.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(n,r){let i=n.appId;i!==void 0&&(ln(r,10),Ac(r,i));let c=n.cid;c!==void 0&&(ln(r,16),ln(r,c));let l=n.cname;l!==void 0&&(ln(r,26),Ac(r,l));let u=n.deviceId;u!==void 0&&(ln(r,34),Ac(r,u));let h=n.elapse;h!==void 0&&(ln(r,40),Dc(r,h));let f=n.fileSize;f!==void 0&&(ln(r,48),Dc(r,mh(f)));let m=n.height;m!==void 0&&(ln(r,56),Dc(r,mh(m)));let E=n.jpg;E!==void 0&&(ln(r,66),ln(r,E.length),NH(r,E));let _=n.networkType;_!==void 0&&(ln(r,72),Dc(r,mh(_)));let y=n.osType;y!==void 0&&(ln(r,80),Dc(r,mh(y)));let A=n.requestId;A!==void 0&&(ln(r,90),Ac(r,A));let C=n.sdkVersion;C!==void 0&&(ln(r,98),Ac(r,C));let I=n.sequence;I!==void 0&&(ln(r,104),Dc(r,mh(I)));let N=n.sid;N!==void 0&&(ln(r,114),Ac(r,N));let L=n.timestamp;L!==void 0&&(ln(r,120),Dc(r,L));let M=n.uid;M!==void 0&&(ln(r,128),ln(r,M));let V=n.vid;V!==void 0&&(ln(r,136),ln(r,V));let j=n.width;j!==void 0&&(ln(r,144),Dc(r,mh(j)));let U=n.service;U!==void 0&&(ln(r,152),ln(r,U));let H=n.callbackData;H!==void 0&&(ln(r,162),ln(r,H.length),NH(r,H));let K=n.ticket;K!==void 0&&(ln(r,170),Ac(r,K));let Y=n.vendorConfigs;Y!==void 0&&(ln(r,178),Ac(r,Y))})(e,t),(function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)})(t)}function ide(e){return(function(n){let r={};e:for(;!ade(n);){let i=zf(n);switch(i>>>3){case 0:break e;case 1:r.code=zf(n);break;case 2:r.msg=PH(n,zf(n));break;case 3:r.requestId=PH(n,zf(n));break;case 4:r.timestamp=cde(n,!1);break;default:ode(n,7&i)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function ode(e,t){switch(t){case 0:for(;128&wo(e););break;case 2:w0(e,zf(e));break;case 5:w0(e,4);break;case 1:w0(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function mh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let sde=[];function w0(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function ade(e){return e.offset>=e.limit}function Mv(e,t){let n=e.bytes,r=e.offset,i=e.limit,c=r+t;if(c>n.length){let l=new Uint8Array(2*c);l.set(n),e.bytes=l}return e.offset=c,c>i&&(e.limit=c),r}function OH(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function NH(e,t){let n=Mv(e,t.length);e.bytes.set(t,n)}function PH(e,t){let n=OH(e,t),r=String.fromCharCode,i=e.bytes,c="\uFFFD",l="";for(let u=0;u<t;u++){let h,f,m,E,_=i[u+n];(128&_)==0?l+=r(_):(224&_)==192?u+1>=t?l+=c:(h=i[u+n+1],(192&h)!=128?l+=c:(E=(31&_)<<6|63&h,E<128?l+=c:(l+=r(E),u++))):(240&_)==224?u+2>=t?l+=c:(h=i[u+n+1],f=i[u+n+2],(49344&(h|f<<8))!=32896?l+=c:(E=(15&_)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?l+=c:(l+=r(E),u+=2))):(248&_)==240?u+3>=t?l+=c:(h=i[u+n+1],f=i[u+n+2],m=i[u+n+3],(12632256&(h|f<<8|m<<16))!=8421504?l+=c:(E=(7&_)<<18|(63&h)<<12|(63&f)<<6|63&m,E<65536||E>1114111?l+=c:(E-=65536,l+=r(55296+(E>>10),56320+(1023&E)),u+=3))):l+=c}return l}function Ac(e,t){let n=t.length,r=0;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),r+=u<128?1:u<2048?2:u<65536?3:4}ln(e,r);let i=Mv(e,r),c=e.bytes;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?c[i++]=u:(u<2048?c[i++]=u>>6&31|192:(u<65536?c[i++]=u>>12&15|224:(c[i++]=u>>18&7|240,c[i++]=u>>12&63|128),c[i++]=u>>6&63|128),c[i++]=63&u|128)}}function wo(e){return e.bytes[OH(e,1)]}function LH(e,t){let n=Mv(e,1);e.bytes[n]=t}function zf(e){let t,n=0,r=0;do t=wo(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function ln(e,t){for(t>>>=0;t>=128;)LH(e,127&t|128),t>>>=7;LH(e,t)}function cde(e,t){let n,r=0,i=0,c=0;return n=wo(e),r=127&n,128&n&&(n=wo(e),r|=(127&n)<<7,128&n&&(n=wo(e),r|=(127&n)<<14,128&n&&(n=wo(e),r|=(127&n)<<21,128&n&&(n=wo(e),i=127&n,128&n&&(n=wo(e),i|=(127&n)<<7,128&n&&(n=wo(e),i|=(127&n)<<14,128&n&&(n=wo(e),i|=(127&n)<<21,128&n&&(n=wo(e),c=127&n,128&n&&(n=wo(e),c|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|c<<24,unsigned:t}}function Dc(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,c=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,l=Mv(e,c),u=e.bytes;switch(c){case 10:u[l+9]=i>>>7&1;case 9:u[l+8]=c!==9?128|i:127&i;case 8:u[l+7]=c!==8?r>>>21|128:r>>>21&127;case 7:u[l+6]=c!==7?r>>>14|128:r>>>14&127;case 6:u[l+5]=c!==6?r>>>7|128:r>>>7&127;case 5:u[l+4]=c!==5?128|r:127&r;case 4:u[l+3]=c!==4?n>>>21|128:n>>>21&127;case 3:u[l+2]=c!==3?n>>>14|128:n>>>14&127;case 2:u[l+1]=c!==2?n>>>7|128:n>>>7&127;case 1:u[l]=c!==1?128|n:127&n}}let kH={},MH={},xv=4294967296,xH=xv*xv,UH=xH/2,A0=VH(0,!0),FH=VH(0),dde=gh(0,-2147483648,!1),lde=gh(-1,2147483647,!1),ude=gh(-1,-1,!0);function VH(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=MH[e],r)?r:(n=gh(e,0,!0),i&&(MH[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=kH[e],r)?r:(n=gh(e,e<0?-1:0,!1),i&&(kH[e]=n),n)}function gh(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function jH(e,t){if(isNaN(e))return t?A0:FH;if(t){if(e<0)return A0;if(e>=xH)return ude}else{if(e<=-UH)return dde;if(e+1>=UH)return lde}return e<0?t?A0:FH:gh(e%xv|0,e/xv|0,t)}function BH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class D0 extends jt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let n=this._connectionState;this._connectionState=t,this.emit(Zo.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),w(this,"name","AgoraRTCImageModeration"),w(this,"_connectionState",Wi.CONNECTING),w(this,"_sequence",0),w(this,"_moderationStartTime",void 0),w(this,"_workerConnection",void 0),w(this,"_workerMessageLengthLimit",void 0),w(this,"_qualityRatio",void 0),w(this,"_connectInfo",void 0),w(this,"_cancelTokenSource",Lr.CancelToken.source()),w(this,"_retryConfig",void 0),w(this,"_moderationInterval",void 0),w(this,"_moderationTimer",null),w(this,"_moderationMode",1),w(this,"_quality",1),w(this,"_qualityTimer",null),w(this,"_ticket",void 0),w(this,"_moderationIntervalMinimum",void 0),w(this,"_uploadFailedNum",0),w(this,"_uploadNum",0),w(this,"_uploadTimer",null),w(this,"_extraInfo",void 0),w(this,"_vendor",""),w(this,"_encoder",new TextEncoder),w(this,"_moderationId",void 0),w(this,"inspectImage",()=>{if(this.connectionState!==Wi.CONNECTED)throw new G(P.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Wi.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=at(5,"image-moderation-"),this._workerMessageLengthLimit=D("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=D("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=D("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new kf("worker-"+this._moderationId,cn),this.on(Zo.STATE_CHANGE,(r,i)=>{S.debug("[".concat(this._moderationId,"] Moderation operation :").concat(rh[r]," ").concat(i||""))}),this.handleWorkerEvents()}init(t,n){return O(this,null,function*(){this.emit(Zo.STATE_CHANGE,rh.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=n,new ie((i,c)=>{this.on(Zo.CONNECTION_STATE_CHANGE,(l,u)=>{l===Wi.CONNECTED&&i()}),this.requestAP(t,r,n).then(l=>{this.connectWorker(l)}).catch(l=>{c(l)})})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),S.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Wi.CONNECTED&&this.inspectImage()}requestAP(t,n,r){return O(this,null,function*(){let i=D("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),c=yield(function(h,f,m,E){let{appId:_,areaCode:y,cname:A,sid:C,token:I,uid:N}=f;ch++;let L="moderation_plugin",M={service_name:L,json_body:JSON.stringify({appId:_,areaCode:y,cname:A,command:"allocateEdge",requestId:ch,seq:ch,sid:C,appToken:I,ts:Date.now(),uid:N+""})},V,j,U=h[0];return Yo(()=>O(null,null,function*(){V=Date.now();let H=yield es(U,{data:M,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(j=Date.now()-V,H.code!==0){let Te=new G(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+H.code,{retry:!0,responseTime:j});throw S.error(Te.toString()),Te}let K=JSON.parse(H.json_body);if(K.code!==200){let Te=new G(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(K.code,", reason: ").concat(K.reason),{code:K.code,responseTime:j});throw S.error(Te.toString()),Te}if(!K.servers||!Array.isArray(K.servers)||K.servers.length===0){let Te=new G(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:K.code,responseTime:j});throw S.error(Te.toString()),Te}if(!K.servers.some(Te=>!!Te.wss)){let Te=new G(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:K.code,responseTime:j});throw S.error(Te.toString()),Te}let Y=D("IMAGE_MODERATION_WORKER_WSS");if(Y)return{addressList:[Y],workerToken:K.workerToken,vid:K.vid,responseTime:j};let ae=D("IMAGE_MODERATION_WORKER_HOST");return{addressList:K.servers.map(Te=>{let{address:Le,wss:De}=Te;if(Le&&De)return"wss://".concat(Le.replace(/\./g,"-"),".").concat(ae,":").concat(De,"/moderation")}).filter(Te=>!!Te),workerToken:K.workerToken,vid:K.vid,ticket:K.appTicket,responseTime:j}}),(H,K)=>(ue.apworkerEvent(C,{success:!0,sc:200,serviceName:L,responseDetail:JSON.stringify(H.addressList),firstSuccess:K===0,responseTime:j,serverIp:h[K%h.length]}),!1),(H,K)=>(ue.apworkerEvent(C,{success:!1,sc:H.data&&H.data.code||200,serviceName:L,responseTime:j,serverIp:h[K%h.length]}),!!(H.code!==P.OPERATION_ABORTED&&H.code!==P.UNEXPECTED_RESPONSE||H.data&&H.data.retry)&&(U=h[(K+1)%h.length],!0)),E)})(i,t,n,r);this.emit(Zo.STATE_CHANGE,rh.AP_CONNECTED);let{addressList:l,ticket:u}=c;return this._ticket=u,l})}connectWorker(t){return O(this,null,function*(){this.emit(Zo.STATE_CHANGE,rh.CONNECT_WORKER),yield this._workerConnection.init(t,1e4)})}handleWorkerEvents(){this._workerConnection.on(Ne.CONNECTED,()=>O(this,null,function*(){this.emit(Zo.STATE_CHANGE,rh.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Wi.CONNECTED})),this._workerConnection.on(Ne.CLOSED,()=>{this.connectionState=Wi.CLOSED}),this._workerConnection.on(Ne.FAILED,()=>{this.connectionState=Wi.CLOSED}),this._workerConnection.on(Ne.RECONNECTING,()=>{this.connectionState=this.connectionState===Wi.CONNECTED?Wi.RECONNECTING:Wi.CONNECTING}),this._workerConnection.on(Ne.ON_MESSAGE,t=>O(this,null,function*(){if(t.data instanceof ArrayBuffer){let n=ide(new Uint8Array(t.data));D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,S.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{ue.reportApiInvoke(this._connectInfo.sid||null,{name:Mt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:St.TRACER}).onError(new G(P.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},D("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else S.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(Ne.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(Ne.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}requestToInspectImage(){return O(this,null,function*(){let t=li(this,Zo.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being played can be inspected"));this._sequence++;let r=yield this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being published can be inspected")})}generateRequestData(t,n){return O(this,null,function*(){let{appId:r,cname:i,cid:c,vid:l,sid:u,uid:h}=n,f=Date.now(),m=yield t.getCurrentFrameImage("image/jpeg",this.quality),E=yield lV(m,r,i),_=this._sequence+"-"+c+"-"+h+"-"+f+"-"+at(12,""),y={appId:r,cid:c,cname:i,deviceId:"",elapse:D0.intToLong(Number(f-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.1",sequence:this._sequence,sid:u,timestamp:jH(f),uid:h,vid:l,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;let A=rde(y);if(A.byteLength<this._workerMessageLengthLimit){if(D("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let C=(function(I){for(var N=1;N<arguments.length;N++){var L=arguments[N]!=null?arguments[N]:{};N%2?BH(Object(L),!0).forEach(function(M){w(I,M,L[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(L)):BH(Object(L)).forEach(function(M){Object.defineProperty(I,M,Object.getOwnPropertyDescriptor(L,M))})}return I})({},y);delete C.jpg,S.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(C))}return A}{let C=this.quality*this._qualityRatio;return this.quality=C,yield this.generateRequestData(t,{appId:r,cname:i,cid:c,vid:l,sid:u,uid:h})}})}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Wi.CLOSED,this.emit(Zo.STATE_CHANGE,rh.CLOSED)}}function HH(e){if(yt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new G(P.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new G(P.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let hde={name:"ImageModeration",create:function(e){let{config:t}=e;return HH(t),new D0(t)}};var GH,WH,qH,zH,KH,YH,$H,XH,JH,ZH,QH,e3,t3,n3,r3,i3,o3,s3,a3,c3,d3,l3,u3,h3,p3,f3,m3,g3,_3,E3,v3,y3,S3,T3,C3,R3,I3,b3,w3,A3,D3,O3,ce;function N3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ao(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N3(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}Dn.setLogger(S);let pde=(GH=ve(),WH=ve({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Yu))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),qH=ve({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Ku.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),zH=ve({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),KH=ve({argsMap:(e,t,n)=>[t,n]}),YH=ve({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return[r?.uid,i]})}),$H=ve({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),XH=ve({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return{uid:r?.uid,mediaType:i}})}),JH=ve(),ZH=ve(),QH=ve(),e3=ve(),t3=ve(),n3=ve(),r3=ve(),i3=ve(),o3=ve(),s3=ve(),a3=ve(),c3=ve(),d3=ve(),l3=ve(),u3=ve(),h3=ve(),p3=ve({argsMap:(e,t)=>[t]}),f3=ve(),m3=ve(),g3=ve(),_3=ve(),E3=ve(),v3=ve(),y3=ve(),S3=ve(),T3=ve({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),C3=ve(),R3=ve(),I3=ve(),b3=ve(),w3=ve(),A3=ve(),D3=ve({reportResult:!0}),O3=ve(),ce=class extends jt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),w(this,"store",void 0),w(this,"_uid",void 0),w(this,"_channelName",void 0),w(this,"_uintUid",void 0),w(this,"_users",[]),w(this,"_config",void 0),w(this,"_clientId",void 0),w(this,"_appId",void 0),w(this,"_sessionId",null),w(this,"_key",void 0),w(this,"_rtmConfig",{}),w(this,"_joinInfo",void 0),w(this,"_gateway",void 0),w(this,"_statsCollector",void 0),w(this,"_configDistribute",void 0),w(this,"_leaveMutex",void 0),w(this,"_publishMutex",void 0),w(this,"_renewTokenMutex",void 0),w(this,"_subscribeMutex",void 0),w(this,"_encryptionMode","none"),w(this,"_encryptionSecret",null),w(this,"_encryptionSalt",null),w(this,"_encryptDataStream",!1),w(this,"_encryptDataStreamKey",null),w(this,"_encryptDataStreamIv",null),w(this,"_proxyServer",void 0),w(this,"_turnServer",{servers:[],mode:"auto"}),w(this,"_cloudProxyServerMode","disabled"),w(this,"_isDualStreamEnabled",!1),w(this,"_defaultStreamFallbackType",void 0),w(this,"_lowStreamParameter",void 0),w(this,"_streamFallbackTypeCacheMap",new Map),w(this,"_remoteStreamTypeCacheMap",new Map),w(this,"_axiosCancelSource",Lr.CancelToken.source()),w(this,"_audioVolumeIndicationInterval",void 0),w(this,"_networkQualityInterval",void 0),w(this,"_userOfflineTimeout",void 0),w(this,"_streamRemovedTimeout",void 0),w(this,"_rteDetailInterval",void 0),w(this,"_liveTranscodeStreamingClient",void 0),w(this,"_liveRawStreamingClient",void 0),w(this,"_channelMediaRelayClient",void 0),w(this,"_networkQualitySensitivity","normal"),w(this,"_p2pChannel",void 0),w(this,"_useLocalAccessPoint",!1),w(this,"_setLocalAPVersion",void 0),w(this,"_joinAndNotLeaveYet",!1),w(this,"_numberOfJoinCount",0),w(this,"_joinResponse",null),w(this,"_remoteDefaultVideoStreamType",void 0),w(this,"_inspect",void 0),w(this,"_moderation",void 0),w(this,"_license",void 0),w(this,"_pendingPublishedUsers",[]),w(this,"ntpAlignErrorCount",0),w(this,"remoteInboundOffset",0),w(this,"_peerConnectionState",void 0),w(this,"_pendingRtpCapabilityChange",void 0),w(this,"_fallbackServerInfo",void 0),w(this,"_dualStreamMode",void 0),w(this,"_handleLocalTrackEnable",(i,c,l)=>{this.publish(i,!1).then(c).catch(l)}),w(this,"_handleLocalTrackDisable",(i,c,l)=>{this.unpublish(i).then(c).catch(l)}),w(this,"_handleUserOnline",i=>{if(D("BLOCK_LOCAL_CLIENT")&&jd(i.uid,this.channelName))return void S.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let c=this._users.find(l=>l.uid===i.uid);if(c)c._trust_in_room_=!0,c._is_pre_created&&(c._is_pre_created=!1,this.safeEmit(Ue.USER_JOINED,c));else{let l=new bc(i.uid,i.uint_id||i.uid);this._users.push(l),S.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(l.uid,{userJoinNotify:Date.now()}),this.safeEmit(Ue.USER_JOINED,l)}}),w(this,"_handleUserOffline",i=>{if(D("BLOCK_LOCAL_CLIENT")&&jd(i.uid,this.channelName))return;let c=this._users.find(l=>l.uid===i.uid);c&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),c._audio_pre_subscribed||c._video_pre_subscribed?c._is_pre_created=!0:ME(this._users,c),this._remoteStreamTypeCacheMap.delete(c.uid),this._streamFallbackTypeCacheMap.delete(c.uid),S.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Ue.USER_LEAVED,c,i.reason))}),w(this,"_handleAddAudioOrVideoStream",(i,c,l,u,h,f,m,E)=>{if(D("BLOCK_LOCAL_CLIENT")&&jd(c,this.channelName))return;let _=this._users.find(C=>C.uid===c);if(!_)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(i)),this.store.subscribe(_.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(_.uid,{videoAddNotify:Date.now()});let y=i==="audio"?_.hasAudio:_.hasVideo;_._uintid||(_._uintid=f||c),i==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,i==="audio"?(_._audio_added_=!0,l!==void 0&&(_._audioSSRC=l),u!==void 0&&(_._cname=u),m&&(_._audioOrtc=m)):(_._video_added_=!0,l!==void 0&&(_._videoSSRC=l),u!==void 0&&(_._cname=u),E!==void 0&&(_._rtxSsrcId=E),m&&(_._videoOrtc=m)),(i==="audio"?_.hasAudio:_.hasVideo)&&!y&&(S.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(i)),this.safeEmit(Ue.USER_PUBLISHED,_,i)),i==="video"?ue.onGatewayStream(this._sessionId,mn.ON_ADD_VIDEO_STREAM,xt.ON_ADD_VIDEO_STREAM,{peer:f||c,ssrc:_._videoSSRC}):ue.onGatewayStream(this._sessionId,mn.ON_ADD_AUDIO_STREAM,xt.ON_ADD_AUDIO_STREAM,{peer:f||c,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,i,l).then(C=>{if(C&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof zd))return this._p2pChannel.unsubscribe(_,i,!0).then(()=>this._subscribe(_,i,!0).catch(I=>{S.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,i)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,i,!0).catch(C=>{S.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}));let A=this._getEncodingName(h);i==="video"&&(A==="unknown"?this.safeEmit(Ue.AV1_DECODABLE_RESULT,!1):An()||tr()||A?.toLocaleLowerCase()!==Pd.av1||xce().then(C=>{D("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Ue.AV1_DECODABLE_RESULT,C),C||this._gateway.downgradeCodec(A)}))}),w(this,"_handleRemoveStream",i=>{if(D("BLOCK_LOCAL_CLIENT")&&jd(i.uid,this.channelName))return;let c=this._users.find(u=>u.uid===i.uid);if(!c)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let l=()=>{};c.hasAudio&&c.hasVideo?l=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(Ue.USER_UNPUBLISHED,c,"audio"),S.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(Ue.USER_UNPUBLISHED,c,"video")}:c.hasVideo?l=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(Ue.USER_UNPUBLISHED,c,"video")}:c.hasAudio&&(l=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(Ue.USER_UNPUBLISHED,c,"audio")}),c._video_pre_subscribed||c._audio_pre_subscribed||(c._trust_audio_stream_added_state_=!0,c._trust_video_stream_added_state_=!0,c._audio_added_=!1,c._video_added_=!1,this._p2pChannel instanceof zd&&this._p2pChannel.unsubscribe(c).then(u=>{if(u)return this._gateway.unsubscribe(u,c.uid)}),c._audioSSRC=void 0,c._videoSSRC=void 0,c._audioOrtc=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),ue.onGatewayStream(this._sessionId,mn.ON_REMOVE_STREAM,xt.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),l()}),w(this,"_handleSetStreamLocalEnable",(i,c,l)=>{if(D("BLOCK_LOCAL_CLIENT")&&jd(c,this.channelName))return;let u=this._users.find(m=>m.uid===c);if(!u)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(l?"enabled":"disabled"," with uid ").concat(c));let h=i==="audio"?u.hasAudio:u.hasVideo;if(i==="audio"){u._trust_audio_enabled_state_=!0;let m=u._audio_enabled_;if(u._audio_enabled_=l,u._audio_enabled_===m)return;{let E=u._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(Ue.USER_INFO_UPDATED,c,E)}}else{u._trust_video_enabled_state_=!0;let m=u._video_enabled_;if(u._video_enabled_=l,u._video_enabled_===m)return;{let E=u._video_enabled_?"enable-local-video":"disable-local-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(Ue.USER_INFO_UPDATED,c,E)}}let f=i==="audio"?u.hasAudio:u.hasVideo;return h!==f?!h&&f?(S.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(i)),void this.safeEmit(Ue.USER_PUBLISHED,u,i)):(i==="video"&&u._videoTrack&&u._videoTrack._destroy(),i==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,i),S.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(i)),void this.safeEmit(Ue.USER_UNPUBLISHED,u,i)):void 0}),w(this,"_handleMuteStream",(i,c,l)=>{if(D("BLOCK_LOCAL_CLIENT")&&jd(i,this.channelName))return;S.debug("[".concat(this._clientId,"] receive mute message"),i,c,l);let u=this._users.find(m=>m.uid===i);if(!u)return void S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));let h=c==="audio"?u.hasAudio:u.hasVideo;if(c==="audio"){u._trust_audio_mute_state_=!0;let m=u._audio_muted_;if(u._audio_muted_=l,u._audio_muted_===m)return;{let E=u._audio_muted_?"mute-audio":"unmute-audio";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Ue.USER_INFO_UPDATED,i,E)}}else{u._trust_video_mute_state_=!0;let m=u._video_muted_;if(u._video_muted_=l,u._video_muted_===m)return;{let E=u._video_muted_?"mute-video":"unmute-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Ue.USER_INFO_UPDATED,i,E)}}let f=c==="audio"?u.hasAudio:u.hasVideo;if(h!==f){if(!h&&f)return(c==="audio"?u._audioSSRC:u._videoSSRC)?(S.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(c)),void this.safeEmit(Ue.USER_PUBLISHED,u,c)):void S.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(c," unmute message  before add stream message, ").concat(c," SSRC doesn't exist yet."));c==="video"&&u._videoTrack&&!u._video_pre_subscribed&&u._videoTrack._destroy(),c==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,c),S.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(c)),this.safeEmit(Ue.USER_UNPUBLISHED,u,c)}}),w(this,"_handleP2PLost",i=>O(this,null,function*(){S.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?yield this._p2pChannel.requestReconnect():S.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)})),w(this,"_handleTokenWillExpire",()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ue.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),w(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),w(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ue.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ue.NETWORK_QUALITY,i)}),w(this,"_handleP2PAddAudioOrVideoStream",(i,c,l,u)=>{let h=this._users.find(m=>m.uid===c);if(!h)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(i)),this.store.subscribe(h.uid,i,void 0,void 0,void 0,Date.now());let f=i==="audio"?h.hasAudio:h.hasVideo;i==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,i==="audio"?(h._audio_added_=!0,l!==void 0&&(h._audioSSRC=l),u!==void 0&&(h._audioMid=u)):(h._video_added_=!0,l!==void 0&&(h._videoSSRC=l),u!==void 0&&(h._videoMid=u)),(i==="audio"?h.hasAudio:h.hasVideo)&&!f&&(S.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(i)),this.safeEmit(Ue.USER_PUBLISHED,h,i)),this._p2pChannel.hasPendingRemoteMedia(h,i)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,i,!0).catch(m=>{S.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=e,this._clientId=t||at(5,"client-"),this.store=new class{constructor(i,c,l,u,h){we(this,"state",void 0),this.state={codec:i,audioCodec:c,mode:l,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Nd.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!h}}dispatch(i){this.state=(function(c,l){switch(l.type){case Re.SET_SESSION_ID:return te(te({},c),{},{sessionId:l.sessionId});case Re.SET_P2P_ID:return te(te({},c),{},{p2pId:l.p2pId});case Re.SET_UID:return te(te({},c),{},{uid:l.uid});case Re.SET_INT_UID:return te(te({},c),{},{intUid:l.intUid});case Re.SET_PUB_ID:return te(te({},c),{},{pubId:l.pubId});case Re.KEY_METRIC_CLIENT_CREATED:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{clientCreated:l.metric})});case Re.KEY_METRIC_JOIN_START:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{joinStart:l.metric})});case Re.KEY_METRIC_PRELOAD_START:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{preloadStart:l.metric})});case Re.KEY_METRIC_PRELOAD_END:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{preloadEnd:l.metric})});case Re.KEY_METRIC_JOIN_END:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{joinEnd:l.metric})});case Re.KEY_METRIC_REQUEST_AP_START:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{requestAPStart:l.metric})});case Re.KEY_METRIC_REQUEST_AP_END:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{requestAPEnd:l.metric})});case Re.KEY_METRIC_REQUEST_SUA_END:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{requestSUAEnd:l.metric})});case Re.KEY_METRIC_BEFORE_CONNECT:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{beforeConnect:l.metric})});case Re.KEY_METRIC_PEER_RECEIVER:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{peerReceiver:l.metric})});case Re.KEY_METRIC_SIGNAL_CONNECTED:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{signalConnected:l.metric})});case Re.KEY_METRIC_JOIN_REQ:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{joinReq:l.metric})});case Re.KEY_METRIC_JOIN_REP:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{joinRep:l.metric})});case Re.KEY_METRIC_JOIN_GATEWAY_START:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{joinGatewayStart:l.metric})});case Re.KEY_METRIC_JOIN_GATEWAY_END:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{joinGatewayEnd:l.metric})});case Re.KEY_METRIC_PEER_CONNECTION_START:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{peerConnectionStart:l.metric})});case Re.KEY_METRIC_PEER_CONNECTION_END:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{peerConnectionEnd:l.metric})});case Re.KEY_METRIC_DESCRIPTION_START:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{descriptionStart:l.metric})});case Re.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{signalChannelOpen:l.metric})});case Re.KEY_METRIC_ICE_CONNECTION_END:return te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{iceConnectionEnd:l.metric})});case Re.KEY_METRIC_PUBLISH:{let u=c.keyMetrics.publish,h=u.findIndex(f=>f.trackId===l.metric.trackId);return h!==-1?(u[h]=te(te({},u[h]),l.metric),te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{publish:[...u]})})):te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{publish:[...c.keyMetrics.publish,l.metric]})})}case Re.KEY_METRIC_SUBSCRIBE:{let u=c.keyMetrics.subscribe,h=u.findIndex(f=>f.userId===l.metric.userId&&f.type===l.metric.type);return h!==-1?(u[h]=te(te({},u[h]),l.metric),te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{subscribe:[...u]})})):te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{subscribe:[...c.keyMetrics.subscribe,l.metric]})})}case Re.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let u=c.keyMetrics.firstVideoFrameDecoded,h=u.findIndex(f=>f.userId===l.metric.userId);return h!==-1?(u[h]=te(te({},u[h]),l.metric),te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{firstVideoFrameDecoded:[...u]})})):te(te({},c),{},{keyMetrics:te(te({},c.keyMetrics),{},{firstVideoFrameDecoded:[...c.keyMetrics.firstVideoFrameDecoded,l.metric]})})}case Re.RESET_FIRST_VIDEO_FRAME_DECODED:return c.keyMetrics.firstVideoFrameDecoded=[],c;case Re.SET_CLOUD_PROXY_SERVER_MODE:return c.cloudProxyServerMode=l.mode,c;case Re.RECORD_JOIN_CHANNEL_SERVICE:return typeof l.index!="number"?c.joinChannelServiceRecords=[...c.joinChannelServiceRecords,l.record]:(c.joinChannelServiceRecords[l.index]=te(te({},c.joinChannelServiceRecords[l.index]),l.record),c.joinChannelServiceRecords=[...c.joinChannelServiceRecords]),c;case Re.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return c.joinChannelServiceRecords=[],c;case Re.RESET_KEY_METRICS:return c.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},c;case Re.SET_USE_P2P:return te(te({},c),{},{useP2P:l.val});case Re.SET_TRANSPORT_TYPE:return te(te({},c),{},{p2pTransport:l.val});case Re.SET_RTE_URL:return te(te({},c),{},{rteUrl:l.rteUrl});case Re.SET_RTE_SID:return te(te({},c),{},{rteSid:l.rteSid});default:return c}})(this.state,i)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(i){this.state.useDcSignal=i}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(i){this.state.networkQualityProbe=i}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(i){this.dispatch({type:Re.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set rteUrl(i){this.dispatch({type:Re.SET_RTE_URL,rteUrl:i})}get rteUrl(){return this.state.rteUrl}set rteSid(i){this.dispatch({type:Re.SET_RTE_SID,rteSid:i})}get rteSid(){return this.state.rteSid}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:Re.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:Re.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:Re.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:Re.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:Re.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:Re.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:Re.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:Re.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Re.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Re.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Re.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Re.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Re.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Re.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Re.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Re.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Re.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Re.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Re.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Re.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Re.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Re.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Re.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Re.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Re.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,c){this.dispatch({type:Re.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:te({userId:i},c)})}descriptionStart(){this.dispatch({type:Re.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Re.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Re.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,c,l,u){this.dispatch({type:Re.KEY_METRIC_PUBLISH,metric:te(te({trackId:i,type:c},l&&{publishStart:l}),u&&{publishEnd:u})})}subscribe(i,c,l,u,h,f,m){this.dispatch({type:Re.KEY_METRIC_SUBSCRIBE,metric:te(te(te(te(te({userId:i,type:c},l&&{subscribeStart:l}),u&&{subscribeEnd:u}),h&&{firstFrame:h}),f&&{streamAdded:f}),m&&{firstDecoded:m})})}massSubscribe(i,c,l,u){i.forEach(h=>{this.dispatch({type:Re.KEY_METRIC_SUBSCRIBE,metric:te(te(te({userId:h.userId,type:h.type},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),u&&{firstFrame:u})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,c){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(l=>l.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof c!="number"?(this.dispatch({type:Re.RECORD_JOIN_CHANNEL_SERVICE,record:te(te({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(c<0||c>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Re.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:c}),c)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Re.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Re.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Re.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,D("SIGNAL_CHANNEL")===1),this._leaveMutex=new Dn("client-leave",this._clientId),this._publishMutex=new Dn("client-publish",this._clientId),this._renewTokenMutex=new Dn("client-renewtoken",this._clientId),this._subscribeMutex=new Dn("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),S.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Vi," build: ").concat(rw,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{Hb(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){S.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new Gf(this.store),this._statsCollector.onStatsException=(i,c,l)=>{S.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(c,", uid: ").concat(l)),i===a0.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(u=>{u instanceof JE&&D("ENABLE_ENCODE_EXCEPTION")&&u.findClosestProfile()}),this.safeEmit(Ue.EXCEPTION,{code:i,msg:c,uid:l})},this._statsCollector.onUploadPublishDuration=(i,c,l,u)=>{let h=this._users.find(f=>f.uid===i);h&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(h.uid,{peerPublishDuration:l,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(h)),ue.peerPublishStatus(this._sessionId,{subscribeElapse:u,audioPublishDuration:c,videoPublishDuration:l,peer:h._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(D("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){let c=this.localTracks.find(l=>l instanceof Tt);c&&c._saveEncodeBitrateRatio!==1&&c.setSaveEncodeBitrateRatio(i==="h264"?D("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Oce(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||cn,httpRetryConfig:e.httpRetryConfig||cn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Bce(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},Qo("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new zd(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(c,l,u,h,f){return O(this,arguments,function*(e,t,n,r,i){let m=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],E=arguments.length>6&&arguments[6]!==void 0&&arguments[6];ft("JOIN_GATEWAY_USE_443PORT_ONLY",m),ft("JOIN_GATEWAY_USE_DUAL_DOMAIN",E);let _=this._gateway.signal.websocket;return _ instanceof Hw&&(_.use443PortOnly=m,_.tryDoubleDomain=E),(function(I,N,L){return O(this,arguments,function*(y,A,C){NE.get(y)||NE.set(y,[]),PE.get(y)||PE.set(y,A),Ds.get(y)||Ds.set(y,0);let M=NE.get(y),V=PE.get(y);if(!M||!V)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ds.get(y)===V){let Y=Sf();M.push(Y),yield Y.promise}Ds.set(y,Ds.get(y)+1);for(var j=arguments.length,U=new Array(j>3?j-3:0),H=3;H<j;H++)U[H-3]=arguments[H];let K=yield C(...U);return Ds.set(y,Ds.get(y)-1),Ds.get(y)===V-1&&M.length>0&&(M[0].resolve(),M.shift()),Ds.get(y)===0&&(NE.set(y,[]),PE.set(y,0),Ds.set(y,0)),K})})("client.join",D("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)})}join(e,t,n,r,i){return O(this,null,function*(){let c=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);let l=(FE||FE||(FE=(window.location.protocol.split(":")[0]||"").toUpperCase(),FE))==="HTTPS",u=S2()?window.isSecureContext:"Browser Not Support";(!S2()&&!l||!window.isSecureContext)&&S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let h;ue.setAppId(e);try{if(!n&&n!==null)throw new G(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Un(n,"token",1,2047),Un(e,"appid",1,2047),cv(t),r&&dv(r),i)if(typeof i=="string")Un(i,"optionalInfo",1,256),h=i;else{if(typeof i!="object")throw new G(P.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:I,enableInstantMuteRestore:N,networkQualityProbe:L}=i;I&&(Eo(I,"autoSubscribe"),S.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(I)),this.store.autoSubscribe=I),N&&(Eo(N,"enableInstantMuteRestore"),S.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(N)),this.store.enableInstantMuteRestore=N),L&&(Eo(L,"networkQualityProbe"),S.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(L)),this.store.networkQualityProbe=L)}}}catch(I){throw ue.reportApiInvoke(Od(),{name:Mt.JOIN,options:[e,t,n,r],states:{isHttps:l,isSecureContext:u},tag:St.TRACER}).onError(I),I}if(this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(yield this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let I=new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ue.reportApiInvoke(Od(),{name:Mt.JOIN,options:[e,t,n,r],states:{isHttps:l,isSecureContext:u},tag:St.TRACER}).onError(I),I}this._gateway.state="CONNECTING",this.store.preloadStart();let f=yield R0({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let m=f?.sid||Od();S.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(c)),this._sessionId||(this._sessionId=m,this.store.sessionId=this._sessionId);let E=ue.reportApiInvoke(this._sessionId,{id:this._clientId,name:Mt.JOIN,options:[e,t,n,r],states:{isHttps:l,isSecureContext:u},tag:St.TRACER}),_=Ao(Ao(Ao({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:h,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!f},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:D("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(_.stringUid=r,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=yield(I=>O(this,null,function*(){let N=(function(j){let U=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),H=new Uint8Array(new ArrayBuffer(U.length));for(let K=0;K<U.length;K+=1)H[K]=U.charCodeAt(K);return H})(),L=yield window.crypto.subtle.importKey("spki",N,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),M=jb(I),V=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},L,M);return(function(j){let U="";for(let H=0;H<j.length;H+=1)U+=String.fromCharCode(j[H]);return window.btoa(U)})(new Uint8Array(V))}))(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let I=new TextEncoder,N=D("USE_PURE_ENCRYPTION_MASTER_KEY")?I.encode(_.appId+this._encryptionSecret+this._encryptionSecret):I.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=yield(function(L,M,V){return O(this,null,function*(){let j=yield window.crypto.subtle.importKey("raw",M,"PBKDF2",!1,["deriveBits","deriveKey"]),U=L==="aes-128-gcm2"?128:256,H=yield window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:N2,hash:"SHA-256",salt:V},j,U+cae);return new Uint8Array(H).subarray(U/8)})})(this._encryptionMode,N,Dd(this._encryptionSalt)),this._encryptDataStreamKey=yield(function(L,M,V){return O(this,null,function*(){let j=yield window.crypto.subtle.importKey("raw",M,"PBKDF2",!1,["deriveBits","deriveKey"]),U=L==="aes-128-gcm2"?128:256;return yield window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:N2,hash:"SHA-256",salt:V},j,{name:"AES-GCM",length:U},!0,["encrypt","decrypt"])})})(this._encryptionMode,N,Dd(this._encryptionSalt))}else u?S.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):S.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,S.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:_.stringUid});let y=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&y===this._sessionId&&ue.joinChannelTimeout(this._sessionId,5)},5e3);try{var A;let I,N=_.cloudProxyServer;if(J(A=["proxy3","proxy4","proxy5"]).call(A,N)){let U=D("PROXY_SERVER_TYPE3");Array.isArray(U)?_.proxyServer=U[0]:_.proxyServer=U}if(ue.setProxyServer(_.proxyServer),S.setProxyServer(_.proxyServer),this.store.requestAPStart(),f){if(S.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(f.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=f.intUid),I={gatewayInfo:f.ap.gatewayInfo},D("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(f.ap.proxyInfo.addresses.length===0)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let U=(yield vB(f.ap.proxyInfo,f.ap.gatewayInfo.uid)).map(H=>({turnServerURL:H.address,tcpport:H.tcpport||Wn.tcpport,udpport:H.udpport||Wn.udpport,username:H.username||Wn.username,password:H.password||Wn.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:U}}wH(f,_.stringUid)}else{if(_.stringUid&&!_.uid){let U;[U,I]=yield ie.all([KB(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||cn,this.store).finally(()=>{this.store.requestSUAEnd()}),zB(_,this._axiosCancelSource.token,this._config.httpRetryConfig||cn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),S.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(U)),_.uid=U,I.gatewayInfo.uid=U,I.gatewayInfo.res.uid=U}else I=yield zB(_,this._axiosCancelSource.token,this._config.httpRetryConfig||cn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(Jo.UPDATE_BITRATE_LIMIT,U=>{this._p2pChannel.updateBitrateLimit(U)}),this._configDistribute.on(Jo.UPDATE_CLIENT_ROLE_OPTIONS,U=>{this._setClientRoleOptions(U)}),this._configDistribute.on(Jo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,U=>{var H;J(H=[0,1,4,5,6,7,8,9]).call(H,U)&&(this.remoteUsers.forEach(K=>{this._remoteStreamTypeCacheMap.get(K.uid)!==U&&this.setRemoteVideoStreamType(K.uid,U)}),this.setRemoteDefaultVideoStreamType(U))}),this._configDistribute.on(Jo.FALLBACK_TO_HLS,U=>{U&&this.safeEmit(Ue.FALLBACK_TO_HLS,Gb.CONFIG)}),this._configDistribute.on(Jo.UPDATE_VOS_CONFIGURE,U=>{this._gateway.setConfigure(U).catch(H=>{S.debug("[".concat(this._clientId,"] auto set vos config failed"),H)})})},0),this._key=n||e;let L=I.gatewayInfo,M=_.uid?_.uid:L.uid;this._joinInfo=Ao(Ao({},_),{},{cid:L.cid,uid:M,vid:L.vid,apResponse:L.res,apGatewayAddress:L.apGatewayAddress,uni_lbs_ip:L.uni_lbs_ip,gatewayAddrs:L.gatewayAddrs}),this.store.intUid=M,this.store.cid=L.cid;let V=yield this._joinGateway();if(!this._joinAndNotLeaveYet)throw new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess(V),this._appId=e,this._channelName=_.cname,this._uid=V,this.store.uid=V,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!An()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(An()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let j=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return S.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(j)),setTimeout(()=>{S.startUpload()},5e3),this.store.joinEnd(),C=this,J(Vd).call(Vd,C)||Vd.push(C),this._cloudProxyServerMode==="disabled"&&Ve().supportWebCrypto&&D("ENABLE_PRELOAD")&&b0(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&ue.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&ue.reportRteDetail(this._sessionId)},D("RTE_DETAIL_REPORT_INTERVAL")||6e4),V}catch(I){let N=Array.isArray(I)?I[0]:I;throw N&&N.code===P.OPERATION_ABORTED?S.warning("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),N):S.error("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),N),N.code!==P.OPERATION_ABORTED&&this._numberOfJoinCount===c&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(N),N}var C})}_joinGateway(){return O(this,null,function*(){if(!this._joinInfo||!this._key)throw new G(P.INVALID_OPERATION);try{return yield this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!D("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===P.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,He.FALLBACK),S.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new G(P.INVALID_OPERATION);return ue.reportApiInvoke(this._sessionId,{name:Mt.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:St.TRACER}).onSuccess(),yield this._joinGateway()}throw e}})}leave(){return O(this,null,function*(){S.info("[".concat(this._clientId,"] Leaving channel"));let e=()=>{!An()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(An()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(n){let r=Vd.indexOf(n);r!==-1&&Vd.splice(r,1)})(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();let t=yield this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();yield this._gateway.leave(this.connectionState!=="CONNECTED",He.LEAVE),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()})}publish(t){return O(this,arguments,function*(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Yu))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new G(P.INVALID_PARAMS,"param list is empty");let r=e;if(this._gateway.role==="audience")throw new G(P.INVALID_OPERATION,"audience can not publish stream");for(let c of r){if(!(c instanceof Yu))throw new G(P.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&n)throw new G(P.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}S.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))));let i=yield this._publishMutex.lock();yield this._configDistribute.awaitConfigDistributeComplete(),n&&r.forEach(c=>{let l=this._configDistribute.getBitrateLimit();c instanceof Tt&&l&&c.setBitrateLimit(l.uplink)});try{yield this._publishHighStream(r),S.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw S.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{i()}})}_publishDataChannel(e){return O(this,null,function*(){if(e==null)throw new G(P.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));yt(e.id,"id",0,65535,!0),Eo(e.ordered,"ordered"),Un(e.metadata,"metadata",0,512),S.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=yield this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new G(P.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new G(P.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&D("FORCE_TURN")&&!D("TURN_ENABLE_TCP")&&!D("TURN_ENABLE_UDP"))throw new G(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let n=(function(i){return UB(i,!1)})(e),r=yield this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new G(P.CREATE_DATACHANNEL_ERROR);try{yield ie.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),yield n._waitTillOpen()}catch(i){if(i.code!==P.DISCONNECT_P2P)throw i}}return S.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw S.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}})}unpublish(e){return O(this,null,function*(){if(!this._joinInfo||this._uid===void 0)throw new G(P.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Yu))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||(yield this._unpublishDataChannel()),t=this._p2pChannel.getAllTracks(!0);S.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));let n=yield this._publishMutex.lock();try{if(this.store.useP2P){let r=yield this._p2pChannel.unpublish(t);r&&(yield this._gateway.sendExtensionMessage(nn.UNPUBLISH,{unpubMsg:r},!0))}else{let r=yield this._p2pChannel.unpublish(t);r&&(yield this._gateway.unpublish(r,this._uid)),S.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw S.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}})}_unpublishDataChannel(e){return O(this,null,function*(){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),S.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));let t=yield this._publishMutex.lock();try{let n=yield this._p2pChannel.unpublishDataChannel(e);n&&(yield this._gateway.unpublishDataChannel(n)),S.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw S.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}})}subscribe(e,t,n){return O(this,null,function*(){if(!(e instanceof bc)){let r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new G(P.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)})}presubscribe(e,t){return O(this,null,function*(){if(an(t,"mediaType",["audio","video"]),this.store.useP2P)throw new G(P.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new G(P.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let n=t===de.AUDIO,r=t===de.VIDEO,i=yield this._subscribeMutex.lock();try{let{ssrcId:c,ortc:l,rtxSsrcId:u,cname:h,uint_id:f}=yield this._gateway.presubscribe(e,t,!0);if(c==null)throw new G(P.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(_=>_.uid===e);m||(m=new bc(e,f||e),m._is_pre_created=!0,this._users.push(m)),h&&(m._cname=h),m._uintid||(m._uintid=f||e),n&&(m._audioSSRC=c,m._audio_pre_subscribed=!0,l&&(m._audioOrtc=l)),r&&(m._videoSSRC=c,m._video_pre_subscribed=!0,l&&(m._videoOrtc=l),u!=null&&(m._rtxSsrcId=u)),S.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(c)),yield this._p2pChannel.subscribe(m,t,c,u,l);let E=n?m._audioTrack:m._videoTrack;if(!E)throw new G(P.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),r&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),E}catch(c){throw S.error("[".concat(this._clientId,"] presub user ").concat(e," error"),c),c}finally{i()}})}_subscribeDataChannel(e,t){return O(this,null,function*(){var n;if(yt(t,"channelId",0,65535,!0),!this._joinInfo)throw new G(P.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e))throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new G(P.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new G(P.INVALID_REMOTE_USER,"user is not published");let i=(n=e._dataChannels)===null||n===void 0?void 0:n.find(u=>u.id===t);if(!i)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new G(P.REMOTE_USER_IS_NOT_PUBLISHED);let c=yield this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let u=yield this._p2pChannel.subscribeDataChannel(e,[i]);if(u&&J(u).call(u,i.id))try{var l;if(typeof i._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new G(P.CREATE_DATACHANNEL_ERROR);let h={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(l=i.metadata)!==null&&l!==void 0?l:""};yield this._gateway.subscribeDataChannel(e.uid,h,!0),yield i._waitTillOpen()}catch(h){if(h?.code!==P.WS_ABORT)throw yield this._p2pChannel.unsubscribeDataChannel(e,[i]),h;yield this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{c()}})}_p2pSubscribe(e,t,n){return O(this,null,function*(){if(an(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){let c=new G(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){let c=new G(P.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let c=new G(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}let i=yield this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(yield this._p2pChannel.hasRemoteMediaWithLock(e,t))yield this._p2pChannel.unmuteRemote(e,t);else try{let l=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&(yield this._p2pChannel.subscribe(e,t,l,u))}catch(l){throw l}S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(l=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});let c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new G(P.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{i()}})}_subscribe(e,t,n){return O(this,null,function*(){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(an(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){let f=new G(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){let f=new G(P.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let f=new G(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let i=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?de.AUDIO:de.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});let h=yield this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(yield this._p2pChannel.hasRemoteMediaWithLock(e,t))yield this._p2pChannel.unmuteRemote(e,t);else try{let m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==i&&(i=m,c=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?de.AUDIO:de.VIDEO,ssrcId:i}),Xn.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),yield this._p2pChannel.subscribe(e,t,i,l,c);try{this._p2pChannel.isPreSubScribe(i)||(yield this._gateway.subscribe(e.uid,u,!0))}catch(E){if(E?.code!==P.WS_ABORT)throw yield this._p2pChannel.unsubscribe(e,t),E;yield this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m?.code,e,t),m}S.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});let f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new G(P.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),f}catch(f){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{h()}})}massSubscribe(e){return O(this,null,function*(){if(ya(e,"subscribeList"),!this._joinInfo)throw new G(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),n=new Map,r=yield this._subscribeMutex.lock();S.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(u=>{let{user:h,mediaType:f}=u;return"user: ".concat(h?.uid,", mediaType: ").concat(f)}).join("; ")));let i=(e=[...e]).map(u=>{let{user:h,mediaType:f}=u;return{user:h,mediaType:f}}),c=yield this._p2pChannel.globalLock();try{var l;for(let h=e.length-1;h>=0;h--){let f=e[h],{user:m,mediaType:E}=f;if(an(E,"mediaType",["audio","video"]),!m){let C=new G(P.INVALID_PARAMS,"user property does not exist in subscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===m)){let C=new G(P.INVALID_REMOTE_USER,"user is not in the channel");S.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),i[h].error=C,e.splice(h,1);continue}if(E==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||E==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){let C=new G(P.REMOTE_USER_IS_NOT_PUBLISHED);S.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(E,", remote user is not published")),i[h].error=C,e.splice(h,1);continue}let y=Rn.Video|Rn.LwoVideo,A=n.get(m);if(A){if(E==="video"?A&y:A&Rn.Audio){e.splice(h,1),S.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(E," twice"));continue}n.set(m,A|(E==="video"?y:Rn.Audio))}else n.set(m,E==="video"?y:Rn.Audio)}for(let h=e.length-1;h>=0;h--){let f=e[h],{user:m,mediaType:E}=f,_=Rn.Video|Rn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,E)){yield this._p2pChannel.unmuteRemoteNoLock(m,E);let y=n.get(m);n.set(m,E==="video"?y^_:y^Rn.Audio),e.splice(h,1)}}this.store.massSubscribe(e.map(h=>({userId:h.user.uid,type:h.mediaType})),t);let u=Ui(l=Array.from(n.entries())).call(l,(h,f)=>{let[m,E]=f;if(E===0)return h;let _={stream_id:m.uid,stream_type:E};return E&Rn.Audio&&(_.audio_ssrc=m._audioSSRC),E&Rn.Video&&(_.video_ssrc=m._videoSSRC),h.push(_),h},[]);try{e.length>0&&(yield this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:m,mediaType:E}=f;return{user:m,mediaType:E,ssrcId:E===de.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:E===de.VIDEO?m._rtxSsrcId:void 0}})));let h=new Map;if(u=u.filter(f=>f.video_ssrc&&!this._p2pChannel.isPreSubScribe(f.video_ssrc)||f.audio_ssrc&&!this._p2pChannel.isPreSubScribe(f.audio_ssrc)||!f.video_ssrc&&!f.audio_ssrc),u.length>0){let f=yield this._gateway.subscribeAll(u,!0);(f?.users||[]).forEach(m=>{let{stream_id:E,video_error_code:_,audio_error_code:y,error_code:A}=m;(_||y||A)&&h.set(E,{video_error_code:_,audio_error_code:y,error_code:A})})}if(Array.from(h.entries()).length>0){let f=[];Array.from(h.entries()).forEach(m=>{let[E,_]=m,y=this.remoteUsers.find(A=>A.uid===E);if(y){let A;_.error_code||_.video_error_code&&_.audio_error_code?A=void 0:_.video_error_code?A=de.VIDEO:_.audio_error_code&&(A=de.AUDIO),f.push({user:y,mediaType:A})}}),f.length>0&&(yield this._p2pChannel.massUnsubscribeNoLock(f))}for(let f of i){let m=h.get(f.user.uid);if(m){let E=m.error_code||f.mediaType==="audio"&&m.audio_error_code||f.mediaType==="video"&&m.video_error_code;if(E){let _=Hd(E);S.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(_.desc)),f.error=new G(P.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(_.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(i.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),i.forEach(f=>{var m;ue.subscribe(this.store.sessionId,{succ:!!f.error,ec:((m=f.error)===null||m===void 0?void 0:m.code)||null,video:f.mediaType===de.VIDEO,audio:f.mediaType===de.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===de.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(f.user._videoSSRC)},!0)}),S.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:m,mediaType:E}=f;return"user: ".concat(m?.uid,", mediaType: ").concat(E)}).join("; "))),i}catch(h){throw yield this._p2pChannel.massUnsubscribeNoLock(e),h}}finally{c(),r()}})}unsubscribe(e,t,n){return O(this,null,function*(){if(!(e instanceof bc)){let c=this.remoteUsers.find(l=>l.uid===e);if(!c)throw new G(P.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else yield this._unsubscribeDataChannel(e,n);if(t&&an(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(P.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){let c=new G(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let i=yield this._subscribeMutex.lock();try{if(this.store.useP2P)yield this._p2pChannel.unsubscribe(e,t);else{let c=yield this._p2pChannel.unsubscribe(e,t);c&&(yield this._gateway.unsubscribe(c,e.uid)),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&ME(this._users,e),S.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===P.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{i()}})}_unsubscribeDataChannel(e,t){return O(this,null,function*(){if(t&&yt(t,"id",0,65535,!0),!this._joinInfo)throw new G(P.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){let i=new G(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){let i=e._dataChannels.find(c=>c.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){let i=new G(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{let i=yield this._p2pChannel.unsubscribeDataChannel(e,r);i&&(yield this._gateway.unsubscribeDataChannel(i,e.uid)),S.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===P.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}})}massUnsubscribe(e){return O(this,null,function*(){if(ya(e,"unsubscribeList"),!this._joinInfo)throw new G(P.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");S.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r?.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];let t=new Map;for(let n=e.length-1;n>=0;n--){let{user:r,mediaType:i}=e[n];if(!r){let u=new G(P.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(an(i,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===r)){S.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}let l=Rn.Video|Rn.LwoVideo;if(t.has(r)){let u=t.get(r),h;switch(i){case"video":h=u&l;break;case"audio":h=u&Rn.Audio;break;default:h=u&(Rn.Audio|l)}if(h){S.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,u|Rn.Audio):i==="video"&&t.set(r,u|l):t.set(r,u|Rn.Audio|l)}else i?i==="audio"?t.set(r,Rn.Audio):i==="video"&&t.set(r,l):t.set(r,Rn.Audio|l)}try{let n=yield this._p2pChannel.massUnsubscribe(e);n&&(yield this._gateway.massUnsubscribe(n)),S.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:c}=r;return"user: ".concat(i?.uid,", mediaType: ").concat(c,";")}).join()))}catch(n){if(n.code===P.DISCONNECT_P2P)return void S.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw S.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}})}setLowStreamParameter(e){return O(this,null,function*(){(function(n){if(!n)throw new z(P.INVALID_PARAMS);qt(n.width)||Fb(n.width,"streamParameter.width"),qt(n.height)||Fb(n.height,"streamParameter.height"),qt(n.framerate)||Fb(n.framerate,"streamParameter.framerate"),qt(n.bitrate)||yt(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Z.LocalVideoLowTrack)})}setDualStreamMode(e,t){return O(this,null,function*(){an(e,"mode",[0,1,-1]);try{switch(t&&(yield this.setLowStreamParameter(t)),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(n=>{S.warning("[".concat(this._clientId,"] set dual stream mode failed"),n.toString())}):S.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case Uu.AUTO_SIMULCAST_STREAM:S.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case Uu.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case Uu.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(n){throw S.error("[".concat(this._clientId,"] set dual stream mode error"),n.toString()),n}})}enableDualStream(){return O(this,null,function*(){if(!Ve().supportDualStream)throw ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new G(P.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new G(P.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{yield this._publishLowStream()}catch(e){throw ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=Uu.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{S.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream"))})}disableDualStream(){return O(this,null,function*(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void S.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(Z.LocalVideoLowTrack))try{let e=yield this._p2pChannel.unpublishLowStream();e&&(yield this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid))}catch(e){throw ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=Uu.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{S.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream"))}})}setClientRole(e,t){return O(this,null,function*(){if((function(r){an(r,"role",["audience","host"])})(e),t&&Hb(t),this.mode==="rtc"||this.mode==="p2p")throw S.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new G(P.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new G(P.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new G(P.INVALID_OPERATION,"can not set client role to audience when publishing stream");let n=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==n&&D("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Gn.REGIONAL_DISTRIBUTION)):(yield this._gateway.setClientRole(e,t),this._config.role=e),S.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),n==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof zd){let{video_codec:r}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var c;return J(c=Object.keys(Pd)).call(c,i)}))}})}_setClientRoleOptions(e){return O(this,null,function*(){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&Hb(e),yield this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{S.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}})}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Un(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new G(P.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new G(P.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ue.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer),S.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new G(P.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new G(P.INVALID_OPERATION,"You have already set the proxy")}if(Id(e))return this._turnServer={servers:e,mode:"original-manual"},void S.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>d2(n)),this._turnServer={servers:e,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new G(P.INVALID_OPERATION,"you should set license before join channel");if(Un(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new G(P.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,S.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new G(P.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new G(P.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new G(P.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new G(P.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new G(P.INVALID_OPERATION,"Stop proxy server after leave channel");ue.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new G(P.INVALID_PARAMS,"accessPoints is required.");ya(e.accessPoints.serverList,"accessPoints.serverList"),Un(e.accessPoints.domain,"accessPoints.domain");let t=(_,y)=>{yt(_,y,0,65535,!0)},n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new G(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");D("CLOSE_AFB_FOR_LOCAL_AP")&&(ft("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),ft("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,c=e.accessPoints.serverList.map(_=>r.test(_)?"".concat(_.replace(/\./g,"-"),".").concat(i):_),l=c.map(_=>"".concat(_,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,ft("WEBCS_DOMAIN",l),ft("WEBCS_DOMAIN_BACKUP_LIST",l),ft("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ya(e.report.hostname,"report.hostname"),ft("EVENT_REPORT_DOMAIN",e.report.hostname[0]),ft("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(ft("EVENT_REPORT_DOMAIN",c[0]),ft("EVENT_REPORT_BACKUP_DOMAIN",c[1]||c[0]));let u=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),u=e.report.port),ft("STATS_COLLECTOR_PORT",u),e.report?ft("ENABLE_EVENT_REPORT",!0):ft("ENABLE_EVENT_REPORT",!1);let h="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ya(e.log.hostname,"log.hostname"),h=e.log.hostname[0]):h=c[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),ft("LOG_UPLOAD_SERVER","".concat(h,":").concat(f));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ya(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=c;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),ft("CDS_AP",m.map(_=>"".concat(_,":").concat(E))),e.cds?ft("ENABLE_CONFIG_DISTRIBUTE",!0):ft("ENABLE_CONFIG_DISTRIBUTE",!1),S.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ya(e,"serverList"),Un(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new G(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,ft("WEBCS_DOMAIN",e),ft("WEBCS_DOMAIN_BACKUP_LIST",e),ft("GATEWAY_DOMAINS",[t]),ft("EVENT_REPORT_DOMAIN",e[0]),ft("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),ft("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),S.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(e){return O(this,null,function*(){if(an(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{yield this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw S.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else S.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))})}setRemoteVideoStreamType(e,t){return O(this,null,function*(){an(t,"streamType",[0,1,4,5,6,7,8,9]);try{yield this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw S.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)})}setStreamFallbackOption(e,t){return O(this,null,function*(){an(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{yield this._gateway.setStreamFallbackOption(e,t)}catch(n){throw S.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)})}setEncryptionConfig(e,t,n,r){(function(c){an(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Un(t,"secret");let i=["aes-128-gcm2","aes-256-gcm2"];if(J(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new G(P.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new G(P.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Eo(r,"encryptDataStream"),!J(i).call(i,e))throw new G(P.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=vc(n))}renewToken(e){return O(this,null,function*(){if(Un(e,"token",1,2047),!this._key||!this._joinInfo)throw new G(P.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let n=yield this._renewTokenMutex.lock();try{if(D("USE_NEW_TOKEN")){S.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let r=yield jce(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||cn);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),yield this._gateway.renewToken({token:e,ticket:r})}else S.debug("[".concat(this._clientId,"] start renew token without ticket")),yield this._gateway.renewToken({token:e});S.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,S.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}})}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?S.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(Ue.VOLUME_INDICATOR,e)},D("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}startLiveStreaming(e,t){return O(this,null,function*(){if(!t){if(this.codec!=="h264")throw new G(P.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new G(P.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new G(P.LIVE_STREAMING_TASK_CONFLICT);let n=t?Ms.TRANSCODE:Ms.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)})}setLiveTranscoding(e){return this._createLiveStreamingClient(Ms.TRANSCODE).setTranscodingConfig(e)}stopLiveStreaming(e){return O(this,null,function*(){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new G(P.INVALID_PARAMS,"can not find live streaming url to stop");yield ie.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))})}startChannelMediaRelay(e){return O(this,null,function*(){QB(e),yield this._createChannelMediaRelayClient().startChannelMediaRelay(e)})}updateChannelMediaRelay(e){return O(this,null,function*(){QB(e),yield this._createChannelMediaRelayClient().updateChannelMediaRelay(e)})}stopChannelMediaRelay(){return O(this,null,function*(){yield this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)})}sendAudioMetadata(e){this._p2pChannel instanceof zd&&this._p2pChannel.addAudioMetadata(e)}sendStreamMessage(t){return O(this,arguments,function*(e){var n;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new G(P.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let c=new TextEncoder;e.payload=c.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&J(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)&&(i=!0,e.payload=yield(function(c,l,u){return O(this,null,function*(){var h;let f=Ui(h=Array.from(u)).call(h,(I,N)=>I+N,0),m={serverTs:0,seq:dae++,length:u.length,checkSum:f},E=new Uint8Array(E2(f,2)),_=new ArrayBuffer(Gu),y=new DataView(_);y.setUint32(0,m.serverTs),y.setUint16(4,m.seq),y.setUint16(6,m.length),y.setUint16(8,m.checkSum);let A=16-u.length%16;u=p2(u,new Uint8Array(A));let C=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:O2,additionalData:E},l,u);return p2(new Uint8Array(_),new Uint8Array(C))})})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new G(P.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(fe.DATA_STREAM,{payload:vc(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-$ce},!r)})}sendMetadata(e){if(!this._joinInfo)throw new G(P.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new G(P.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(fe.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:vc(e)})}sendCustomReportMessage(e){return O(this,null,function*(){if(Array.isArray(e)||(e=[e]),e.forEach(Eae),!this._joinInfo)throw new G(P.INVALID_OPERATION,"can not send custom report, not joined");yield ue.sendCustomReportMessage(this._joinInfo.sid,e)})}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let e=this._statsCollector.getRemoteNetworkQualityStats();if(D("DELETE_NEQ_AFTER_USER_LEAVE")){let t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{J(t).call(t,n)||delete e[n]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}pickSVCLayer(e,t){return O(this,null,function*(){an(t.spatialLayer,"spatialLayer",[0,1,2,3]),an(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield this._gateway.pickSVCLayer(e,t)}catch(n){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}})}setRTMConfig(e){return O(this,null,function*(){let{apRTM:t=!1,rtmFlag:n}=e;if(Eo(t,"apRTM"),yt(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,S.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)})}_reset(){if(S.debug("[".concat(this._clientId,"] reset client")),(function(e){let t=th.indexOf(e);t!==-1&&th.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Lr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&bH(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&ue.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ue.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Dn("client-publish",this._clientId),this._subscribeMutex=new Dn("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;let r=e||Od();e?S.debug("[".concat(this._clientId,"] new Session ").concat(r)):S.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));let i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,ue.addSid(r);let c={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};ue.sessionInit(this._sessionId,Ao({cname:t.channel,appid:t.appId},c)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}_publishHighStream(e){return O(this,null,function*(){if(!this._joinInfo||this._uid===void 0)throw new G(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&D("FORCE_TURN")&&!D("TURN_ENABLE_TCP")&&!D("TURN_ENABLE_UDP"))throw new G(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{let n=yield this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let r=(yield n.next()).value;if(r){try{yield this._gateway.sendExtensionMessage(nn.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}yield n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let r=(yield n.next()).value;if(r){var t;let i;try{i=yield this._gateway.publish(this._uid,r,!0)}catch(c){if(c.code!==P.DISCONNECT_P2P)throw n.throw(c),c}yield n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let i of e)i instanceof Tt&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(c=>{S.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||(yield this._p2pChannel.muteLocalTrack(i))}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===P.WS_ABORT)return;throw n}})}_publishLowStream(){return O(this,null,function*(){if(!this._joinInfo||this._uid===void 0)throw new G(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let n=yield this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(yield n.next()).value;if(r){var t;let i;try{i=yield this._gateway.publish(this._uid,r,!0)}catch(c){if(c.code!==P.DISCONNECT_P2P)throw n.throw(c),c}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===P.WS_ABORT)return;throw n}})}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new G(P.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Qo("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,c)=>{ue.reportApiInvoke(this._sessionId,{name:Mt.ON_LIVE_STREAM_ERROR,options:[i,c],tag:St.TRACER}).onSuccess(),this.safeEmit(Ue.LIVE_STREAMING_ERROR,i,c)},n.onLiveStreamWarning=(i,c)=>{ue.reportApiInvoke(this._sessionId,{name:Mt.ON_LIVE_STREAM_WARNING,options:[i,c],tag:St.TRACER}).onSuccess(),this.safeEmit(Ue.LIVE_STREAMING_WARNING,i,c)},n.on(Vw.REQUEST_WORKER_MANAGER_LIST,(i,c,l)=>{if(!this._joinInfo)return l(new G(P.INVALID_OPERATION,"can not find join info to get worker manager"));(function(u,h,f,m){return O(this,null,function*(){let E=D("UAP_AP").slice(0,D("AJAX_REQUEST_CONCURRENT")).map(_=>h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap"));return yield Lce(E,u,h,f,m)})})(i,this._joinInfo,this._axiosCancelSource.token,cn).then(c).catch(l)}),n};return e===Ms.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new G(P.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Qo("ChannelMediaRelay").create(e));r.on("state",i=>{i===Yr.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Ue.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(Ue.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,c)=>{var l;i==="resolution"&&((l=this._channelMediaRelayClient)===null||l===void 0||l.setVideoProfile(c))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:n,deleted:r}=e,i=[];if(t){let c=[];this._users.forEach(l=>{l._dataChannels.forEach(u=>{n.every(h=>h.uid!==l._uintid||h.stream_id!==u.id)&&c.push({uid:l._uintid,stream_id:u.id,ordered:u.ordered,max_retrans_times:u.maxRetransmits,metadata:u.metadata})})}),c.length>0&&this._handleUpdateDataChannel({added:[],deleted:c})}Array.isArray(n)&&n.length>0&&n.forEach(c=>{let{uid:l,stream_id:u,ordered:h,max_retrans_times:f,metadata:m}=c,E=this._users.find(_=>_._uintid===l);if(!E)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(S.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(l)),J(i).call(i,E)||i.push(E),E._uintid||(E._uintid=l),E._dataChannels.findIndex(_=>_.id===c.stream_id)===-1){let _={id:u,ordered:!!h,maxRetransmits:f,metadata:m},y=(function(A){return UB(A,!0)})(_);E._dataChannels.push(y),S.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(Ue.USER_PUBLISHED,E,"datachannel",_)}this._p2pChannel.hasPendingRemoteDataChannel(E,c.stream_id)&&(S.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,c.stream_id).catch(_=>{S.error("[".concat(this._clientId,"] resubscribe datachannel error"),_.toString())}))}),t&&(this.safeEmit(Ue.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(c=>{let{uid:l,stream_id:u}=c,h=this._users.find(m=>m._uintid===l);if(!h)return void S.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let f=h._dataChannels.find(m=>m.id===c.stream_id);f&&(S.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(l)),this._p2pChannel.unsubscribeDataChannel(h,[f]).then(m=>{if(h._dataChannels=h._dataChannels.filter(E=>E!==f),m)return this._gateway.unsubscribeDataChannel(m,h.uid)}),S.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(Ue.USER_UNPUBLISHED,h,"datachannel",f._config))})}_getEncodingName(e){var t,n;if(!this._joinResponse)return;let r=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!r)return;for(let u of r){var i;if(u.payloadType===e)return u==null||(i=u.rtpMap)===null||i===void 0?void 0:i.encodingName}let c=(n=this._joinResponse.ortc.rtpCapabilities.recv)===null||n===void 0?void 0:n.videoCodecs;if(c)for(let u of c){var l;if(u.payloadType===e)return u==null||(l=u.rtpMap)===null||l===void 0?void 0:l.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){let t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){S.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Ue.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(tn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void S.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{let{value:i,type:c,expires:l}=t[r];l&&l<=n||c||Pw()||!Object.prototype.hasOwnProperty.call(HE,r)||(yi[r]=i,ct[r]=i,S.debug("Update gateway parameters from config distribute",r,i))})}catch(t){S.error("Error update config from local cache",t.message)}})()}),this._gateway.on(tn.DISCONNECT_P2P,()=>O(this,null,function*(){yield this._p2pChannel.disconnectForReconnect()})),this._gateway.on(tn.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===He.FALLBACK)return;let i=()=>{this.safeEmit(Ue.CONNECTION_STATE_CHANGE,e,t,n)};if(ue.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Mt.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:St.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),S.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(l=>{l._trust_in_room_=!1,l._trust_audio_enabled_state_=!1,l._trust_video_enabled_state_=!1,l._trust_audio_mute_state_=!1,l._trust_video_mute_state_=!1,l._trust_audio_stream_added_state_=!1,l._trust_video_stream_added_state_=!1,l._is_pre_created||(l._audio_pre_subscribed||(l._audioSSRC=void 0,l._audioOrtc=void 0),l._video_pre_subscribed||(l._videoSSRC=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),l._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var c;this._streamFallbackTypeCacheMap.forEach((l,u)=>{this._gateway.setStreamFallbackOption(u,l).catch(h=>{S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((l,u)=>{this._gateway.setRemoteVideoStreamType(u,l).catch(h=>{S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),D("VOS_CONFIGURE")&&Array.isArray(D("VOS_CONFIGURE"))&&D("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(D("VOS_CONFIGURE")).catch(l=>{S.debug("[".concat(this._clientId,"] auto set vos config failed"),l)}),S.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((c=this._joinInfo)===null||c===void 0?void 0:c.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{S.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(l=>{S.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(l))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(l=>{S.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),l)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(l=>!l._trust_in_room_).forEach(l=>{S.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(l.uid)),this._handleUserOffline({uid:l.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(l=>{l._trust_audio_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,de.AUDIO,!1)),l._trust_video_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,de.VIDEO,!1)),l._trust_audio_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(l.uid)),this._handleSetStreamLocalEnable("audio",l.uid,!0)),l._trust_video_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(l.uid)),this._handleSetStreamLocalEnable("video",l.uid,!0)),l._trust_video_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(l.uid)),this._handleResetAddStream(l,"video")),l._trust_audio_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(l.uid)),this._handleResetAddStream(l,"audio")),l._video_added_||l._audio_added_||(S.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(l.uid)),this._handleRemoveStream({uid:l.uid,uint_id:l._uintid}))}))},1e3))}i()}),this._gateway.on(tn.REQUEST_NEW_GATEWAY_LIST,(e,t)=>O(this,null,function*(){if(!this._joinInfo)return t(new G(P.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;if(this._fallbackServerInfo)n=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,ue.reportApiInvoke(this._sessionId,{name:Mt.VOS_FALLBACK_CN,options:{cur:n.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:St.TRACER}).onSuccess(),S.info("[".concat(this._clientId,"] use fallback cn server info"));else{let i=yield R0(Ao(Ao({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,wH(i),this._joinInfo.preload=!0):(n=yield Rv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||cn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);let r=[];n.gatewayInfo.gatewayAddrs.forEach(i=>{let{address:c}=i,[l,u]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:u}):r.push({host:l,port:u})}),e(r)}catch(n){t(n)}})),this._gateway.on(tn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ue.NETWORK_QUALITY,e)}),this._gateway.on(tn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Ue.STREAM_TYPE_CHANGED,e,t),ue.reportApiInvoke(this._sessionId,{name:Mt.STREAM_TYPE_CHANGE,options:[e,t],tag:St.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(tn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(tn.REQUEST_P2P_CONNECTION_PARAMS,(e,t,n)=>O(this,null,function*(){try{let r=yield this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=yield this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}})),this._gateway.on(tn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:S.debug("no attributes in joinResponse");let r=wB(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(tn.PRE_CONNECT_PC,(e,t,n)=>O(this,null,function*(){let{candidates:r,fingerprint:i,turnServer:c}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){let{cert:u,cid:h}=this._joinInfo.apResponse,f="".concat(h,"_").concat(u);if(f.length<4||f.length>256)return void S.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(f.length));yield this._p2pChannel.startP2PConnection({turnServer:c,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var l;t(yield this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(u),icePwd:"".concat(h,"_").concat(u)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(l=D("FINGERPRINT"))!==null&&l!==void 0?l:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(m){m.code&&m.code===P.EXCHANGE_SDP_FAILED&&(yield this._p2pChannel.startP2PConnection({turnServer:c,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)),n(m)}}})),this._gateway.on(tn.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(Ue.FALLBACK_TO_HLS,Gb.VOSERROR)}),this._gateway.on(tn.RESET_SIGNAL,()=>{this._p2pChannel instanceof zd&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(tn.DATACHANNEL_FAILBACK,()=>{ue.reportApiInvoke(this._sessionId,{name:Mt.DATACHANNEL_FAILBACK,options:{},tag:St.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ie.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ie.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ie.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Ie.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Ie.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Ie.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Ie.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ie.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ie.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,de.AUDIO,!0)),this._gateway.signal.on(Ie.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,de.AUDIO,!1)),this._gateway.signal.on(Ie.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,de.VIDEO,!0)),this._gateway.signal.on(Ie.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,de.VIDEO,!1)),this._gateway.signal.on(Ie.RECEIVE_METADATA,e=>{let t=Dd(e.metadata);this.safeEmit(Ue.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Ie.ON_DATA_STREAM,e=>O(this,null,function*(){var t;if(!e)return;let n=Dd(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&J(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Gu)throw new G(P.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Gu));n=yield(function(c,l,u){return O(this,null,function*(){let h=u.subarray(0,Gu),f=h.slice(8,Gu),m=(f[0]<<8)+f[1],E=(h[6]<<8)+h[7],_=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:O2,additionalData:new Uint8Array(E2(m,2))},l,u.subarray(Gu));return new Uint8Array(_).subarray(0,E)})})(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){let i=this._p2pChannel.getStats(),c=this.remoteUsers.find(u=>u.uid===e.uid),l=i?.audioRecv.find(u=>u.ssrc===c?._audioSSRC);r=l?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),Jce(Ao(Ao({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(Ie.ON_CRYPT_ERROR,()=>{Ec(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ue.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ie.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ie.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,He.TOKEN_EXPIRE),this.safeEmit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ie.ON_STREAM_FALLBACK_UPDATE,e=>{S.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Ue.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ie.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===Uu.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{S.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(Ie.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),S.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Ie.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Ie.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(pe.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case fe.PUBLISH:{if(!t)return;let i=t.ortc;if(i){var n,r;let c=i.some(h=>{let{stream_type:f}=h;return f===dt.Audio}),l=i.some(h=>{let{stream_type:f}=h;return f!==dt.Audio}),u=i.some(h=>{let{stream_type:f}=h;return f===dt.Screen||f===dt.ScreenLow});t.state==="offer"&&ue.publish(this._joinInfo.sid,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:P.TIMEOUT,audio:c,video:l,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:u,audioName:c?(n=i.find(h=>{let{stream_type:f}=h;return f===dt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:l?(r=i.find(h=>{let{stream_type:f}=h;return f!==dt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case fe.SUBSCRIBE:t&&ue.subscribe(this._joinInfo.sid,{succ:!1,ec:P.TIMEOUT,audio:t.stream_type===de.AUDIO,video:t.stream_type===de.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Xn.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Ie.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Ie.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;D("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!jd(r.string_id||r.stream_id,this.channelName)));let t=[],n=[];for(let r of e.users){let i=this._users.find(m=>m._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new bc(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Ue.PUBLISHED_USER_LIST).length===0&&(S.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Ue.USER_JOINED,i)));let c=Rn.Audio&r.stream_type,l=(Rn.Video|Rn.LwoVideo)&r.stream_type,u=(65280&r.stream_type)!=0,h=c&&i.hasAudio,f=l&&i.hasVideo;l&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),c&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),c&&!h&&this.getListeners(Ue.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Ue.USER_PUBLISHED,i,"audio")),l&&!f&&this.getListeners(Ue.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Ue.USER_PUBLISHED,i,"video")),(c&&!h||l&&!f||u)&&t.push(i),l&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),c&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(S.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{S.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Ue.PUBLISHED_USER_LIST).length>0?D("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(S.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Ue.PUBLISHED_USER_LIST,t)):S.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Ie.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;if(this._p2pChannel instanceof zd){if(this.role==="audience"&&D("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void S.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return J(r=Object.keys(Pd)).call(r,n)}))}}),this._gateway.signal.on(pe.VOS_FALLBACK_PROMISE,(e,t,n)=>O(this,null,function*(){if(e==="FALLBACKCN"&&D("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return n(new G(P.UNEXPECTED_ERROR,"can not recover, no join info"));S.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));let i=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;let c=yield Rv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||cn,this.store);if(D("QUALITY_FALLBACK_REHEARSAL"))return ue.reportApiInvoke(this._sessionId,{name:Mt.VOS_FALLBACK_CN,options:{cur:c.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:St.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=i,void n();this._fallbackServerInfo=c,t()}catch(c){var r;let l=c==null||(r=c.data)===null||r===void 0?void 0:r.desc;D("QUALITY_FALLBACK_REHEARSAL")?(ue.reportApiInvoke(this._sessionId,{name:Mt.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+l||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:St.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=i):Array.isArray(l)&&J(l).call(l,"request downgrade fallback")&&this.safeEmit(Ue.FALLBACK_TO_HLS,Gb.AP_ERROR),n(c)}}else n()}))}_handleP2PEvents(){this._gateway.signal.on(Ie.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(nn.PUBLISH,(e,t,n)=>{let{uid:r}=e;e.forEach(i=>{let{kind:c,ssrcs:l,mid:u,isMuted:h}=i;this._handleP2PAddAudioOrVideoStream(c,r,l[0].ssrcId,u);let f=this._users.find(m=>m.uid===r);return f&&this.store.useP2P?this._p2pChannel.mockSubscribe(f,c,l[0].ssrcId,u).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,c,!!h)})}),this._gateway.signal.on(nn.CALL,(e,t,n)=>O(this,null,function*(){if(this.store.useP2P)try{var r;t(yield this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}})),this._gateway.signal.on(pe.P2P_CONNECTION,e=>O(this,null,function*(){this.store.useP2P&&(yield this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(nn.UNPUBLISH,(e,t,n)=>O(this,null,function*(){if(this.store.useP2P){let{unpubMsg:r,uid:i}=e,c=this._users.find(l=>l.uid===i);if(!c)return S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(l=>O(this,null,function*(){let{stream_type:u}=l,h=u===dt.Audio?de.AUDIO:de.VIDEO;yield this._p2pChannel.unsubscribe(c,h),this._handleMuteStream(i,h,!0)})),t()}catch(l){n(l)}}})),this._gateway.signal.on(nn.CONTROL,(e,t)=>O(this,null,function*(){let{action:n}=e;switch(n){case Cc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,de.VIDEO,!0);break;case Cc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,de.AUDIO,!0);break;case Cc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,de.VIDEO,!1);break;case Cc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,de.AUDIO,!1)}})),this._gateway.signal.on(nn.RESTART_ICE,(e,t,n)=>O(this,null,function*(){if(this.store.useP2P)try{let{direction:r,iceParameter:i}=e;r!==Ir.SEND_ONLY||i?t(yield this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}})),this._gateway.signal.on(nn.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(me.RequestP2PRestartICE,(e,t,n)=>O(this,null,function*(){try{let{direction:r}=e;t(yield this._gateway.sendExtensionMessage(nn.RESTART_ICE,e,r===Ir.SEND_ONLY))}catch(r){n(r)}})),this._p2pChannel.on(me.LocalCandidate,e=>{this._gateway.sendExtensionMessage(nn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(me.RequestP2PMuteLocal,(e,t,n)=>O(this,null,function*(){try{yield this._gateway.sendExtensionMessage(nn.CONTROL,e,!0),t()}catch(r){n(r)}})),this._p2pChannel.on(me.RequestP2PUnmuteRemote,(e,t,n)=>O(this,null,function*(){if(this._joinInfo)try{yield this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===P.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(me.RequestP2PMuteRemote,(e,t,n)=>O(this,null,function*(){if(this._joinInfo)try{yield this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===P.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(me.StateChange,(e,t)=>{t===it.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(me.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(Ue.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(me.RequestMuteLocal,(e,t,n)=>O(this,null,function*(){if(this._joinInfo)try{yield this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===P.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(me.RequestUnmuteLocal,(e,t,n)=>O(this,null,function*(){if(this._joinInfo)try{yield this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===P.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(me.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(me.RequestRePublishDataChannel,(e,t,n)=>{ie.all(e.map(r=>O(this,null,function*(){let i=yield this._p2pChannel.publishDataChannel([r]);try{i.forEach(c=>{this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)})}catch(c){if(c.code!==P.DISCONNECT_P2P)throw c}}))).then(t).catch(n)}),this._p2pChannel.on(me.RequestReSubscribe,(e,t,n)=>O(this,null,function*(){try{for(let{user:r,kind:i}of e)i===de.VIDEO?yield this.subscribe(r,"video"):yield this.subscribe(r,"audio");t()}catch(r){n(r)}})),this._p2pChannel.on(me.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(me.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(me.MediaReconnectStart,e=>{this.safeEmit(Ue.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(me.MediaReconnectEnd,e=>{this.safeEmit(Ue.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(me.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(me.RequestRestartICE,e=>O(this,null,function*(){if(this.store.useP2P)return;let t=yield this._p2pChannel.restartICE(e),n=yield t.next();if(n.done)return;let r=n.value,i;try{i=yield this._gateway.restartICE({iceParameters:r})}catch(l){return void t.throw(l)}let{iceParameters:c}=(function(l){let u=l.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}})(i);yield t.next({remoteIceParameters:c})})),this._p2pChannel.on(me.RequestReconnect,()=>O(this,null,function*(){this._gateway.reconnect()})),this._p2pChannel.on(me.RequestReconnectPC,()=>O(this,null,function*(){var e;let{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=yield this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:c}=yield this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),l=wB(i,c);yield this._p2pChannel.connect(l),yield this._p2pChannel.republish(),yield this._p2pChannel.reSubscribe()})),this._p2pChannel.on(me.RequestUnpublishForReconnectPC,(e,t,n)=>O(this,null,function*(){this._joinInfo&&this._uid!==void 0?(yield this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(me.P2PLost,()=>{this.safeEmit(Ue.P2P_LOST,this.store.uid)}),this._p2pChannel.on(me.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(me.ConnectionTypeChange,e=>{this.safeEmit(Ue.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(me.FirstVideoBufferReady,(e,t)=>{this.safeEmit(Ue.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(me.FirstVideoPreRender,(e,t)=>{this.safeEmit(Ue.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(me.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(me.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(me.AudioMetadata,e=>{this.safeEmit(Ue.AUDIO_METADATA,e)}),this._p2pChannel.on(me.AudioPts,e=>{this.safeEmit(Ue.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(e){return O(this,null,function*(){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let n=(t={config:e},Qo("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);let{appId:r,cname:i,sid:c,token:l,uid:u,cid:h,vid:f}=this._joinInfo;yield n.init({appId:r,areaCode:"",cname:i,sid:c,token:l,uid:u,cid:h,vid:f?Number(f):0},cn)}catch(n){throw Array.isArray(n)?n[0]:n}var t})}handleVideoInspectEvents(e){e.on(Nn.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ue.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Co.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ue.CONTENT_INSPECT_ERROR,new G(P.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Nn.INSPECT_RESULT,(t,n)=>{var r;if(n?.code===P.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return S.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Ue.CONTENT_INSPECT_RESULT,t,n)}),e.on(Nn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}disableContentInspect(){return O(this,null,function*(){if(!this._inspect)throw new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}})}setImageModeration(e,t){return O(this,null,function*(){if(Eo(e,"enabled"),e){if(!t)throw new G(P.INVALID_PARAMS,"config is required");if(HH(t),!this._joinInfo)throw new G(P.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let r=(n={config:t},Qo("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);let{appId:i,cname:c,sid:l,token:u,uid:h,cid:f,vid:m}=this._joinInfo;yield r.init({appId:i,areaCode:"",cname:c,sid:l,token:u,uid:h,cid:f,vid:m?Number(m):0},cn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new G(P.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}})}handleImageModerationEvents(e){e.on(Zo.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ue.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===Wi.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new G(P.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Zo.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if((function(t){an(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new G(P.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,S.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return S.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(e){return O(this,null,function*(){Eo(e,"enabled"),ft("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&(yield this._gateway.setPublishAudioFilterEnabled(e))})}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},oe(ce.prototype,"leave",[GH],Object.getOwnPropertyDescriptor(ce.prototype,"leave"),ce.prototype),oe(ce.prototype,"publish",[WH],Object.getOwnPropertyDescriptor(ce.prototype,"publish"),ce.prototype),oe(ce.prototype,"unpublish",[qH],Object.getOwnPropertyDescriptor(ce.prototype,"unpublish"),ce.prototype),oe(ce.prototype,"subscribe",[zH],Object.getOwnPropertyDescriptor(ce.prototype,"subscribe"),ce.prototype),oe(ce.prototype,"presubscribe",[KH],Object.getOwnPropertyDescriptor(ce.prototype,"presubscribe"),ce.prototype),oe(ce.prototype,"massSubscribe",[YH],Object.getOwnPropertyDescriptor(ce.prototype,"massSubscribe"),ce.prototype),oe(ce.prototype,"unsubscribe",[$H],Object.getOwnPropertyDescriptor(ce.prototype,"unsubscribe"),ce.prototype),oe(ce.prototype,"massUnsubscribe",[XH],Object.getOwnPropertyDescriptor(ce.prototype,"massUnsubscribe"),ce.prototype),oe(ce.prototype,"setLowStreamParameter",[JH],Object.getOwnPropertyDescriptor(ce.prototype,"setLowStreamParameter"),ce.prototype),oe(ce.prototype,"setDualStreamMode",[ZH],Object.getOwnPropertyDescriptor(ce.prototype,"setDualStreamMode"),ce.prototype),oe(ce.prototype,"enableDualStream",[QH],Object.getOwnPropertyDescriptor(ce.prototype,"enableDualStream"),ce.prototype),oe(ce.prototype,"disableDualStream",[e3],Object.getOwnPropertyDescriptor(ce.prototype,"disableDualStream"),ce.prototype),oe(ce.prototype,"setClientRole",[t3],Object.getOwnPropertyDescriptor(ce.prototype,"setClientRole"),ce.prototype),oe(ce.prototype,"_setClientRoleOptions",[n3],Object.getOwnPropertyDescriptor(ce.prototype,"_setClientRoleOptions"),ce.prototype),oe(ce.prototype,"setProxyServer",[r3],Object.getOwnPropertyDescriptor(ce.prototype,"setProxyServer"),ce.prototype),oe(ce.prototype,"setTurnServer",[i3],Object.getOwnPropertyDescriptor(ce.prototype,"setTurnServer"),ce.prototype),oe(ce.prototype,"setLicense",[o3],Object.getOwnPropertyDescriptor(ce.prototype,"setLicense"),ce.prototype),oe(ce.prototype,"startProxyServer",[s3],Object.getOwnPropertyDescriptor(ce.prototype,"startProxyServer"),ce.prototype),oe(ce.prototype,"stopProxyServer",[a3],Object.getOwnPropertyDescriptor(ce.prototype,"stopProxyServer"),ce.prototype),oe(ce.prototype,"setLocalAccessPointsV2",[c3],Object.getOwnPropertyDescriptor(ce.prototype,"setLocalAccessPointsV2"),ce.prototype),oe(ce.prototype,"setLocalAccessPoints",[d3],Object.getOwnPropertyDescriptor(ce.prototype,"setLocalAccessPoints"),ce.prototype),oe(ce.prototype,"setRemoteDefaultVideoStreamType",[l3],Object.getOwnPropertyDescriptor(ce.prototype,"setRemoteDefaultVideoStreamType"),ce.prototype),oe(ce.prototype,"setRemoteVideoStreamType",[u3],Object.getOwnPropertyDescriptor(ce.prototype,"setRemoteVideoStreamType"),ce.prototype),oe(ce.prototype,"setStreamFallbackOption",[h3],Object.getOwnPropertyDescriptor(ce.prototype,"setStreamFallbackOption"),ce.prototype),oe(ce.prototype,"setEncryptionConfig",[p3],Object.getOwnPropertyDescriptor(ce.prototype,"setEncryptionConfig"),ce.prototype),oe(ce.prototype,"renewToken",[f3],Object.getOwnPropertyDescriptor(ce.prototype,"renewToken"),ce.prototype),oe(ce.prototype,"enableAudioVolumeIndicator",[m3],Object.getOwnPropertyDescriptor(ce.prototype,"enableAudioVolumeIndicator"),ce.prototype),oe(ce.prototype,"startLiveStreaming",[g3],Object.getOwnPropertyDescriptor(ce.prototype,"startLiveStreaming"),ce.prototype),oe(ce.prototype,"setLiveTranscoding",[_3],Object.getOwnPropertyDescriptor(ce.prototype,"setLiveTranscoding"),ce.prototype),oe(ce.prototype,"stopLiveStreaming",[E3],Object.getOwnPropertyDescriptor(ce.prototype,"stopLiveStreaming"),ce.prototype),oe(ce.prototype,"startChannelMediaRelay",[v3],Object.getOwnPropertyDescriptor(ce.prototype,"startChannelMediaRelay"),ce.prototype),oe(ce.prototype,"updateChannelMediaRelay",[y3],Object.getOwnPropertyDescriptor(ce.prototype,"updateChannelMediaRelay"),ce.prototype),oe(ce.prototype,"stopChannelMediaRelay",[S3],Object.getOwnPropertyDescriptor(ce.prototype,"stopChannelMediaRelay"),ce.prototype),oe(ce.prototype,"sendCustomReportMessage",[T3],Object.getOwnPropertyDescriptor(ce.prototype,"sendCustomReportMessage"),ce.prototype),oe(ce.prototype,"pickSVCLayer",[C3],Object.getOwnPropertyDescriptor(ce.prototype,"pickSVCLayer"),ce.prototype),oe(ce.prototype,"setRTMConfig",[R3],Object.getOwnPropertyDescriptor(ce.prototype,"setRTMConfig"),ce.prototype),oe(ce.prototype,"enableContentInspect",[I3],Object.getOwnPropertyDescriptor(ce.prototype,"enableContentInspect"),ce.prototype),oe(ce.prototype,"disableContentInspect",[b3],Object.getOwnPropertyDescriptor(ce.prototype,"disableContentInspect"),ce.prototype),oe(ce.prototype,"setImageModeration",[w3],Object.getOwnPropertyDescriptor(ce.prototype,"setImageModeration"),ce.prototype),oe(ce.prototype,"setP2PTransport",[A3],Object.getOwnPropertyDescriptor(ce.prototype,"setP2PTransport"),ce.prototype),oe(ce.prototype,"getJoinChannelServiceRecords",[D3],Object.getOwnPropertyDescriptor(ce.prototype,"getJoinChannelServiceRecords"),ce.prototype),oe(ce.prototype,"setPublishAudioFilterEnabled",[O3],Object.getOwnPropertyDescriptor(ce.prototype,"setPublishAudioFilterEnabled"),ce.prototype),ce);function P3(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},n=at(5,"client-"),r=ue.reportApiInvoke(null,{id:n,name:Mt.CREATE_CLIENT,options:[t],tag:St.TRACER});try{(function(i){an(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),an(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&an(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&Un(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&d2(i.turnServer),i.httpRetryConfig!==void 0&&c2(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&c2(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return($F(16,0,!0)||xb(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",S.debug("browser not support vp9, force use vp8")),ft("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new pde(Ao(Ao({forceWaitGatewayResponse:!0},t),{},{role:J(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)}function fde(){let e=!1,t=Je();return(t.name===Qe.CHROME&&Number(t.version)>=58&&(Ko.engine.name!=="WebKit"||(function(){let n=Je();if(kE()){if(n.os===Sn.MAC_OS)return!0;if(n.os===Sn.IOS){let r=Ko.os.version&&Ko.os.version.split(".");if(r&&Number(r[0])===14&&r[1]&&Number(r[1])>=3||r&&Number(r[0])>14)return!0}}return!1})())||t.name===Qe.FIREFOX&&Number(t.version)>=56||t.name===Qe.OPERA&&Number(t.version)>=45||t.name===Qe.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(tr()||_o())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||ZF()||Je().name===Qe.QQ)&&(e=!0),e}class Kf{constructor(t,n){w(this,"id",0),w(this,"element",void 0),w(this,"peerPair",void 0),w(this,"context",void 0),w(this,"audioPlayerElement",void 0),w(this,"audioTrack",void 0),Kf.count+=1,this.id=Kf.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}switchSdp(){return O(this,null,function*(){if(!this.peerPair)return;let t=(r,i)=>O(this,null,function*(){let c=i==="offer"?yield r.createOffer():yield r.createAnswer();return yield r.setLocalDescription(c),r.iceGatheringState==="complete"?r.localDescription:new ie(l=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&l(r.localDescription)}})}),n=(r,i)=>O(this,null,function*(){return yield r.setRemoteDescription(i)});try{let r=yield t(this.peerPair[0],"offer");yield n(this.peerPair[1],r);let i=yield t(this.peerPair[1],"answer");yield n(this.peerPair[0],i)}catch(r){throw new G(P.LOCAL_AEC_ERROR,r.toString()).print()}})}getTracksFromMediaElement(t){return O(this,null,function*(){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new G(P.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new G(P.LOCAL_AEC_ERROR,"no dest node when local aec").print();let r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r})}getElement(){return this.element}startEchoCancellation(){return O(this,null,function*(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,n=yield this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),yield this.switchSdp()})}close(){S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var L3,Uv;w(Kf,"count",0);let mde=window.AudioContext||window.webkitAudioContext,gde=new(L3=ve({report:ue}),oe((Uv=class{constructor(){w(this,"units",[]),w(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new mde);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Kf(e,this.context),this.units.push(t)),t.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Je().name!==Qe.SAFARI}}).prototype,"processExternalMediaAEC",[L3],Object.getOwnPropertyDescriptor(Uv.prototype,"processExternalMediaAEC"),Uv.prototype),Uv);function k3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function M3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k3(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let O0=window||document;function x3(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!O0)return;let n=pn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);let r=i=>{if(!(i&&i.blockedURI&&(pn.onSecurityPolicyViolation||pn.getListeners(xs.SECURITY_POLICY_VIOLATION).length>0)))return;let c=i.blockedURI;D("CSP_DETECTED_HOSTNAME_LIST").some(l=>J(c).call(c,l))&&(pn.onSecurityPolicyViolation&&typeof pn.onSecurityPolicyViolation=="function"&&pn.onSecurityPolicyViolation(i),pn.getListeners(xs.SECURITY_POLICY_VIOLATION).length>0&&pn.safeEmit(xs.SECURITY_POLICY_VIOLATION,i))};n&&O0.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||pn.getListeners(xs.SECURITY_POLICY_VIOLATION).length>0)&&O0.addEventListener("securitypolicyviolation",r),pn._cspEventHandlerPointer=r}var _de=B,Ede=BI,U3=RegExp.prototype,vde=function(e){return e===U3||_de(U3,e)?Ede(e):e.flags},lr=a(vde);function _h(e){let t=e.length;for(;--t>=0;)e[t]=0}let N0=256,F3=286,Yf=30,$f=15,P0=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Fv=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),yde=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),V3=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ia=new Array(576);_h(Ia);let Xf=new Array(60);_h(Xf);let Jf=new Array(512);_h(Jf);let Zf=new Array(256);_h(Zf);let L0=new Array(29);_h(L0);let Vv=new Array(Yf);function k0(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let j3,B3,H3;function M0(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}_h(Vv);let G3=e=>e<256?Jf[e]:Jf[256+(e>>>7)],Qf=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ai=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Qf(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Hs=(e,t,n)=>{Ai(e,n[2*t],n[2*t+1])},W3=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},q3=(e,t,n)=>{let r=new Array(16),i,c,l=0;for(i=1;i<=$f;i++)l=l+n[i-1]<<1,r[i]=l;for(c=0;c<=t;c++){let u=e[2*c+1];u!==0&&(e[2*c]=W3(r[u]++,u))}},z3=e=>{let t;for(t=0;t<F3;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Yf;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},K3=e=>{e.bi_valid>8?Qf(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Y3=(e,t,n,r)=>{let i=2*t,c=2*n;return e[i]<e[c]||e[i]===e[c]&&r[t]<=r[n]},x0=(e,t,n)=>{let r=e.heap[n],i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Y3(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Y3(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},$3=(e,t,n)=>{let r,i,c,l,u=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+u++],r+=(255&e.pending_buf[e.sym_buf+u++])<<8,i=e.pending_buf[e.sym_buf+u++],r===0?Hs(e,i,t):(c=Zf[i],Hs(e,c+N0+1,t),l=P0[c],l!==0&&(i-=L0[c],Ai(e,i,l)),r--,c=G3(r),Hs(e,c,n),l=Fv[c],l!==0&&(r-=Vv[c],Ai(e,r,l)));while(u<e.sym_next);Hs(e,256,t)},U0=(e,t)=>{let n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,c=t.stat_desc.elems,l,u,h,f=-1;for(e.heap_len=0,e.heap_max=573,l=0;l<c;l++)n[2*l]!==0?(e.heap[++e.heap_len]=f=l,e.depth[l]=0):n[2*l+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=f<2?++f:0,n[2*h]=1,e.depth[h]=0,e.opt_len--,i&&(e.static_len-=r[2*h+1]);for(t.max_code=f,l=e.heap_len>>1;l>=1;l--)x0(e,n,l);h=c;do l=e.heap[1],e.heap[1]=e.heap[e.heap_len--],x0(e,n,1),u=e.heap[1],e.heap[--e.heap_max]=l,e.heap[--e.heap_max]=u,n[2*h]=n[2*l]+n[2*u],e.depth[h]=(e.depth[l]>=e.depth[u]?e.depth[l]:e.depth[u])+1,n[2*l+1]=n[2*u+1]=h,e.heap[1]=h++,x0(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,E)=>{let _=E.dyn_tree,y=E.max_code,A=E.stat_desc.static_tree,C=E.stat_desc.has_stree,I=E.stat_desc.extra_bits,N=E.stat_desc.extra_base,L=E.stat_desc.max_length,M,V,j,U,H,K,Y=0;for(U=0;U<=$f;U++)m.bl_count[U]=0;for(_[2*m.heap[m.heap_max]+1]=0,M=m.heap_max+1;M<573;M++)V=m.heap[M],U=_[2*_[2*V+1]+1]+1,U>L&&(U=L,Y++),_[2*V+1]=U,V>y||(m.bl_count[U]++,H=0,V>=N&&(H=I[V-N]),K=_[2*V],m.opt_len+=K*(U+H),C&&(m.static_len+=K*(A[2*V+1]+H)));if(Y!==0){do{for(U=L-1;m.bl_count[U]===0;)U--;m.bl_count[U]--,m.bl_count[U+1]+=2,m.bl_count[L]--,Y-=2}while(Y>0);for(U=L;U!==0;U--)for(V=m.bl_count[U];V!==0;)j=m.heap[--M],j>y||(_[2*j+1]!==U&&(m.opt_len+=(U-_[2*j+1])*_[2*j],_[2*j+1]=U),V--)}})(e,t),q3(n,f,e.bl_count)},X3=(e,t,n)=>{let r,i,c=-1,l=t[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=l,l=t[2*(r+1)+1],++u<h&&i===l||(u<f?e.bl_tree[2*i]+=u:i!==0?(i!==c&&e.bl_tree[2*i]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,c=i,l===0?(h=138,f=3):i===l?(h=6,f=3):(h=7,f=4))},J3=(e,t,n)=>{let r,i,c=-1,l=t[1],u=0,h=7,f=4;for(l===0&&(h=138,f=3),r=0;r<=n;r++)if(i=l,l=t[2*(r+1)+1],!(++u<h&&i===l)){if(u<f)do Hs(e,i,e.bl_tree);while(--u!=0);else i!==0?(i!==c&&(Hs(e,i,e.bl_tree),u--),Hs(e,16,e.bl_tree),Ai(e,u-3,2)):u<=10?(Hs(e,17,e.bl_tree),Ai(e,u-3,3)):(Hs(e,18,e.bl_tree),Ai(e,u-11,7));u=0,c=i,l===0?(h=138,f=3):i===l?(h=6,f=3):(h=7,f=4)}},Z3=!1,Q3=(e,t,n,r)=>{Ai(e,0+(r?1:0),3),K3(e),Qf(e,n),Qf(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Sde=e=>{Z3||((()=>{let t,n,r,i,c,l=new Array(16);for(r=0,i=0;i<28;i++)for(L0[i]=r,t=0;t<1<<P0[i];t++)Zf[r++]=i;for(Zf[r-1]=i,c=0,i=0;i<16;i++)for(Vv[i]=c,t=0;t<1<<Fv[i];t++)Jf[c++]=i;for(c>>=7;i<Yf;i++)for(Vv[i]=c<<7,t=0;t<1<<Fv[i]-7;t++)Jf[256+c++]=i;for(n=0;n<=$f;n++)l[n]=0;for(t=0;t<=143;)Ia[2*t+1]=8,t++,l[8]++;for(;t<=255;)Ia[2*t+1]=9,t++,l[9]++;for(;t<=279;)Ia[2*t+1]=7,t++,l[7]++;for(;t<=287;)Ia[2*t+1]=8,t++,l[8]++;for(q3(Ia,287,l),t=0;t<Yf;t++)Xf[2*t+1]=5,Xf[2*t]=W3(t,5);j3=new k0(Ia,P0,257,F3,$f),B3=new k0(Xf,Fv,0,Yf,$f),H3=new k0(new Array(0),yde,0,19,7)})(),Z3=!0),e.l_desc=new M0(e.dyn_ltree,j3),e.d_desc=new M0(e.dyn_dtree,B3),e.bl_desc=new M0(e.bl_tree,H3),e.bi_buf=0,e.bi_valid=0,z3(e)},Tde=(e,t,n,r)=>{let i,c,l=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(u=>{let h,f=4093624447;for(h=0;h<=31;h++,f>>>=1)if(1&f&&u.dyn_ltree[2*h]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(h=32;h<N0;h++)if(u.dyn_ltree[2*h]!==0)return 1;return 0})(e)),U0(e,e.l_desc),U0(e,e.d_desc),l=(u=>{let h;for(X3(u,u.dyn_ltree,u.l_desc.max_code),X3(u,u.dyn_dtree,u.d_desc.max_code),U0(u,u.bl_desc),h=18;h>=3&&u.bl_tree[2*V3[h]+1]===0;h--);return u.opt_len+=3*(h+1)+5+5+4,h})(e),i=e.opt_len+3+7>>>3,c=e.static_len+3+7>>>3,c<=i&&(i=c)):i=c=n+5,n+4<=i&&t!==-1?Q3(e,t,n,r):e.strategy===4||c===i?(Ai(e,2+(r?1:0),3),$3(e,Ia,Xf)):(Ai(e,4+(r?1:0),3),((u,h,f,m)=>{let E;for(Ai(u,h-257,5),Ai(u,f-1,5),Ai(u,m-4,4),E=0;E<m;E++)Ai(u,u.bl_tree[2*V3[E]+1],3);J3(u,u.dyn_ltree,h-1),J3(u,u.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),$3(e,e.dyn_ltree,e.dyn_dtree)),z3(e),r&&K3(e)},Cde=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Zf[n]+N0+1)]++,e.dyn_dtree[2*G3(t)]++),e.sym_next===e.sym_end),Rde=e=>{Ai(e,2,3),Hs(e,256,Ia),(t=>{t.bi_valid===16?(Qf(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Ide={_tr_init:Sde,_tr_stored_block:Q3,_tr_flush_block:Tde,_tr_tally:Cde,_tr_align:Rde},em=(e,t,n,r)=>{let i=65535&e|0,c=e>>>16&65535|0,l=0;for(;n!==0;){l=n>2e3?2e3:n,n-=l;do i=i+t[r++]|0,c=c+i|0;while(--l);i%=65521,c%=65521}return i|c<<16|0};let bde=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var br=(e,t,n,r)=>{let i=bde,c=r+n;e^=-1;for(let l=r;l<c;l++)e=e>>>8^i[255&(e^t[l])];return-1^e},$d={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Eh={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:wde,_tr_stored_block:F0,_tr_flush_block:Ade,_tr_tally:Oc,_tr_align:Dde}=Ide,{Z_NO_FLUSH:Nc,Z_PARTIAL_FLUSH:Ode,Z_FULL_FLUSH:Nde,Z_FINISH:Do,Z_BLOCK:eG,Z_OK:Vr,Z_STREAM_END:tG,Z_STREAM_ERROR:Gs,Z_DATA_ERROR:Pde,Z_BUF_ERROR:V0,Z_DEFAULT_COMPRESSION:Lde,Z_FILTERED:kde,Z_HUFFMAN_ONLY:jv,Z_RLE:Mde,Z_FIXED:xde,Z_DEFAULT_STRATEGY:Ude,Z_UNKNOWN:Fde,Z_DEFLATED:Bv}=Eh,j0=286,Vde=30,jde=19,Bde=2*j0+1,Hde=15,Xd=258,Ws=262,vh=42,Jd=113,tm=666,Zd=(e,t)=>(e.msg=$d[t],t),nG=e=>2*e-(e>4?9:0),Pc=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Gde=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)},Lc=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,qi=e=>{let t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},zi=(e,t)=>{Ade(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,qi(e.strm)},Zt=(e,t)=>{e.pending_buf[e.pending++]=t},nm=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},B0=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=em(e.adler,t,i,n):e.state.wrap===2&&(e.adler=br(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},rG=(e,t)=>{let n,r,i=e.max_chain_length,c=e.strstart,l=e.prev_length,u=e.nice_match,h=e.strstart>e.w_size-Ws?e.strstart-(e.w_size-Ws):0,f=e.window,m=e.w_mask,E=e.prev,_=e.strstart+Xd,y=f[c+l-1],A=f[c+l];e.prev_length>=e.good_match&&(i>>=2),u>e.lookahead&&(u=e.lookahead);do if(n=t,f[n+l]===A&&f[n+l-1]===y&&f[n]===f[c]&&f[++n]===f[c+1]){c+=2,n++;do;while(f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&c<_);if(r=Xd-(_-c),c=_-Xd,r>l){if(e.match_start=t,l=r,r>=u)break;y=f[c+l-1],A=f[c+l]}}while((t=E[t&m])>h&&--i!=0);return l<=e.lookahead?l:e.lookahead},yh=e=>{let t=e.w_size,n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ws)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Gde(e),r+=t),e.strm.avail_in===0)break;if(n=B0(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Lc(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Lc(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ws&&e.strm.avail_in!==0)},iG=(e,t)=>{let n,r,i,c=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,l=0,u=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<c&&(n===0&&t!==Do||t===Nc||n!==r+e.strm.avail_in)))break;l=t===Do&&n===r+e.strm.avail_in?1:0,F0(e,0,0,l),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,qi(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(B0(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(l===0);return u-=e.strm.avail_in,u&&(u>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=u&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-u,e.strm.next_in),e.strstart),e.strstart+=u,e.insert+=u>e.w_size-e.insert?e.w_size-e.insert:u),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),l?4:t!==Nc&&t!==Do&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(B0(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,c=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=c||(r||t===Do)&&t!==Nc&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,l=t===Do&&e.strm.avail_in===0&&n===r?1:0,F0(e,e.block_start,n,l),e.block_start+=n,qi(e.strm)),l?3:1)},H0=(e,t)=>{let n,r;for(;;){if(e.lookahead<Ws){if(yh(e),e.lookahead<Ws&&t===Nc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Lc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Ws&&(e.match_length=rG(e,n)),e.match_length>=3)if(r=Oc(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Lc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Lc(e,e.ins_h,e.window[e.strstart+1]);else r=Oc(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(zi(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Do?(zi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(zi(e,!1),e.strm.avail_out===0)?1:2},Sh=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Ws){if(yh(e),e.lookahead<Ws&&t===Nc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Lc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ws&&(e.match_length=rG(e,n),e.match_length<=5&&(e.strategy===kde||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Oc(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Lc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(zi(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Oc(e,0,e.window[e.strstart-1]),r&&zi(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Oc(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Do?(zi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(zi(e,!1),e.strm.avail_out===0)?1:2};function qs(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}let rm=[new qs(0,0,0,0,iG),new qs(4,4,8,4,H0),new qs(4,5,16,8,H0),new qs(4,6,32,32,H0),new qs(4,4,16,16,Sh),new qs(8,16,32,32,Sh),new qs(8,16,128,128,Sh),new qs(8,32,128,256,Sh),new qs(32,128,258,1024,Sh),new qs(32,258,258,4096,Sh)];function Wde(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Bv,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Bde),this.dyn_dtree=new Uint16Array(2*(2*Vde+1)),this.bl_tree=new Uint16Array(2*(2*jde+1)),Pc(this.dyn_ltree),Pc(this.dyn_dtree),Pc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Hde+1),this.heap=new Uint16Array(2*j0+1),Pc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*j0+1),Pc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let im=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==vh&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Jd&&t.status!==tm?1:0},oG=e=>{if(im(e))return Zd(e,Gs);e.total_in=e.total_out=0,e.data_type=Fde;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?vh:Jd,e.adler=t.wrap===2?0:1,t.last_flush=-2,wde(t),Vr},sG=e=>{let t=oG(e);return t===Vr&&(n=>{n.window_size=2*n.w_size,Pc(n.head),n.max_lazy_match=rm[n.level].max_lazy,n.good_match=rm[n.level].good_length,n.nice_match=rm[n.level].nice_length,n.max_chain_length=rm[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},aG=(e,t,n,r,i,c)=>{if(!e)return Gs;let l=1;if(t===Lde&&(t=6),r<0?(l=0,r=-r):r>15&&(l=2,r-=16),i<1||i>9||n!==Bv||r<8||r>15||t<0||t>9||c<0||c>xde||r===8&&l!==1)return Zd(e,Gs);r===8&&(r=9);let u=new Wde;return e.state=u,u.strm=e,u.status=vh,u.wrap=l,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=i+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<i+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=t,u.strategy=c,u.method=n,sG(e)};var qde=(e,t)=>{if(im(e)||t>eG||t<0)return e?Zd(e,Gs):Gs;let n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===tm&&t!==Do)return Zd(e,e.avail_out===0?V0:Gs);let r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(qi(e),e.avail_out===0)return n.last_flush=-1,Vr}else if(e.avail_in===0&&nG(t)<=nG(r)&&t!==Do)return Zd(e,V0);if(n.status===tm&&e.avail_in!==0)return Zd(e,V0);if(n.status===vh&&n.wrap===0&&(n.status=Jd),n.status===vh){let i=Bv+(n.w_bits-8<<4)<<8,c=-1;if(c=n.strategy>=jv||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=c<<6,n.strstart!==0&&(i|=32),i+=31-i%31,nm(n,i),n.strstart!==0&&(nm(n,e.adler>>>16),nm(n,65535&e.adler)),e.adler=1,n.status=Jd,qi(e),n.pending!==0)return n.last_flush=-1,Vr}if(n.status===57){if(e.adler=0,Zt(n,31),Zt(n,139),Zt(n,8),n.gzhead)Zt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Zt(n,255&n.gzhead.time),Zt(n,n.gzhead.time>>8&255),Zt(n,n.gzhead.time>>16&255),Zt(n,n.gzhead.time>>24&255),Zt(n,n.level===9?2:n.strategy>=jv||n.level<2?4:0),Zt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Zt(n,255&n.gzhead.extra.length),Zt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=br(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Zt(n,0),Zt(n,0),Zt(n,0),Zt(n,0),Zt(n,0),Zt(n,n.level===9?2:n.strategy>=jv||n.level<2?4:0),Zt(n,3),n.status=Jd,qi(e),n.pending!==0)return n.last_flush=-1,Vr}if(n.status===69){if(n.gzhead.extra){let i=n.pending,c=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+c>n.pending_buf_size;){let u=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+u),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=br(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=u,qi(e),n.pending!==0)return n.last_flush=-1,Vr;i=0,c-=u}let l=new Uint8Array(n.gzhead.extra);n.pending_buf.set(l.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending+=c,n.gzhead.hcrc&&n.pending>i&&(e.adler=br(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=br(e.adler,n.pending_buf,n.pending-c,c)),qi(e),n.pending!==0)return n.last_flush=-1,Vr;c=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Zt(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=br(e.adler,n.pending_buf,n.pending-c,c)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=br(e.adler,n.pending_buf,n.pending-c,c)),qi(e),n.pending!==0)return n.last_flush=-1,Vr;c=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Zt(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=br(e.adler,n.pending_buf,n.pending-c,c))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(qi(e),n.pending!==0))return n.last_flush=-1,Vr;Zt(n,255&e.adler),Zt(n,e.adler>>8&255),e.adler=0}if(n.status=Jd,qi(e),n.pending!==0)return n.last_flush=-1,Vr}if(e.avail_in!==0||n.lookahead!==0||t!==Nc&&n.status!==tm){let i=n.level===0?iG(n,t):n.strategy===jv?((c,l)=>{let u;for(;;){if(c.lookahead===0&&(yh(c),c.lookahead===0)){if(l===Nc)return 1;break}if(c.match_length=0,u=Oc(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,u&&(zi(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,l===Do?(zi(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(zi(c,!1),c.strm.avail_out===0)?1:2})(n,t):n.strategy===Mde?((c,l)=>{let u,h,f,m,E=c.window;for(;;){if(c.lookahead<=Xd){if(yh(c),c.lookahead<=Xd&&l===Nc)return 1;if(c.lookahead===0)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(f=c.strstart-1,h=E[f],h===E[++f]&&h===E[++f]&&h===E[++f])){m=c.strstart+Xd;do;while(h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&f<m);c.match_length=Xd-(m-f),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(u=Oc(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(u=Oc(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),u&&(zi(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,l===Do?(zi(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(zi(c,!1),c.strm.avail_out===0)?1:2})(n,t):rm[n.level].func(n,t);if(i!==3&&i!==4||(n.status=tm),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),Vr;if(i===2&&(t===Ode?Dde(n):t!==eG&&(F0(n,0,0,!1),t===Nde&&(Pc(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),qi(e),e.avail_out===0))return n.last_flush=-1,Vr}return t!==Do?Vr:n.wrap<=0?tG:(n.wrap===2?(Zt(n,255&e.adler),Zt(n,e.adler>>8&255),Zt(n,e.adler>>16&255),Zt(n,e.adler>>24&255),Zt(n,255&e.total_in),Zt(n,e.total_in>>8&255),Zt(n,e.total_in>>16&255),Zt(n,e.total_in>>24&255)):(nm(n,e.adler>>>16),nm(n,65535&e.adler)),qi(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Vr:tG)},zde=(e,t)=>{let n=t.length;if(im(e))return Gs;let r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==vh||r.lookahead)return Gs;if(i===1&&(e.adler=em(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Pc(r.head),r.strstart=0,r.block_start=0,r.insert=0);let h=new Uint8Array(r.w_size);h.set(t.subarray(n-r.w_size,n),0),t=h,n=r.w_size}let c=e.avail_in,l=e.next_in,u=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,yh(r);r.lookahead>=3;){let h=r.strstart,f=r.lookahead-2;do r.ins_h=Lc(r,r.ins_h,r.window[h+3-1]),r.prev[h&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=h,h++;while(--f);r.strstart=h,r.lookahead=2,yh(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=l,e.input=u,e.avail_in=c,r.wrap=i,Vr},om={deflateInit:(e,t)=>aG(e,t,Bv,15,8,Ude),deflateInit2:aG,deflateReset:sG,deflateResetKeep:oG,deflateSetHeader:(e,t)=>im(e)||e.state.wrap!==2?Gs:(e.state.gzhead=t,Vr),deflate:qde,deflateEnd:e=>{if(im(e))return Gs;let t=e.state.status;return e.state=null,t===Jd?Zd(e,Pde):Vr},deflateSetDictionary:zde,deflateInfo:"pako deflate (from Nodeca project)"};let Kde=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Hv={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(let r in n)Kde(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;let n=new Uint8Array(t);for(let r=0,i=0,c=e.length;r<c;r++){let l=e[r];n.set(l,i),i+=l.length}return n}};let cG=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{cG=!1}let sm=new Uint8Array(256);for(let e=0;e<256;e++)sm[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;sm[254]=sm[254]=1;var am={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,c,l=e.length,u=0;for(i=0;i<l;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<l&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(u),c=0,i=0;c<u;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<l&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[c++]=n:n<2048?(t[c++]=192|n>>>6,t[c++]=128|63&n):n<65536?(t[c++]=224|n>>>12,t[c++]=128|n>>>6&63,t[c++]=128|63&n):(t[c++]=240|n>>>18,t[c++]=128|n>>>12&63,t[c++]=128|n>>>6&63,t[c++]=128|63&n);return t},buf2string:(e,t)=>{let n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i,c=new Array(2*n);for(i=0,r=0;r<n;){let l=e[r++];if(l<128){c[i++]=l;continue}let u=sm[l];if(u>4)c[i++]=65533,r+=u-1;else{for(l&=u===2?31:u===3?15:7;u>1&&r<n;)l=l<<6|63&e[r++],u--;u>1?c[i++]=65533:l<65536?c[i++]=l:(l-=65536,c[i++]=55296|l>>10&1023,c[i++]=56320|1023&l)}}return((l,u)=>{if(u<65534&&l.subarray&&cG)return String.fromCharCode.apply(null,l.length===u?l:l.subarray(0,u));let h="";for(let f=0;f<u;f++)h+=String.fromCharCode(l[f]);return h})(c,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+sm[e[n]]>t?n:t}},dG=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let lG=Object.prototype.toString,{Z_NO_FLUSH:Yde,Z_SYNC_FLUSH:$de,Z_FULL_FLUSH:Xde,Z_FINISH:Jde,Z_OK:Gv,Z_STREAM_END:Zde,Z_DEFAULT_COMPRESSION:Qde,Z_DEFAULT_STRATEGY:ele,Z_DEFLATED:tle}=Eh;function cm(e){this.options=Hv.assign({level:Qde,method:tle,chunkSize:16384,windowBits:15,memLevel:8,strategy:ele},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dG,this.strm.avail_out=0;let n=om.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Gv)throw new Error($d[n]);if(t.header&&om.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?am.string2buf(t.dictionary):lG.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=om.deflateSetDictionary(this.strm,r),n!==Gv)throw new Error($d[n]);this._dict_set=!0}}function G0(e,t){let n=new cm(t);if(n.push(e,!0),n.err)throw n.msg||$d[n.err];return n.result}cm.prototype.push=function(e,t){let n=this.strm,r=this.options.chunkSize,i,c;if(this.ended)return!1;for(c=t===~~t?t:t===!0?Jde:Yde,typeof e=="string"?n.input=am.string2buf(e):lG.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(c===$de||c===Xde)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=om.deflate(n,c),i===Zde)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=om.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Gv;if(n.avail_out!==0){if(c>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},cm.prototype.onData=function(e){this.chunks.push(e)},cm.prototype.onEnd=function(e){e===Gv&&(this.result=Hv.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var nle={Deflate:cm,deflate:G0,deflateRaw:function(e,t){return(t=t||{}).raw=!0,G0(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,G0(e,t)},constants:Eh};let Wv=16209;var rle=function(e,t){let n,r,i,c,l,u,h,f,m,E,_,y,A,C,I,N,L,M,V,j,U,H,K,Y,ae=e.state;n=e.next_in,K=e.input,r=n+(e.avail_in-5),i=e.next_out,Y=e.output,c=i-(t-e.avail_out),l=i+(e.avail_out-257),u=ae.dmax,h=ae.wsize,f=ae.whave,m=ae.wnext,E=ae.window,_=ae.hold,y=ae.bits,A=ae.lencode,C=ae.distcode,I=(1<<ae.lenbits)-1,N=(1<<ae.distbits)-1;e:do{y<15&&(_+=K[n++]<<y,y+=8,_+=K[n++]<<y,y+=8),L=A[_&I];t:for(;;){if(M=L>>>24,_>>>=M,y-=M,M=L>>>16&255,M===0)Y[i++]=65535&L;else{if(!(16&M)){if((64&M)==0){L=A[(65535&L)+(_&(1<<M)-1)];continue t}if(32&M){ae.mode=16191;break e}e.msg="invalid literal/length code",ae.mode=Wv;break e}V=65535&L,M&=15,M&&(y<M&&(_+=K[n++]<<y,y+=8),V+=_&(1<<M)-1,_>>>=M,y-=M),y<15&&(_+=K[n++]<<y,y+=8,_+=K[n++]<<y,y+=8),L=C[_&N];n:for(;;){if(M=L>>>24,_>>>=M,y-=M,M=L>>>16&255,!(16&M)){if((64&M)==0){L=C[(65535&L)+(_&(1<<M)-1)];continue n}e.msg="invalid distance code",ae.mode=Wv;break e}if(j=65535&L,M&=15,y<M&&(_+=K[n++]<<y,y+=8,y<M&&(_+=K[n++]<<y,y+=8)),j+=_&(1<<M)-1,j>u){e.msg="invalid distance too far back",ae.mode=Wv;break e}if(_>>>=M,y-=M,M=i-c,j>M){if(M=j-M,M>f&&ae.sane){e.msg="invalid distance too far back",ae.mode=Wv;break e}if(U=0,H=E,m===0){if(U+=h-M,M<V){V-=M;do Y[i++]=E[U++];while(--M);U=i-j,H=Y}}else if(m<M){if(U+=h+m-M,M-=m,M<V){V-=M;do Y[i++]=E[U++];while(--M);if(U=0,m<V){M=m,V-=M;do Y[i++]=E[U++];while(--M);U=i-j,H=Y}}}else if(U+=m-M,M<V){V-=M;do Y[i++]=E[U++];while(--M);U=i-j,H=Y}for(;V>2;)Y[i++]=H[U++],Y[i++]=H[U++],Y[i++]=H[U++],V-=3;V&&(Y[i++]=H[U++],V>1&&(Y[i++]=H[U++]))}else{U=i-j;do Y[i++]=Y[U++],Y[i++]=Y[U++],Y[i++]=Y[U++],V-=3;while(V>2);V&&(Y[i++]=Y[U++],V>1&&(Y[i++]=Y[U++]))}break}}break}}while(n<r&&i<l);V=y>>3,n-=V,y-=V<<3,_&=(1<<y)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<l?l-i+257:257-(i-l),ae.hold=_,ae.bits=y};let qv=15,ile=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ole=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),sle=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ale=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var dm=(e,t,n,r,i,c,l,u)=>{let h=u.bits,f,m,E,_,y,A,C=0,I=0,N=0,L=0,M=0,V=0,j=0,U=0,H=0,K=0,Y=null,ae=new Uint16Array(16),Ce=new Uint16Array(16),Te,Le,De,tt=null;for(C=0;C<=qv;C++)ae[C]=0;for(I=0;I<r;I++)ae[t[n+I]]++;for(M=h,L=qv;L>=1&&ae[L]===0;L--);if(M>L&&(M=L),L===0)return i[c++]=20971520,i[c++]=20971520,u.bits=1,0;for(N=1;N<L&&ae[N]===0;N++);for(M<N&&(M=N),U=1,C=1;C<=qv;C++)if(U<<=1,U-=ae[C],U<0)return-1;if(U>0&&(e===0||L!==1))return-1;for(Ce[1]=0,C=1;C<qv;C++)Ce[C+1]=Ce[C]+ae[C];for(I=0;I<r;I++)t[n+I]!==0&&(l[Ce[t[n+I]]++]=I);if(e===0?(Y=tt=l,A=20):e===1?(Y=ile,tt=ole,A=257):(Y=sle,tt=ale,A=0),K=0,I=0,C=N,y=c,V=M,j=0,E=-1,H=1<<M,_=H-1,e===1&&H>852||e===2&&H>592)return 1;for(;;){Te=C-j,l[I]+1<A?(Le=0,De=l[I]):l[I]>=A?(Le=tt[l[I]-A],De=Y[l[I]-A]):(Le=96,De=0),f=1<<C-j,m=1<<V,N=m;do m-=f,i[y+(K>>j)+m]=Te<<24|Le<<16|De|0;while(m!==0);for(f=1<<C-1;K&f;)f>>=1;if(f!==0?(K&=f-1,K+=f):K=0,I++,--ae[C]==0){if(C===L)break;C=t[n+l[I]]}if(C>M&&(K&_)!==E){for(j===0&&(j=M),y+=N,V=C-j,U=1<<V;V+j<L&&(U-=ae[V+j],!(U<=0));)V++,U<<=1;if(H+=1<<V,e===1&&H>852||e===2&&H>592)return 1;E=K&_,i[E]=M<<24|V<<16|y-c|0}}return K!==0&&(i[y+K]=C-j<<24|64<<16|0),u.bits=M,0};let{Z_FINISH:uG,Z_BLOCK:cle,Z_TREES:zv,Z_OK:Qd,Z_STREAM_END:dle,Z_NEED_DICT:lle,Z_STREAM_ERROR:Oo,Z_DATA_ERROR:hG,Z_MEM_ERROR:pG,Z_BUF_ERROR:ule,Z_DEFLATED:fG}=Eh,Kv=16180,Yv=16190,ba=16191,W0=16192,q0=16194,$v=16199,Xv=16200,z0=16206,Ln=16209,mG=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function hle(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let el=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<Kv||t.mode>16211?1:0},gG=e=>{if(el(e))return Oo;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Kv,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Qd},_G=e=>{if(el(e))return Oo;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,gG(e)},EG=(e,t)=>{let n;if(el(e))return Oo;let r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Oo:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,_G(e))},vG=(e,t)=>{if(!e)return Oo;let n=new hle;e.state=n,n.strm=e,n.window=null,n.mode=Kv;let r=EG(e,t);return r!==Qd&&(e.state=null),r},K0,Y0,yG=!0,ple=e=>{if(yG){K0=new Int32Array(512),Y0=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(dm(1,e.lens,0,288,K0,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;dm(2,e.lens,0,32,Y0,0,e.work,{bits:5}),yG=!1}e.lencode=K0,e.lenbits=9,e.distcode=Y0,e.distbits=5},SG=(e,t,n,r)=>{let i,c=e.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new Uint8Array(c.wsize)),r>=c.wsize?(c.window.set(t.subarray(n-c.wsize,n),0),c.wnext=0,c.whave=c.wsize):(i=c.wsize-c.wnext,i>r&&(i=r),c.window.set(t.subarray(n-r,n-r+i),c.wnext),(r-=i)?(c.window.set(t.subarray(n-r,n),0),c.wnext=r,c.whave=c.wsize):(c.wnext+=i,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=i))),0};var fle=(e,t)=>{let n,r,i,c,l,u,h,f,m,E,_,y,A,C,I,N,L,M,V,j,U,H,K=0,Y=new Uint8Array(4),ae,Ce,Te=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(el(e)||!e.output||!e.input&&e.avail_in!==0)return Oo;n=e.state,n.mode===ba&&(n.mode=W0),l=e.next_out,i=e.output,h=e.avail_out,c=e.next_in,r=e.input,u=e.avail_in,f=n.hold,m=n.bits,E=u,_=h,H=Qd;e:for(;;)switch(n.mode){case Kv:if(n.wrap===0){n.mode=W0;break}for(;m<16;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if(2&n.wrap&&f===35615){n.wbits===0&&(n.wbits=15),n.check=0,Y[0]=255&f,Y[1]=f>>>8&255,n.check=br(n.check,Y,2,0),f=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=Ln;break}if((15&f)!==fG){e.msg="unknown compression method",n.mode=Ln;break}if(f>>>=4,m-=4,U=8+(15&f),n.wbits===0&&(n.wbits=U),U>15||U>n.wbits){e.msg="invalid window size",n.mode=Ln;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&f?16189:ba,f=0,m=0;break;case 16181:for(;m<16;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if(n.flags=f,(255&lr(n))!==fG){e.msg="unknown compression method",n.mode=Ln;break}if(57344&lr(n)){e.msg="unknown header flags set",n.mode=Ln;break}n.head&&(n.head.text=f>>8&1),512&lr(n)&&4&n.wrap&&(Y[0]=255&f,Y[1]=f>>>8&255,n.check=br(n.check,Y,2,0)),f=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}n.head&&(n.head.time=f),512&lr(n)&&4&n.wrap&&(Y[0]=255&f,Y[1]=f>>>8&255,Y[2]=f>>>16&255,Y[3]=f>>>24&255,n.check=br(n.check,Y,4,0)),f=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&lr(n)&&4&n.wrap&&(Y[0]=255&f,Y[1]=f>>>8&255,n.check=br(n.check,Y,2,0)),f=0,m=0,n.mode=16184;case 16184:if(1024&lr(n)){for(;m<16;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}n.length=f,n.head&&(n.head.extra_len=f),512&lr(n)&&4&n.wrap&&(Y[0]=255&f,Y[1]=f>>>8&255,n.check=br(n.check,Y,2,0)),f=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&lr(n)&&(y=n.length,y>u&&(y=u),y&&(n.head&&(U=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(c,c+y),U)),512&lr(n)&&4&n.wrap&&(n.check=br(n.check,r,y,c)),u-=y,c+=y,n.length-=y),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&lr(n)){if(u===0)break e;y=0;do U=r[c+y++],n.head&&U&&n.length<65536&&(n.head.name+=String.fromCharCode(U));while(U&&y<u);if(512&lr(n)&&4&n.wrap&&(n.check=br(n.check,r,y,c)),u-=y,c+=y,U)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&lr(n)){if(u===0)break e;y=0;do U=r[c+y++],n.head&&U&&n.length<65536&&(n.head.comment+=String.fromCharCode(U));while(U&&y<u);if(512&lr(n)&&4&n.wrap&&(n.check=br(n.check,r,y,c)),u-=y,c+=y,U)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&lr(n)){for(;m<16;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if(4&n.wrap&&f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Ln;break}f=0,m=0}n.head&&(n.head.hcrc=lr(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=ba;break;case 16189:for(;m<32;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}e.adler=n.check=mG(f),f=0,m=0,n.mode=Yv;case Yv:if(n.havedict===0)return e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,n.hold=f,n.bits=m,lle;e.adler=n.check=1,n.mode=ba;case ba:if(t===cle||t===zv)break e;case W0:if(n.last){f>>>=7&m,m-=7&m,n.mode=z0;break}for(;m<3;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}switch(n.last=1&f,f>>>=1,m-=1,3&f){case 0:n.mode=16193;break;case 1:if(ple(n),n.mode=$v,t===zv){f>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Ln}f>>>=2,m-=2;break;case 16193:for(f>>>=7&m,m-=7&m;m<32;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Ln;break}if(n.length=65535&f,f=0,m=0,n.mode=q0,t===zv)break e;case q0:n.mode=16195;case 16195:if(y=n.length,y){if(y>u&&(y=u),y>h&&(y=h),y===0)break e;i.set(r.subarray(c,c+y),l),u-=y,c+=y,h-=y,l+=y,n.length-=y;break}n.mode=ba;break;case 16196:for(;m<14;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if(n.nlen=257+(31&f),f>>>=5,m-=5,n.ndist=1+(31&f),f>>>=5,m-=5,n.ncode=4+(15&f),f>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Ln;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}n.lens[Te[n.have++]]=7&f,f>>>=3,m-=3}for(;n.have<19;)n.lens[Te[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,ae={bits:n.lenbits},H=dm(0,n.lens,0,19,n.lencode,0,n.work,ae),n.lenbits=ae.bits,H){e.msg="invalid code lengths set",n.mode=Ln;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;K=n.lencode[f&(1<<n.lenbits)-1],I=K>>>24,N=K>>>16&255,L=65535&K,!(I<=m);){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if(L<16)f>>>=I,m-=I,n.lens[n.have++]=L;else{if(L===16){for(Ce=I+2;m<Ce;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if(f>>>=I,m-=I,n.have===0){e.msg="invalid bit length repeat",n.mode=Ln;break}U=n.lens[n.have-1],y=3+(3&f),f>>>=2,m-=2}else if(L===17){for(Ce=I+3;m<Ce;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}f>>>=I,m-=I,U=0,y=3+(7&f),f>>>=3,m-=3}else{for(Ce=I+7;m<Ce;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}f>>>=I,m-=I,U=0,y=11+(127&f),f>>>=7,m-=7}if(n.have+y>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Ln;break}for(;y--;)n.lens[n.have++]=U}}if(n.mode===Ln)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Ln;break}if(n.lenbits=9,ae={bits:n.lenbits},H=dm(1,n.lens,0,n.nlen,n.lencode,0,n.work,ae),n.lenbits=ae.bits,H){e.msg="invalid literal/lengths set",n.mode=Ln;break}if(n.distbits=6,n.distcode=n.distdyn,ae={bits:n.distbits},H=dm(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,ae),n.distbits=ae.bits,H){e.msg="invalid distances set",n.mode=Ln;break}if(n.mode=$v,t===zv)break e;case $v:n.mode=Xv;case Xv:if(u>=6&&h>=258){e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,n.hold=f,n.bits=m,rle(e,_),l=e.next_out,i=e.output,h=e.avail_out,c=e.next_in,r=e.input,u=e.avail_in,f=n.hold,m=n.bits,n.mode===ba&&(n.back=-1);break}for(n.back=0;K=n.lencode[f&(1<<n.lenbits)-1],I=K>>>24,N=K>>>16&255,L=65535&K,!(I<=m);){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if(N&&(240&N)==0){for(M=I,V=N,j=L;K=n.lencode[j+((f&(1<<M+V)-1)>>M)],I=K>>>24,N=K>>>16&255,L=65535&K,!(M+I<=m);){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}f>>>=M,m-=M,n.back+=M}if(f>>>=I,m-=I,n.back+=I,n.length=L,N===0){n.mode=16205;break}if(32&N){n.back=-1,n.mode=ba;break}if(64&N){e.msg="invalid literal/length code",n.mode=Ln;break}n.extra=15&N,n.mode=16201;case 16201:if(n.extra){for(Ce=n.extra;m<Ce;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;K=n.distcode[f&(1<<n.distbits)-1],I=K>>>24,N=K>>>16&255,L=65535&K,!(I<=m);){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if((240&N)==0){for(M=I,V=N,j=L;K=n.distcode[j+((f&(1<<M+V)-1)>>M)],I=K>>>24,N=K>>>16&255,L=65535&K,!(M+I<=m);){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}f>>>=M,m-=M,n.back+=M}if(f>>>=I,m-=I,n.back+=I,64&N){e.msg="invalid distance code",n.mode=Ln;break}n.offset=L,n.extra=15&N,n.mode=16203;case 16203:if(n.extra){for(Ce=n.extra;m<Ce;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Ln;break}n.mode=16204;case 16204:if(h===0)break e;if(y=_-h,n.offset>y){if(y=n.offset-y,y>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Ln;break}y>n.wnext?(y-=n.wnext,A=n.wsize-y):A=n.wnext-y,y>n.length&&(y=n.length),C=n.window}else C=i,A=l-n.offset,y=n.length;y>h&&(y=h),h-=y,n.length-=y;do i[l++]=C[A++];while(--y);n.length===0&&(n.mode=Xv);break;case 16205:if(h===0)break e;i[l++]=n.length,h--,n.mode=Xv;break;case z0:if(n.wrap){for(;m<32;){if(u===0)break e;u--,f|=r[c++]<<m,m+=8}if(_-=h,e.total_out+=_,n.total+=_,4&n.wrap&&_&&(e.adler=n.check=lr(n)?br(n.check,i,_,l-_):em(n.check,i,_,l-_)),_=h,4&n.wrap&&(lr(n)?f:mG(f))!==n.check){e.msg="incorrect data check",n.mode=Ln;break}f=0,m=0}n.mode=16207;case 16207:if(n.wrap&&lr(n)){for(;m<32;){if(u===0)break e;u--,f+=r[c++]<<m,m+=8}if(4&n.wrap&&f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Ln;break}f=0,m=0}n.mode=16208;case 16208:H=dle;break e;case Ln:H=hG;break e;case 16210:return pG;default:return Oo}return e.next_out=l,e.avail_out=h,e.next_in=c,e.avail_in=u,n.hold=f,n.bits=m,(n.wsize||_!==e.avail_out&&n.mode<Ln&&(n.mode<z0||t!==uG))&&SG(e,e.output,e.next_out,_-e.avail_out),E-=e.avail_in,_-=e.avail_out,e.total_in+=E,e.total_out+=_,n.total+=_,4&n.wrap&&_&&(e.adler=n.check=lr(n)?br(n.check,i,_,e.next_out-_):em(n.check,i,_,e.next_out-_)),e.data_type=n.bits+(n.last?64:0)+(n.mode===ba?128:0)+(n.mode===$v||n.mode===q0?256:0),(E===0&&_===0||t===uG)&&H===Qd&&(H=ule),H},wa={inflateReset:_G,inflateReset2:EG,inflateResetKeep:gG,inflateInit:e=>vG(e,15),inflateInit2:vG,inflate:fle,inflateEnd:e=>{if(el(e))return Oo;let t=e.state;return t.window&&(t.window=null),e.state=null,Qd},inflateGetHeader:(e,t)=>{if(el(e))return Oo;let n=e.state;return(2&n.wrap)==0?Oo:(n.head=t,t.done=!1,Qd)},inflateSetDictionary:(e,t)=>{let n=t.length,r,i,c;return el(e)?Oo:(r=e.state,r.wrap!==0&&r.mode!==Yv?Oo:r.mode===Yv&&(i=1,i=em(i,t,n,0),i!==r.check)?hG:(c=SG(e,t,n,n),c?(r.mode=16210,pG):(r.havedict=1,Qd)))},inflateInfo:"pako inflate (from Nodeca project)"},mle=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let TG=Object.prototype.toString,{Z_NO_FLUSH:gle,Z_FINISH:_le,Z_OK:lm,Z_STREAM_END:$0,Z_NEED_DICT:X0,Z_STREAM_ERROR:Ele,Z_DATA_ERROR:CG,Z_MEM_ERROR:vle}=Eh;function um(e){this.options=Hv.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dG,this.strm.avail_out=0;let n=wa.inflateInit2(this.strm,t.windowBits);if(n!==lm)throw new Error($d[n]);if(this.header=new mle,wa.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=am.string2buf(t.dictionary):TG.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=wa.inflateSetDictionary(this.strm,t.dictionary),n!==lm)))throw new Error($d[n])}function J0(e,t){let n=new um(t);if(n.push(e),n.err)throw n.msg||$d[n.err];return n.result}um.prototype.push=function(e,t){let n=this.strm,r=this.options.chunkSize,i=this.options.dictionary,c,l,u;if(this.ended)return!1;for(l=t===~~t?t:t===!0?_le:gle,TG.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),c=wa.inflate(n,l),c===X0&&i&&(c=wa.inflateSetDictionary(n,i),c===lm?c=wa.inflate(n,l):c===CG&&(c=X0));n.avail_in>0&&c===$0&&n.state.wrap>0&&e[n.next_in]!==0;)wa.inflateReset(n),c=wa.inflate(n,l);switch(c){case Ele:case CG:case X0:case vle:return this.onEnd(c),this.ended=!0,!1}if(u=n.avail_out,n.next_out&&(n.avail_out===0||c===$0))if(this.options.to==="string"){let h=am.utf8border(n.output,n.next_out),f=n.next_out-h,m=am.buf2string(n.output,h);n.next_out=f,n.avail_out=r-f,f&&n.output.set(n.output.subarray(h,h+f),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(c!==lm||u!==0){if(c===$0)return c=wa.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},um.prototype.onData=function(e){this.chunks.push(e)},um.prototype.onEnd=function(e){e===lm&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Hv.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var yle={Inflate:um,inflate:J0,inflateRaw:function(e,t){return(t=t||{}).raw=!0,J0(e,t)},ungzip:J0,constants:Eh};let{Deflate:tTe,deflate:Sle,deflateRaw:Tle,gzip:nTe}=nle,{Inflate:rTe,inflate:Cle,inflateRaw:Rle,ungzip:iTe}=yle;var Ile=Sle,ble=Tle,wle=Cle,Ale=Rle,RG=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(RG||{});class Dle{constructor(){w(this,"_sequence",0),w(this,"_startTime",Date.now()),w(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let u=new Uint8Array(4);u.set([1,0,0,0]);let h={id:0,length:4,data:u.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};n.commonPacketHeader.extension=1,n.extension=f,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;D("SHOW_DATASTREAM2_LOG")&&S.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));let r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),c=new DataView(r),l=0;if(c.setUint16(l,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),l+=2,c.setUint32(l,n.commonPacketHeader.sequence,!0),l+=4,c.setUint16(l,n.commonStreamHeader,!0),l+=2,n.extension){let u=this.serializeExtension(n.extension);i.set(new Uint8Array(u),l),l+=u.byteLength}if(i.set(new Uint8Array(n.payload),l),l+=n.payload.byteLength,l!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let n=new DataView(t),r=0,i=n.getUint16(r,!0);r+=2;let c={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)},l,u;if(r+=4,D("SHOW_DATASTREAM2_LOG")&&S.debug("receive data header: ".concat(JSON.stringify(c))),n.getUint16(r,!0),r+=2,c.extension){u=this.deserializeExtension(t.slice(r)),r+=2+u.length,l=t.slice(r);let h=!1;if(u.datas.length>0){let f=u.datas.find(m=>m.id===0);f&&(h=(1&new DataView(f.data).getUint32(0,!0))==1)}l=h?this.decompress(l):l}else l=t.slice(8);return l}serializeExtension(t){let{profile:n,length:r,datas:i}=t,c=new ArrayBuffer(r+2),l=new Uint8Array(c),u=new DataView(c),h=0;if(u.setUint8(h++,n),u.setUint8(h++,r),i.forEach(f=>{n?(u.setUint8(h++,f.id),u.setUint8(h++,f.length),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength):(u.setUint8(h++,f.id|f.length<<4),l.set(new Uint8Array(f.data),h),h+=f.data.byteLength)}),h!==r+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(r+2));return c}deserializeExtension(t){let n=new DataView(t),r=0,i=n.getUint8(r);r++;let c=n.getUint8(r);r++;let l=i===RG.TWO_BYTE,u=[],h=new DataView(t,2),f=0;for(;f<c;){let m=0,E=0,_=new ArrayBuffer(0);l?(m=h.getUint8(f),f++,E=h.getUint8(f),f++):(m=15&h.getUint8(f),E=h.getUint8(f)>>4,f++),E>0&&(_=h.buffer.slice(f+2,f+2+E),f+=_.byteLength),u.push({id:m,length:E,data:_})}if(f!==c)throw Error("parse error");return{profile:i,length:c,datas:u}}decompress(t){return wle(new Uint8Array(t))}compress(t){return Ile(new Uint8Array(t))}}let Ole={name:"DataStream",create:(e,t)=>{let n=t?new kae(e):new Mae(e);return n.useDataStream(new Dle),n}};class Nle extends jt{constructor(t,n,r){super(),w(this,"ws",void 0),w(this,"requestId",1),w(this,"heartBeatTimer",void 0),w(this,"joinInfo",void 0),w(this,"clientId",void 0),w(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),w(this,"onClose",i=>{this.emit("close"),this.dispose()}),w(this,"onMessage",i=>{let c=JSON.parse(i.data);if(!c||c.command!=="serverResponse"||!c.requestId)return c&&c.command==="serverStatus"&&c.serverStatus&&c.serverStatus.command?(this.emit("status",c.serverStatus),void this.emit(c.serverStatus.command,c.serverStatus)):void 0;this.emit("req_".concat(c.requestId),c)}),this.joinInfo=t,this.clientId=n,this.ws=new kf("cross-channel-".concat(this.clientId),r),this.ws.on(Ne.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ne.CONNECTED,this.onOpen),this.ws.on(Ne.ON_MESSAGE,this.onMessage),this.ws.on(Ne.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ie((n,r)=>{let i=window.setTimeout(()=>{r(new G(P.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,c=>{window.clearTimeout(i),c.state&&c.state!==0?r(new G(P.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new G(P.WS_ABORT))})})}request(t){return O(this,null,function*(){if(this.ws.state==="closed")throw new G(P.WS_DISCONNECT);let n=()=>new ie((l,u)=>{this.ws.once(Ne.CLOSED,()=>u(new G(P.WS_ABORT))),this.ws.once(Ne.CONNECTED,l)});this.ws.state!=="connected"&&(yield n());let r=this.sendMessage(t),i=new ie((l,u)=>{let h=()=>{u(new G(P.WS_ABORT))};this.ws.once(Ne.RECONNECTING,h),this.ws.once(Ne.CLOSED,h),this.once("req_".concat(r),l),Tn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Ne.RECONNECTING,h),this.ws.off(Ne.CLOSED,h),u(new G(P.TIMEOUT,"cross channel ws request timeout"))})}),c=yield i;if(!c||c.code!==200)throw new G(P.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(c)));return c})}connect(t){return O(this,null,function*(){this.ws.removeAllListeners(Ne.REQUEST_NEW_URLS),this.ws.on(Ne.REQUEST_NEW_URLS,n=>{n(t)}),yield this.ws.init(t)})}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Ple extends jt{set state(t){t!==this._state&&(t!==Yr.RELAY_STATE_FAILURE&&(this.errorCode=nh.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,c){super(),w(this,"joinInfo",void 0),w(this,"sid",void 0),w(this,"clientId",void 0),w(this,"cancelToken",Lr.CancelToken.source()),w(this,"workerToken",void 0),w(this,"requestId",0),w(this,"signal",void 0),w(this,"prevChannelMediaConfig",void 0),w(this,"httpRetryConfig",void 0),w(this,"_resolution",void 0),w(this,"_state",Yr.RELAY_STATE_IDLE),w(this,"errorCode",nh.RELAY_OK),w(this,"onStatus",l=>{S.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(l))),l&&l.command&&(l.command==="onAudioPacketReceived"&&this.emit("event",Ta.PACKET_RECEIVED_AUDIO_FROM_SRC),l.command==="onVideoPacketReceived"&&this.emit("event",Ta.PACKET_RECEIVED_VIDEO_FROM_SRC),l.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=nh.SRC_TOKEN_EXPIRED,this.state=Yr.RELAY_STATE_FAILURE),l.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=nh.DEST_TOKEN_EXPIRED,this.state=Yr.RELAY_STATE_FAILURE))}),w(this,"onReconnect",()=>O(this,null,function*(){S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ta.NETWORK_DISCONNECTED),this.state=Yr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(l=>{this.state!==Yr.RELAY_STATE_IDLE&&(S.error("auto restart channel media relay failed",l.toString()),this.errorCode=nh.SERVER_CONNECTION_LOST,this.state=Yr.RELAY_STATE_FAILURE)})})),this.joinInfo=t,this.clientId=n,this.sid=Od(),this.signal=new Nle(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=c}startChannelMediaRelay(t){return O(this,null,function*(){if(this.state!==Yr.RELAY_STATE_IDLE)throw new G(P.INVALID_OPERATION);this.state=Yr.RELAY_STATE_CONNECTING,yield this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{yield this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new G(P.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new G(P.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new G(P.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t})}updateChannelMediaRelay(t){return O(this,null,function*(){if(this.state!==Yr.RELAY_STATE_RUNNING)throw new G(P.INVALID_OPERATION);yield this.sendUpdateMessage(t),this.prevChannelMediaConfig=t})}setVideoProfile(t){return O(this,null,function*(){if(this._resolution=t,this.state!==Yr.RELAY_STATE_RUNNING)throw new G(P.INVALID_OPERATION);let n=this.genMessage(xr.SetVideoProfile);yield this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))})}stopChannelMediaRelay(){return O(this,null,function*(){yield this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Yr.RELAY_STATE_IDLE,this.dispose()})}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Lr.CancelToken.source(),this.state=Yr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){return O(this,null,function*(){let t=yield Vce(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,yield this.signal.connect(t.addressList),this.emit("event",Ta.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)})}sendStartRelayMessage(t){return O(this,null,function*(){let n=this.genMessage(xr.SetSdkProfile,t);yield this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let r=this.genMessage(xr.SetSourceChannel,t);yield this.signal.request(r),yield this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ta.PACKET_JOINED_SRC_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let i=this.genMessage(xr.SetSourceUserId,t);yield this.signal.request(i),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let c=this.genMessage(xr.SetDestChannel,t);yield this.signal.request(c),yield this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ta.PACKET_JOINED_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let l=this.genMessage(xr.StartPacketTransfer,t);yield this.signal.request(l),this.emit("event",Ta.PACKET_SENT_TO_DEST_CHANNEL),this.state=Yr.RELAY_STATE_RUNNING,S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)})}sendUpdateMessage(t){return O(this,null,function*(){let n=this.genMessage(xr.UpdateDestChannel,t);yield this.signal.request(n),this.emit("event",Ta.PACKET_UPDATE_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})}sendStopRelayMessage(){return O(this,null,function*(){let t=this.genMessage(xr.StopPacketTransfer);yield this.signal.request(t),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})}genMessage(t,n){let r=[],i=[],c=[];this.requestId+=1;let l={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Vi,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};l.sdkVersion==="4.24.1"&&(l.sdkVersion="0.0.1");let u=null,h=null;switch(t){case xr.SetSdkProfile:return l.clientRequest={command:"SetSdkProfile",type:"multi_channel"},l;case xr.SetSourceChannel:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new G(P.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},l;case xr.SetSourceUserId:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new G(P.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceUserId",uid:h.uid+""},l;case xr.SetDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new G(P.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{r.push(f.channelName),i.push(f.uid+""),c.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:c},l;case xr.StartPacketTransfer:return l.clientRequest={command:"StartPacketTransfer"},l;case xr.Reconnect:return l.clientRequest={command:"Reconnect"},l;case xr.StopPacketTransfer:return l.clientRequest={command:"StopPacketTransfer"},l;case xr.UpdateDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new G(P.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{r.push(f.channelName),i.push(f.uid+""),c.push(f.token||this.joinInfo.appId)}),l.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:c},l;case xr.SetVideoProfile:l.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return l}}let Lle={name:"ChannelMediaRelay",create:function(e){return new Ple(e.joinInfo,e.clientId,e.websocketRetryConfig||cn,e.httpRetryConfig||cn,e.resolution)}};function IG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function hm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?IG(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IG(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class kle extends jt{constructor(t,n,r,i){super(),w(this,"spec",void 0),w(this,"token",void 0),w(this,"websocket",void 0),w(this,"pingpongTimer",void 0),w(this,"reconnectMode","retry"),w(this,"serviceMode",void 0),w(this,"reqId",0),w(this,"commandReqId",0),w(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),w(this,"handleWebSocketMessage",c=>{if(!c.data)return;let l=JSON.parse(c.data);l.requestId?this.emit("@".concat(l.requestId,"-").concat(l.sid),l):(ue.workerEvent(this.spec.sid,{actionType:"status",serverCode:l.code,workerType:this.serviceMode===Ms.TRANSCODE?1:2}),this.emit(Sc.PUBLISH_STREAM_STATUS,l))}),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new kf("live-streaming",r),this.websocket.on(Ne.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ne.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ne.REQUEST_NEW_URLS,(c,l)=>{hn(this,Sc.REQUEST_NEW_ADDRESS).then(c).catch(l)}),this.websocket.on(Ne.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}request(t,n,r,i){return O(this,null,function*(){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let c=this.commandReqId,l=this.reqId;if(!l||!this.websocket)throw new G(P.UNEXPECTED_ERROR);let u=hm({command:t,sdkVersion:Vi==="4.24.1"?"0.0.1":Vi,seq:l,requestId:l,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new G(P.WS_DISCONNECT);let h=()=>new ie((_,y)=>{this.websocket.once(Ne.CLOSED,()=>y(new G(P.WS_ABORT))),this.websocket.once(Ne.CONNECTED,_)});this.websocket.state!=="connected"&&(yield h()),u.clientRequest&&(u.clientRequest.workerToken=this.token);let f=new ie((_,y)=>{let A=()=>{y(new G(P.WS_ABORT))};this.websocket.once(Ne.RECONNECTING,A),this.websocket.once(Ne.CLOSED,A),this.once("@".concat(l,"-").concat(this.spec.sid),C=>{_(C)})});i&&ue.workerEvent(this.spec.sid,hm(hm({},i),{},{requestId:c,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));let m=Date.now();this.websocket.sendMessage(u);let E=null;try{E=yield f}catch(_){if(this.websocket.state==="closed")throw _;return yield h(),yield this.request(t,n,r)}return i&&ue.workerEvent(this.spec.sid,hm(hm({},i),{},{requestId:c,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-m})),E.code!==200&&this.handleResponseError(E),E})}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Vi==="4.24.1"?"0.0.1":Vi;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case _n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case _n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case _n.LIVE_STREAM_RESPONSE_BAD_STREAM:case _n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new G(P.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case _n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new G(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case _n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new G(P.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case _n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let n=new G(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Sc.WARNING,n,t.serverResponse.url)}case _n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let n=new G(P.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Sc.WARNING,n,t.serverResponse.url)}case _n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new G(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case _n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new G(P.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case _n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let n=new G(P.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Sc.WARNING,n,t.serverResponse.url)}case _n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new G(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case _n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new G(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case _n.LIVE_STREAM_RESPONSE_WORKER_LOST:case _n.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new G(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case _n.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new G(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new G(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case _n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new G(P.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(bf)},6e3)}}function bG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Xr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bG(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bG(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Mle extends jt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:cn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:cn;super(),w(this,"onLiveStreamWarning",void 0),w(this,"onLiveStreamError",void 0),w(this,"spec",void 0),w(this,"retryTimeout",1e4),w(this,"connection",void 0),w(this,"httpRetryConfig",void 0),w(this,"wsRetryConfig",void 0),w(this,"streamingTasks",new Map),w(this,"isStartingStreamingTask",!1),w(this,"taskMutex",new Dn("live-streaming")),w(this,"cancelToken",Lr.CancelToken.source()),w(this,"transcodingConfig",void 0),w(this,"uapResponse",void 0),w(this,"lastTaskId",1),w(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}setTranscodingConfig(t){return O(this,null,function*(){let n=Xr(Xr({},Ece),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(S.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(l=>Xr(Xr(Xr({},_ce),l),{},{zOrder:l.zOrder?l.zOrder+1:1}))),(function(l){qt(l.width)||yt(l.width,"config.width",0,1e4),qt(l.height)||yt(l.height,"config.height",0,1e4),qt(l.videoBitrate)||yt(l.videoBitrate,"config.videoBitrate",1,1e6),qt(l.videoFrameRate)||yt(l.videoFrameRate,"config.videoFrameRate"),qt(l.lowLatency)||Eo(l.lowLatency,"config.lowLatency"),qt(l.audioSampleRate)||an(l.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),qt(l.audioBitrate)||yt(l.audioBitrate,"config.audioBitrate",1,128),qt(l.audioChannels)||an(l.audioChannels,"config.audioChannels",[1,2,3,4,5]),qt(l.videoGop)||yt(l.videoGop,"config.videoGop"),qt(l.videoCodecProfile)||an(l.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),qt(l.userCount)||yt(l.userCount,"config.userCount",0,17),qt(l.backgroundColor)||yt(l.backgroundColor,"config.backgroundColor",0,16777215),qt(l.userConfigExtraInfo)||Un(l.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),l.transcodingUsers&&!qt(l.transcodingUsers)&&(ya(l.transcodingUsers,"config.transcodingUsers"),l.transcodingUsers.forEach((u,h)=>{dv(u.uid),qt(u.x)||yt(u.x,"transcodingUser[".concat(h,"].x"),0,1e4),qt(u.y)||yt(u.y,"transcodingUser[".concat(h,"].y"),0,1e4),qt(u.width)||yt(u.width,"transcodingUser[".concat(h,"].width"),0,1e4),qt(u.height)||yt(u.height,"transcodingUser[".concat(h,"].height"),0,1e4),qt(u.zOrder)||yt(u.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),qt(u.alpha)||yt(u.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),qt(l.watermark)||Fw(l.watermark,"watermark"),qt(l.backgroundImage)||Fw(l.backgroundImage,"backgroundImage"),l.images&&!qt(l.images)&&(ya(l.images,"config.images"),l.images.forEach((u,h)=>{Fw(u,"images[".concat(h,"]"))}))})(n);let r=[];n.images&&r.push(...n.images.map(l=>Xr(Xr(Xr({},Uw),l),{},{zOrder:255}))),n.backgroundImage&&(r.push(Xr(Xr(Xr({},Uw),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(Xr(Xr(Xr({},Uw),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(l=>Xr({},l)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);let i=(n.userConfigs||[]).map(l=>typeof l.uid=="number"?ie.resolve(l.uid):KB(l.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((yield ie.all(i)).forEach((l,u)=>{n.userConfigs&&n.userConfigs[u]&&(n.userConfigs[u].uid=l)}),this.transcodingConfig=n,this.connection)try{var c;let l=yield this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ai(c=this.streamingTasks).call(c)).map(u=>u.taskId).join("#")});S.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(l.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(l){if(!l.data||!l.data.retry)throw l;l.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),l.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,l).then(()=>{S.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(h=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})})}})}startLiveStreamingTask(t,n,r){return O(this,null,function*(){if(!this.transcodingConfig&&n===Ms.TRANSCODE)throw new G(P.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));let c=yield this.taskMutex.lock();if(!this.connection&&r)return void c();if(this.streamingTasks.get(t)&&!r)return c(),new G(P.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=yield this.connect(n))}catch(u){throw c(),u}switch(n){case Ms.TRANSCODE:i.transcodingConfig=Xr({},this.transcodingConfig);case Ms.RAW:}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let l=this.lastTaskId++;try{let u=new ie((f,m)=>{Tn(this.retryTimeout).then(()=>{if(r)return m(r);let E=this.statusError.get(t);return E?(this.statusError.delete(t),m(E)):void 0})}),h=yield ie.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===Ms.TRANSCODE?1:2,requestByUser:!r,tid:l.toString()}),u]);this.isStartingStreamingTask=!1,S.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(h.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:l}),c()}catch(u){if(c(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||r)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),yield this.startLiveStreamingTask(t,n,u)):yield this.startLiveStreamingTask(t,n,u)}})}stopLiveStreamingTask(t){return new ie((n,r)=>{let i=this.streamingTasks.get(t);if(!i||!this.connection)return new G(P.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let c=i.mode;i.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:c===Ms.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(l=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(l.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;let n=Array.from(ai(t=this.streamingTasks).call(t));this.terminate();for(let r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Lr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(t){return O(this,null,function*(){if(this.connection)throw new G(P.UNEXPECTED_ERROR,"live streaming connection has already connected");let n=yield hn(this,Vw.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new kle(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Sc.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(Sc.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Sc.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new G(P.UNEXPECTED_ERROR,"can not get new live streaming address list"));hn(this,Vw.REQUEST_WORKER_MANAGER_LIST,t).then(c=>{this.uapResponse=c,r(c.addressList)}).catch(i)}),yield this.connection.init(n.addressList),this.connection})}handlePublishStreamServer(t){let n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case _n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case _n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let l=new G(P.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return S.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,l);if(!this.isStartingStreamingTask)return;this.statusError.set(n,l)}case _n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let l=new G(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,l)}case _n.LIVE_STREAM_RESPONSE_WORKER_LOST:case _n.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var c;if(!this.connection)return;this.connection.tryNextAddress();let l=Array.from(ai(c=this.streamingTasks).call(c));for(let u of l)u.abortTask?u.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new G(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(h=>{S.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let xle={name:"LiveStreaming",create:function(e){return new Mle(e.joinInfo,e.websocketRetryConfig||cn,e.httpRetryConfig||cn)}};function Ule(e){let t=DG();return(function(n,r){let i=n.appId;i!==void 0&&(ht(r,10),zs(r,i));let c=n.cid;c!==void 0&&(ht(r,16),ht(r,c));let l=n.cname;l!==void 0&&(ht(r,26),zs(r,l));let u=n.deviceId;u!==void 0&&(ht(r,34),zs(r,u));let h=n.elapse;h!==void 0&&(ht(r,40),kc(r,h));let f=n.fileSize;f!==void 0&&(ht(r,48),kc(r,Th(f)));let m=n.height;m!==void 0&&(ht(r,56),kc(r,Th(m)));let E=n.jpg;E!==void 0&&(ht(r,66),ht(r,E.length),(function(Ut,$){let ne=Ch(Ut,$.length);Ut.bytes.set($,ne)})(r,E));let _=n.networkType;_!==void 0&&(ht(r,72),kc(r,Th(_)));let y=n.osType;y!==void 0&&(ht(r,80),kc(r,Th(y)));let A=n.requestId;A!==void 0&&(ht(r,90),zs(r,A));let C=n.sdkVersion;C!==void 0&&(ht(r,98),zs(r,C));let I=n.sequence;I!==void 0&&(ht(r,104),kc(r,Th(I)));let N=n.sid;N!==void 0&&(ht(r,114),zs(r,N));let L=n.timestamp;L!==void 0&&(ht(r,120),kc(r,L));let M=n.uid;M!==void 0&&(ht(r,128),ht(r,M));let V=n.vid;V!==void 0&&(ht(r,136),ht(r,V));let j=n.width;j!==void 0&&(ht(r,144),kc(r,Th(j)));let U=n.service;U!==void 0&&(ht(r,152),ht(r,U));let H=n.callbackData;H!==void 0&&(ht(r,162),zs(r,H));let K=n.jpgEncryption;K!==void 0&&(ht(r,168),ht(r,K));let Y=n.requestType;Y!==void 0&&(ht(r,176),ht(r,Y));let ae=n.scorePorn;ae!==void 0&&(ht(r,185),nA(r,ae));let Ce=n.scoreSexy;Ce!==void 0&&(ht(r,193),nA(r,Ce));let Te=n.scoreNeutral;Te!==void 0&&(ht(r,201),nA(r,Te));let Le=n.scene;Le!==void 0&&(ht(r,208),ht(r,Le));let De=n.ossFilePrefix;De!==void 0&&(ht(r,218),zs(r,De));let tt=n.serviceVendor;if(tt!==void 0)for(let Ut of tt){ht(r,226);let $=DG();jle(Ut,$),ht(r,$.limit),Wle(r,$),Gle($)}})(e,t),(function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)})(t)}function Fle(e){return(function(n){let r={};e:for(;!OG(n);){let i=Ks(n);switch(i>>>3){case 0:break e;case 1:r.code=Ks(n);break;case 2:r.msg=NG(n,Ks(n));break;case 3:{let c=Ble(n);r.data=Vle(n),n.limit=c;break}default:wG(n,7&i)}}return r})({bytes:t=e,offset:0,limit:t.length});var t}function Vle(e){let t={};e:for(;!OG(e);){let n=Ks(e);switch(n>>>3){case 0:break e;case 1:t.requestId=NG(e,Ks(e));break;case 2:t.requestType=Ks(e)>>>0;break;case 3:t.scorePorn=tA(e);break;case 4:t.scoreSexy=tA(e);break;case 5:t.scoreNeutral=tA(e);break;case 6:t.requestScene=Ks(e)>>>0;break;case 7:t.scene=Ks(e)>>>0;break;default:wG(e,7&n)}}return t}function jle(e,t){let n=e.service;n!==void 0&&(ht(t,8),ht(t,n));let r=e.vendor;r!==void 0&&(ht(t,16),ht(t,r));let i=e.token;i!==void 0&&(ht(t,26),zs(t,i));let c=e.callbackUrl;c!==void 0&&(ht(t,34),zs(t,c))}function Ble(e){let t=Ks(e),n=e.limit;return e.limit=e.offset+t,n}function wG(e,t){switch(t){case 0:for(;128&PG(e););break;case 2:Q0(e,Ks(e));break;case 5:Q0(e,4);break;case 1:Q0(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Hle=new Float32Array(1);new Uint8Array(Hle.buffer);let Z0=new Float64Array(1),Jr=new Uint8Array(Z0.buffer);function Th(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let AG=[];function DG(){let e=AG.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Gle(e){AG.push(e)}function Q0(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function OG(e){return e.offset>=e.limit}function Ch(e,t){let n=e.bytes,r=e.offset,i=e.limit,c=r+t;if(c>n.length){let l=new Uint8Array(2*c);l.set(n),e.bytes=l}return e.offset=c,c>i&&(e.limit=c),r}function eA(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function NG(e,t){let n=eA(e,t),r=String.fromCharCode,i=e.bytes,c="\uFFFD",l="";for(let u=0;u<t;u++){let h,f,m,E,_=i[u+n];(128&_)==0?l+=r(_):(224&_)==192?u+1>=t?l+=c:(h=i[u+n+1],(192&h)!=128?l+=c:(E=(31&_)<<6|63&h,E<128?l+=c:(l+=r(E),u++))):(240&_)==224?u+2>=t?l+=c:(h=i[u+n+1],f=i[u+n+2],(49344&(h|f<<8))!=32896?l+=c:(E=(15&_)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?l+=c:(l+=r(E),u+=2))):(248&_)==240?u+3>=t?l+=c:(h=i[u+n+1],f=i[u+n+2],m=i[u+n+3],(12632256&(h|f<<8|m<<16))!=8421504?l+=c:(E=(7&_)<<18|(63&h)<<12|(63&f)<<6|63&m,E<65536||E>1114111?l+=c:(E-=65536,l+=r(55296+(E>>10),56320+(1023&E)),u+=3))):l+=c}return l}function zs(e,t){let n=t.length,r=0;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),r+=u<128?1:u<2048?2:u<65536?3:4}ht(e,r);let i=Ch(e,r),c=e.bytes;for(let l=0;l<n;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<n&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?c[i++]=u:(u<2048?c[i++]=u>>6&31|192:(u<65536?c[i++]=u>>12&15|224:(c[i++]=u>>18&7|240,c[i++]=u>>12&63|128),c[i++]=u>>6&63|128),c[i++]=63&u|128)}}function Wle(e,t){let n=Ch(e,t.limit),r=e.bytes,i=t.bytes;for(let c=0,l=t.limit;c<l;c++)r[c+n]=i[c]}function PG(e){return e.bytes[eA(e,1)]}function LG(e,t){let n=Ch(e,1);e.bytes[n]=t}function tA(e){let t=eA(e,8),n=e.bytes;return Jr[0]=n[t++],Jr[1]=n[t++],Jr[2]=n[t++],Jr[3]=n[t++],Jr[4]=n[t++],Jr[5]=n[t++],Jr[6]=n[t++],Jr[7]=n[t++],Z0[0]}function nA(e,t){let n=Ch(e,8),r=e.bytes;Z0[0]=t,r[n++]=Jr[0],r[n++]=Jr[1],r[n++]=Jr[2],r[n++]=Jr[3],r[n++]=Jr[4],r[n++]=Jr[5],r[n++]=Jr[6],r[n++]=Jr[7]}function Ks(e){let t,n=0,r=0;do t=PG(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function ht(e,t){for(t>>>=0;t>=128;)LG(e,127&t|128),t>>>=7;LG(e,t)}function kc(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,c=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,l=Ch(e,c),u=e.bytes;switch(c){case 10:u[l+9]=i>>>7&1;case 9:u[l+8]=c!==9?128|i:127&i;case 8:u[l+7]=c!==8?r>>>21|128:r>>>21&127;case 7:u[l+6]=c!==7?r>>>14|128:r>>>14&127;case 6:u[l+5]=c!==6?r>>>7|128:r>>>7&127;case 5:u[l+4]=c!==5?128|r:127&r;case 4:u[l+3]=c!==4?n>>>21|128:n>>>21&127;case 3:u[l+2]=c!==3?n>>>14|128:n>>>14&127;case 2:u[l+1]=c!==2?n>>>7|128:n>>>7&127;case 1:u[l]=c!==1?128|n:127&n}}function kG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}let qle=new Map([["moderation",1],["supervise",2]]);class zle extends jt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let n=this._connectionState;this._connectionState=t,this.emit(Nn.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Ui(n=t.map(r=>qle.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),w(this,"name","AgoraRTCVideoContentInspect"),w(this,"_connectionState",Co.CONNECTING),w(this,"_innerConnectionState",void 0),w(this,"sequence",0),w(this,"inspectStartTime",void 0),w(this,"workerManagerConnection",void 0),w(this,"workerConnection",void 0),w(this,"workerMessageLengthLimit",void 0),w(this,"inspectIntervalMinimum",void 0),w(this,"qualityRatio",void 0),w(this,"_connectInfo",void 0),w(this,"_cancelTokenSource",Lr.CancelToken.source()),w(this,"_retryConfig",void 0),w(this,"wmSequence",0),w(this,"inspectInterval",void 0),w(this,"inspectTimer",null),w(this,"ossFilePrefix",void 0),w(this,"extraInfo",void 0),w(this,"_inspectType",void 0),w(this,"_inspectMode",void 0),w(this,"_quality",1),w(this,"qualityTimer",null),w(this,"_inspectId",void 0),w(this,"_needWorkUrlOnly",!1),w(this,"inspectImage",()=>{if(this.connectionState!==Co.CONNECTED)throw new G(P.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Co.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=at(5,"inspect-"),this.workerMessageLengthLimit=D("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=D("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=D("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new kf("worker-manager-"+this._inspectId,cn),this.on(Nn.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,S.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ro[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new kf("worker-"+this._inspectId,cn),this.handleWorkerEvents()}init(t,n){return O(this,null,function*(){this.emit(Nn.STATE_CHANGE,Ro.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=n,new ie((i,c)=>{this.on(Nn.CONNECTION_STATE_CHANGE,(l,u)=>{u===Co.CONNECTED&&i()}),this.requestAP(t,r,n).then(l=>{this.connectWorkerManager(l)}).catch(l=>{c(l)})})})}requestAP(t,n,r){return O(this,null,function*(){let i=D("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),c=yield(function(u,h,f,m){let{appId:E,areaCode:_,cname:y,sid:A,token:C,uid:I}=h;ch++;let N="image_moderation_api",L={service_name:N,json_body:JSON.stringify({appId:E,areaCode:_,cname:y,command:"allocateEdge",requestId:ch,seq:ch,sid:A,token:C,ts:Date.now(),uid:I+""})},M,V,j=u[0];return Yo(()=>O(null,null,function*(){M=Date.now();let U=yield es(j,{data:L,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(V=Date.now()-M,U.code!==0){let Te=new G(P.UNEXPECTED_RESPONSE,"image inspect ap error, code"+U.code,{retry:!0,responseTime:V});throw S.error(Te.toString()),Te}let H=JSON.parse(U.json_body);if(H.code!==200){let Te=new G(P.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(H.code,", reason: ").concat(H.reason),{code:H.code,responseTime:V});throw S.error(Te.toString()),Te}if(!H.servers||!Array.isArray(H.servers)||H.servers.length===0){let Te=new G(P.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:H.code,responseTime:V});throw S.error(Te.toString()),Te}let K=D("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(K)return{addressList:[K],workerToken:H.workerToken,vid:H.vid,responseTime:V};let Y=D("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ae=D("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:H.servers.map(Te=>{let{address:Le,wss:De}=Te;if(Le&&De)return"wss://".concat(Le.replace(/\./g,"-"),".").concat(Y,":").concat(ae||De)}).filter(Te=>!!Te),workerToken:H.workerToken,vid:H.vid,responseTime:V}}),(U,H)=>(ue.apworkerEvent(A,{success:!0,sc:200,serviceName:N,responseDetail:JSON.stringify(U.addressList),firstSuccess:H===0,responseTime:V,serverIp:u[H%u.length]}),!1),(U,H)=>(ue.apworkerEvent(A,{success:!1,sc:U.data&&U.data.code||200,serviceName:N,responseTime:V,serverIp:u[H%u.length]}),!!(U.code!==P.OPERATION_ABORTED&&U.code!==P.UNEXPECTED_RESPONSE||U.data&&U.data.retry)&&(j=u[(H+1)%u.length],!0)),m)})(i,t,n,r);this.emit(Nn.STATE_CHANGE,Ro.AP_CONNECTED);let{addressList:l}=c;return this.wmSequence++,l})}connectWorkerManager(n){return O(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(Nn.STATE_CHANGE,Ro.CONNECT_WORKER_MANAGER),yield this.workerManagerConnection.init(t,1e4)})}connectWorker(t){return O(this,null,function*(){yield this.workerConnection.init([t])})}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ne.CONNECTED,()=>O(this,null,function*(){this.emit(Nn.STATE_CHANGE,Ro.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Ne.CLOSED,()=>{this._innerConnectionState<Ro.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ne.FAILED,()=>{this._innerConnectionState<Ro.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ne.RECONNECTING,()=>{this._innerConnectionState<Ro.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ne.ON_MESSAGE,t=>O(this,null,function*(){this.emit(Nn.STATE_CHANGE,Ro.GET_WORKER_MANAGER_RESPONSE);let n=this.workerManagerConnection.url;this.workerManagerConnection.close();let r=JSON.parse(t.data);if(r.code!==200)throw S.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new G(P.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw S.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new G(P.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{let i=D("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,c=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Nn.STATE_CHANGE,Ro.CONNECT_WORKER,c),this._needWorkUrlOnly?this.emit(Nn.REQUEST_NEW_WORKER_URL,c):yield this.connectWorker(c)}})),this.workerManagerConnection.on(Ne.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(Ne.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Ne.CONNECTED,()=>O(this,null,function*(){this.emit(Nn.STATE_CHANGE,Ro.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Co.CONNECTED})),this.workerConnection.on(Ne.ON_MESSAGE,t=>O(this,null,function*(){if(t.data instanceof ArrayBuffer){let r=Fle(new Uint8Array(t.data));if(D("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&S.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Nn.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;let i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},c=Ui(n=Object.keys(i)).call(n,(u,h)=>i[u]>i[h]?u:h,"porn"),l=Object.keys(i).find(u=>u===c);this.emit(Nn.INSPECT_RESULT,l)}else this.emit(Nn.INSPECT_RESULT,void 0,new G(P.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Nn.INSPECT_RESULT,void 0,new G(P.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else S.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Nn.INSPECT_RESULT,void 0,new G(P.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(Ne.CLOSED,()=>{this.connectionState=Co.CLOSED}),this.workerConnection.on(Ne.FAILED,()=>{this.connectionState=Co.CLOSED}),this.workerConnection.on(Ne.RECONNECTING,()=>{this.connectionState=this.connectionState===Co.CONNECTED?Co.RECONNECTING:Co.CONNECTING}),this.workerConnection.on(Ne.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(Ne.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Nn.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}requestToInspectImage(){return O(this,null,function*(){this.sequence++;let t=li(this,Nn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Nn.INSPECT_RESULT,void 0,new G(P.INVALID_OPERATION,"Only the track being played can be inspected"));let r=yield this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Nn.INSPECT_RESULT,void 0,new G(P.INVALID_OPERATION,"Only the track being published can be inspected"))})}generateRequestData(t,n){return O(this,null,function*(){let{appId:r,cname:i,cid:c,vid:l,sid:u,uid:h}=n,f=Date.now(),m=yield t.getCurrentFrameImage("image/jpeg",this.quality),E=yield lV(m,r,i),_=this.sequence+"-"+c+"-"+h+"-"+f+"-"+at(12,""),y={appId:r,cid:c,cname:i,deviceId:"",elapse:(A=Number(f-this.inspectStartTime),{low:A|=0,high:A>>31,unsigned:A>=0}),fileSize:E.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.1",sequence:this.sequence,sid:u,timestamp:jH(f),uid:h,vid:l,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var A;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;let C=Ule(y);if(C.byteLength<this.workerMessageLengthLimit){if(D("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let I=(function(N){for(var L=1;L<arguments.length;L++){var M=arguments[L]!=null?arguments[L]:{};L%2?kG(Object(M),!0).forEach(function(V){w(N,V,M[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(M)):kG(Object(M)).forEach(function(V){Object.defineProperty(N,V,Object.getOwnPropertyDescriptor(M,V))})}return N})({},y);delete I.jpg,S.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(I))}return C}{let I=this.quality*this.qualityRatio;return this.quality=I,yield this.generateRequestData(t,{appId:r,cname:i,cid:c,vid:l,sid:u,uid:h})}})}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Co.CLOSED,this.emit(Nn.STATE_CHANGE,Ro.CLOSED)}}let Kle={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(n){if(!n)throw new G(P.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new G(P.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let r=[...new Set(n.inspectType)];r.forEach(i=>{var c;if(!J(c=["supervise","moderation"]).call(c,i))throw new G(P.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new G(P.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new zle(t)}};var MG=a(mi.Object.getOwnPropertySymbols),Yle=st,$le=WC.indexOf,Xle=l_,rA=Fp([].indexOf),xG=!!rA&&1/rA([1],1,-0)<0;Yle({target:"Array",proto:!0,forced:xG||!Xle("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return xG?rA(this,e,t)||0:$le(this,e,t)}});var Jle=xi("Array","indexOf"),Zle=B,Qle=Jle,iA=Array.prototype,eue=function(e){var t=e.indexOf;return e===iA||Zle(iA,e)&&t===iA.indexOf?Qle:t},UG=a(eue);function tue(e,t){if(e==null)return{};var n,r,i=(function(l,u){if(l==null)return{};var h={};for(var f in l)if({}.hasOwnProperty.call(l,f)){if(UG(u).call(u,f)!==-1)continue;h[f]=l[f]}return h})(e,t);if(MG){var c=MG(e);for(r=0;r<c.length;r++)n=c[r],UG(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let FG=class{get localCapabilities(){return Pt(this._localCapabilities)}get rtpCapabilities(){return Pt(this._rtpCapabilities)}get candidates(){return Pt(this._candidates)}get iceParameters(){return Pt(this._iceParameters)}get dtlsParameters(){return Pt(this._dtlsParameters)}constructor(e){w(this,"sessionDesc",void 0),w(this,"_localCapabilities",void 0),w(this,"_rtpCapabilities",void 0),w(this,"_candidates",void 0),w(this,"_iceParameters",void 0),w(this,"_dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname","o/i14u9pJrxRKAsu"),w(this,"firefoxSsrcMidMap",new Map),e=Pt(e);let{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:c,direction:l,setup:u,videoCodec:h,audioCodec:f}=e,m;this.setup=u,m=l===Ir.RECEIVE_ONLY?Tr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Tr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=c;let E=l===Ir.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_=l===Ir.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=l===Ir.RECEIVE_ONLY?i.send.videoCodecs:jf(de.VIDEO,E,_,h),A=l===Ir.RECEIVE_ONLY?i.send.audioCodecs:jf(de.AUDIO,E,_,f);for(let C of m.mediaDescriptions)C.attributes.iceUfrag=t.iceUfrag,C.attributes.icePwd=t.icePwd,C.attributes.fingerprints=n.fingerprints,C.attributes.candidates=r,C.attributes.setup=this.setup,C.media.mediaType==="application"&&(C.attributes.sctpPort="5000"),C.media.mediaType==="video"&&(C.media.fmts=y.map(I=>I.payloadType.toString(10)),C.attributes.payloads=y,C.attributes.extmaps=E.videoExtensions),C.media.mediaType==="audio"&&(C.media.fmts=A.map(I=>I.payloadType.toString(10)),C.attributes.payloads=A,C.attributes.extmaps=E.audioExtensions,ah(C));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return Sa(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");let{ssrcs:c,ssrcGroups:l}=Ff(t,this.cname,D("SYNC_GROUP")?n:void 0),u=this.findPreloadMediaDesc(c);if(u){if(Nt()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,u.attributes.mid),i&&(i.twcc||i.remb)){let h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,i),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{let h=this.findAvailableMediaIndex(e,c,r),f;return h===-1?(f=this.createOrRecycleSendMedia(e,c,l,"sendonly",r,i),this.updateBundleMids()):(f=Pt(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=c,f.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,i)),Nt()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){let r=[];return e.forEach(i=>{let c=i._mediaStreamTrack.kind,l=this.findAvailableRecvMediaIndex(c),u,h=!1;l===-1?(h=!0,u=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(u=Pt(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="recvonly"),r.push({mid:u.attributes.mid,needCreateTransceiver:h})}),r}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:n,address:r,port:i,type:c,relatedAddress:l,relatedPort:u,priority:h}=new RTCIceCandidate(e),f={foundation:t??"",componentId:"1",transport:n??"",priority:h?h+"":"",connectionAddress:r??"",port:i?i+"":"",type:c?c+"":"",relAddr:l??"",relPort:u?u+"":"",extension:{}};this.candidates.some(m=>m.priority===f.priority&&m.connectionAddress===f.connectionAddress&&m.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){let c=e._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=jf(c,l,this.localCapabilities.send,c===de.AUDIO?i:r),h=c===de.VIDEO?l.videoExtensions:l.audioExtensions,f="".concat(++this.currentMidIndex),m={media:{mediaType:c,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungRecvMediaDsec(m,e);let E=this.findFirstClosedMedia(c);if(E){let _=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[_]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>J(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>J(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Nt()){if(i){let c=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(c||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!c||c!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Pt(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,c){let l=this.rtpCapabilities.send,u=e===de.VIDEO?l.videoCodecs:l.audioCodecs,h=e===de.VIDEO?l.videoExtensions:l.audioExtensions;Nt()&&(i="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};f=this.mungSendMediaDesc(f,c);let m=this.findFirstClosedMedia(e);if(m){let E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,t,n){let r=Pt(e);return Kw(r),Gd(r,t),Yw(r,t),DB(r),Ev(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=Pt(e);return Ev(n,t,this.localCapabilities.recv),ah(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Nt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},nue=["sdp"];var Lt;function VG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Mc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VG(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VG(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let jG=(Lt=class xp extends uB{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),w(this,"direction",void 0),w(this,"name",void 0),w(this,"store",void 0),w(this,"spec",void 0),w(this,"peerConnection",void 0),w(this,"initialOffer",void 0),w(this,"transport",void 0),w(this,"statsFilter",void 0),w(this,"localCandidateCount",0),w(this,"_isInRestartIce",!1),w(this,"mutex",void 0),w(this,"onLocalCandidate",void 0),w(this,"remoteSDP",void 0),w(this,"pendingCandidates",[]),w(this,"localCapabilities",void 0),w(this,"isReady",!1),w(this,"restartCnt",0),w(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Dn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(xp.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Ir.SEND_ONLY,this.name=this.direction===Ir.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=BE(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,Nt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(t){return O(this,null,function*(){try{let n=yield Xw();if(this.localCapabilities=Vf(n),t){let{sdp:r}=t,i=tue(t,nue),c=(function(){let m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Uf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bo(E,m,"videoExtensions",_,y,A),bo(E,m,"videoCodecs",_,y,A),bo(E,m,"audioExtensions",_,y,A),bo(E,m,"audioCodecs",_,y,A),D("RAISE_H264_BASELINE_PRIORITY")){let C=A.videoCodecs.findIndex(I=>I.rtpMap&&I.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&I.fmtp&&I.fmtp.parameters["profile-level-id"]==="42001f");if(C!==-1){let I=A.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(I<C){S.debug("raising H264 baseline profile priority");let N=A.videoCodecs[C];A.videoCodecs.splice(C,1),A.videoCodecs.splice(I,0,N)}I!==-1&&D("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(N=>!(N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:_,recv:y,sendrecv:A}})({},{},r);this.remoteSDP=new FG({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),yield this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let l=yield this.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let u=Fs(l.sdp);yield this.peerConnection.setLocalDescription(l);let h=yield NB({},{},l.sdp);this.localCapabilities=Vf(h);let f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),Mc(Mc({},u),{},{sdp:l.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let r=yield this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=Fs(r.sdp);return this.initialOffer=r,Mc(Mc({},i),{},{sdp:r.sdp})}}catch(n){throw new z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}})}connect(t){return O(this,null,function*(){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");yield this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:n,iceParameters:r,dtlsParameters:i}=t,c=yield NB({},{},n);this.remoteSDP=new FG({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),yield this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let l=this.peerConnection.getTransceivers()[0];l!=null&&l.sender&&l.sender.transport&&this.tryBindTransportEvents(l.sender.transport)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}})}addRemoteCandidate(t){return O(this,null,function*(){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new z(P.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}})}send(t,n,r){var i=this;return Pr(function*(){let c=yield ke(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let l=[],u=i.remoteSDP.receive(t,n,r);t.forEach((I,N)=>{if(u[N].needCreateTransceiver){let L=i.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});l.push(L),I._updateRtpTransceiver(L)}else{let L=i.peerConnection.getTransceivers().find(M=>M.mid===u[N].mid);if(!L)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[N].mid));l.push(L),I._updateRtpTransceiver(L)}}),Nt()&&D("SIMULCAST")===!0&&(yield ke(i.applySimulcastForFirefox(l,t)));let h=u.map(I=>I.mid),f=yield ke(i.peerConnection.createOffer()),m=i.mungSendOfferSDP(f.sdp,t,h),E=Tr(m),_=h.map(I=>{let N=E.mediaDescriptions.find(L=>L.attributes.mid===I);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return zw(N,D("USE_PUB_RTX"))}),y=l.map((I,N)=>{let L=h[N];return{localSSRC:_[N],id:L}});yield ke(i.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield y}catch(I){let N=i.remoteSDP.toString();throw yield ke(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ke(i.peerConnection.setRemoteDescription({type:"answer",sdp:N})),yield ke(i.stopSending(h,!0)),I}yield ke(i.applySimulcastEncodings(l,t)),yield ke(i.applySendEncodings(l,t));let A=i.remoteSDP.toString(),C=i.logSDPExchange(m,"offer","local","send");return C?.(A),yield ke(i.setRemoteDescription({type:"answer",sdp:A})),l.map((I,N)=>{let L=h[N];return{localSSRC:_[N],id:L}})}catch(l){throw l instanceof z?l:new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{c()}})()}stopSending(t,n){return O(this,null,function*(){let r=n?void 0:yield this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});let c=yield this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");yield this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);let u=this.remoteSDP.toString();l?.(u),yield this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}})}receive(t,n,r,i){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,n,r,i);if(l){let h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");yield this.setRemoteDescription({type:"offer",sdp:h});let m=yield this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,c,t);f?.(E||""),yield this.peerConnection.setLocalDescription({type:"answer",sdp:E}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(c){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}})}mockReceive(t,n,r,i){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,n,r,i);if(l){let u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");yield this.setRemoteDescription({type:"offer",sdp:u});let f=yield this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,c,t);h?.(m||""),yield this.peerConnection.setLocalDescription({type:"answer",sdp:m}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(c){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}})}stopReceiving(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");yield this.setRemoteDescription({type:"offer",sdp:n});let i=yield this.peerConnection.createAnswer();r?.(i.sdp||""),yield this.peerConnection.setLocalDescription(i)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}})}restartICE(t){return O(this,null,function*(){try{if(this.store.p2pTransport===Nd.Auto&&(this.store.p2pTransport=Nd.SdRtn,Ve().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xp.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ve().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xp.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let n=yield this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:r}=Fs(n.sdp);return this.store.descriptionStart(),this.direction===Ir.SEND_ONLY&&(yield this.peerConnection.setLocalDescription(n)),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ir.RECEIVE_ONLY){this.restartCnt++,yield this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let n=yield this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:r}=Fs(n.sdp);return yield this.peerConnection.setLocalDescription(n),r}yield this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}})}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=yield this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);let c=this.remoteSDP.toString(),l=this.logSDPExchange(i,"offer","local","updateEncoderConfig");yield this.peerConnection.setLocalDescription({type:"offer",sdp:i}),l?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new z(P.EXCHANGE_SDP_FAILED,r.toString())}})}updateSendParameters(t,n){return O(this,null,function*(){let r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nt()||(yield this.applySimulcastEncodings(r,[n])):yield this.applySendEncodings(r,[n]))})}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){return O(this,null,function*(){let r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&(yield r.sender.replaceTrack(t._mediaStreamTrack))})}getSelectedCandidatePair(){return O(this,null,function*(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Mc(Mc({},yo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Mc(Mc({},yo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;J(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i={iceServers:[]};var c;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Id(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...xp.turnServerConfigToIceServers(t.turnServer.servers,n,r)),D("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...xp.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),J(c=[Nd.Relay,Nd.SdRtn]).call(c,n)&&(i.iceTransportPolicy="relay"),D("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(i.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&Ve().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),S.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=[],c=t.filter(u=>u.tcpport);S.debug("P2PConnection turnServers is ".concat(c,", current index is ").concat(r));let l=c.length>r?c[r]:c[0];switch(n){case Nd.SdRtn:let u=t.filter(f=>{var m;return J(m=f.username).call(m,"glb:")&&f.turnServerURL==f.turnServerURL}),h=u.length>r?u[r]:u[0];h&&(i.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(Io(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),i.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Io(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case Nd.Relay:l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Io(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;default:l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Io(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"stun:".concat(l.turnServerURL,":").concat(l.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};let n=t.iceTransport;n&&(n.onstatechange=()=>{let r=t?.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:r,remote:i}=n.getSelectedCandidatePair()||{};if(r&&i){let c=r.address+":"+r.port,l=i.address+":"+i.port;S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Us(c)),", remote ").concat(JSON.stringify(Us(l))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(t,n){return O(this,null,function*(){var r;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ve().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let i={},c={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var l;let{bitrateMax:m,frameRate:E,scaleResolutionDownBy:_}=t._encoderConfig;m&&(c.maxBitrate=1e3*m),J(l=t._hints).call(l,ot.LOW_STREAM)&&(E&&(c.maxFramerate=Ur(E)),_&&_>=1&&(c.scaleResolutionDownBy=_))}if(D("DSCP_TYPE")&&Ns()){var u;let m=D("DSCP_TYPE");J(u=["very-low","low","medium","high"]).call(u,m)&&(c.networkPriority=m)}let h=n.getParameters(),f=(r=h.encodings)===null||r===void 0?void 0:r[0];Nt()&&!f&&(i.encodings=[c]),f&&Object.assign(f,c),Object.assign(h,i),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),yield n.setParameters(h)})}applySendEncodings(t,n){return O(this,null,function*(){try{if(!Ve().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){let i=t[r],c=n[r];c instanceof Tt&&!this.isVP8Simulcast(c)&&(yield this.updateRtpSenderEncodings(c,i.sender))}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}})}mungSendOfferSDP(t,n,r){let i=Tr(t);return n.forEach((c,l)=>{let u=r[l],h=i.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(Gd(h,c),$w(h,c,this.store.codec))}),Sa(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(t,n){return O(this,null,function*(){if(t.length===n.length)for(let h=0;h<t.length;h++){var r,i,c,l,u;let f=t[h],m=n[h];if(m instanceof Tt&&!J(r=m._hints).call(r,ot.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},_={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];let y=f.sender.getParameters();yield f.sender.setParameters(Object.assign(y,E))}}})}applySimulcastEncodings(t,n){return O(this,null,function*(){if(!Nt()&&t.length===n.length)for(let r=0;r<t.length;r++){let i=n[r];if(i instanceof Tt&&this.isVP8Simulcast(i)){let c=t[r],l={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];let h=c.sender.getParameters();yield c.sender.setParameters(Object.assign(h,l))}}})}isVP8Simulcast(t){var n,r,i,c,l;return!!(t instanceof Tt&&D("SIMULCAST")&&this.store.codec==="vp8"&&!J(n=t._hints).call(n,ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(D("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",r==="local"?"remote":"local",i)}:void 0}muteLocal(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});let r=yield this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let c=this.remoteSDP.toString();i?.(c),yield this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}})}unmuteLocal(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>O(this,null,function*(){l.direction="sendonly"}));let r=yield this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);let c=this.remoteSDP.toString();i?.(c),yield this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}})}getRemoteSSRC(t,n){return O(this,null,function*(){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;let c=(i=Tr(n).mediaDescriptions.find(l=>l.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs;return c?.[0].ssrcId}})}setRemoteDescription(t){return O(this,null,function*(){var n;yield this.peerConnection.setRemoteDescription(t),J(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())})}mungReceiveAnswerSDP(t,n,r){let i=Tr(t),c=i.mediaDescriptions.find(l=>l.attributes.mid===n);return c&&r===de.AUDIO&&c.media.mediaType==="audio"&&ah(c),Sa(i)}},oe(Lt.prototype,"establish",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"establish"),Lt.prototype),oe(Lt.prototype,"connect",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"connect"),Lt.prototype),oe(Lt.prototype,"receive",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"receive"),Lt.prototype),oe(Lt.prototype,"mockReceive",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"mockReceive"),Lt.prototype),oe(Lt.prototype,"stopReceiving",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"stopReceiving"),Lt.prototype),oe(Lt.prototype,"restartICE",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"restartICE"),Lt.prototype),oe(Lt.prototype,"close",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"close"),Lt.prototype),oe(Lt.prototype,"updateEncoderConfig",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"updateEncoderConfig"),Lt.prototype),oe(Lt.prototype,"updateSendParameters",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"updateSendParameters"),Lt.prototype),oe(Lt.prototype,"replaceTrack",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"replaceTrack"),Lt.prototype),oe(Lt.prototype,"muteLocal",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"muteLocal"),Lt.prototype),oe(Lt.prototype,"unmuteLocal",[No],Object.getOwnPropertyDescriptor(Lt.prototype,"unmuteLocal"),Lt.prototype),Lt);function No(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return O(this,arguments,function*(){let i=this.mutex,c=yield i.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return yield r.apply(this,u)}finally{c()}})},n}let rs=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var BG,HG,GG,WG,qG,zG,KG,YG,$G,XG,JG,Ht;function ZG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Jv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZG(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZG(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let rue=(BG=is(rs.SEND_ONLY),HG=is(rs.SEND_ONLY),GG=is(),WG=is(rs.RECEIVE_ONLY),qG=is(rs.RECEIVE_ONLY),zG=is(rs.RECEIVE_ONLY),KG=is(rs.RECEIVE_ONLY),YG=is(rs.RECEIVE_ONLY),$G=is(rs.RECEIVE_ONLY),XG=is(),JG=is(rs.RECEIVE_ONLY),Ht=class extends jt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(me.StateChange,t,this._state)}constructor(e,t){super(),w(this,"isPlanB",!1),w(this,"store",void 0),w(this,"statsUploader",void 0),w(this,"sendConnection",void 0),w(this,"recvConnection",void 0),w(this,"localTrackMap",new Map),w(this,"remoteUserMap",new Map),w(this,"localDataChannels",[]),w(this,"pendingLocalTracks",[]),w(this,"pendingRemoteTracks",[]),w(this,"statsCollector",void 0),w(this,"dtlsFailedCount",0),w(this,"sendMutex",void 0),w(this,"recvMutex",void 0),w(this,"_state",it.Disconnected),w(this,"_restartStates",["disconnected","failed"]),w(this,"reconnectInterval",void 0),w(this,"uploadUnplinkStarted",!1),w(this,"uploadDownlinkStarted",!1),w(this,"uplinkStateUploadInterval",void 0),w(this,"downlinkStatsUploadInterval",void 0),w(this,"handleMuteLocalTrack",(n,r,i)=>O(this,null,function*(){let c=yield this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==it.Connected)return void i(new z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let h=this.filterTobeMutedTracks(n);if(h.length===0)return void r();let f=h.find(y=>y[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),yield this.sendConnection.muteLocal(h.map(y=>{let[,{id:A}]=y;return A}));let m=!1;var l,u;n.trackMediaType==="video"?m=!((l=this.localTrackMap.get(Z.LocalAudioTrack))===null||l===void 0||!l.track._muted):m=((u=this.localTrackMap.get(Z.LocalVideoTrack))===null||u===void 0?void 0:u.id)===void 0;let E=this.createMuteMessage(h);yield Rt(this,me.RequestMuteLocal,E);let _=n.trackMediaType==="video"?Cc.MUTE_LOCAL_VIDEO:Cc.MUTE_LOCAL_AUDIO;yield Rt(this,me.RequestP2PMuteLocal,{action:_,message:E,isMuteAll:m}),r()}catch(h){i(h)}finally{c()}})),w(this,"handleUnmuteLocalTrack",(n,r,i)=>O(this,null,function*(){let c=yield this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==it.Connected)return void i(new z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let l=this.filterTobeUnmutedTracks(n);if(l.length===0)return void r();yield this.sendConnection.unmuteLocal(l.map(f=>{let[,{id:m}]=f;return m}));let u=this.createUnmuteMessage(l),h=n.trackMediaType==="video"?Cc.UNMUTE_LOCAL_VIDEO:Cc.UNMUTE_LOCAL_AUDIO;yield Rt(this,me.RequestP2PMuteLocal,{action:h,message:u}),r()}catch(l){i(l)}finally{c()}})),w(this,"handleUpdateVideoEncoder",(n,r,i,c)=>O(this,null,function*(){let l;typeof c=="boolean"&&c||(l=yield this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let h=this.localTrackMap.get(Z.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==n||this.state!==it.Connected)return void r();let{id:f,track:m}=h;f&&(yield this.sendConnection.updateSendParameters(f,m),yield this.sendConnection.updateEncoderConfig(f,m),this.emit(me.UpdateVideoEncoder,m)),r()}catch(h){i(h)}finally{var u;(u=l)===null||u===void 0||u()}})),w(this,"handleUpdateVideoSendParameters",(n,r,i)=>O(this,null,function*(){let c=yield this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let l=this.localTrackMap.get(Z.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==it.Connected)return void r();let{id:u,track:h}=l;u&&(yield this.sendConnection.updateSendParameters(u,h)),r()}catch(l){i(l)}finally{c()}})),w(this,"handleReplaceTrack",(n,r,i,c)=>O(this,null,function*(){let l;S.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(l=yield this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var u;let f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==it.Connected)return void r();if(yield(u=this.sendConnection)===null||u===void 0?void 0:u.replaceTrack(n,f[1].id),f[0]===Z.LocalVideoTrack&&Ve().supportDualStreamEncoding){let m=this.localTrackMap.get(Z.LocalVideoLowTrack);if(m){let E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,yield new ie((_,y)=>{this.handleReplaceTrack(m.track,_,y,!0)})}}r()}catch(f){i(f)}finally{var h;(h=l)===null||h===void 0||h()}})),w(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),w(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),w(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),w(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new pH(e),this.bindStatsUploaderEvents(),this.sendMutex=new Dn("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Dn("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},D("ICE_RESTART_INTERVAL"))}startP2PConnection(e,t){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})}connect(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED,"p2p mode does not support connect.")})}startP2P(e,t){return O(this,null,function*(){let n;try{if(t){this.recvConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=yield this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new jG(e,this.store,Ir.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let r=yield this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=it.New,this.sendConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=yield this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new jG(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let r=yield this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}})}p2pConnect(e){return O(this,null,function*(){if(!this.sendConnection)throw new z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),yield this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=it.Connected})}addRemoteCandidate(e,t){return O(this,null,function*(){if(t===Ir.RECEIVE_ONLY){if(!this.sendConnection)throw new z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield this.recvConnection.addRemoteCandidate(e)}})}publish(e,t,n){var r=this;return Pr(function*(){let i=yield ke(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==it.Connected){r.throwIfTrackTypeNotMatch(e);let f=e.filter(m=>r.pendingLocalTracks.indexOf(m)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(f))}r.store.pubId=r.store.pubId+1,Xn.markPublishStart(r.store.clientId,r.store.pubId);let c=r.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield ke(r.tryToUnmuteAudio(e)));c.forEach(f=>{let{track:m,type:E}=f,_=Date.now();r.store.publish(m.getTrackId(),E===Z.LocalAudioTrack?"audio":"video",_)}),r.bindLocalTrackEvents(c);let l=yield ke(r.sendConnection.send(c.map(f=>{let{track:m}=f;return m}),r.store.codec,r.store.audioCodec)),u=(yield ke(l.next())).value,h=r.createGatewayPublishMessage(c,u);try{yield h}catch(f){throw l.throw(f),f?.code===P.WS_ABORT&&c.forEach(m=>{let{track:E}=m;r.pendingLocalTracks.indexOf(E)===-1&&r.pendingLocalTracks.push(E)}),r.unbindLocalTrackEvents(c),f}yield ke(l.next()),c.forEach(f=>{let{type:m}=f;r.statsCollector.addLocalStats(m)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(c,u),c.forEach(f=>{let{track:m,type:E}=f,_=Date.now();r.store.publish(m.getTrackId(),E===Z.LocalAudioTrack?"audio":"video",void 0,_)}),r.startUploadUplinkState()}finally{i()}})()}unpublish(e){return O(this,null,function*(){if(!this.sendConnection||this.state!==it.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!J(e).call(e,i)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let n=t.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();let r=this.createGatewayUnpublishMessage(t);if(yield this.sendConnection.stopSending(t.map(i=>{let[,{id:c}]=i;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[c,{track:l}]=i;return{type:c,track:l}})),t.forEach(i=>{let[c]=i;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===it.Connected)return n&&n[1].track.close(),r;e.forEach(i=>{let c=this.pendingLocalTracks.indexOf(i);c!==-1&&this.pendingLocalTracks.splice(c,1)})})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:c,ssrcs:l}]=r,u={stream_type:qce(c,i),ssrcs:l};c._muted||!c._enabled?t.push(u):n.push(u)}),t.length>0&&t.forEach(r=>{Rt(this,me.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{Rt(this,me.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Pr(function*(){throw new z(P.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){return O(this,null,function*(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield hn(this,me.RequestRePublish,this.pendingLocalTracks),this.emit(me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])})}unpublishLowStream(){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})}subscribe(e,t,n,r){return O(this,null,function*(){var i;if(!this.recvConnection)throw new z(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;let{track:c,mid:l,transceiver:u}=yield this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===de.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new Qu(c,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new Zu(c,e.uid,e._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack));let h=this.remoteUserMap.get(e);h?h.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let f=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:_}=m;return E.uid===e.uid&&t===_});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(me.MediaReconnectEnd,e.uid))})}mockSubscribe(e,t,n,r){return O(this,null,function*(){if(!this.recvConnection)throw new z(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");yield this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)})}unsubscribe(e,t,n){return O(this,null,function*(){let r=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(r.forEach(c=>{let l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.recvConnection||n||r.forEach(c=>{let{kind:l}=c;var u;if(l===de.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===de.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(yield this.recvConnection.stopReceiving(i.map(c=>{let[,{id:l}]=c;return l})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(c=>{let[l,{kind:u}]=c;var h,f;if(u===de.VIDEO&&l._videoSSRC&&((h=this.recvConnection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===de.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(u===de.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),i.forEach(c=>{let[,{kind:l}]=c;Rt(this,me.RequestP2PMuteRemote,l)}))})}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[de.VIDEO,de.AUDIO].forEach(r=>{n.has(r)?Rt(this,me.RequestP2PUnmuteRemote,r):Rt(this,me.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}massSubscribe(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})}massSubscribeNoLock(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})}massUnsubscribe(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})}massUnsubscribeNoLock(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})}muteRemote(e,t){return O(this,null,function*(){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===de.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)})}unmuteRemote(e,t){return O(this,null,function*(){return this.unmuteRemoteNoLock(e,t)})}unmuteRemoteNoLock(e,t){return O(this,null,function*(){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))})}getAllTracks(e){let t=this.localTrackMap.get(Z.LocalAudioTrack);if(t?.track instanceof gn){let n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Z.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===Z.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Z.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,i){if(e){let l=this.localTrackMap.get(Z.LocalAudioTrack),u=r?this.localTrackMap.get(Z.LocalVideoLowTrack):this.localTrackMap.get(Z.LocalVideoTrack);ue.publish(this.store.sessionId,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l?.track.getTrackLabel(),videoName:u?.track.getTrackLabel(),screenshare:u?.track._hints.indexOf(ot.SCREEN_TRACK)!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var c;n||(n=[]);let l=n.find(h=>h instanceof $t),u=r?(c=this.localTrackMap.get(Z.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(h=>h instanceof Tt);ue.publish(this.store.sessionId,{eventElapse:Xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l?.getTrackLabel(),videoName:u?.getTrackLabel(),screenshare:u?._hints.indexOf(ot.SCREEN_TRACK)!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){let i=r===de.VIDEO?n._videoSSRC:n._audioSSRC;i&&ue.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===de.VIDEO,audio:r===de.AUDIO,peerid:n.uid,subscribeRequestid:r===de.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Xn.measureFromSubscribeStart(this.store.clientId,i)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Dn("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Dn("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Z.LocalAudioTrack);if(e?.track instanceof gn){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=it.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Z.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Z.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof Tt||t&&t.track instanceof $t?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}hasRemoteMediaWithLock(e,t){return O(this,null,function*(){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))})}getRemoteMedia(e){var t;let n=Array.from(nr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Z.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=fd(e).call(e,(n,r)=>n.level-r.level),e}disconnectForReconnect(){return O(this,null,function*(){this.sendConnection&&this.recvConnection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=it.Reconnecting,D("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Z.LocalVideoTrack:J(t=r._hints).call(t,ot.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Z.LocalAudioTrack:r instanceof gn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Z.LocalVideoLowTrack:}}),this.emit(me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(nr(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:r,kind:i}=n;if((e instanceof bc?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e,t){return O(this,null,function*(){let n,r;if(e===Ir.SEND_ONLY){if(!this.sendConnection)throw new z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=yield this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=yield this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){let i=yield r.restartICE(t);return r.isInRestartIce=!1,i}{let i=yield r.restartICE();if(i){let c=yield hn(this,me.RequestP2PRestartICE,{direction:Ir.RECEIVE_ONLY,iceParameter:i});yield r.restartICE(c),r.isInRestartIce=!1}}}finally{n()}})}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(Z.LocalVideoTrack),n=this.localTrackMap.get(Z.LocalAudioTrack),r=e.videoSend.find(y=>{var A;return y.ssrc===(t==null||(A=t.ssrcs)===null||A===void 0?void 0:A[0].ssrcId)}),i=e.audioSend.find(y=>{var A;return y.ssrc===(n==null||(A=n.ssrcs)===null||A===void 0?void 0:A[0].ssrcId)});if(!r||!i)return 1;let c=li(this,me.NeedSignalRTT),l=r?r.rttMs:void 0,u=i?i.rttMs:void 0,h=l&&u?(l+u)/2:l||u,f=(h&&c?(h+c)/2:h||c)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,_=t?.track;if(_&&_._encoderConfig&&_._hints.indexOf(ot.SCREEN_TRACK)===-1){let y=_._encoderConfig.bitrateMax,A=e.bitrate.actualEncoded;if(y&&A){let C=(1e3*y-A)/(1e3*y);return rB[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n,i=r._audioSSRC,c=r._videoSSRC,l=e.audioRecv.find(A=>A.ssrc===i),u=e.videoRecv.find(A=>A.ssrc===c);if(!l&&!u)return void(t+=1);let h=li(this,me.NeedSignalRTT),f=e.rtt,m=(f&&h?(f+h)/2:f||h)||0,E=l?l.jitterMs:void 0,_=e.recvPacketLossRate,y=.7*_*100/50+.3*m/1500;E&&(y=.6*_*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}muteLocalTrack(e){return O(this,null,function*(){return new ie((t,n)=>{this.handleMuteLocalTrack(e,t,n)})})}filterTobePublishedTracks(e,t,n){let r=[],i=Ve(),c=this.getAllTracks();e=Fu(e=e.filter(h=>c.indexOf(h)===-1));let l=!1,u=!1;for(let h of e){if(h instanceof Tt&&(this.localTrackMap.has(Z.LocalVideoTrack)||l?new z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:h,type:Z.LocalVideoTrack}),l=!0),t)){let f=this.getLowVideoTrack(h,n);r.push({track:f,type:Z.LocalVideoLowTrack})}if(h instanceof $t){let f=this.localTrackMap.get(Z.LocalAudioTrack);if(f){if(!(f.track instanceof gn))throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(u){let m=r.find(E=>{let{type:_}=E;return _===Z.LocalAudioTrack});if(!(m.track instanceof gn))throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(h)}else{if(!i.webAudioMediaStreamDest||h instanceof gn||h._bypassWebAudio)r.push({track:h,type:Z.LocalAudioTrack});else{let m=new gn;m.addAudioTrack(h),r.push({track:m,type:Z.LocalAudioTrack})}u=!0}}}return r}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=Fu(e=e.filter(r=>n.indexOf(r)!==-1));for(let r of e){if(r instanceof $t){let i=this.localTrackMap.get(Z.LocalAudioTrack);if(!i)continue;i.track instanceof gn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Z.LocalAudioTrack,i]),i.track.close())):t.push([Z.LocalAudioTrack,i])}if(r instanceof Tt){let i=this.localTrackMap.get(Z.LocalVideoTrack);if(!i)continue;t.push([Z.LocalVideoTrack,i]);let c=this.localTrackMap.get(Z.LocalVideoLowTrack);c&&t.push([Z.LocalVideoLowTrack,c])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Z.LocalVideoTrack:n.addListener(he.GET_STATS,this.handleGetLocalVideoStats),n.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(he.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(he.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Z.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Z.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof gn?e.trackList.forEach(n=>{n.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(he.GET_STATS,this.handleGetLocalAudioStats),n.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(he.GET_STATS,this.handleGetLocalAudioStats),e.addListener(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Z.LocalVideoTrack:n.off(he.GET_STATS,this.handleGetLocalVideoStats),n.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(he.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(he.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Z.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Z.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof gn?e.trackList.forEach(t=>{t.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(he.GET_STATS,this.handleGetLocalAudioStats),t.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(he.GET_STATS,this.handleGetLocalAudioStats),e.off(he.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(he.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(he.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(he.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Zu&&t.addListener(he.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Qu&&t.addListener(he.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(he.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(de.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(de.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let c,{track:l,type:u}=n;switch(u){case Z.LocalAudioTrack:c=dt.Audio;break;case Z.LocalVideoTrack:c=J(i=l._hints).call(i,ot.SCREEN_TRACK)?dt.Screen:dt.High;break;case Z.LocalVideoLowTrack:c=dt.Low}return{kind:u===Z.LocalAudioTrack?de.AUDIO:de.VIDEO,stream_type:c,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:l.muted||!l.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:c,ssrcs:l,id:u}]=t;switch(i){case Z.LocalVideoTrack:r=J(n=c._hints).call(n,ot.SCREEN_TRACK)?dt.Screen:dt.High;break;case Z.LocalAudioTrack:r=dt.Audio;break;case Z.LocalVideoLowTrack:r=dt.Low}return{stream_type:r,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:c}=n;this.localTrackMap.set(c,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=t=>O(this,null,function*(){var n;S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(me.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),J(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&(yield Tn(800)),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))}),e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ue.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:St.TRACER}).onSuccess(),this.emit(me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;let r=Array.from(nr(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Bi.FIRST_FRAME_DECODED),ue.firstRemoteFrame(this.store.sessionId,mn.FIRST_AUDIO_DECODE,xt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;let r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&ue.firstRemoteFrame(this.store.sessionId,mn.FIRST_AUDIO_RECEIVED,xt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;let r=Array.from(nr(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&ue.firstRemoteFrame(this.store.sessionId,mn.FIRST_VIDEO_RECEIVED,xt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{let r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(me.ConnectionTypeChange,r),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Rc(n))," -> ").concat(JSON.stringify(Rc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Rc(n))," -> ").concat(JSON.stringify(Rc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(me.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}handleDisconnect(e){return O(this,null,function*(){let t=e===Ir.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,S.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ir.SEND_ONLY?this.restartICE(e):hn(this,me.RequestP2PRestartICE,{direction:Ir.SEND_ONLY}))})}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let n=this.localTrackMap.get(Z.LocalAudioTrack);if(e instanceof $t&&n?.track instanceof gn)return n.track.isActive||t.push([Z.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:c}]=i;return e===c});if(r&&(t.push(r),r[0]===Z.LocalVideoTrack)){let i=this.localTrackMap.get(Z.LocalVideoLowTrack);i&&t.push([Z.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(Z.LocalAudioTrack);if(e instanceof $t&&n?.track instanceof gn)return n.track.isActive&&t.push([Z.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:c}]=i;return e===c});if(r)if(r[0]===Z.LocalVideoTrack){t.push(r);let i=this.localTrackMap.get(Z.LocalVideoLowTrack);i&&t.push([Z.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:c,ssrcs:l,id:u}]=t;switch(i){case Z.LocalAudioTrack:r=dt.Audio;break;case Z.LocalVideoTrack:r=J(n=c._hints).call(n,ot.SCREEN_TRACK)?dt.Screen:dt.High;break;case Z.LocalVideoLowTrack:r=dt.Low}return{stream_type:r,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:c,ssrcs:l,id:u}]=t;switch(i){case Z.LocalAudioTrack:r=dt.Audio;break;case Z.LocalVideoTrack:r=J(n=c._hints).call(n,ot.SCREEN_TRACK)?dt.Screen:dt.High;break;case Z.LocalVideoLowTrack:r=dt.Low}return{stream_type:r,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){let n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){let i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[c,l]=i;n.push([e,{kind:c,id:l}])});return n}createUnsubscribeMessage(e){let t=[];return e.forEach(n=>{let[r,{kind:i,id:c}]=n;switch(i){case de.VIDEO:return void(r._videoSSRC&&t.push({stream_type:de.VIDEO,ssrcId:r._videoSSRC}));case de.AUDIO:return void(r._audioSSRC&&t.push({stream_type:de.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t,i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}updateBitrateLimit(e){return O(this,null,function*(){let t=this.localTrackMap.get(Z.LocalVideoTrack),n=this.localTrackMap.get(Z.LocalVideoLowTrack);t&&(yield t.track.setBitrateLimit(e.uplink),yield new ie((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(yield n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),yield new ie((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}tryToUnmuteAudio(e){return O(this,null,function*(){for(let t=0;t<e.length;t++)if(e[t]instanceof $t){let n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;let r=this.createUnmuteMessage(n);return void(yield Rt(this,me.RequestUnmuteLocal,r))}})}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(me.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(me.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){return O(this,null,function*(){this.dtlsFailedCount+=1,yield Tn(UE(this.dtlsFailedCount,cn)),this.emit(me.RequestReconnect)})}reconnectP2P(){return O(this,null,function*(){})}canPublishLowStream(){return this.localTrackMap.has(Z.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Tt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Tt).length>1)throw new z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof $t).length>1&&(e.some(t=>t instanceof $t&&t._bypassWebAudio)||!Ve().webAudioMediaStreamDest))throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof Tt&&this.pendingLocalTracks.some(n=>n instanceof Tt))throw new z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof $t&&this.pendingLocalTracks.some(n=>n instanceof $t)&&(!Ve().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof $t&&n._bypassWebAudio)))throw new z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let n=!D("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ve().supportDualStreamEncoding,r=Jv(Jv({},{width:160,height:120,framerate:15,bitrate:50}),t),i;i=n?e._mediaStreamTrack.clone():m0(e,r);let c=at(8,"track-low-"),l=new Tt(i,Jv(Jv({},n&&{scaleResolutionDownBy:qw(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(kd.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,qu.LOW_STREAM)}),l._hints.push(ot.LOW_STREAM),e.addListener(he.NEED_CLOSE,()=>{l.close()}),l}globalLock(){return O(this,null,function*(){return this.recvMutex.lock("From P2PChannel2.globalLock")})}reportVideoFirstFrameDecoded(e,t,n,r){var i;let c=Array.from(nr(i=this.remoteUserMap).call(i)).find(l=>l._videoSSRC===e);if(c){r||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());let l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===c.uid&&h.type==="video");ue.firstRemoteVideoDecode(this.store.sessionId,mn.FIRST_VIDEO_DECODE,xt.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:Xn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:u?.subscribeEnd||0,subscriberStart:u?.subscribeStart||0,videoAddNotify:u?.streamAdded||0,state:r?1:0})}}remoteMediaSsrcChanged(e,t,n){return O(this,null,function*(){if(!this.recvConnection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let i=r.get(t);if(!i)return!1;let c=yield this.recvConnection.getRemoteSSRC(i);return c!==void 0&&c!==n})}isPreSubScribe(e){return!1}publishDataChannel(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED)})}unpublishDataChannel(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED)})}subscribeDataChannel(e,t){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED)})}unsubscribeDataChannel(e,t){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED)})}hasPendingRemoteDataChannel(e,t){throw new z(P.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new z(P.NOT_SUPPORTED)}preConnect(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED)})}getEstablishParams(){throw new z(P.NOT_SUPPORTED)}reSubscribe(e){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED)})}reportVideoFirstFrameRender(e){}updateVideoStreamParameter(e,t){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED)})}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Z.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,qu.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},oe(Ht.prototype,"p2pConnect",[BG],Object.getOwnPropertyDescriptor(Ht.prototype,"p2pConnect"),Ht.prototype),oe(Ht.prototype,"unpublish",[HG],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublish"),Ht.prototype),oe(Ht.prototype,"unpublishLowStream",[GG],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublishLowStream"),Ht.prototype),oe(Ht.prototype,"subscribe",[WG],Object.getOwnPropertyDescriptor(Ht.prototype,"subscribe"),Ht.prototype),oe(Ht.prototype,"mockSubscribe",[qG],Object.getOwnPropertyDescriptor(Ht.prototype,"mockSubscribe"),Ht.prototype),oe(Ht.prototype,"unsubscribe",[zG],Object.getOwnPropertyDescriptor(Ht.prototype,"unsubscribe"),Ht.prototype),oe(Ht.prototype,"muteRemote",[KG],Object.getOwnPropertyDescriptor(Ht.prototype,"muteRemote"),Ht.prototype),oe(Ht.prototype,"unmuteRemote",[YG],Object.getOwnPropertyDescriptor(Ht.prototype,"unmuteRemote"),Ht.prototype),oe(Ht.prototype,"hasRemoteMediaWithLock",[$G],Object.getOwnPropertyDescriptor(Ht.prototype,"hasRemoteMediaWithLock"),Ht.prototype),oe(Ht.prototype,"disconnectForReconnect",[XG],Object.getOwnPropertyDescriptor(Ht.prototype,"disconnectForReconnect"),Ht.prototype),oe(Ht.prototype,"remoteMediaSsrcChanged",[JG],Object.getOwnPropertyDescriptor(Ht.prototype,"remoteMediaSsrcChanged"),Ht.prototype),Ht);function is(e){return function(t,n,r){let i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=function(){return O(this,arguments,function*(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];switch(e){case rs.SEND_ONLY:{let h=yield this.sendMutex.lock("From P2PChannel2.".concat(n));try{return yield i.apply(this,l)}finally{h()}}case rs.RECEIVE_ONLY:{let h=yield this.recvMutex.lock("From P2PChannel2.".concat(n));try{return yield i.apply(this,l)}finally{h()}}default:{let h=yield this.sendMutex.lock("From P2PChannel2.".concat(n)),f=yield this.recvMutex.lock("From P2PChannel2.".concat(n));try{return yield i.apply(this,l)}finally{h(),f()}}}})},r}}class tl extends jt{constructor(t,n){super(),w(this,"signal",void 0),w(this,"token",void 0),w(this,"tokenTimeout",void 0),w(this,"tokenInterval",void 0),w(this,"_sequence",0),w(this,"userMap",new Map),w(this,"encoder",new TextEncoder),this.signal=t,this.token=n;let r=()=>{this.signal.connectionState===Ge.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*D("P2P_TOKEN_INTERVAL"))};r()}send(t,n,r,i,c){return O(this,null,function*(){var l;if(this.userMap.size===0)return;let u=Array.from(ai(l=this.userMap).call(l))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=i??at(6,""),c=c??this._sequence++;let h={_id:i,_type:t,_seq:c,_message:n,token:"".concat(this.token,"_").concat(u)};D("SHOW_P2P_LOG")&&S.debug("send message",h,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(h)).forEach(m=>{this.signal.request(fe.DATA_STREAM,{payload:vc(this.encoder.encode(m))})});let f=new ie((m,E)=>{let _=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),C),this.off(ih.ABORT,A),S.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?E(new z(P.INVALID_REMOTE_USER)):E(new z(P.TIMEOUT))},D("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{_&&window.clearTimeout(_),this.off(ih.ABORT,A),r&&m()},A=()=>{_&&window.clearTimeout(_),this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),C),E(new z(P.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(ih.ABORT,A),this.once("res-@".concat(i,"_ack"),y);let C=(N,L)=>{I=!0,_&&window.clearTimeout(_),this.off("res-@".concat(i,"_ack"),y),this.off(ih.ABORT,A),N==="success"?m(L):E(new z(P.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))},I=!1;r||(this.once("res-@".concat(i),C),Tn(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{I||S.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(h))}))});try{return yield f}catch(m){if(m.code===P.TIMEOUT)return yield this.send(t,n,r,i,c);throw m}})}onMessage(t){var n;let{_uid:r}=t,i,c=this.userMap.get(r);if(c)i=c.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==nn.CHECK)return;let{token:f}=t;i=new Map,c={uid:r,isStart:!0,token:f,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,c),this.signal.emit(Ie.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var l;let{id:f,total:m}=t,E=(l=i.get(f))!==null&&l!==void 0?l:[];if(E.push(t),i.has(f)||i.set(f,E),E.length!==m)return;{let _=fd(E).call(E,(y,A)=>y.index-A.index).map(y=>y.payload).join("");i.delete(f),(t=JSON.parse(_))._uid=r}}let{_type:u,token:h}=t;if(J(n=[nn.ACK,nn.CHECK]).call(n,u))return u===nn.CHECK&&this.handleCheckToken(c,h),void this.receiveMessage(t);h==="".concat(c.token,"_").concat(this.token)?this.handleReceivedMessage(t):S.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(c.token,"_").concat(this.token),t)}check(){let t={_id:at(6,""),token:this.token,_type:nn.CHECK};D("SHOW_P2P_LOG")&&S.debug("send message",t),this.signal.request(fe.DATA_STREAM,{payload:vc(this.encoder.encode(JSON.stringify(t)))})}ack(t){let n={_id:t,_type:nn.ACK,token:this.token};D("SHOW_P2P_LOG")&&S.debug("send message",n),this.signal.request(fe.DATA_STREAM,{payload:vc(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(nn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){let n=()=>{this.userMap.forEach(f=>{let{receivedMessagesMap:m,nextExpectedSequenceNumber:E}=f;for(;m.has(E);){let _=m.get(E);m.delete(E),this.receiveMessage(_),f.nextExpectedSequenceNumber++}})};if(!t)return void n();let{_uid:r,_seq:i}=t,c=this.userMap.get(r),{receivedMessagesMap:l,isStart:u,nextExpectedSequenceNumber:h}=c;if(i<h)return this.ack(t._id),void S.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));l.set(i,t),u&&i===h&&(this.receiveMessage(t),l.delete(h),c.nextExpectedSequenceNumber++,n())}receiveMessage(t){let{_id:n,_type:r,_message:i,_uid:c}=t;if(D("SHOW_P2P_LOG")&&S.debug("receive message",t),n){let l;switch(t._type!==nn.ACK&&(i&&(l=JSON.parse(i)),this.ack(t._id)),t._type){case nn.CANDIDATE:case nn.CONTROL:this.signal.emit(r,l,c);break;case nn.PUBLISH:case nn.UNPUBLISH:case nn.RESTART_ICE:case nn.CALL:l.uid=c,hn(this.signal,r,l).then(u=>{this.response(t._id,u)}).catch(()=>{this.response(t._id,void 0,!0)});break;case nn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case nn.RESPONSE:{let{success:u,message:h}=l;this.emit("res-@".concat(n),u?"success":"failed",h);break}}}}splitMessage(t){if(t.length<tl.MAX_MESSAGE_SIZE)return[t];let n=[],{remoteToken:r}=JSON.parse(t),i=at(6,""),c=0,l=800,u=Math.ceil(t.length/l);for(;t.length>0;){c++;let h={id:i,index:c,total:u,payload:t.slice(0,l),token:"".concat(this.token,"_").concat(r)};JSON.stringify(h).length>tl.MAX_MESSAGE_SIZE?l-=50:(n.push(h),t=t.slice(l))}return n.map(h=>JSON.stringify(h))}handleCheckToken(t,n){return t.token!==n?(S.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{S.debug("token timeout, ".concat(n)),this.reset(t.uid)},D("MAX_P2P_TIMEOUT")),!0)}handleUserOnline(){return O(this,null,function*(){let t=yield hn(this.signal,nn.CALL,void 0),n=yield this.send(nn.CALL,t);this.signal.emit(pe.P2P_CONNECTION,n,!0)})}reset(t,n){return O(this,null,function*(){let r=this.userMap.get(t);r&&(this.emit(ih.ABORT),this.signal.emit(Ie.ON_USER_OFFLINE,{uid:r.uid,reason:vce.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(S.debug("change local token from ".concat(n," to ").concat(n)),this.token=at(6,"")))})}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(ih.ABORT)}}w(tl,"MAX_SIZE",1),w(tl,"MAX_MESSAGE_SIZE",1024);class iue extends jt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ge.CONNECTED?this.emit(pe.WS_CONNECTED):t===Ge.RECONNECTING?this.emit(pe.WS_RECONNECTING,this._websocketReconnectReason):t===Ge.CLOSED&&this.emit(pe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),w(this,"__name__","P2PSignal"),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ge.CLOSED),w(this,"reconnectToken",void 0),w(this,"p2pToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new Yb(5)),w(this,"pingpongTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"_external_signal",void 0),w(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(pe.ON_BINARY_DATA,r.data);let i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let c="res-@".concat(i._id);this.emit(c,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Ie.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Ie.MUTE_AUDIO:case Ie.MUTE_VIDEO:case Ie.ON_P2P_LOST:case Ie.ON_USER_ONLINE:return;case Ie.ON_USER_OFFLINE:let{uid:c}=i._message;return S.debug("[".concat(this.clientId,"] user-offline uid: ").concat(c)),void this._external_signal.reset(c)}if(this.emit(i._type,i._message),i._type===Ie.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ie.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(He.UID_BANNED);break;case 15:this.close(He.IP_BANNED);break;case 16:this.close(He.CHANNEL_BANNED)}if(i._type===Ie.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case _e.ERR_LICENSE_MISSING:this.close(He.LICENSE_MISSING);break;case _e.ERR_LICENSE_EXPIRED:this.close(He.LICENSE_EXPIRED);break;case _e.ERR_LICENSE_MINUTES_EXCEEDED:this.close(He.LICENSE_MINUTES_EXCEEDED);break;case _e.ERR_LICENSE_PERIOD_INVALID:this.close(He.LICENSE_PERIOD_INVALID);break;case _e.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(He.LICENSE_MULTIPLE_SDK_SERVICE);break;case _e.ERR_LICENSE_ILLEGAL:this.close(He.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Hw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,D("JOIN_GATEWAY_USE_DUAL_DOMAIN"),D("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ge.CONNECTED&&this.reconnect("retry",Gn.OFFLINE)}),this.p2pToken=at(6,""),this._external_signal=new tl(this,this.p2pToken)}request(t,n,r,i){return O(this,null,function*(){let c=at(6,""),l={_id:c,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new ie((A,C)=>{if(this.connectionState===Ge.CONNECTED)return A();let I=()=>{this.off(pe.WS_CLOSED,N),A()},N=()=>{this.off(pe.WS_CONNECTED,I),C(new z(P.WS_ABORT))};this.once(pe.WS_CONNECTED,I),this.once(pe.WS_CLOSED,N)});if(this.connectionState!==Ge.CONNECTING&&this.connectionState!==Ge.RECONNECTING||t===fe.JOIN||t===fe.REJOIN||(yield h()),this.websocket.sendMessage(l,!0),i)return;let f=new ie((A,C)=>{let I=!1,N=(M,V)=>{I=!0,A({isSuccess:M==="success",message:V||{}}),this.off(pe.WS_CLOSED,L),this.off(pe.WS_RECONNECTING,L),this.emit(pe.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),N);let L=()=>{C(new z(P.WS_ABORT,"type: ".concat(t))),this.off(pe.WS_CLOSED,L),this.off(pe.WS_RECONNECTING,L),this.off("res-@".concat(c),N)};this.once(pe.WS_CLOSED,L),this.once(pe.WS_RECONNECTING,L),Tn(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||I||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(pe.REQUEST_TIMEOUT,t,n))})}),m=null;try{m=yield f}catch(A){if(this.connectionState===Ge.CLOSED||t===fe.LEAVE)throw new z(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?A.throw():t===fe.JOIN||t===fe.REJOIN?null:(yield h(),yield this.request(t,n))}if(m.isSuccess)return m.message;let E=Number(m.message.error_code||m.message.code),_=Hd(E),y=new z(P.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:_.desc});return _.action==="success"?m.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(_.desc,", action: ").concat(_.action)),E===_e.ERR_TOO_MANY_BROADCASTERS?((t===fe.JOIN||t===fe.REJOIN)&&(this.initError=y,this.close()),y.throw()):_.action==="failed"?y.throw():_.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===_e.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Gn.MULTI_IP)):this.reconnect(_.action,Gn.SERVER_ERROR),t===fe.JOIN||t===fe.REJOIN?null:yield this.request(t,n)))})}waitMessage(t,n){return new ie(r=>{let i=c=>{(!n||n(c))&&(this.off(t,i),r(c))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Bd.WRTC_STATS,n)}upload(t,n){let r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{let c=D("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ge.CONNECTED)return;let l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},D("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){let r={_type:t,_message:n};this.websocket.sendMessage(r)}sendExtensionMessage(t,n,r){return O(this,null,function*(){return yield this._external_signal.send(t,n,r)})}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((n,r)=>{this.once(pe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(pe.WS_CLOSED,()=>r(this.initError||new z(P.WS_ABORT))),this.connectionState=Ge.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||He.LEAVE,this.connectionState=Ge.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=at(6,""),this._external_signal.clear(),this._external_signal=new tl(this,this.p2pToken)}join(){return O(this,null,function*(){if(!this.joinResponse){this.emit(pe.ABORT_P2P_EXECUTION);let t=yield hn(this,pe.REQUEST_JOIN_INFO),n=yield this.request(fe.JOIN,t);if(!n)return this.emit(pe.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(pe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0})}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}downgradeCodec(t){return O(this,null,function*(){return!1})}handleDataStream(t){try{var n;let r=Dd(t.payload),i=new TextDecoder().decode(r),c=JSON.parse(i);"total"in c&&"id"in c||J(n=Object.values(nn)).call(n,c._type)?(c._uid=t.uid,this._external_signal.onMessage(c)):this.emit(Ie.ON_DATA_STREAM,t)}catch{this.emit(Ie.ON_DATA_STREAM,t)}}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);let n=Hd(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===_e.ERR_REPEAT_JOIN_CHANNEL&&D("IGNORE_UID_CHECK")?void this.close(He.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(He.UID_BANNED),void this.close()):void this.reconnect(n.action,Gn.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=D("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>D("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Gn.TIMEOUT):this.request(fe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-n;this.rttRolling.add(r),D("REPORT_STATS")&&this.send(fe.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(Ne.RECONNECT_CREATE_CONNECTION,t=>{this.emit(pe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ne.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ne.CLOSED,()=>{this.connectionState=Ge.CLOSED}),this.websocket.on(Ne.FAILED,()=>{this._disconnectedReason=He.NETWORK_ERROR,this.connectionState=Ge.CLOSED}),this.websocket.on(Ne.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ge.CONNECTED?this.connectionState=Ge.RECONNECTING:this.connectionState=Ge.CONNECTING}),this.websocket.on(Ne.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(S.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):S.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(Ne.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(pe.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof z&&t.code===P.UNEXPECTED_RESPONSE&&t.data.code===_e.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Gn.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Gn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ne.REQUEST_NEW_URLS,(t,n)=>{hn(this,pe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ie.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let oue={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new rue(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new iue(n,t)}};function QG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function eW(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QG(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QG(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class sue{constructor(t){w(this,"sessionDesc",void 0),w(this,"localCapabilities",void 0),w(this,"rtpCapabilities",void 0),w(this,"candidates",void 0),w(this,"_originCandidates",void 0),w(this,"iceParameters",void 0),w(this,"dtlsParameters",void 0),w(this,"setup",void 0),w(this,"currentMidIndex",void 0),w(this,"cname",void 0),t=Pt(t);let{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:c,setup:l,localCapabilities:u,sdkCodec:h,cname:f}=t,m=Tr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=c,this.candidates=i,this._originCandidates=Pt(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=l,this.localCapabilities=u,this.cname=f;for(let E=0;E<m.mediaDescriptions.length;E++){let _=m.mediaDescriptions[E];if(_.attributes.iceUfrag=n.iceUfrag,_.attributes.icePwd=n.icePwd,_.attributes.fingerprints=r.fingerprints,_.attributes.candidates=i,_.attributes.setup=l,_.media.mediaType==="video"){_.media.fmts=c.videoCodecs.map(C=>C.payloadType.toString(10));let y=c.videoCodecs.filter(C=>{var I,N;return(I=C.rtpMap)===null||I===void 0?void 0:J(N=I.encodingName.toLowerCase()).call(N,h)}),A=c.videoCodecs.filter(C=>!J(y).call(y,C));_.attributes.payloads=[...y,...A],_.attributes.extmaps=c.videoExtensions}_.media.mediaType==="audio"&&(_.media.fmts=c.audioCodecs.map(y=>y.payloadType.toString(10)),_.attributes.payloads=c.audioCodecs,_.attributes.extmaps=c.audioExtensions),m.mediaDescriptions[E]=this.mungMediaDesc(_)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return Sa(this.sessionDesc)}send(t,n,r){let{ssrcs:i,ssrcGroups:c}=Ff(n,this.cname),l=this.sessionDesc.mediaDescriptions.find(f=>t===de.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),u=i[0].attributes.label,h=i[0].attributes.mslabel;return l.attributes.ssrcs=l.attributes.ssrcs.concat(i),l.attributes.ssrcGroups=l.attributes.ssrcGroups.concat(c),{id:u,mslabel:h}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:i}=n;return this.send(r,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{let r=[],i=[],c=[];n.attributes.ssrcs.forEach(l=>{J(t).call(t,l.attributes.label||"")?c.push(l):r.push(l)}),n.attributes.ssrcGroups.forEach(l=>{var u;J(u=c.map(h=>h.ssrcId)).call(u,l.ssrcIds[0])||i.push(l)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=i})}mute(t){let n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){let n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((i,c)=>{let l=i._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===l.kind),h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],i);this.sessionDesc.mediaDescriptions[u]=h})}stopReceiving(t){}updateCandidates(t){let n=this._originCandidates.filter(i=>i.transport==="udp"),r=[];if(n.forEach(i=>{r.push(eW(eW({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),n.length!==0){switch(t){case On.TCP_RELAY:this.candidates=r;break;case On.UDP_TCP_RELAY:case On.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(let i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Pt(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){let r=Pt(t);return Gd(r,n),Yw(r,n),r}updateRecvMedia(t,n){let r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){let i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){let i=this.sessionDesc.mediaDescriptions.find(l=>t===de.VIDEO?l.attributes.mid==="video":l.attributes.mid==="audio");if(i){let l=i.attributes.ssrcs.find(u=>u.attributes.label===n);var c;l&&(l.attributes.label=r,(c=l.attributes.msid)===null||c===void 0||c.replace(n,r))}}mungMediaDesc(t){let n=Pt(t);return Kw(n),(function(r){let i=r.attributes.extmaps.find(c=>_v(c.extensionName));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach(c=>{let l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})})(n),n}getSSRC(t){for(let n of this.sessionDesc.mediaDescriptions)for(let r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var It;function tW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Zv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tW(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tW(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let aue=(It=class e_ extends hv{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return J(n=Object.keys(Pd)).call(n,t)}))]}constructor(t,n){super(t,n),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"statsFilter",void 0),w(this,"useRTX",!1),w(this,"localCapabilities",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"establishPromise",void 0),w(this,"mutex",void 0),this.store=n,this.mutex=new Dn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e_.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=BE(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,Nt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){return O(this,null,function*(){try{let t=yield this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=Fs(t.sdp),r=Uf(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:D("FILTER_VIDEO_FEC"),filterAudioFec:D("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,Zv(Zv({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}})}updateRemoteConnect(){return O(this,null,function*(){})}connect(t){return O(this,null,function*(){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new sue(Zv(Zv({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let n=this.remoteSDP.toString();yield this.peerConnection.setLocalDescription(this.initialOffer),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}})}updateRemoteRTPCapabilities(t,n){return O(this,null,function*(){throw new z(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})}getPreMedia(t){}send(t,n){var r=this;return Pr(function*(){let i=yield ke(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=t.map(_=>r.peerConnection.addTrack(_._mediaStreamTrack)),l=yield ke(r.peerConnection.createOffer()),u=Tr(l.sdp),h=t.map(_=>{let y=_._mediaStreamTrack,A=u.mediaDescriptions.find(C=>C.attributes.mid===y.kind);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(C,I,N){let L=C.attributes.ssrcs.filter(V=>V.attributes.label===I),M=C.attributes.ssrcGroups;if(L.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(M&&L.length>1){let V=M.find(j=>j.ssrcIds.indexOf(L[0].ssrcId)!==-1);return V?[{ssrcId:V.ssrcIds[0],rtx:N?V.ssrcIds[1]:void 0}]:[{ssrcId:L[0].ssrcId}]}return[{ssrcId:L[0].ssrcId}]})(A,y.id,r.useRTX)}),f;try{f=yield h}catch(_){throw c.forEach(y=>{An()&&y.replaceTrack(null),r.peerConnection.removeTrack(y)}),_}let m=r.mungSendOfferSDP(l.sdp,t);r.remoteSDP.receive(t,n,f);let E=r.remoteSDP.toString();return yield ke(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ke(r.applySendEncodings(c,t)),yield ke(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((_,y)=>{let A=_._mediaStreamTrack.id;return{localSSRC:h[y],id:A}})}catch(c){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{i()}})()}stopSending(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getSenders().filter(c=>{var l;return t.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(c=>{An()&&c.replaceTrack(null),this.peerConnection.removeTrack(c)});let r=yield this.peerConnection.createOffer();yield this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);let i=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}})}receive(t,n,r,i){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:c,mslabel:l}=this.remoteSDP.send(t,n,i),u=new ie((m,E)=>{let _=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(c)))},1e4),y=A=>{let C=Je();if((C.name==="Safari"&&Number(C.version)===11||tr())&&A.track.id!==c&&A.streams[0].id===l){var I;let N=A.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(t,c,A.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(_),void m(N)}if(A.track.id===c)return this.peerConnection.removeEventListener("track",y),clearTimeout(_),void m(A.track)};this.peerConnection.addEventListener("track",y)}),h=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:h});let f=yield this.peerConnection.createAnswer();return yield this.peerConnection.setLocalDescription(f),{track:yield u,id:c}}catch(c){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}})}stopReceiving(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let r=yield this.peerConnection.createAnswer();yield this.peerConnection.setLocalDescription(r)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}})}muteRemote(t){return O(this,null,function*(){})}unmuteRemote(t){return O(this,null,function*(){})}muteLocal(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(An()&&r.track)r.track.enabled=!1;else{let i=r.getParameters();i.encodings.forEach(c=>c.active=!1),r.setParameters(i)}})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}})}unmuteLocal(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getSenders().filter(c=>{var l;return t.indexOf(((l=c.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(c=>O(this,null,function*(){if(An()&&c.track)c.track.enabled=!0;else{let l=c.getParameters();l.encodings.forEach(u=>u.active=!0),yield c.setParameters(l)}}));let r=yield this.peerConnection.createOffer();yield this.peerConnection.setLocalDescription(r);let i=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}})}restartICE(t){var n=this;return Pr(function*(){let r=yield ke(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let i=Ve().supportPCSetConfiguration;if(t===On.RELAY&&!i)return;if(i){let f=n.peerConnection.getConfiguration(),m=t===On.RELAY?"relay":"all";f.iceTransportPolicy!==m&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(m,"]")),f.iceTransportPolicy=m,n.peerConnection.setConfiguration(f))}t!==On.RELAY&&n.remoteSDP.updateCandidates(t);let c=yield ke(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=Fs(c.sdp),{remoteIceParameters:u}=yield l.iceParameters;n.remoteSDP.restartICE(u);let h=n.remoteSDP.toString();yield ke(n.peerConnection.setLocalDescription(c)),yield ke(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(i){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=yield this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);let c=this.remoteSDP.toString();yield this.peerConnection.setLocalDescription({type:"offer",sdp:i}),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new z(P.EXCHANGE_SDP_FAILED,r.toString())}})}updateSendParameters(t,n){return O(this,null,function*(){let r=this.peerConnection.getSenders().filter(i=>{var c;return((c=i.track)===null||c===void 0?void 0:c.id)===t});r.length===1&&(yield this.applySendEncodings(r,[n]))})}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){return O(this,null,function*(){let r=this.peerConnection.getSenders().find(i=>{var c;return((c=i.track)===null||c===void 0?void 0:c.id)===n});r&&(yield r.replaceTrack(t._mediaStreamTrack))})}createDataChannels(t,n){throw new z(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new z(P.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Id(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e_.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e_.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}updateRtpSenderEncodings(t,n){return O(this,null,function*(){var r;if(n||(n=this.peerConnection.getSenders().find(f=>{var m;return((m=f.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ve().supportSetRtpSenderParameters)return S.warn("Browser not support set rtp-sender parameters");let i={},c={};if(t instanceof Tt)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(D("DSCP_TYPE")&&Ns()){var l;let f=D("DSCP_TYPE");J(l=["very-low","low","medium","high"]).call(l,f)&&(c.networkPriority=f)}let u=n.getParameters(),h=(r=u.encodings)===null||r===void 0?void 0:r[0];h&&Object.assign(h,c),Object.assign(u,i),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),yield n.setParameters(u)})}applySendEncodings(t,n){return O(this,null,function*(){try{if(!Ve().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){let i=t[r],c=n[r];i&&c&&(yield this.updateRtpSenderEncodings(c,i))}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}})}mungSendOfferSDP(t,n){let r=Tr(t);return n.forEach((i,c)=>{let l=i._mediaStreamTrack,u=r.mediaDescriptions.find(h=>h.attributes.mid===l.kind);u&&Gd(u,i)}),Sa(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let n=this.remoteSDP.batchSend(t).map((c,l)=>{let{id:u,mslabel:h}=c,{kind:f}=t[l];return new ie((m,E)=>{let _=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(u)))},1e4),y=A=>{let C=Je();if(C.name==="Safari"&&Number(C.version)===11&&A.track.id!==u&&A.streams[0].id===h){var I;let N=A.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(f,u,A.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(_),void m({track:N,id:u})}if(A.track.id===u)return this.peerConnection.removeEventListener("track",y),clearTimeout(_),void m({track:A.track,id:u})};this.peerConnection.addEventListener("track",y)})}),r=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=yield this.peerConnection.createAnswer();return yield this.peerConnection.setLocalDescription(i),yield ie.all(n)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}})}getRemoteSSRC(t){return O(this,null,function*(){if(!this.remoteSDP)return;let n=this.remoteSDP.getSSRC(t);return n?.[0].ssrcId})}setConfiguration(t){if(Ve().supportPCSetConfiguration){let n=e_.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},oe(It.prototype,"connect",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"connect"),It.prototype),oe(It.prototype,"stopSending",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"stopSending"),It.prototype),oe(It.prototype,"receive",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"receive"),It.prototype),oe(It.prototype,"stopReceiving",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"stopReceiving"),It.prototype),oe(It.prototype,"muteRemote",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"muteRemote"),It.prototype),oe(It.prototype,"unmuteRemote",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"unmuteRemote"),It.prototype),oe(It.prototype,"muteLocal",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"muteLocal"),It.prototype),oe(It.prototype,"unmuteLocal",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"unmuteLocal"),It.prototype),oe(It.prototype,"close",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),oe(It.prototype,"updateEncoderConfig",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"updateEncoderConfig"),It.prototype),oe(It.prototype,"updateSendParameters",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"updateSendParameters"),It.prototype),oe(It.prototype,"replaceTrack",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),oe(It.prototype,"getRemoteSSRC",[Ki],Object.getOwnPropertyDescriptor(It.prototype,"getRemoteSSRC"),It.prototype),It);function Ki(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return O(this,arguments,function*(){let i=this.mutex,c=yield i.lock("Locking from P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return yield r.apply(this,u)}finally{c()}})},n}let cue={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new aue(n,t)}},due={interceptLocalAudioFrame:function(t){return O(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ve().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(QE.has(e)||!e.track)return;let r={track:e.track};if(va()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(u){return void S.error("create audio-encoded-streams error",u&&u.message)}let l=new TransformStream({transform(u,h){r.controller||(r.controller=h),e.track&&e.track.id!==r.track.id&&(S.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let f=n.metadata&&n.metadata();f?(function(m,E){let{chunk:_,controller:y}=E,A=yc.METADATA;_.data=(function(C,I,N){let L=N.byteLength,M=L+Iw+$j,V=Cw+Rw+M,j=new ArrayBuffer(C.byteLength+V),U=new DataView(j);U.setUint8(0,Yj),U.setUint16(1,M),U.setUint8(3,I),U.setUint16(4,L);for(let K=0;K<L;K++)U.setUint8(6+K,N[K]);let H=new Uint8Array(U.buffer);return H.set(new Uint8Array(C),V),H.buffer})(_.data,A,m),y.enqueue(_)})(f,{sender:e,chunk:u,controller:h}):h.enqueue(u)}});c.readable.pipeThrough(l).pipeTo(c.writable)}else if(An()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");let c=ZE(),l=new MessageChannel;yield new ie(h=>c.onmessage=f=>{f.data==="registered"&&h(void 0)});let u=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=u,yield new ie(h=>c.onmessage=f=>{f.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var f;if(h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==r.track.id)S.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i);else if(h.data.getMetadata){let m=n.metadata&&n.metadata();m&&l.port1.postMessage({metadata:m})}},r.worker=c}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let c=QE.get(e);if(c){QE.delete(e);try{var l,u;(l=c.controller)===null||l===void 0||l.terminate(),(u=c.worker)===null||u===void 0||u.terminate()}catch(h){S.warning(h&&h.message)}}}QE.set(e,r),e.track.addEventListener("ended",i)})},interceptRemoteAudioFrame:function(t){return O(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ve().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(ov.has(e))return;let r={track:e.track,onMetadata:n.onMetadata,onPts:n.onPts};if(va()&&!tr()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");kb(Qe.CHROME,87,116)||(n.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(u){return void S.error("create audio-encoded-streams error",u&&u.message)}let l=new TransformStream({transform(u,h){r.controller||(r.controller=h),e.track&&e.track.id!==r.track.id&&(S.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i)),n.enableTopn?(function(f,m,E){var _;let y=bw(new DataView(m.data));if(!y)return E.enqueue(m);let A=f.track.id;jae.set(A,f.track);let C=(_=y.tlv.find(j=>j.tag===yc.AUDIO_LEVEL))===null||_===void 0?void 0:_.value,I=0;typeof C=="number"&&(I=127-C);let N=Math.round(Math.pow(10,I/60)-1),{selected:L,speaker:M}=(function(j,U){let H=eh.get(j);if(H||(H=(function(K){let Y=new Jj;return eh.set(K,Y),$o||($o=new Fae(D("TOPN_SILENCE_THRESHOLD")||500),$o.on("ActiveSpeakerChanged",ae=>{ae!=null&&(nv=ae)})),$o.addSpeakers([Y]),Y})(j)),eh.size<=Zj)return{selected:!0,speaker:H};if(!$o)throw new Error("no active speaker detector");return $o.levelChanged(H.id,U),Fd=$o.loudest.map(K=>K.id),nv&&!J(Fd).call(Fd,nv)&&Fd.length>=Zj&&Fd.pop(),{selected:J(Fd).call(Fd,H.id)||H.id===nv,speaker:H}})(f,N),V=(function(j,U,H){let K=Xo.get(j)||new Vae(j,U);return K.score=H,Xo.set(j,K),(function(Y){if(rv.set(Y,!0),!iv)return void(iv=Date.now());let ae=Date.now();ae-iv>1e3&&(rv.get(Y)?rv.set(Y,!1):(Qj(Y),rv.delete(Y)),iv=ae)})(j),K})(A,f.track,M.energyScore);V.addSample(L),V.active&&(m.data=y.frame.buffer,E.enqueue(m))})(e,u,h):n.enableMetadata||n.enablePts?(function(f,m,E,_){let y=new DataView(f.data),A=y.getUint8(0),C;if((128&A)!=0&&A!==71){let L=(function(M){if(M.byteLength<=0)return[];let V=[],j=0;for(;j<M.byteLength;){let H=(128&M.getUint8(j))>>7,K=127&M.getUint8(j);if(!(H&&j+4<=M.byteLength)){j++;break}{let Y=M.getUint32(j,!1),ae=(16776192&Y)>>10,Ce=1023&Y;V.push({pt:K,ts_offset:ae,length:Ce,data:new Uint8Array}),j+=4}}let U=M.byteLength-j;for(let H of V){if(H.length>U)return console.warn("Broken red payload"),[];H.length>0&&(H.data=new Uint8Array(M.buffer,M.byteOffset+j,H.length),j+=H.length,U-=H.length)}if(U>0){let H={pt:V.length>0?V[V.length-1].pt:0,ts_offset:0,length:U,data:new Uint8Array(M.buffer,M.byteOffset+j,U)};V.push(H)}return V})(y);if(L.length>0){let M=(function(V){let j=0;for(let K=0;K<V.length;K++)j+=K<V.length-1?4:1,j+=V[K].length;let U=new Uint8Array(j),H=0;for(let K=0;K<V.length;K++)if(K<V.length-1){let Y=(2147483648|(127&V[K].pt)<<24|(262143&V[K].ts_offset)<<10|1023&V[K].length)>>>0;U[H++]=Y>>24&255,U[H++]=Y>>16&255,U[H++]=Y>>8&255,U[H++]=255&Y}else U[H++]=127&V[K].pt;for(let K of V)U.set(K.data,H),H+=K.length;return U})(L.map(V=>{let j=new Uint8Array(V.length);j.set(V.data);let U=bw(new DataView(j.buffer));return U!=null&&U.frame&&(V.data=U?.frame),C=U,V}));f.data=M.buffer}}else C=bw(y),C&&(f.data=C.frame.buffer);if(m.enqueue(f),!C)return;let I=C.tlv.find(L=>L.tag===yc.METADATA);I&&E&&I.value instanceof Uint8Array&&E(I.value);let N=C.tlv.find(L=>L.tag===yc.AUDIO_64_BIT_PTS);N&&_&&N.value instanceof Uint8Array&&N.value.length==8&&_(new DataView(N.value.buffer).getBigUint64(0,!0))})(u,h,n.onMetadata,n.onPts):h.enqueue(u)}});c.readable.pipeThrough(l).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");let c=ZE(),l=new MessageChannel;yield new ie(h=>c.onmessage=f=>{f.data==="registered"&&h(void 0)});let u=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=u,yield new ie(h=>c.onmessage=f=>{f.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var f;h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==r.track.id?(S.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i)):h.data.metadata&&r.onMetadata?r.onMetadata(h.data.metadata):h.data.pts&&r.onPts&&r.onPts(h.data.pts)},r.worker=c}function i(){e.track.removeEventListener("ended",i),(function(c){let l=ov.get(c);if(l){(function(f){let m=eh.get(f);m&&(eh.delete(f),$o&&($o.removeSpeakers([m]),eh.size===0&&($o.destroy(),$o=null)))})(c),Qj(c.track.id),ov.delete(c);try{var u,h;(u=l.controller)===null||u===void 0||u.terminate(),(h=l.worker)===null||h===void 0||h.terminate()}catch(f){S.warning(f&&f.message)}}})(e)}ov.set(e,r),e.track.addEventListener("ended",i)})},interceptLocalVideoFrame:function(e,t){return O(this,null,function*(){if(!Ve().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(sv.has(e)||!e.track)return;let n={track:e.track};if(va()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(u){return void S.error("create video-encoded-streams error",u&&u.message)}let c=[];t.on("sei-to-send",u=>{c.push(u)});let l=new TransformStream({transform(u,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));let f=nB(new Uint8Array(u.data)),m=c.shift();if(m){let E=(function(_,y,A){switch(A){case Ow:return(function(C,I){let N=tB(I),L=N.length,M=Math.floor(L/255),V=L%255,j=new Uint8Array(6+M+1+L+C.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let U=0;for(;U<M;)j[6+U]=255,U++;return j[6+U]=V,U++,j.set(N,6+U),j.set(new Uint8Array(C),6+U+L),j.buffer})(_,y);case Nw:return(function(C,I){let N=tB(I),L=N.length,M=Math.floor(L/255),V=L%255,j=new Uint8Array(7+M+1+L+1+C.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=78,j[5]=1,j[6]=101;let U=0;for(;U<M;)j[7+U]=255,U++;return j[7+U]=V,U++,j.set(N,7+U),U+=L,j[7+U]=128,U++,j.set(new Uint8Array(C),7+U),j.buffer})(_,y);default:return null}})(u.data,m,f);E&&(u.data=E)}h.enqueue(u)}});i.readable.pipeThrough(l).pipeTo(i.writable)}else{if(!An())return;{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");let i=ZE(),c=new MessageChannel;yield new ie(u=>i.onmessage=h=>{h.data==="registered"&&u(void 0)});let l=new RTCRtpScriptTransform(i,{name:"sei-tx",port:c.port2},[c.port2]);e.transform=l,yield new ie(u=>i.onmessage=h=>{h.data==="started"&&u(void 0)}),t.on("sei-to-send",u=>{c.port1.postMessage({sei:u})}),c.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}let i=sv.get(e);if(i){sv.delete(e);try{var c,l;(c=i.controller)===null||c===void 0||c.terminate(),(l=i.worker)===null||l===void 0||l.terminate()}catch(u){S.warning(u&&u.message)}}}sv.set(e,n),e.track.addEventListener("ended",r)})},interceptRemoteVideoFrame:function(t){return O(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ve().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(!e.track)return;if(Lf.has(e)){let c=Lf.get(e);return void(c&&(c.onSei=n.onSei))}let r={track:e.track,onSei:n.onSei};if(va()){if(!e.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(u){return void S.error("create video-encoded-streams error",u&&u.message)}let l=new TransformStream({transform(u,h){if(r.controller||(r.controller=h),!r.firstFrameInfo){var f;let E=u.getMetadata()||{};r.firstFrameInfo=Dt({type:u.type,rtpTimestamp:u.timestamp,payloadType:E.payloadType||0,ssrc:E.synchronizationSource||0,length:u.data.byteLength},"mimeType"in E?{mimeType:E.mimeType}:{}),(f=n.onFirstFrame)===null||f===void 0||f.call(n,r.firstFrameInfo)}e.track&&e.track.id!==r.track.id&&(S.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let m=(function(E,_){switch(_){case Ow:return(function(y){let A=new DataView(y.data),C=0;for(;C+4<y.data.byteLength;){if(A.getUint8(C+0)===0&&A.getUint8(C+1)===0&&A.getUint8(C+2)===0&&A.getUint8(C+3)===1&&A.getUint8(C+4)===6){let I=C+6,N=0,L=0;for(;(L=A.getUint8(I++))===255;)N+=255;N+=L;let M=eB(y.data,I,N);return new Uint8Array(M)}C++}return null})(E);case Nw:return(function(y){let A=new DataView(y.data),C=0;for(;C+5<y.data.byteLength;){if(A.getUint8(C+0)===0&&A.getUint8(C+1)===0&&A.getUint8(C+2)===0&&A.getUint8(C+3)===1&&A.getUint8(C+4)===78&&A.getUint8(C+5)===1&&A.getUint8(C+6)===101){let I=C+7,N=0,L=0;for(;(L=A.getUint8(I++))===255;)N+=255;N+=L;let M=eB(y.data,I,N);return new Uint8Array(M)}C++}return null})(E);default:return null}})(u,nB(new Uint8Array(u.data)));m&&r.onSei&&r.onSei(m),h.enqueue(u)}});c.readable.pipeThrough(l).pipeTo(c.writable)}else if(An()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");let c=ZE(),l=new MessageChannel;yield new ie(h=>c.onmessage=f=>{f.data==="registered"&&h(void 0)});let u=new RTCRtpScriptTransform(c,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=u,yield new ie(h=>c.onmessage=f=>{f.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var f;if(h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==r.track.id)S.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i);else if(h.data.sei&&r.onSei)r.onSei(h.data.sei);else if(h.data.firstFrameInfo&&n.onFirstFrame){var m;(m=n.onFirstFrame)===null||m===void 0||m.call(n,h.data.firstFrameInfo)}},r.worker=c}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(c){let l=Lf.get(c);if(l){Lf.delete(c);try{var u,h;(u=l.controller)===null||u===void 0||u.terminate(),(h=l.worker)===null||h===void 0||h.terminate()}catch(f){S.warning(f&&f.message)}}})(e)}Lf.set(e,r),e.track.addEventListener("ended",i)})}},lue={name:"InterceptFrame",create:()=>due};var $e;function nW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function os(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nW(Object(n),!0).forEach(function(r){w(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nW(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let uue=($e=class Up extends hv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return J(n=Object.keys(Pd)).call(n,t)}))]}constructor(t,n,r){super(t,n),w(this,"id",at(5,"connection-")),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"forceTurn",!1),w(this,"remoteSDP",void 0),w(this,"initialOffer",void 0),w(this,"transportEventReceiver",void 0),w(this,"statsFilter",void 0),w(this,"extension",{useXR:D("USE_XR")}),w(this,"localCapabilities",void 0),w(this,"remoteCodecs",void 0),w(this,"localCandidateCount",0),w(this,"allCandidatesReceived",!1),w(this,"isPreallocation",!1),w(this,"preMediaMap",new Map),w(this,"dataStreamChannelMap",new Map),w(this,"establishPromise",void 0),w(this,"recoveredDataChannelIds",[]),w(this,"currentDataChannelId",1),w(this,"supportAV1RtpSpec",!1),w(this,"mutex",void 0),w(this,"qualityLimitationReason",Bu.NONE),w(this,"isFirstConnected",!1),this.store=n,this.forceTurn=f0(t),this.mutex=new Dn("NVConnectionExtension-mutex",n.clientId),this.peerConnection=r,this.isFirstConnected=!1,this.statsFilter=BE(this.peerConnection,D("STATS_UPDATE_INTERVAL"),void 0,Nt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}updateRemoteRTPCapabilities(t,n){return O(this,null,function*(){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){let r=yield this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield this.peerConnection.setLocalDescription(r);let c=this.remoteSDP.toString();i?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else S.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")})}establish(){return O(this,null,function*(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let n=yield this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=Fs(n.sdp),i=yield Xw({filterRTX:!D("USE_PUB_RTX")&&!D("USE_SUB_RTX"),filterVideoFec:D("FILTER_VIDEO_FEC"),filterAudioFec:D("FILTER_AUDIO_FEC"),filterVideoCodec:D("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:D("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:D("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Vf(i),this.initialOffer=n,D("ENABLE_SVC")&&this.store.codec=="av1"){let l=yield OB();var t;l&&(this.supportAV1RtpSpec=!0,(t=i.send)===null||t===void 0||t.videoExtensions.push(l))}let c;return n.sdp&&vv(n.sdp)&&(c=Pt(i),TB(c)),os(os({},r),{},{rtpCapabilities:c||i,offerSDP:n.sdp})}catch(n){throw new z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}})}connect(t){return O(this,null,function*(){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&vv(this.initialOffer.sdp)&&CB(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new tH(os(os({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!D("ENABLE_PRE_SUB_WITH_PRE_PC")||!D("PRE_USE_LOCAL_CODECS"))&&Of(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let n=this.remoteSDP.toString(),r=Jw(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),yield this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i?.(n),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:n});let c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),Of(this.store))if(t.preallocation&&D("ENABLE_PRE_SUB_WITH_PRE_PC")){let l=D("PRE_SUB_NUM"),{mids:u,preSSRCs:h}=this.remoteSDP.preloadRemoteMedia(l);yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(h)),this.presetMedia(u,h)}else{let{preSSRCs:l=[]}=t,u=l.map(f=>f.ssrcMsg[0].ssrcId);if(l.length===0)return;let{mids:h}=this.remoteSDP.batchSend(l.map(f=>Object.assign({},f)));yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(h,u)}}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(n.toString()))}})}presetMedia(t,n){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(c=>{if(c.mid!=null&&r===c.mid&&c.receiver.track){let l=c.receiver.track,u;l.kind==="video"&&D("ENABLE_PRE_RENDER")&&(u=new Ju({trackId:"track-".concat(l.kind,"-unknown-").concat(this.store.clientId,"_").concat(at(5,""))},!0),u.updateVideoTrack(l),u.onFirstVideoFrameRender=()=>{var h;let f=this.preMediaMap.get(n[i]);f&&(f.firstVideoRender=Date.now()),(h=this.onFirstVideoRender)===null||h===void 0||h.call(this,n[i])},u.onVideoBufferReady=()=>{var h;(h=this.onFirstVideoBufferReady)===null||h===void 0||h.call(this,n[i])},u.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[i],{mid:r,track:l,player:u,transceiver:c})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}updateRemoteConnect(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let n=!1,{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let l=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||l}let{preSSRCs:i=[]}=t,c=i.map(l=>l.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(c)){let l=[],u=[];if(Array.from(this.preMediaMap.entries()).every(h=>{let[f,{mid:m,player:E,track:_}]=h;return l.push(m),u.push(f),this.preMediaMap.delete(f),E&&E.destroy(),!0}),l.length>0&&(this.remoteSDP.stopSending(l),yield $r(this.peerConnection,this.remoteSDP,this.extension),S.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),ue.reportApiInvoke(this.store.sessionId,{name:Mt.PRELOAD_MEDIA_FAILED,options:[i,u],tag:St.TRACER}).onSuccess()),i.length>0){let{mids:h}=this.remoteSDP.batchSend(i.map(f=>Object.assign({},f)));yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(c)),this.presetMedia(h,c)}}n?(yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):S.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(n.toString()))}})}send(t,n,r){var i=this;return Pr(function*(){let c=yield ke(i.mutex.lock("From NVConnectionExtension.send"));try{if(!i.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");let l=[],u=xf();t.forEach(I=>{let N=i.peerConnection.addTransceiver(I._mediaStreamTrack,os({direction:"sendonly"},I.trackMediaType==="video"&&i.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));l.push(N),I._updateRtpTransceiver(N)}),Nt()&&D("SIMULCAST")===!0&&(yield ke(i.applySimulcastForFirefox(l,t)));let h=yield ke(i.peerConnection.createOffer()),f=i.remoteSDP.predictReceivingMids(t.length),m=i.mungSendOfferSDP(h.sdp,t,f),E=Tr(m),_=f.map(I=>{let N=E.mediaDescriptions.find(L=>L.attributes.mid===I);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return zw(N,D("USE_PUB_RTX"))}),y;try{y=yield _}catch(I){y=[],i.remoteSDP.receive(t,n,r,y);let N=i.remoteSDP.toString();throw yield ke(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ke(i.peerConnection.setRemoteDescription({type:"answer",sdp:N})),yield ke(i.stopSending(f,!0)),I}i.remoteSDP.receive(t,n,r,y);let A=i.remoteSDP.toString(),C=i.logSDPExchange(m,"offer","local","send");return yield ke(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ke(i.applySimulcastEncodings(l,t)),yield ke(i.applySendEncodings(l,t)),C?.(A),yield ke(i.peerConnection.setRemoteDescription({type:"answer",sdp:A})),l.map((I,N)=>{let L=f[N];return{localSSRC:_[N],id:L,transceiver:I}})}catch(l){throw l instanceof z?l:new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(l.toString()))}finally{c()}})()}createDataChannels(t,n){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")S.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{let c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:D("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(c=>{c._updateOriginDataChannel(r)});let{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){let c=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:c});let l=yield this.peerConnection.createAnswer();yield this.peerConnection.setLocalDescription(l),S.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else S.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof z?r:new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(r.toString()))}})}stopDataChannels(t){return O(this,null,function*(){try{let n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof z?n:new z(P.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(n.toString()))}})}stopSending(t,n){return O(this,null,function*(){let r=n?void 0:yield this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");i.map(h=>{var f;uh(this.id+h.mid,this),h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});let c=yield this.peerConnection.createOffer(),l=this.logSDPExchange(c.sdp||"","offer","local","stopSending");yield this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);let u=this.remoteSDP.toString();l?.(u),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(i.toString()))}finally{r&&r()}})}receive(t,n,r,i){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:l}=this.remoteSDP.send(t,n,r,i);l&&(yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));let u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}}catch(c){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(c.toString()))}})}batchReceive(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");let{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(yield $r(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),n.map(i=>{let c=this.peerConnection.getTransceivers().find(l=>l.mid===i);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:i,transceiver:c}})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(n.toString()))}})}stopReceiving(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(c=>{Array.from(this.preMediaMap.entries()).some(l=>{let[u,{mid:h,player:f}]=l;if(h===c)return this.preMediaMap.delete(u),f&&f.destroy(),!0})}),this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=yield this.peerConnection.createAnswer();r?.(i.sdp||""),yield this.peerConnection.setLocalDescription(i)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(n.toString()))}})}muteRemote(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=yield this.peerConnection.createAnswer();r?.(i.sdp||""),yield this.peerConnection.setLocalDescription(i)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(n.toString()))}})}unmuteRemote(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=yield this.peerConnection.createAnswer();r?.(i.sdp||""),yield this.peerConnection.setLocalDescription(i)}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(n.toString()))}})}muteLocal(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(l=>{l.direction="inactive"});let r=yield this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let c=this.remoteSDP.toString();i?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(n.toString()))}})}unmuteLocal(t){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((l,u)=>O(this,null,function*(){l.direction="sendonly"}));let r=yield this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let c=this.remoteSDP.toString();i?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new z(P.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(n.toString()))}})}restartICE(t){var n=this;return Pr(function*(){let r=yield ke(n.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let i=Ve().supportPCSetConfiguration,c=D("FORCE_TURN_TCP")||n.forceTurn;if(t===On.RELAY&&!i)return;if(i&&!c){let E=t===On.RELAY?"relay":"all",_=n.peerConnection.getConfiguration();_.iceTransportPolicy!==E&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,n.peerConnection.setConfiguration(_))}n.remoteSDP.updateCandidates(t);let l=yield ke(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let u=Fs(l.sdp),{remoteIceParameters:h}=yield u.iceParameters;n.remoteSDP.restartICE(h);let f=n.remoteSDP.toString(),m=n.logSDPExchange(l.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ke(n.peerConnection.setLocalDescription(l)),m?.(f),yield ke(n.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(i){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}extendCandidate(){return O(this,null,function*(){if(!this.remoteSDP||this.isFirstConnected)return;let t=yield this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(On.TCP_RELAY),yield $r(this.peerConnection,this.remoteSDP,this.extension)}catch(n){S.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}})}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{uh(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:r}=n;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return os(os({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){return O(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");let r=yield this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);let c=this.remoteSDP.toString(),l=this.logSDPExchange(i,"offer","local","updateEncoderConfig");yield this.peerConnection.setLocalDescription({type:"offer",sdp:i}),l?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new z(P.EXCHANGE_SDP_FAILED,r.toString())}})}updateSendParameters(t,n){return O(this,null,function*(){let r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nt()||(yield this.applySimulcastEncodings(r,[n])):yield this.applySendEncodings(r,[n]))})}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){return O(this,null,function*(){let r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&(yield r.sender.replaceTrack(t._mediaStreamTrack))})}getSelectedCandidatePair(){return O(this,null,function*(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:os(os({},yo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:os(os({},yo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;let r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",c=Us(t.url||"");S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(r,"), url: ").concat(c||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},D("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Id(t.turnServer.servers)?n.iceServers=t.turnServer.servers:D("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(D("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Up.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Up.newTurnServerConfigToIceServers(t.turnServer.servers)),D("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Up.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Up.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&Ve().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Io(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){let n=[];return t.forEach(r=>{let i=D("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Io(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Io(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){let n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in i?i.error:i)};let r=n.iceTransport;r&&(r.onstatechange=()=>{let i=n?.iceTransport.state;var c;i&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:i,remote:c}=r.getSelectedCandidatePair()||{};if(i&&c){let l=i.address+":"+i.port,u=c.address+":"+c.port;S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Us(l)),", remote ").concat(JSON.stringify(Us(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(t,n){return O(this,null,function*(){var r,i;if(n||(n=this.peerConnection.getSenders().find(I=>I.track===t._mediaStreamTrack)),!n)return S.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ve().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let c={},l={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}let u=yB(this.peerConnection,t._mediaStreamTrack),h=dV(t);if(aH(t)&&u&&n&&h&&this.getLocalVideoStats&&J(r=["vp8","vp9"]).call(r,this.store.codec)){var f;let C=c.degradationPreference||(J(f=t._hints).call(f,ot.CUSTOM_TRACK)?D("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");cH(this.id+u.mid,h,this,C,I=>{n&&this.updateAdaptation(n,I)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;let{bitrateMax:C,frameRate:I,scaleResolutionDownBy:N}=t._encoderConfig;C&&(l.maxBitrate=1e3*C),(J(m=t._hints).call(m,ot.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(I&&(l.maxFramerate=Ur(I)),N&&N>=1&&(l.scaleResolutionDownBy=N))}let{maxFramerate:E}=D("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(l.maxFramerate=l.maxFramerate?Math.min(l.maxFramerate,E):E),D("DSCP_TYPE")&&Ns()){var _;let C=D("DSCP_TYPE");J(_=["very-low","low","medium","high"]).call(_,C)&&(l.networkPriority=C)}let y=n.getParameters(),A=(i=y.encodings)===null||i===void 0?void 0:i[0];Nt()&&!A&&(c.encodings=[l]),A&&Object.assign(A,l),Object.assign(y,c),S.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),yield n.setParameters(y),yield LB(this.store.codec,n,D("SVC_MODE"))})}updateAdaptation(t,n){return O(this,null,function*(){var r,i;if(!t)return S.debug("[updateAdaptation] no rtpSender found");if(!Ve().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let c={},{bitrateMax:l,frameRate:u,scaleResolutionDownBy:h}=n;l&&(c.maxBitrate=1e3*l),u&&(c.maxFramerate=Ur(u)),h&&h>=1&&J(r=["vp8","vp9"]).call(r,this.store.codec)&&(c.scaleResolutionDownBy=h);let f=t.getParameters(),m=(i=f.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,c),Object.assign(f,{});try{yield t.setParameters(f),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):S.debug("[updateAdaptation] rtpSender transport not connected}")}})}applySendEncodings(t,n){return O(this,null,function*(){try{if(!Ve().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){let i=t[r],c=n[r];c instanceof Tt&&!this.isVP8Simulcast(c)&&(yield this.updateRtpSenderEncodings(c,i.sender))}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}})}mungSendOfferSDP(t,n,r){let i=Tr(t);return n.forEach((c,l)=>{let u=r[l],h=i.mediaDescriptions.find(f=>f.attributes.mid===u);h&&(Gd(h,c),$w(h,c,this.store.codec))}),Sa(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(t,n){return O(this,null,function*(){if(t.length===n.length)for(let h=0;h<t.length;h++){var r,i,c,l,u;let f=t[h],m=n[h];if(m instanceof Tt&&!J(r=m._hints).call(r,ot.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(l=m._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=m._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},_={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];let y=f.sender.getParameters();yield f.sender.setParameters(Object.assign(y,E))}}})}applySimulcastEncodings(t,n){return O(this,null,function*(){if(!Nt()&&t.length===n.length)for(let r=0;r<t.length;r++){let i=n[r];if(i instanceof Tt&&this.isVP8Simulcast(i)){let c=t[r],l={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];let h=c.sender.getParameters();yield c.sender.setParameters(Object.assign(h,l))}}})}isVP8Simulcast(t){var n,r,i,c,l;return!!(t instanceof Tt&&D("SIMULCAST")&&this.store.codec==="vp8"&&!J(n=t._hints).call(n,ot.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(D("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during NVConnectionExtension.").concat(i,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",r==="local"?"remote":"local",i)}:void 0}getRemoteSSRC(t){return O(this,null,function*(){if(!this.remoteSDP)return;let n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0})}setConfiguration(t){if(Ve().supportPCSetConfiguration){let n=Up.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},oe($e.prototype,"updateRemoteRTPCapabilities",[jr],Object.getOwnPropertyDescriptor($e.prototype,"updateRemoteRTPCapabilities"),$e.prototype),oe($e.prototype,"connect",[jr],Object.getOwnPropertyDescriptor($e.prototype,"connect"),$e.prototype),oe($e.prototype,"updateRemoteConnect",[jr],Object.getOwnPropertyDescriptor($e.prototype,"updateRemoteConnect"),$e.prototype),oe($e.prototype,"createDataChannels",[jr],Object.getOwnPropertyDescriptor($e.prototype,"createDataChannels"),$e.prototype),oe($e.prototype,"receive",[jr],Object.getOwnPropertyDescriptor($e.prototype,"receive"),$e.prototype),oe($e.prototype,"batchReceive",[jr],Object.getOwnPropertyDescriptor($e.prototype,"batchReceive"),$e.prototype),oe($e.prototype,"stopReceiving",[jr],Object.getOwnPropertyDescriptor($e.prototype,"stopReceiving"),$e.prototype),oe($e.prototype,"muteRemote",[jr],Object.getOwnPropertyDescriptor($e.prototype,"muteRemote"),$e.prototype),oe($e.prototype,"unmuteRemote",[jr],Object.getOwnPropertyDescriptor($e.prototype,"unmuteRemote"),$e.prototype),oe($e.prototype,"muteLocal",[jr],Object.getOwnPropertyDescriptor($e.prototype,"muteLocal"),$e.prototype),oe($e.prototype,"unmuteLocal",[jr],Object.getOwnPropertyDescriptor($e.prototype,"unmuteLocal"),$e.prototype),oe($e.prototype,"close",[jr],Object.getOwnPropertyDescriptor($e.prototype,"close"),$e.prototype),oe($e.prototype,"updateEncoderConfig",[jr],Object.getOwnPropertyDescriptor($e.prototype,"updateEncoderConfig"),$e.prototype),oe($e.prototype,"updateSendParameters",[jr],Object.getOwnPropertyDescriptor($e.prototype,"updateSendParameters"),$e.prototype),oe($e.prototype,"replaceTrack",[jr],Object.getOwnPropertyDescriptor($e.prototype,"replaceTrack"),$e.prototype),oe($e.prototype,"updateAdaptation",[jr],Object.getOwnPropertyDescriptor($e.prototype,"updateAdaptation"),$e.prototype),oe($e.prototype,"getRemoteSSRC",[jr],Object.getOwnPropertyDescriptor($e.prototype,"getRemoteSSRC"),$e.prototype),$e);function jr(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return O(this,arguments,function*(){let i=this.mutex,c=yield i.lock("From NVConnectionExtension.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return yield r.apply(this,u)}finally{c()}})},n}var pt;function rW(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=RE,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new Qv(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Qv(e){function t(n){if(Object(n)!==n)return ie.reject(new TypeError(n+" is not an object."));var r=n.done;return ie.resolve(n.value).then(function(i){return{value:i,done:r}})}return Qv=function(n){this.s=n,this.n=n.next},Qv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ie.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ie.reject(n):t(r.apply(this.s,arguments))}},new Qv(e)}let hue=(pt=class vC extends hv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),w(this,"name","DataChannelConnection"),w(this,"store",void 0),w(this,"peerConnection",void 0),w(this,"cname",void 0),w(this,"mutex",new Dn("DataChannelConnection-mutex")),w(this,"dataChannel",void 0),w(this,"_p2pConnection",void 0),w(this,"establishPromise",void 0),w(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(vC.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new uue(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var n;return(n=this._p2pConnection)===null||n===void 0?void 0:n.getPreMedia(t)}isPreSub(){var t,n;return(t=(n=this._p2pConnection)===null||n===void 0?void 0:n.isPreSub())!==null&&t!==void 0&&t}establish(){return O(this,null,function*(){return yield this._p2pConnection.establish()})}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}connect(t){return O(this,null,function*(){return this.cname=t.cname,yield this._p2pConnection.connect(t),yield new ie((n,r)=>{let i=setTimeout(()=>{this.closeSignal(),r(new G(P.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},D("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(i),void n()},this.dataChannel.onerror=c=>{this.closeSignal(),r(c)},this.dataChannel.addEventListener("close",()=>{r(new G(P.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}})}updateRemoteRTPCapabilities(t,n){return O(this,null,function*(){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)})}send(t,n,r){var i=this;return Pr(function*(){let c=yield ke(i.mutex.lock("From DataChannelConnection.send"));try{return yield*ol(Mu(rW(i._p2pConnection.send(t,n,r))))}finally{c()}})()}stopSending(t,n){return O(this,null,function*(){return this._p2pConnection.stopSending(t,n)})}createDataChannels(t,n){return O(this,null,function*(){return this._p2pConnection.createDataChannels(t,n)})}stopDataChannels(t){return O(this,null,function*(){return this._p2pConnection.stopDataChannels(t)})}receive(t,n,r,i){return O(this,null,function*(){return this._nvMedia?(S.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),yield this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(S.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),yield this._p2pConnection.receive(t,n,r,i))})}batchReceive(t){return O(this,null,function*(){return[...yield this._p2pConnection.batchReceive(t)]})}stopReceiving(t){return O(this,null,function*(){return yield this._p2pConnection.stopReceiving(t)})}muteRemote(t){return O(this,null,function*(){return yield this._p2pConnection.muteRemote(t)})}unmuteRemote(t){return O(this,null,function*(){return yield this._p2pConnection.unmuteRemote(t)})}muteLocal(t){return O(this,null,function*(){return yield this._p2pConnection.muteLocal(t)})}unmuteLocal(t){return O(this,null,function*(){return yield this._p2pConnection.unmuteLocal(t)})}restartICE(t){var n=this;return Pr(function*(){return yield*ol(Mu(rW(n._p2pConnection.restartICE(t))))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;return(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}updateEncoderConfig(t,n){return O(this,null,function*(){return yield this._p2pConnection.updateEncoderConfig(t,n)})}updateSendParameters(t,n){return O(this,null,function*(){return yield this._p2pConnection.updateSendParameters(t,n)})}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}replaceTrack(t,n){return O(this,null,function*(){return yield this._p2pConnection.replaceTrack(t,n)})}getRemoteSSRC(t){return O(this,null,function*(){return this._p2pConnection.getRemoteSSRC(t)})}logSDPExchange(t,n,r,i){if(D("SDP_LOGGING"))return S.upload("exchanging ".concat(r," ").concat(n," SDP during DataChannelConnection.").concat(i,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",r==="local"?"remote":"local",i)}:void 0}static resolvePCConfiguration(t){let n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Id(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...vC.turnServerConfigToIceServers(t.turnServer.servers)),D("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...vC.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),D("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),D("ENABLE_ENCODED_TRANSFORM")&&Ve().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Io(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!D("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var n;return(n=this.onFirstVideoRender)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var n;return(n=this.onFirstVideoBufferReady)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,r)=>{var i;return(i=this.onFirstVideoDecoded)===null||i===void 0?void 0:i.call(this,t,n,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},oe(pt.prototype,"connect",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"connect"),pt.prototype),oe(pt.prototype,"updateRemoteRTPCapabilities",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteRTPCapabilities"),pt.prototype),oe(pt.prototype,"createDataChannels",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"createDataChannels"),pt.prototype),oe(pt.prototype,"receive",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"receive"),pt.prototype),oe(pt.prototype,"stopReceiving",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"stopReceiving"),pt.prototype),oe(pt.prototype,"muteRemote",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"muteRemote"),pt.prototype),oe(pt.prototype,"unmuteRemote",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteRemote"),pt.prototype),oe(pt.prototype,"muteLocal",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"muteLocal"),pt.prototype),oe(pt.prototype,"unmuteLocal",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteLocal"),pt.prototype),oe(pt.prototype,"close",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"close"),pt.prototype),oe(pt.prototype,"updateEncoderConfig",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"updateEncoderConfig"),pt.prototype),oe(pt.prototype,"updateSendParameters",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"updateSendParameters"),pt.prototype),oe(pt.prototype,"replaceTrack",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"replaceTrack"),pt.prototype),oe(pt.prototype,"getRemoteSSRC",[Di],Object.getOwnPropertyDescriptor(pt.prototype,"getRemoteSSRC"),pt.prototype),pt);function Di(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return O(this,arguments,function*(){let i=this.mutex,c=yield i.lock("From DataChannelConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return yield r.apply(this,u)}finally{c()}})},n}function iW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class pue extends jt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;J(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(En.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(En.CONNECTED):this._state==="closed"?this.emit(En.CLOSED):this._state==="failed"&&this.emit(En.FAILED))}constructor(t,n,r,i){super(),w(this,"connectionID",0),w(this,"currentURLIndex",0),w(this,"reconnectReason",void 0),w(this,"_reconnectMode","tryNext"),w(this,"_initMutex",void 0),w(this,"_name",void 0),w(this,"_state","closed"),w(this,"_reconnectInterrupter",void 0),w(this,"_url",void 0),w(this,"_retryConfig",void 0),w(this,"_reconnectCount",0),w(this,"_forceCloseTimeout",5e3),w(this,"_onlineReconnectListener",void 0),w(this,"_closeEstablishingTransmitter",()=>{}),w(this,"_store",void 0),w(this,"_joinChannelServiceRecordIndex",void 0),w(this,"_transmitter",void 0),w(this,"_useCompress",void 0),w(this,"_inflateLength",0),w(this,"_deflateLength",0),this._store=i,this._name=t,this._retryConfig=(function(c){for(var l=1;l<arguments.length;l++){var u=arguments[l]!=null?arguments[l]:{};l%2?iW(Object(u),!0).forEach(function(h){w(c,h,u[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(u)):iW(Object(u)).forEach(function(h){Object.defineProperty(c,h,Object.getOwnPropertyDescriptor(u,h))})}return c})({},n),this._useCompress=r}resetReconnectCount(t){S.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;let r=this._transmitter;n?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void S.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));let i=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),i&&i.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){let t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let ss=(function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e})({});class fue{constructor(t,n,r){w(this,"version",1),w(this,"initialRTO",void 0),w(this,"maxBatchAckCount",void 0),w(this,"maxRTO",void 0),w(this,"initialRTT",void 0),w(this,"ID",void 0),w(this,"rtt",void 0),w(this,"packetNumber",1),w(this,"rtoRatioMap",new Map),w(this,"timeoutMap",new Map),w(this,"unorderedPacketQueue",[]),w(this,"batchAckPacketQueue",[]),w(this,"lastOrderedPacketNumber",0),w(this,"batchAckTimer",void 0),w(this,"sendImpl",void 0),w(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=at(7,"transmitter-"),this.initialRTO=r?.initialRTO!==void 0?r.initialRTO:D("TRANSMITTER_INITIAL_RTO"),this.initialRTT=r?.initialRTT!==void 0?r.initialRTT:D("TRANSMITTER_INITIAL_RTT"),this.rtt=r?.initialRTT!==void 0?r.initialRTT:D("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=r?.maxBatchAckCount!==void 0?r.maxBatchAckCount:D("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=r?.maxRTO!==void 0?r.maxRTO:D("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:ss.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case ss.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;let r=new ArrayBuffer(n.length+15),i=new DataView(r);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.packetNumber),i2(i,7,BigInt(t.sendTs)),new Uint8Array(i.buffer).set(n,15),r}case ss.Ack:{let n=new ArrayBuffer(16),r=new DataView(n);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),i2(r,8,BigInt(t.ackSendTs)),n}}}deserialize(t){let n=new DataView(t),r=n.getUint16(0),i=n.getUint8(2);switch(i){case ss.Default:{let c=n.getUint32(3),l=r2(n,7),u=t.slice(15),h=new Uint8Array(u);return{version:r,type:i,packetNumber:c,sendTs:Number(l),payload:h}}case ss.Ack:{let c=n.getUint32(3),l=n.getUint8(7),u=r2(n,8);return{version:r,type:i,maxAckPacketNumber:c,shift:l,ackSendTs:Number(u)}}default:throw S.error("[".concat(this.ID,"] Unrecognized packet type ").concat(i)),new Error("Unrecognized packet type ".concat(i))}}sendMessage(t){D("DC_DEBUG_LOG")&&typeof t=="string"&&S.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));let n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;let r=this.calculateRTO(n),i=window.setTimeout(()=>{this.resendMessage(n)},r);this.timeoutMap.set(n.packetNumber,i),this.sendPacket(n)}onData(t){let n=this.deserialize(t);n.type===ss.Default?this.ack(n):n.type===ss.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){let n=this.calculateRTO(t),r=window.setTimeout(()=>{D("DC_DEBUG_LOG")&&typeof t.payload=="string"&&S.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(n)),this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){let n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{let r=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,n){let r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){let n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){let n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:ss.Ack,version:this.version};D("DC_DEBUG_LOG")&&S.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;let n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:ss.Ack,version:this.version};D("DC_DEBUG_LOG")&&S.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;let t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:ss.Ack,version:this.version};D("DC_DEBUG_LOG")&&S.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===ss.Default&&(t.sendTs=Math.round(performance.now()));let n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){let r=this.timeoutMap.get(n);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class oW extends pue{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),w(this,"_initMutex",void 0),w(this,"_reconnectInterrupter",void 0),w(this,"_url",void 0),w(this,"_transmitter",void 0),w(this,"_addresses",void 0),w(this,"_reliableTransmission",void 0),w(this,"_textEncoder",void 0),w(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new Dn("datachannel");let{timeout:r,timeoutFactor:i}=n,c=Math.max(300,Math.floor(3*r/5)),l=Math.max(1.2,Math.floor(8*i)/10);Sr.ONLINE&&(this._retryConfig.timeout=c,this._retryConfig.timeoutFactor=l),zt.on(bd.NETWORK_STATE_CHANGE,(u,h)=>{u!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(u)),u===Sr.ONLINE?(this._retryConfig.timeout=c,this._retryConfig.timeoutFactor=l):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=i))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(n){return O(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=r;let i=(c,l)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(h=>h.fingerprint||D("FINGERPRINT"));let u=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(u).then(c).catch(l),this.once(En.CLOSED,()=>l(new G(P.WS_DISCONNECT))),this.once(En.CONNECTED,()=>c())};return this._initMutex.lock().then(c=>new ie((l,u)=>{i(l,u)}).then(()=>{c()}).catch(()=>{c()}))})}sendMessage(n){return O(this,arguments,function*(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new G(P.WS_ABORT,"datachannel is not ready");try{r||(t=JSON.stringify(t));let i=this._textEncoder.encode(t),c=ble(i,{raw:!0});this._reliableTransmission.sendMessage(c)}catch(i){throw new G(P.WS_ERR,"send datachannel signal message error"+i.toString())}})}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){let n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new ie((n,r)=>{var i;let c=()=>{S.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),n()},l=m=>O(this,null,function*(){var E;if((E=this._closeEstablishingTransmitter)===null||E===void 0||E.call(this),S.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");let _=li(this,En.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,y=yield this.reconnectWithAction(_);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!y)return r(new G(P.WS_DISCONNECT,"datachannel reconnect failed: ".concat(m.code))),void this.close(!0);n()}else r(new G(P.WS_DISCONNECT,"datachannel close: ".concat(m.code))),this.close()}),u=m=>O(this,null,function*(){try{var E;(E=this._reliableTransmission)===null||E===void 0||E.onData(m.data)}catch(_){console.log(_)}});this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),S.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));let h=(i=this._store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),f=Date.now();hn(this,En.TO_CONNECT_DATACHANNEL).then(m=>{var E,_;if(!m)throw new Error("transmissonInfo not exist yet");let{transmitter:y,close:A}=m;this._transmitter=y,(E=this._store)===null||E===void 0||E.signalChannelOpen();let C=Date.now()-f;S.debug("[choose dc] dc open cost ".concat(C,"ms")),this._reliableTransmission=new fue(I=>{var N;this._transmitter&&this._transmitter.readyState==="open"&&((N=this._transmitter)===null||N===void 0||N.send(I))},I=>{if(typeof I=="string")this.emit(En.ON_MESSAGE,I);else{let N=Ale(I,{raw:!0}).buffer,L=this._textDecoder.decode(N);this.emit(En.ON_MESSAGE,L)}}),this._closeEstablishingTransmitter=()=>{var I;(I=this._reliableTransmission)===null||I===void 0||I.close(),this._reliableTransmission=void 0,A()},c&&c(),y.onclose=l,y.onmessage=u,(_=this._store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this._joinChannelServiceRecordIndex=h}).catch(m=>{var E;if((E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:m instanceof G&&m.code===P.WS_ABORT?"aborted":"error",errors:[m]},h),this.state!=="closed"){if(m instanceof G&&m.code===P.WS_ERR){let _=new G(P.WS_ERR,"init datachannel failed! Error: ".concat(m.toString()));return S.error("[".concat(this._name,"]").concat(_)),void r(_)}l&&l(m)}else r(new G(P.WS_DISCONNECT,"datachannel is closed: ".concat(m.toString())))})})}reconnectWithAction(n){return O(this,arguments,function*(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||zt.networkState!==Sr.OFFLINE||(this._onlineReconnectListener=zt.onlineWaiter&&zt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},r){let h=UE(this._reconnectCount,this._retryConfig);S.debug("[".concat(this._name,"] wait ").concat(h,"ms to reconnect datachannel, mode: ").concat(t)),yield ie.race([Tn(h),this._onlineReconnectListener||new ie(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;let c=(h,f)=>O(this,null,function*(){this.emit(En.RECONNECT_CREATE_CONNECTION,f),yield this.createTransmitterConnection(h)});try{if(t==="retry"){let h=this._addresses[this.currentURLIndex];yield c(h,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let f=this.currentURLIndex;f<this._addresses.length;f++){if(this._addresses[f].fingerprint||D("FINGERPRINT")){this.currentURLIndex=f;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return S.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),yield this.reconnectWithAction("recover",!1);S.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));let h=this._addresses[this.currentURLIndex];yield c(h,t)}else t==="recover"&&(S.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(En.FAILBACK));return!0}catch(h){var l,u;return S.error("[".concat(this._name,"] reconnect failed"),h.toString()),h!=null&&(l=h.data)!==null&&l!==void 0&&l.desc&&Array.isArray(h.data.desc)&&h.data.desc.length&&J(u=h.data.desc).call(u,"dynamic key expired")?(this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield this.reconnectWithAction(t,r)}})}}class mue extends jt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Ge.CONNECTED?this.emit(pe.WS_CONNECTED):t===Ge.RECONNECTING?this.emit(pe.WS_RECONNECTING,this._websocketReconnectReason):t===Ge.CLOSED&&this.emit(pe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(S.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:n,message:r}=t;this.emit(n,r),n===Ie.ON_NOTIFICATION&&this.handleNotification(r),n===Ie.ON_USER_BANNED&&this.handleUserBanned(r)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(He.UID_BANNED);break;case 15:this.close(He.IP_BANNED);break;case 16:this.close(He.CHANNEL_BANNED)}}constructor(t,n){super(),w(this,"__name__","DataChannelSignal"),w(this,"_disconnectedReason",void 0),w(this,"_websocketReconnectReason",void 0),w(this,"_connectionState",Ge.CLOSED),w(this,"reconnectToken",void 0),w(this,"websocket",void 0),w(this,"openConnectionTime",void 0),w(this,"clientId",void 0),w(this,"lastMsgTime",Date.now()),w(this,"uploadCache",[]),w(this,"uploadCacheInterval",void 0),w(this,"rttRolling",new Yb(5)),w(this,"pingpongTimer",void 0),w(this,"inflateDataTimer",void 0),w(this,"pingpongTimeoutCount",0),w(this,"ortc",void 0),w(this,"joinResponse",void 0),w(this,"multiIpOption",void 0),w(this,"initError",void 0),w(this,"spec",void 0),w(this,"store",void 0),w(this,"isJoining",!1),w(this,"pendingNotifications",[]),w(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(pe.ON_BINARY_DATA,r);let i=JSON.parse(r);if(D("DC_DEBUG_LOG")&&S.debug("[datachannel-signal] received packet",i),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let c="res-@".concat(i._id);this.emit(c,i._result,i._message)}else Object.prototype.hasOwnProperty.call(i,"_type")&&(this.isJoining?i._type===Ie.ON_NOTIFICATION||i._type===Ie.ON_USER_BANNED?(this.emit(i._type,i._message),i._type===Ie.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ie.ON_USER_BANNED&&this.handleUserBanned(i._message)):(this.pendingNotifications.push({type:i._type,message:i._message}),S.debug("[".concat(this.clientId,"] cached notification during join: ").concat(i._type))):(this.emit(i._type,i._message),i._type===Ie.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ie.ON_USER_BANNED&&this.handleUserBanned(i._message)))}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new oW("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ge.CONNECTED&&this.reconnect("retry",Tc.OFFLINE)})}request(t,n,r,i){return O(this,null,function*(){let c=at(6,""),l={_id:c,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new ie((A,C)=>{if(this.connectionState===Ge.CONNECTED)return A();let I=()=>{this.off(pe.WS_CLOSED,N),A()},N=()=>{this.off(pe.WS_CONNECTED,I),C(new G(P.WS_ABORT))};this.once(pe.WS_CONNECTED,I),this.once(pe.WS_CLOSED,N),t!==fe.PUBLISH&&t!==fe.SUBSCRIBE&&t!==fe.UNSUBSCRIBE&&t!==fe.UNPUBLISH&&t!==fe.CONTROL&&t!==fe.RESTART_ICE||this.once(pe.DISCONNECT_P2P,()=>{C(new G(P.DISCONNECT_P2P))}),t!==fe.PUBLISH&&t!==fe.RESTART_ICE||this.once(pe.ABORT_P2P_EXECUTION,()=>{C(new G(P.DISCONNECT_P2P))})});if(this.connectionState!==Ge.CONNECTING&&this.connectionState!==Ge.RECONNECTING||t===fe.JOIN||t===fe.REJOIN||(yield h()),t===fe.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),D("DC_DEBUG_LOG")&&S.debug("[datachannel-signal] sendMessage",l),yield this.websocket.sendMessage(l,!0,!1),i)return;let f=new ie((A,C)=>{let I=!1,N=(M,V)=>{I=!0,A({isSuccess:M==="success",message:V||{}}),this.off(pe.WS_CLOSED,L),this.off(pe.WS_RECONNECTING,L),this.emit(pe.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),N);let L=()=>{C(new G(P.WS_ABORT,"type: ".concat(t))),this.off(pe.WS_CLOSED,L),this.off(pe.WS_RECONNECTING,L),this.off("res-@".concat(c),N)};this.once(pe.WS_CLOSED,L),this.once(pe.WS_RECONNECTING,L),Tn(D("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||I||(S.warning("dc request timeout, type: ".concat(t)),this.emit(pe.REQUEST_TIMEOUT,t,n))})}),m=null;try{m=yield f}catch(A){if(this.connectionState===Ge.CLOSED||t===fe.LEAVE)throw new G(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?A.throw():t===fe.JOIN||t===fe.REJOIN?null:(yield h(),yield this.request(t,n))}if(m.isSuccess)return m.message;let E=Number(m.message.error_code||m.message.code),_=Hd(E),y=new G(P.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(m.message.error_str),{code:E,data:m.message});return _.action==="success"?m.message:(S.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(_.desc,", action: ").concat(_.action)),E===_e.ERR_TOO_MANY_BROADCASTERS?((t===fe.JOIN||t===fe.REJOIN)&&(this.initError=y,this.close()),y.throw()):_.action==="failed"?y.throw():_.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===_e.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Tc.MULTI_IP)):this.reconnect(_.action,Tc.SERVER_ERROR),t===fe.JOIN||t===fe.REJOIN?null:yield this.request(t,n)))})}waitMessage(t,n){return new ie(r=>{let i=c=>{(!n||n(c))&&(this.off(t,i),r(c))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Bd.WRTC_STATS,n)}upload(t,n){let r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{let c=D("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ge.CONNECTED)return;let l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},D("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){return O(this,null,function*(){let r={_type:t,_message:n};yield this.websocket.sendMessage(r)})}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((n,r)=>{this.once(pe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(pe.WS_CLOSED,()=>r(this.initError||new G(P.WS_ABORT))),this.connectionState=Ge.CONNECTING,this.websocket.init(t).catch(r),this.websocket.once(En.FAILBACK,()=>{r(new G(P.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(S.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new G(P.INIT_DATACHANNEL_TIMEOUT)))},D("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||He.LEAVE,this.connectionState=Ge.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===He.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new oW("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){return O(this,null,function*(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),D("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(pe.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=yield hn(this,pe.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];let n=yield this.request(fe.JOIN,t);if(this.store.joinRep(),this.ortc=t?.ortc,!n)return this.emit(pe.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(pe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ge.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0})}rejoin(){return O(this,null,function*(){if(!this.reconnectToken)throw new G(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=wd(this,pe.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let n=yield this.request(fe.REJOIN,t);return!!n&&(this.connectionState=Ge.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),D("DC_PINGPONG_INTERVAL")),n.peers&&n.peers.forEach(r=>{this.emit(Ie.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ie.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ie.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ie.MUTE_AUDIO,{uid:r.uid}):this.emit(Ie.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ie.MUTE_VIDEO,{uid:r.uid}):this.emit(Ie.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ie.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ie.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ie.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ie.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ie.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)})}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}downgradeCodec(t){return O(this,null,function*(){if(!this.ortc)return!1;let n={downgrade_codec:t,ortc:this.ortc};return!!(yield this.request(fe.DOWNGRADE_CODEC,n))})}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);let n=Hd(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(He.UID_BANNED),void this.close()):void this.reconnect(n.action,Tc.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,D("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));let t=D("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(S.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>D("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",Tc.FALLBACK):this.request(fe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-n;this.rttRolling.add(r),D("REPORT_STATS")&&this.send(fe.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){let{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(Bd.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(En.RECONNECT_CREATE_CONNECTION,t=>{this.emit(pe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(En.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(En.CLOSED,()=>{this.connectionState=Ge.CLOSED}),this.websocket.on(En.FAILED,()=>{this._disconnectedReason=He.NETWORK_ERROR,this.connectionState=Ge.CLOSED}),this.websocket.on(En.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Ge.CONNECTED?this.connectionState=Ge.RECONNECTING:this.connectionState=Ge.CONNECTING}),this.websocket.on(En.WILL_RECONNECT,(t,n)=>{if(wd(this,pe.IS_P2P_DISCONNECTED)&&t==="retry")return S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(pe.NEED_RENEW_SESSION),this.emit(pe.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(S.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(pe.NEED_RENEW_SESSION),this.emit(pe.DISCONNECT_P2P)),n(t)}),this.websocket.on(En.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Tc.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(pe.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof G&&t.code===P.UNEXPECTED_RESPONSE&&t.data.code===_e.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Tc.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Tc.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(En.REQUEST_NEW_URLS,(t,n)=>{hn(this,pe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ie.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(En.TO_CONNECT_DATACHANNEL,(t,n)=>{hn(this,pe.PRE_CONNECT_PC).then(t).catch(n)}),this.websocket.on(En.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(pe.DATACHANNEL_FAILBACK)})}}let gue={name:"DataChannelConnection",create:function(e){let{store:t,spec:n}=e;return new hue(n,t)}},_ue={name:"DataChannelSignal",create:function(e){let{store:t,spec:n}=e;return new mue(n,t)}};ew(),ft("PROCESS_ID","process-".concat(at(8,""),"-").concat(at(4,""),"-").concat(at(4,""),"-").concat(at(4,""),"-").concat(at(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void S.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),n=Date.now();S.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(ct,r)){let{value:i,expires:c}=t[r];if(c&&c<=n)return;yi[r]=i,ct[r]=i}})}catch(t){S.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(yi.AREAS)&&yi.AREAS.length>0&&t0(yi.AREAS,!0);let sW=(e,t,n)=>{S.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),ft(e,t,n)};Vs(Lle,!1),Vs(xle,!1),Vs(hde,!1),Vs(Kle,!1),Vs(Ole,!1),Vs(oue,!1),Vs(cue,!1),Vs(lue,!1),Vs(gue,!1),Vs(_ue,!1);let pn=(function(e){let t=new jt,n=e,r={getListeners:t.getListeners.bind(t),on:(i,c)=>((function(l,u){l===xs.SECURITY_POLICY_VIOLATION&&x3(u,!0)})(i,c),t.on.bind(t)(i,c)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return M3(M3({},n),r)})({__TRACK_LIST__:Ld,VERSION:Vi,BUILD:rw,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:sW,getParameter:D,getSupportedCodec:function(){return O(this,null,function*(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,n=yield(function(r){return O(this,null,function*(){let i;return Ve().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(yield r.createOffer()).sdp):i=(yield r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i})})(t);if(!n)return e;t.close(),t=null,e=(function(r){let i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i})(n)}catch(t){throw new G(P.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e})},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=ue.reportApiInvoke(null,{name:Mt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:St.TRACER}),n=(function(){let c=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],l=!1;try{let u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;l=!(!u||!f),c&&!h&&(l=!1),l&&Tf()&&zF(75)&&new u().close()}catch(u){S.error("check system requirement failed: ",u),l=!1}return l})(e),r=fde();S.debug("checkSystemRequirements, api:",n,"browser",r);let i=n&&r;return t.onSuccess(i),D("IGNORE_RTC_DEVICE_CHECK")?n:i},getDevices:function(e){return Ii.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Ii.getRecordingDevices(e)},getCameras:function(e){return Ii.getCamerasDevices(e)},getElectronScreenSources:J2,getPlaybackDevices:function(e){return Ii.getSpeakers(e)},createClient:P3,createCameraVideoTrack:function(){return O(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=D("CAMERA_CAPTURE_CONFIG"),n=at(8,"track-cam-"),r=ue.reportApiInvoke(null,{id:n,tag:St.TRACER,name:Mt.CREATE_CAM_VIDEO_TRACK,options:[Dt({},e),t]});t&&(e.encoderConfig=t);let i=XE(e),c=null;S.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{c=(yield Ri({video:i},n)).getVideoTracks()[0]||null}catch(u){throw r.onError(u),u}if(!c){let u=new z(P.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(u),u.throw(S)}if(e.optimizationMode&&Tw(n,c,e,To(e.encoderConfig)),D("USE_STANDARD_BITRATE_DEFAULT")){let u=To(e.encoderConfig);e.encoderConfig=u,delete u.bitrateMax,delete u.bitrateMin}let l=new JE(c,e,i,e.scalabiltyMode?zE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(l.getTrackId()),S.info("create camera video success, trackId:",n),l})},createCustomVideoTrack:function(e){let t=at(8,"track-cus-"),n=ue.reportApiInvoke(null,{id:t,tag:St.TRACER,name:Mt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});D("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);let r=new Tt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?zE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[ot.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),S.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:function(){return O(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",n=typeof t=="object"?(function(_){let y=aV(_);return j2()&&_.suppressLocalAudioPlayback&&(y.suppressLocalAudioPlayback=_.suppressLocalAudioPlayback),B2()&&_.restrictOwnAudio&&(y.restrictOwnAudio=!0),y})(t):void 0;n&&(t="auto");let r=at(8,"track-scr-v-"),i=ue.reportApiInvoke(null,{id:r,tag:St.TRACER,name:Mt.CREATE_SCREEN_VIDEO_TRACK,options:[Dt({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let c=(function(_){let y={};_.screenSourceType&&(y.mediaSource=_.screenSourceType),_.extensionId&&va()&&(y.extensionId=_.extensionId);let{displaySurface:A,selfBrowserSurface:C,surfaceSwitching:I,systemAudio:N,preferCurrentTab:L,windowAudio:M,monitorTypeSurfaces:V}=_;(Os(107)||Cd(107)||Rd(93))&&(A&&(an(A,"displaySurface",["browser","window","monitor"]),y.displaySurface=A),C?(an(C,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=C):y.selfBrowserSurface="include",I&&(an(I,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=I)),(Os(105)||Cd(105)||Rd(91))&&N&&(an(N,"systemAudio",["exclude","include"]),y.systemAudio=N),(Os(94)||Cd(94)||Rd(80))&&L&&(y.preferCurrentTab=!0),(Os(141)||Cd(141)||Rd(125))&&M&&(an(M,"windowAudio",["exclude","system"]),y.windowAudio=M),(Os(119)||Cd(119)||Rd(105))&&V&&(an(V,"monitorTypeSurfaces",["exclude","include"]),y.monitorTypeSurfaces=V),_.electronScreenSourceId&&(y.sourceId=_.electronScreenSourceId);let j=_.encoderConfig?dw(_.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:j?j.width:void 0,maxHeight:j?j.height:void 0},j&&(j.frameRate&&(typeof j.frameRate=="number"?(y.mandatory.maxFrameRate=j.frameRate,y.mandatory.minFrameRate=j.frameRate):(y.mandatory.maxFrameRate=j.frameRate.max||j.frameRate.ideal||j.frameRate.exact||void 0,y.mandatory.minFrameRate=j.frameRate.min||j.frameRate.ideal||j.frameRate.exact||void 0),y.frameRate=j.frameRate),j.width&&(y.width=j.width),j.height&&(y.height=j.height)),y})(e),l=null,u=null,h=Ve();if(!h.supportShareAudio&&t==="enable"){let _=new z(P.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(_),_.throw(S)}S.info("start create screen video track with config",e,"withAudio",t,"trackId",r);let f=h.supportShareAudio&&t!=="disable";try{let _=yield Ri({screen:c,screenAudio:f?n||!0:void 0},r);l=_.getVideoTracks()[0]||null,u=_.getAudioTracks()[0]||null}catch(_){throw i.onError(_),_}if(!l){let _=new z(P.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(_),_.throw(S)}if(!u&&t==="enable"){l&&l.stop();let _=new z(P.SHARE_AUDIO_NOT_ALLOWED);return i.onError(_),_.throw(S)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Tw(r,l,e,e.encoderConfig&&dw(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let m=new Tt(l,e.encoderConfig?dw(e.encoderConfig):{},e.scalabiltyMode?zE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[ot.SCREEN_TRACK]);if(!u)return i.onSuccess(m.getTrackId()),S.info("create screen video track success","video:",m.getTrackId()),m;let E=new $t(u,void 0,at(8,"track-scr-a-"),!1);return i.onSuccess([m.getTrackId(),E.getTrackId()]),S.info("create screen video track success","video:",m.getTrackId(),"audio:",E.getTrackId()),[m,E]})},createMicrophoneAndCameraTracks:function(){return O(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=D("CAMERA_CAPTURE_CONFIG"),r=at(8,"track-mic-"),i=at(8,"track-cam-"),c=ue.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:St.TRACER,name:Mt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);let l=XE(t),u=cV(e),h=null,f=null;S.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let _=yield Ri({audio:u,video:l},"".concat(r,"-").concat(i));h=_.getAudioTracks()[0],f=_.getVideoTracks()[0]}catch(_){throw c.onError(_),_}if(!h||!f){let _=new z(P.UNEXPECTED_ERROR,"can not find tracks in media stream");return c.onError(_),_.throw(S)}if(t.optimizationMode&&Tw(i,f,t,To(t.encoderConfig)),D("USE_STANDARD_BITRATE_DEFAULT")){let _=To(t.encoderConfig);t.encoderConfig=_,delete _.bitrateMax,delete _.bitrateMin}let m=new Pf(h,e,u,r),E=new JE(f,t,l,t.scalabiltyMode?zE(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return c.onSuccess([m.getTrackId(),E.getTrackId()]),S.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[m,E]})},createMicrophoneAudioTrack:function(){return O(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=at(8,"track-mic-"),n=ue.reportApiInvoke(null,{id:t,tag:St.TRACER,name:Mt.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=cV(e),i=null;S.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(yield Ri({audio:r},t)).getAudioTracks()[0]||null}catch(l){throw n.onError(l),l}if(!i){let l=new z(P.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(l),l.throw(S)}let c=new Pf(i,e,r,t);return n.onSuccess(c.getTrackId()),S.info("create microphone audio track success, trackId:",t),c})},createCustomAudioTrack:kj,createBufferSourceAudioTrack:function(e){return O(this,null,function*(){var t;let{cacheOnlineFile:n,encoderConfig:r}=e,{source:i}=e,c={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},l=at(8,"track-buf-"),u=ue.reportApiInvoke(null,{id:l,tag:St.TRACER,name:Mt.CREATE_BUFFER_AUDIO_TRACK,options:[c]});if(D("DISABLE_WEBAUDIO"))throw new z(P.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");S.info("start create buffer source audio track with config",JSON.stringify(c),"trackId",l);let h=i;if(!(i instanceof AudioBuffer))try{i=yield(function(E,_){return O(this,null,function*(){let y=null;if(typeof E=="string"){let C=$V.get(E);if(C)return S.debug("use cached audio resource: ",E),C;try{y=(yield Yo(()=>Lr.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(I){throw new z(P.FETCH_AUDIO_FILE_FAILED,I.toString())}}else y=yield new ie((I,N)=>{let L=new FileReader;L.onload=M=>{M.target?I(M.target.result):N(new z(P.READ_LOCAL_AUDIO_FILE_ERROR))},L.onerror=()=>{N(new z(P.READ_LOCAL_AUDIO_FILE_ERROR))},L.readAsArrayBuffer(E)});let A=yield(function(C){let I=$u();return new ie((N,L)=>{I.decodeAudioData(C,M=>{N(M)},M=>{L(new z(P.DECODE_AUDIO_FILE_FAILED,M.toString()))})})})(y);return typeof E=="string"&&_&&$V.set(E,A),A})})(i,n)}catch(E){return u.onError(E),E.throw(S)}let f=new Lae(i),m=new Pae(h,f,r?KE(r):{},l);return S.info("create buffer source audio track success, trackId:",l),u.onSuccess(m.getTrackId()),m})},setAppType:function(e){if(S.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw S.debug("Invalid appType"),new G(P.INVALID_PARAMS,"invalid app type",e);ft("APP_TYPE",Math.floor(e))},setLogLevel:function(e){S.setLogLevel(e)},enableLogUpload:function(){D("USE_NEW_LOG")?ft("UPLOAD_LOG",!0):S.enableLogUpload()},disableLogUpload:function(){D("USE_NEW_LOG")?ft("UPLOAD_LOG",!1):S.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new ZB},checkAudioTrackIsActive:function(t){return O(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=ue.reportApiInvoke(null,{tag:St.TRACER,name:Mt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof $t||e instanceof Qu)){let f=new G(P.INVALID_TRACK,"the parameter is not a audio track");return r.onError(f),f.throw()}n&&n<1e3&&(n=1e3);let i=e instanceof $t?e.getTrackLabel():"remote_track",c=e.getVolumeLevel(),l=c,u=c,h=Date.now();return new ie(f=>{let m=setInterval(()=>{let E=e.getVolumeLevel();l=E>l?E:l,u=E<u?E:u;let _=l-u>1e-4,y=Date.now()-h;if(_||y>n){clearInterval(m);let A=_,C={duration:y,deviceLabel:i,maxVolumeLevel:l,result:A};S.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(C))),r.onSuccess(C),f(A)}},200)})})},checkVideoTrackIsActive:function(t){return O(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=ue.reportApiInvoke(null,{tag:St.TRACER,name:Mt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof Tt||e instanceof Zu)){let _=new G(P.INVALID_TRACK,"the parameter is not a video track");return r.onError(_),_.throw()}n&&n<1e3&&(n=1e3);let i=e instanceof Tt?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(An()||kE())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([c]),l.play();let u=document.createElement("canvas");u.width=160,u.height=120;let h=0,f=0;try{let _=Date.now();h=yield(function(y,A,C,I){let N,L=0,M=null;return new ie((V,j)=>{function U(){L>I&&N&&(N(),V(L));let H=C.getContext("2d");if(!H){let ae=new G(P.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(ae.toString()),void j(ae)}H.drawImage(y,0,0,160,120);let K=H.getImageData(0,0,C.width,C.height),Y=Math.floor(K.data.length/3);if(M){for(let ae=0;ae<Y;ae+=3)if(K.data[ae]!==M[ae])return L+=1,void(M=K.data);M=K.data}else M=K.data}setTimeout(()=>{N&&(N(),V(L))},A),N=mw(()=>{U()},30)})})(l,n,u,4),f=Date.now()-_}catch(_){throw r.onError(_),_}Zce===Qe.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;let m=h>4,E={duration:f,changedPicNum:h,deviceLabel:i,result:m};return S.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),r.onSuccess(E),m})},setArea:t0,audioElementPlayCenter:cr,resumeAudioContext:function(){return cr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){gde.processExternalMediaAEC(e)},registerExtensions:function(e){let t=D("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!J(t).call(t,n.name)&&t.push(n.name);let r=n;r.__registered__=!0,r.logger.hookLog=S.extLog,r.reporter.hookApiInvoke=ue.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=D(i)})}),sW("PLUGIN_INFO",t)},ChannelMediaRelayError:nh,ChannelMediaRelayEvent:Ta,ChannelMediaRelayState:Yr,RemoteStreamFallbackType:bae,RemoteStreamType:Iae,ConnectionDisconnectedReason:He,AudienceLatencyLevelType:eae,AREAS:nt,preload:function(e,t,n,r){return O(this,null,function*(){return C0(e,t,n,r)})},startLastmileProbeTest:function(e,t,n,r){return O(this,null,function*(){let i={state:"unavailable"};yield C0(e,t,n,r);let c=yield R0({appId:e,cname:t,token:n||e,uid:r,cloudProxyServer:"disabled"});if(!c)return i;yield I0(c);let l,u=P3({mode:"rtc",codec:"vp8"});try{l=yield u.join(e,t,n,r,{networkQualityProbe:!0})}catch{return i}let h=new nde,f=h.createMuteAudioTrack(),m=yield kj({mediaStreamTrack:f});yield u.publish([m]);let[E,_,y]=yield new ie((M,V)=>{let j=setTimeout(()=>{clearTimeout(j),M([!0,null,"audio"])},5e3);u.on("user-published",(U,H)=>O(null,null,function*(){U.uid===l&&(clearTimeout(j),M([!1,U,H]))}))});if(E||!_)return yield u.unpublish([m]),yield u.leave(),m.close(),h.close(),i;yield u.subscribe(_,y),yield new ie((M,V)=>{let j=setTimeout(()=>{clearTimeout(j),M(null)},5e3)});let A=u.getRTCStats(),C=u.getLocalAudioStats(),I=A.RTT,N=C.sendJitterMs,L=C.currentPacketLossRate;return i={state:"complete",rtt:I,packetLossRate:L,jitter:N,networkQuality:((M,V,j)=>{let U=1;if(j>0){let Ce=Math.log(100*j)/Math.log(2)+1;Ce=Math.min(5,Math.max(0,Ce)),U=1-Ce/5}let H=1;if(M>0){let Ce=Math.log(M/40)/Math.log(2)+1;Ce=Math.min(5,Math.max(0,Ce)),H=1-Ce/5}let K=1;if(V>0){let Ce=Math.log(V/10)/Math.log(2.5)+1;Ce=Math.min(5,Math.max(0,Ce)),K=1-Ce/5}let Y=.5*U+.3*H+.2*K,ae=0;return ae=Y>=.8?1:Y>=.6?2:Y>=.4?3:Y>=.2?4:5,ae})(I,N,L)},yield u.unsubscribe(_),yield u.unpublish([m]),yield u.leave(),m.close(),h.close(),yield I0(c),i})}});return Object.defineProperties(pn,{onAudioAutoplayFailed:{get:()=>Mr.onAudioAutoplayFailed,set:e=>{Mr.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Mr.onAutoplayFailed,set:e=>{Mr.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>pn._onSecurityPolicyViolation,set(e){pn._onSecurityPolicyViolation=e,x3(e)}},__CLIENT_LIST__:{get:()=>D("SHOW_GLOBAL_CLIENT_LIST")?Vd:[]}}),Ii.on(Md.CAMERA_DEVICE_CHANGED,e=>{S.info("camera device changed",JSON.stringify(e)),pn.onCameraChanged&&pn.onCameraChanged(e),pn.safeEmit(xs.CAMERA_CHANGED,e)}),Ii.on(Md.RECORDING_DEVICE_CHANGED,e=>{S.info("microphone device changed",JSON.stringify(e)),pn.onMicrophoneChanged&&pn.onMicrophoneChanged(e),pn.safeEmit(xs.MICROPHONE_CHANGED,e)}),Ii.on(Md.PLAYOUT_DEVICE_CHANGED,e=>{S.debug("playout device changed",JSON.stringify(e)),pn.onPlaybackDeviceChanged&&pn.onPlaybackDeviceChanged(e),pn.safeEmit(xs.PLAYBACK_DEVICE_CHANGED,e)}),cr.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),Mr.onAudioAutoplayFailed&&Mr.onAudioAutoplayFailed()},mt.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),Mr.onAudioAutoplayFailed&&Mr.onAudioAutoplayFailed(),pn.safeEmit(xs.AUTOPLAY_FAILED)}),mt.on(Fn.STATE_CHANGE,(e,t)=>{S.info("audio context state changed: ".concat(t," => ").concat(e)),pn.onAudioContextStateChanged&&pn.onAudioContextStateChanged(e,t),pn.safeEmit(xs.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),zt.on(bd.NETWORK_STATE_CHANGE,(e,t)=>{S.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=pn),pn})});var cA;function ry(){return cA}function $s(o){let s=cA;return cA=o,s}var fW=Symbol("NotFound");function bh(o){return o===fW||o?.name==="\u0275NotFound"}var Qr=null,iy=!1,dA=1,Aue=null,ei=Symbol("SIGNAL");function lt(o){let s=Qr;return Qr=o,s}function cy(){return Qr}var wh={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Ah(o){if(iy)throw new Error("");if(Qr===null)return;Qr.consumerOnSignalRead(o);let s=Qr.producersTail;if(s!==void 0&&s.producer===o)return;let a,d=Qr.recomputing;if(d&&(a=s!==void 0?s.nextProducer:Qr.producers,a!==void 0&&a.producer===o)){Qr.producersTail=a,a.lastReadVersion=o.version;return}let p=o.consumersTail;if(p!==void 0&&p.consumer===Qr&&(!d||Oue(p,Qr)))return;let g=Oh(Qr),v={producer:o,consumer:Qr,nextProducer:a,prevConsumer:p,lastReadVersion:o.version,nextConsumer:void 0};Qr.producersTail=v,s!==void 0?s.nextProducer=v:Qr.producers=v,g&&EW(o,v)}function mW(){dA++}function dy(o){if(!(Oh(o)&&!o.dirty)&&!(!o.dirty&&o.lastCleanEpoch===dA)){if(!o.producerMustRecompute(o)&&!gm(o)){ay(o);return}o.producerRecomputeValue(o),ay(o)}}function lA(o){if(o.consumers===void 0)return;let s=iy;iy=!0;try{for(let a=o.consumers;a!==void 0;a=a.nextConsumer){let d=a.consumer;d.dirty||Due(d)}}finally{iy=s}}function uA(){return Qr?.consumerAllowSignalWrites!==!1}function Due(o){o.dirty=!0,lA(o),o.consumerMarkedDirty?.(o)}function ay(o){o.dirty=!1,o.lastCleanEpoch=dA}function Dh(o){return o&&gW(o),lt(o)}function gW(o){o.producersTail=void 0,o.recomputing=!0}function mm(o,s){lt(s),o&&_W(o)}function _W(o){o.recomputing=!1;let s=o.producersTail,a=s!==void 0?s.nextProducer:o.producers;if(a!==void 0){if(Oh(o))do a=hA(a);while(a!==void 0);s!==void 0?s.nextProducer=void 0:o.producers=void 0}}function gm(o){for(let s=o.producers;s!==void 0;s=s.nextProducer){let a=s.producer,d=s.lastReadVersion;if(d!==a.version||(dy(a),d!==a.version))return!0}return!1}function _m(o){if(Oh(o)){let s=o.producers;for(;s!==void 0;)s=hA(s)}o.producers=void 0,o.producersTail=void 0,o.consumers=void 0,o.consumersTail=void 0}function EW(o,s){let a=o.consumersTail,d=Oh(o);if(a!==void 0?(s.nextConsumer=a.nextConsumer,a.nextConsumer=s):(s.nextConsumer=void 0,o.consumers=s),s.prevConsumer=a,o.consumersTail=s,!d)for(let p=o.producers;p!==void 0;p=p.nextProducer)EW(p.producer,p)}function hA(o){let s=o.producer,a=o.nextProducer,d=o.nextConsumer,p=o.prevConsumer;if(o.nextConsumer=void 0,o.prevConsumer=void 0,d!==void 0?d.prevConsumer=p:s.consumersTail=p,p!==void 0)p.nextConsumer=d;else if(s.consumers=d,!Oh(s)){let g=s.producers;for(;g!==void 0;)g=hA(g)}return a}function Oh(o){return o.consumerIsAlwaysLive||o.consumers!==void 0}function ly(o){Aue?.(o)}function Oue(o,s){let a=s.producersTail;if(a!==void 0){let d=s.producers;do{if(d===o)return!0;if(d===a)break;d=d.nextProducer}while(d!==void 0)}return!1}function uy(o,s){return Object.is(o,s)}function hy(o,s){let a=Object.create(Nue);a.computation=o,s!==void 0&&(a.equal=s);let d=()=>{if(dy(a),Ah(a),a.value===fm)throw a.error;return a.value};return d[ei]=a,ly(a),d}var oy=Symbol("UNSET"),sy=Symbol("COMPUTING"),fm=Symbol("ERRORED"),Nue=gt(Ee({},wh),{value:oy,dirty:!0,error:null,equal:uy,kind:"computed",producerMustRecompute(o){return o.value===oy||o.value===sy},producerRecomputeValue(o){if(o.value===sy)throw new Error("");let s=o.value;o.value=sy;let a=Dh(o),d,p=!1;try{d=o.computation(),lt(null),p=s!==oy&&s!==fm&&d!==fm&&o.equal(s,d)}catch(g){d=fm,o.error=g}finally{mm(o,a)}if(p){o.value=s;return}o.value=d,o.version++}});function Pue(){throw new Error}var vW=Pue;function yW(o){vW(o)}function pA(o){vW=o}var Lue=null;function fA(o,s){let a=Object.create(py);a.value=o,s!==void 0&&(a.equal=s);let d=()=>SW(a);return d[ei]=a,ly(a),[d,v=>Nh(a,v),v=>mA(a,v)]}function SW(o){return Ah(o),o.value}function Nh(o,s){uA()||yW(o),o.equal(o.value,s)||(o.value=s,kue(o))}function mA(o,s){uA()||yW(o),Nh(o,s(o.value))}var py=gt(Ee({},wh),{equal:uy,value:void 0,kind:"signal"});function kue(o){o.version++,mW(),lA(o),Lue?.(o)}function _t(o){return typeof o=="function"}function Ph(o){let a=o(d=>{Error.call(d),d.stack=new Error().stack});return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}var fy=Ph(o=>function(a){o(this),this.message=a?`${a.length} errors occurred during unsubscription:
${a.map((d,p)=>`${p+1}) ${d.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=a});function Em(o,s){if(o){let a=o.indexOf(s);0<=a&&o.splice(a,1)}}var rr=class o{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;let{_parentage:a}=this;if(a)if(this._parentage=null,Array.isArray(a))for(let g of a)g.remove(this);else a.remove(this);let{initialTeardown:d}=this;if(_t(d))try{d()}catch(g){s=g instanceof fy?g.errors:[g]}let{_finalizers:p}=this;if(p){this._finalizers=null;for(let g of p)try{TW(g)}catch(v){s=s??[],v instanceof fy?s=[...s,...v.errors]:s.push(v)}}if(s)throw new fy(s)}}add(s){var a;if(s&&s!==this)if(this.closed)TW(s);else{if(s instanceof o){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=(a=this._finalizers)!==null&&a!==void 0?a:[]).push(s)}}_hasParent(s){let{_parentage:a}=this;return a===s||Array.isArray(a)&&a.includes(s)}_addParent(s){let{_parentage:a}=this;this._parentage=Array.isArray(a)?(a.push(s),a):a?[a,s]:s}_removeParent(s){let{_parentage:a}=this;a===s?this._parentage=null:Array.isArray(a)&&Em(a,s)}remove(s){let{_finalizers:a}=this;a&&Em(a,s),s instanceof o&&s._removeParent(this)}};rr.EMPTY=(()=>{let o=new rr;return o.closed=!0,o})();var gA=rr.EMPTY;function my(o){return o instanceof rr||o&&"closed"in o&&_t(o.remove)&&_t(o.add)&&_t(o.unsubscribe)}function TW(o){_t(o)?o():o.unsubscribe()}var ls={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Lh={setTimeout(o,s,...a){let{delegate:d}=Lh;return d?.setTimeout?d.setTimeout(o,s,...a):setTimeout(o,s,...a)},clearTimeout(o){let{delegate:s}=Lh;return(s?.clearTimeout||clearTimeout)(o)},delegate:void 0};function gy(o){Lh.setTimeout(()=>{let{onUnhandledError:s}=ls;if(s)s(o);else throw o})}function vm(){}var CW=_A("C",void 0,void 0);function RW(o){return _A("E",void 0,o)}function IW(o){return _A("N",o,void 0)}function _A(o,s,a){return{kind:o,value:s,error:a}}var sl=null;function kh(o){if(ls.useDeprecatedSynchronousErrorHandling){let s=!sl;if(s&&(sl={errorThrown:!1,error:null}),o(),s){let{errorThrown:a,error:d}=sl;if(sl=null,a)throw d}}else o()}function bW(o){ls.useDeprecatedSynchronousErrorHandling&&sl&&(sl.errorThrown=!0,sl.error=o)}var al=class extends rr{constructor(s){super(),this.isStopped=!1,s?(this.destination=s,my(s)&&s.add(this)):this.destination=Uue}static create(s,a,d){return new Mh(s,a,d)}next(s){this.isStopped?vA(IW(s),this):this._next(s)}error(s){this.isStopped?vA(RW(s),this):(this.isStopped=!0,this._error(s))}complete(){this.isStopped?vA(CW,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(s){this.destination.next(s)}_error(s){try{this.destination.error(s)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Mue=Function.prototype.bind;function EA(o,s){return Mue.call(o,s)}var yA=class{constructor(s){this.partialObserver=s}next(s){let{partialObserver:a}=this;if(a.next)try{a.next(s)}catch(d){_y(d)}}error(s){let{partialObserver:a}=this;if(a.error)try{a.error(s)}catch(d){_y(d)}else _y(s)}complete(){let{partialObserver:s}=this;if(s.complete)try{s.complete()}catch(a){_y(a)}}},Mh=class extends al{constructor(s,a,d){super();let p;if(_t(s)||!s)p={next:s??void 0,error:a??void 0,complete:d??void 0};else{let g;this&&ls.useDeprecatedNextContext?(g=Object.create(s),g.unsubscribe=()=>this.unsubscribe(),p={next:s.next&&EA(s.next,g),error:s.error&&EA(s.error,g),complete:s.complete&&EA(s.complete,g)}):p=s}this.destination=new yA(p)}};function _y(o){ls.useDeprecatedSynchronousErrorHandling?bW(o):gy(o)}function xue(o){throw o}function vA(o,s){let{onStoppedNotification:a}=ls;a&&Lh.setTimeout(()=>a(o,s))}var Uue={closed:!0,next:vm,error:xue,complete:vm};var xh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function $i(o){return o}function SA(...o){return TA(o)}function TA(o){return o.length===0?$i:o.length===1?o[0]:function(a){return o.reduce((d,p)=>p(d),a)}}var Ft=(()=>{class o{constructor(a){a&&(this._subscribe=a)}lift(a){let d=new o;return d.source=this,d.operator=a,d}subscribe(a,d,p){let g=Vue(a)?a:new Mh(a,d,p);return kh(()=>{let{operator:v,source:T}=this;g.add(v?v.call(g,T):T?this._subscribe(g):this._trySubscribe(g))}),g}_trySubscribe(a){try{return this._subscribe(a)}catch(d){a.error(d)}}forEach(a,d){return d=wW(d),new d((p,g)=>{let v=new Mh({next:T=>{try{a(T)}catch(b){g(b),v.unsubscribe()}},error:g,complete:p});this.subscribe(v)})}_subscribe(a){var d;return(d=this.source)===null||d===void 0?void 0:d.subscribe(a)}[xh](){return this}pipe(...a){return TA(a)(this)}toPromise(a){return a=wW(a),new a((d,p)=>{let g;this.subscribe(v=>g=v,v=>p(v),()=>d(g))})}}return o.create=s=>new o(s),o})();function wW(o){var s;return(s=o??ls.Promise)!==null&&s!==void 0?s:Promise}function Fue(o){return o&&_t(o.next)&&_t(o.error)&&_t(o.complete)}function Vue(o){return o&&o instanceof al||Fue(o)&&my(o)}function CA(o){return _t(o?.lift)}function Wt(o){return s=>{if(CA(s))return s.lift(function(a){try{return o(a,this)}catch(d){this.error(d)}});throw new TypeError("Unable to lift unknown Observable type")}}function Bt(o,s,a,d,p){return new RA(o,s,a,d,p)}var RA=class extends al{constructor(s,a,d,p,g,v){super(s),this.onFinalize=g,this.shouldUnsubscribe=v,this._next=a?function(T){try{a(T)}catch(b){s.error(b)}}:super._next,this._error=p?function(T){try{p(T)}catch(b){s.error(b)}finally{this.unsubscribe()}}:super._error,this._complete=d?function(){try{d()}catch(T){s.error(T)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var s;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:a}=this;super.unsubscribe(),!a&&((s=this.onFinalize)===null||s===void 0||s.call(this))}}};function Uh(){return Wt((o,s)=>{let a=null;o._refCount++;let d=Bt(s,void 0,void 0,void 0,()=>{if(!o||o._refCount<=0||0<--o._refCount){a=null;return}let p=o._connection,g=a;a=null,p&&(!g||p===g)&&p.unsubscribe(),s.unsubscribe()});o.subscribe(d),d.closed||(a=o.connect())})}var Fh=class extends Ft{constructor(s,a){super(),this.source=s,this.subjectFactory=a,this._subject=null,this._refCount=0,this._connection=null,CA(s)&&(this.lift=s.lift)}_subscribe(s){return this.getSubject().subscribe(s)}getSubject(){let s=this._subject;return(!s||s.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:s}=this;this._subject=this._connection=null,s?.unsubscribe()}connect(){let s=this._connection;if(!s){s=this._connection=new rr;let a=this.getSubject();s.add(this.source.subscribe(Bt(a,void 0,()=>{this._teardown(),a.complete()},d=>{this._teardown(),a.error(d)},()=>this._teardown()))),s.closed&&(this._connection=null,s=rr.EMPTY)}return s}refCount(){return Uh()(this)}};var AW=Ph(o=>function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ur=(()=>{class o extends Ft{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(a){let d=new Ey(this,this);return d.operator=a,d}_throwIfClosed(){if(this.closed)throw new AW}next(a){kh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let d of this.currentObservers)d.next(a)}})}error(a){kh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=a;let{observers:d}=this;for(;d.length;)d.shift().error(a)}})}complete(){kh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:a}=this;for(;a.length;)a.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var a;return((a=this.observers)===null||a===void 0?void 0:a.length)>0}_trySubscribe(a){return this._throwIfClosed(),super._trySubscribe(a)}_subscribe(a){return this._throwIfClosed(),this._checkFinalizedStatuses(a),this._innerSubscribe(a)}_innerSubscribe(a){let{hasError:d,isStopped:p,observers:g}=this;return d||p?gA:(this.currentObservers=null,g.push(a),new rr(()=>{this.currentObservers=null,Em(g,a)}))}_checkFinalizedStatuses(a){let{hasError:d,thrownError:p,isStopped:g}=this;d?a.error(p):g&&a.complete()}asObservable(){let a=new Ft;return a.source=this,a}}return o.create=(s,a)=>new Ey(s,a),o})(),Ey=class extends ur{constructor(s,a){super(),this.destination=s,this.source=a}next(s){var a,d;(d=(a=this.destination)===null||a===void 0?void 0:a.next)===null||d===void 0||d.call(a,s)}error(s){var a,d;(d=(a=this.destination)===null||a===void 0?void 0:a.error)===null||d===void 0||d.call(a,s)}complete(){var s,a;(a=(s=this.destination)===null||s===void 0?void 0:s.complete)===null||a===void 0||a.call(s)}_subscribe(s){var a,d;return(d=(a=this.source)===null||a===void 0?void 0:a.subscribe(s))!==null&&d!==void 0?d:gA}};var Br=class extends ur{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){let a=super._subscribe(s);return!a.closed&&s.next(this._value),a}getValue(){let{hasError:s,thrownError:a,_value:d}=this;if(s)throw a;return this._throwIfClosed(),d}next(s){super.next(this._value=s)}};var Oi=new Ft(o=>o.complete());function DW(o){return o&&_t(o.schedule)}function OW(o){return o[o.length-1]}function vy(o){return _t(OW(o))?o.pop():void 0}function Fc(o){return DW(OW(o))?o.pop():void 0}function PW(o,s,a,d){function p(g){return g instanceof a?g:new a(function(v){v(g)})}return new(a||(a=Promise))(function(g,v){function T(B){try{x(d.next(B))}catch(W){v(W)}}function b(B){try{x(d.throw(B))}catch(W){v(W)}}function x(B){B.done?g(B.value):p(B.value).then(T,b)}x((d=d.apply(o,s||[])).next())})}function NW(o){var s=typeof Symbol=="function"&&Symbol.iterator,a=s&&o[s],d=0;if(a)return a.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&d>=o.length&&(o=void 0),{value:o&&o[d++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function cl(o){return this instanceof cl?(this.v=o,this):new cl(o)}function LW(o,s,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=a.apply(o,s||[]),p,g=[];return p=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),T("next"),T("throw"),T("return",v),p[Symbol.asyncIterator]=function(){return this},p;function v(re){return function(Se){return Promise.resolve(Se).then(re,W)}}function T(re,Se){d[re]&&(p[re]=function(ze){return new Promise(function(Me,Oe){g.push([re,ze,Me,Oe])>1||b(re,ze)})},Se&&(p[re]=Se(p[re])))}function b(re,Se){try{x(d[re](Se))}catch(ze){ee(g[0][3],ze)}}function x(re){re.value instanceof cl?Promise.resolve(re.value.v).then(B,W):ee(g[0][2],re)}function B(re){b("next",re)}function W(re){b("throw",re)}function ee(re,Se){re(Se),g.shift(),g.length&&b(g[0][0],g[0][1])}}function kW(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=o[Symbol.asyncIterator],a;return s?s.call(o):(o=typeof NW=="function"?NW(o):o[Symbol.iterator](),a={},d("next"),d("throw"),d("return"),a[Symbol.asyncIterator]=function(){return this},a);function d(g){a[g]=o[g]&&function(v){return new Promise(function(T,b){v=o[g](v),p(T,b,v.done,v.value)})}}function p(g,v,T,b){Promise.resolve(b).then(function(x){g({value:x,done:T})},v)}}var yy=o=>o&&typeof o.length=="number"&&typeof o!="function";function Sy(o){return _t(o?.then)}function Ty(o){return _t(o[xh])}function Cy(o){return Symbol.asyncIterator&&_t(o?.[Symbol.asyncIterator])}function Ry(o){return new TypeError(`You provided ${o!==null&&typeof o=="object"?"an invalid object":`'${o}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function jue(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Iy=jue();function by(o){return _t(o?.[Iy])}function wy(o){return LW(this,arguments,function*(){let a=o.getReader();try{for(;;){let{value:d,done:p}=yield cl(a.read());if(p)return yield cl(void 0);yield yield cl(d)}}finally{a.releaseLock()}})}function Ay(o){return _t(o?.getReader)}function ir(o){if(o instanceof Ft)return o;if(o!=null){if(Ty(o))return Bue(o);if(yy(o))return Hue(o);if(Sy(o))return Gue(o);if(Cy(o))return MW(o);if(by(o))return Wue(o);if(Ay(o))return que(o)}throw Ry(o)}function Bue(o){return new Ft(s=>{let a=o[xh]();if(_t(a.subscribe))return a.subscribe(s);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Hue(o){return new Ft(s=>{for(let a=0;a<o.length&&!s.closed;a++)s.next(o[a]);s.complete()})}function Gue(o){return new Ft(s=>{o.then(a=>{s.closed||(s.next(a),s.complete())},a=>s.error(a)).then(null,gy)})}function Wue(o){return new Ft(s=>{for(let a of o)if(s.next(a),s.closed)return;s.complete()})}function MW(o){return new Ft(s=>{zue(o,s).catch(a=>s.error(a))})}function que(o){return MW(wy(o))}function zue(o,s){var a,d,p,g;return PW(this,void 0,void 0,function*(){try{for(a=kW(o);d=yield a.next(),!d.done;){let v=d.value;if(s.next(v),s.closed)return}}catch(v){p={error:v}}finally{try{d&&!d.done&&(g=a.return)&&(yield g.call(a))}finally{if(p)throw p.error}}s.complete()})}function Ni(o,s,a,d=0,p=!1){let g=s.schedule(function(){a(),p?o.add(this.schedule(null,d)):this.unsubscribe()},d);if(o.add(g),!p)return g}function Dy(o,s=0){return Wt((a,d)=>{a.subscribe(Bt(d,p=>Ni(d,o,()=>d.next(p),s),()=>Ni(d,o,()=>d.complete(),s),p=>Ni(d,o,()=>d.error(p),s)))})}function Oy(o,s=0){return Wt((a,d)=>{d.add(o.schedule(()=>a.subscribe(d),s))})}function xW(o,s){return ir(o).pipe(Oy(s),Dy(s))}function UW(o,s){return ir(o).pipe(Oy(s),Dy(s))}function FW(o,s){return new Ft(a=>{let d=0;return s.schedule(function(){d===o.length?a.complete():(a.next(o[d++]),a.closed||this.schedule())})})}function VW(o,s){return new Ft(a=>{let d;return Ni(a,s,()=>{d=o[Iy](),Ni(a,s,()=>{let p,g;try{({value:p,done:g}=d.next())}catch(v){a.error(v);return}g?a.complete():a.next(p)},0,!0)}),()=>_t(d?.return)&&d.return()})}function Ny(o,s){if(!o)throw new Error("Iterable cannot be null");return new Ft(a=>{Ni(a,s,()=>{let d=o[Symbol.asyncIterator]();Ni(a,s,()=>{d.next().then(p=>{p.done?a.complete():a.next(p.value)})},0,!0)})})}function jW(o,s){return Ny(wy(o),s)}function BW(o,s){if(o!=null){if(Ty(o))return xW(o,s);if(yy(o))return FW(o,s);if(Sy(o))return UW(o,s);if(Cy(o))return Ny(o,s);if(by(o))return VW(o,s);if(Ay(o))return jW(o,s)}throw Ry(o)}function Kn(o,s){return s?BW(o,s):ir(o)}function rt(...o){let s=Fc(o);return Kn(o,s)}function Vh(o,s){let a=_t(o)?o:()=>o,d=p=>p.error(a());return new Ft(s?p=>s.schedule(d,0,p):d)}function IA(o){return!!o&&(o instanceof Ft||_t(o.lift)&&_t(o.subscribe))}var Da=Ph(o=>function(){o(this),this.name="EmptyError",this.message="no elements in sequence"});function wt(o,s){return Wt((a,d)=>{let p=0;a.subscribe(Bt(d,g=>{d.next(o.call(s,g,p++))}))})}var{isArray:Kue}=Array;function Yue(o,s){return Kue(s)?o(...s):o(s)}function Py(o){return wt(s=>Yue(o,s))}var{isArray:$ue}=Array,{getPrototypeOf:Xue,prototype:Jue,keys:Zue}=Object;function Ly(o){if(o.length===1){let s=o[0];if($ue(s))return{args:s,keys:null};if(Que(s)){let a=Zue(s);return{args:a.map(d=>s[d]),keys:a}}}return{args:o,keys:null}}function Que(o){return o&&typeof o=="object"&&Xue(o)===Jue}function ky(o,s){return o.reduce((a,d,p)=>(a[d]=s[p],a),{})}function My(...o){let s=Fc(o),a=vy(o),{args:d,keys:p}=Ly(o);if(d.length===0)return Kn([],s);let g=new Ft(ehe(d,s,p?v=>ky(p,v):$i));return a?g.pipe(Py(a)):g}function ehe(o,s,a=$i){return d=>{HW(s,()=>{let{length:p}=o,g=new Array(p),v=p,T=p;for(let b=0;b<p;b++)HW(s,()=>{let x=Kn(o[b],s),B=!1;x.subscribe(Bt(d,W=>{g[b]=W,B||(B=!0,T--),T||d.next(a(g.slice()))},()=>{--v||d.complete()}))},d)},d)}}function HW(o,s,a){o?Ni(a,o,s):s()}function GW(o,s,a,d,p,g,v,T){let b=[],x=0,B=0,W=!1,ee=()=>{W&&!b.length&&!x&&s.complete()},re=ze=>x<d?Se(ze):b.push(ze),Se=ze=>{g&&s.next(ze),x++;let Me=!1;ir(a(ze,B++)).subscribe(Bt(s,Oe=>{p?.(Oe),g?re(Oe):s.next(Oe)},()=>{Me=!0},void 0,()=>{if(Me)try{for(x--;b.length&&x<d;){let Oe=b.shift();v?Ni(s,v,()=>Se(Oe)):Se(Oe)}ee()}catch(Oe){s.error(Oe)}}))};return o.subscribe(Bt(s,re,()=>{W=!0,ee()})),()=>{T?.()}}function hr(o,s,a=1/0){return _t(s)?hr((d,p)=>wt((g,v)=>s(d,g,p,v))(ir(o(d,p))),a):(typeof s=="number"&&(a=s),Wt((d,p)=>GW(d,p,o,a)))}function WW(o=1/0){return hr($i,o)}function qW(){return WW(1)}function jh(...o){return qW()(Kn(o,Fc(o)))}function ym(o){return new Ft(s=>{ir(o()).subscribe(s)})}function bA(...o){let s=vy(o),{args:a,keys:d}=Ly(o),p=new Ft(g=>{let{length:v}=a;if(!v){g.complete();return}let T=new Array(v),b=v,x=v;for(let B=0;B<v;B++){let W=!1;ir(a[B]).subscribe(Bt(g,ee=>{W||(W=!0,x--),T[B]=ee},()=>b--,void 0,()=>{(!b||!W)&&(x||g.next(d?ky(d,T):T),g.complete())}))}});return s?p.pipe(Py(s)):p}function Pi(o,s){return Wt((a,d)=>{let p=0;a.subscribe(Bt(d,g=>o.call(s,g,p++)&&d.next(g)))})}function Vc(o){return Wt((s,a)=>{let d=null,p=!1,g;d=s.subscribe(Bt(a,void 0,void 0,v=>{g=ir(o(v,Vc(o)(s))),d?(d.unsubscribe(),d=null,g.subscribe(a)):p=!0})),p&&(d.unsubscribe(),d=null,g.subscribe(a))})}function zW(o,s,a,d,p){return(g,v)=>{let T=a,b=s,x=0;g.subscribe(Bt(v,B=>{let W=x++;b=T?o(b,B,W):(T=!0,B),d&&v.next(b)},p&&(()=>{T&&v.next(b),v.complete()})))}}function jc(o,s){return _t(s)?hr(o,s,1):hr(o,1)}function Bc(o){return Wt((s,a)=>{let d=!1;s.subscribe(Bt(a,p=>{d=!0,a.next(p)},()=>{d||a.next(o),a.complete()}))})}function Oa(o){return o<=0?()=>Oi:Wt((s,a)=>{let d=0;s.subscribe(Bt(a,p=>{++d<=o&&(a.next(p),o<=d&&a.complete())}))})}function xy(o=the){return Wt((s,a)=>{let d=!1;s.subscribe(Bt(a,p=>{d=!0,a.next(p)},()=>d?a.complete():a.error(o())))})}function the(){return new Da}function dl(o){return Wt((s,a)=>{try{s.subscribe(a)}finally{a.add(o)}})}function Na(o,s){let a=arguments.length>=2;return d=>d.pipe(o?Pi((p,g)=>o(p,g,d)):$i,Oa(1),a?Bc(s):xy(()=>new Da))}function Bh(o){return o<=0?()=>Oi:Wt((s,a)=>{let d=[];s.subscribe(Bt(a,p=>{d.push(p),o<d.length&&d.shift()},()=>{for(let p of d)a.next(p);a.complete()},void 0,()=>{d=null}))})}function wA(o,s){let a=arguments.length>=2;return d=>d.pipe(o?Pi((p,g)=>o(p,g,d)):$i,Bh(1),a?Bc(s):xy(()=>new Da))}function AA(o,s){return Wt(zW(o,s,arguments.length>=2,!0))}function DA(...o){let s=Fc(o);return Wt((a,d)=>{(s?jh(o,a,s):jh(o,a)).subscribe(d)})}function ti(o,s){return Wt((a,d)=>{let p=null,g=0,v=!1,T=()=>v&&!p&&d.complete();a.subscribe(Bt(d,b=>{p?.unsubscribe();let x=0,B=g++;ir(o(b,B)).subscribe(p=Bt(d,W=>d.next(s?s(b,W,B,x++):W),()=>{p=null,T()}))},()=>{v=!0,T()}))})}function Uy(o){return Wt((s,a)=>{ir(o).subscribe(Bt(a,()=>a.complete(),vm)),!a.closed&&s.subscribe(a)})}function wr(o,s,a){let d=_t(o)||s||a?{next:o,error:s,complete:a}:o;return d?Wt((p,g)=>{var v;(v=d.subscribe)===null||v===void 0||v.call(d);let T=!0;p.subscribe(Bt(g,b=>{var x;(x=d.next)===null||x===void 0||x.call(d,b),g.next(b)},()=>{var b;T=!1,(b=d.complete)===null||b===void 0||b.call(d),g.complete()},b=>{var x;T=!1,(x=d.error)===null||x===void 0||x.call(d,b),g.error(b)},()=>{var b,x;T&&((b=d.unsubscribe)===null||b===void 0||b.call(d)),(x=d.finalize)===null||x===void 0||x.call(d)}))}):$i}function KW(o){let s=lt(null);try{return o()}finally{lt(s)}}var BA="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",xe=class extends Error{code;constructor(s,a){super(By(s,a)),this.code=s}};function nhe(o){return`NG0${Math.abs(o)}`}function By(o,s){return`${nhe(o)}${s?": "+s:""}`}function on(o){for(let s in o)if(o[s]===on)return s;throw Error("")}function XW(o,s){for(let a in s)s.hasOwnProperty(a)&&!o.hasOwnProperty(a)&&(o[a]=s[a])}function La(o){if(typeof o=="string")return o;if(Array.isArray(o))return`[${o.map(La).join(", ")}]`;if(o==null)return""+o;let s=o.overriddenName||o.name;if(s)return`${s}`;let a=o.toString();if(a==null)return""+a;let d=a.indexOf(`
`);return d>=0?a.slice(0,d):a}function HA(o,s){return o?s?`${o} ${s}`:o:s||""}var rhe=on({__forward_ref__:on});function Js(o){return o.__forward_ref__=Js,o.toString=function(){return La(this())},o}function Hr(o){return GA(o)?o():o}function GA(o){return typeof o=="function"&&o.hasOwnProperty(rhe)&&o.__forward_ref__===Js}function qe(o){return{token:o.token,providedIn:o.providedIn||null,factory:o.factory,value:void 0}}function hs(o){return{providers:o.providers||[],imports:o.imports||[]}}function Rm(o){return ihe(o,Hy)}function WA(o){return Rm(o)!==null}function ihe(o,s){return o.hasOwnProperty(s)&&o[s]||null}function ohe(o){let s=o?.[Hy]??null;return s||null}function NA(o){return o&&o.hasOwnProperty(Vy)?o[Vy]:null}var Hy=on({\u0275prov:on}),Vy=on({\u0275inj:on}),Fe=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(s,a){this._desc=s,this.\u0275prov=void 0,typeof a=="number"?this.__NG_ELEMENT_ID__=a:a!==void 0&&(this.\u0275prov=qe({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function qA(o){return o&&!!o.\u0275providers}var zA=on({\u0275cmp:on}),KA=on({\u0275dir:on}),YA=on({\u0275pipe:on}),$A=on({\u0275mod:on}),Tm=on({\u0275fac:on}),ml=on({__NG_ELEMENT_ID__:on}),YW=on({__NG_ENV_ID__:on});function gl(o){return typeof o=="string"?o:o==null?"":String(o)}function JW(o){return typeof o=="function"?o.name||o.toString():typeof o=="object"&&o!=null&&typeof o.type=="function"?o.type.name||o.type.toString():gl(o)}var ZW=on({ngErrorCode:on}),she=on({ngErrorMessage:on}),ahe=on({ngTokenPath:on});function XA(o,s){return QW("",-200,s)}function Gy(o,s){throw new xe(-201,!1)}function QW(o,s,a){let d=new xe(s,o);return d[ZW]=s,d[she]=o,a&&(d[ahe]=a),d}function che(o){return o[ZW]}var PA;function e4(){return PA}function Xi(o){let s=PA;return PA=o,s}function JA(o,s,a){let d=Rm(o);if(d&&d.providedIn=="root")return d.value===void 0?d.value=d.factory():d.value;if(a&8)return null;if(s!==void 0)return s;Gy(o,"Injector")}var dhe={},ll=dhe,lhe="__NG_DI_FLAG__",LA=class{injector;constructor(s){this.injector=s}retrieve(s,a){let d=ul(a)||0;try{return this.injector.get(s,d&8?null:ll,d)}catch(p){if(bh(p))return p;throw p}}};function uhe(o,s=0){let a=ry();if(a===void 0)throw new xe(-203,!1);if(a===null)return JA(o,void 0,s);{let d=hhe(s),p=a.retrieve(o,d);if(bh(p)){if(d.optional)return null;throw p}return p}}function et(o,s=0){return(e4()||uhe)(Hr(o),s)}function ge(o,s){return et(o,ul(s))}function ul(o){return typeof o>"u"||typeof o=="number"?o:0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)}function hhe(o){return{optional:!!(o&8),host:!!(o&1),self:!!(o&2),skipSelf:!!(o&4)}}function kA(o){let s=[];for(let a=0;a<o.length;a++){let d=Hr(o[a]);if(Array.isArray(d)){if(d.length===0)throw new xe(900,!1);let p,g=0;for(let v=0;v<d.length;v++){let T=d[v],b=phe(T);typeof b=="number"?b===-1?p=T.token:g|=b:p=T}s.push(et(p,g))}else s.push(et(d))}return s}function phe(o){return o[lhe]}function hl(o,s){let a=o.hasOwnProperty(Tm);return a?o[Tm]:null}function Wy(o,s){o.forEach(a=>Array.isArray(a)?Wy(a,s):s(a))}function ZA(o,s,a){s>=o.length?o.push(a):o.splice(s,0,a)}function Im(o,s){return s>=o.length-1?o.pop():o.splice(s,1)[0]}function t4(o,s,a,d){let p=o.length;if(p==s)o.push(a,d);else if(p===1)o.push(d,o[0]),o[0]=a;else{for(p--,o.push(o[p-1],o[p]);p>s;){let g=p-2;o[p]=o[g],p--}o[s]=a,o[s+1]=d}}function n4(o,s,a){let d=Gh(o,s);return d>=0?o[d|1]=a:(d=~d,t4(o,d,s,a)),d}function qy(o,s){let a=Gh(o,s);if(a>=0)return o[a|1]}function Gh(o,s){return fhe(o,s,1)}function fhe(o,s,a){let d=0,p=o.length>>a;for(;p!==d;){let g=d+(p-d>>1),v=o[g<<a];if(s===v)return g<<a;v>s?p=g:d=g+1}return~(p<<a)}var Wc={},Ji=[],ka=new Fe(""),QA=new Fe("",-1),eD=new Fe(""),Cm=class{get(s,a=ll){if(a===ll){let p=QW("",-201);throw p.name="\u0275NotFound",p}return a}};function tD(o){return o[$A]||null}function qc(o){return o[zA]||null}function nD(o){return o[KA]||null}function r4(o){return o[YA]||null}function Ma(o){return{\u0275providers:o}}function i4(o){return Ma([{provide:ka,multi:!0,useValue:o}])}function o4(...o){return{\u0275providers:rD(!0,o),\u0275fromNgModule:!0}}function rD(o,...s){let a=[],d=new Set,p,g=v=>{a.push(v)};return Wy(s,v=>{let T=v;jy(T,g,[],d)&&(p||=[],p.push(T))}),p!==void 0&&s4(p,g),a}function s4(o,s){for(let a=0;a<o.length;a++){let{ngModule:d,providers:p}=o[a];iD(p,g=>{s(g,d)})}}function jy(o,s,a,d){if(o=Hr(o),!o)return!1;let p=null,g=NA(o),v=!g&&qc(o);if(!g&&!v){let b=o.ngModule;if(g=NA(b),g)p=b;else return!1}else{if(v&&!v.standalone)return!1;p=o}let T=d.has(p);if(v){if(T)return!1;if(d.add(p),v.dependencies){let b=typeof v.dependencies=="function"?v.dependencies():v.dependencies;for(let x of b)jy(x,s,a,d)}}else if(g){if(g.imports!=null&&!T){d.add(p);let x;try{Wy(g.imports,B=>{jy(B,s,a,d)&&(x||=[],x.push(B))})}finally{}x!==void 0&&s4(x,s)}if(!T){let x=hl(p)||(()=>new p);s({provide:p,useFactory:x,deps:Ji},p),s({provide:eD,useValue:p,multi:!0},p),s({provide:ka,useValue:()=>et(p),multi:!0},p)}let b=g.providers;if(b!=null&&!T){let x=o;iD(b,B=>{s(B,x)})}}else return!1;return p!==o&&o.providers!==void 0}function iD(o,s){for(let a of o)qA(a)&&(a=a.\u0275providers),Array.isArray(a)?iD(a,s):s(a)}var mhe=on({provide:String,useValue:on});function a4(o){return o!==null&&typeof o=="object"&&mhe in o}function ghe(o){return!!(o&&o.useExisting)}function _he(o){return!!(o&&o.useFactory)}function pl(o){return typeof o=="function"}function c4(o){return!!o.useClass}var bm=new Fe(""),Fy={},$W={},OA;function wm(){return OA===void 0&&(OA=new Cm),OA}var pr=class{},fl=class extends pr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(s,a,d,p){super(),this.parent=a,this.source=d,this.scopes=p,xA(s,v=>this.processProvider(v)),this.records.set(QA,Hh(void 0,this)),p.has("environment")&&this.records.set(pr,Hh(void 0,this));let g=this.records.get(bm);g!=null&&typeof g.value=="string"&&this.scopes.add(g.value),this.injectorDefTypes=new Set(this.get(eD,Ji,{self:!0}))}retrieve(s,a){let d=ul(a)||0;try{return this.get(s,ll,d)}catch(p){if(bh(p))return p;throw p}}destroy(){Sm(this),this._destroyed=!0;let s=lt(null);try{for(let d of this._ngOnDestroyHooks)d.ngOnDestroy();let a=this._onDestroyHooks;this._onDestroyHooks=[];for(let d of a)d()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),lt(s)}}onDestroy(s){return Sm(this),this._onDestroyHooks.push(s),()=>this.removeOnDestroy(s)}runInContext(s){Sm(this);let a=$s(this),d=Xi(void 0),p;try{return s()}finally{$s(a),Xi(d)}}get(s,a=ll,d){if(Sm(this),s.hasOwnProperty(YW))return s[YW](this);let p=ul(d),g,v=$s(this),T=Xi(void 0);try{if(!(p&4)){let x=this.records.get(s);if(x===void 0){let B=The(s)&&Rm(s);B&&this.injectableDefInScope(B)?x=Hh(MA(s),Fy):x=null,this.records.set(s,x)}if(x!=null)return this.hydrate(s,x,p)}let b=p&2?wm():this.parent;return a=p&8&&a===ll?null:a,b.get(s,a)}catch(b){let x=che(b);throw x===-200||x===-201?new xe(x,null):b}finally{Xi(T),$s(v)}}resolveInjectorInitializers(){let s=lt(null),a=$s(this),d=Xi(void 0),p;try{let g=this.get(ka,Ji,{self:!0});for(let v of g)v()}finally{$s(a),Xi(d),lt(s)}}toString(){let s=[],a=this.records;for(let d of a.keys())s.push(La(d));return`R3Injector[${s.join(", ")}]`}processProvider(s){s=Hr(s);let a=pl(s)?s:Hr(s&&s.provide),d=vhe(s);if(!pl(s)&&s.multi===!0){let p=this.records.get(a);p||(p=Hh(void 0,Fy,!0),p.factory=()=>kA(p.multi),this.records.set(a,p)),a=s,p.multi.push(s)}this.records.set(a,d)}hydrate(s,a,d){let p=lt(null);try{if(a.value===$W)throw XA(La(s));return a.value===Fy&&(a.value=$W,a.value=a.factory(void 0,d)),typeof a.value=="object"&&a.value&&She(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}finally{lt(p)}}injectableDefInScope(s){if(!s.providedIn)return!1;let a=Hr(s.providedIn);return typeof a=="string"?a==="any"||this.scopes.has(a):this.injectorDefTypes.has(a)}removeOnDestroy(s){let a=this._onDestroyHooks.indexOf(s);a!==-1&&this._onDestroyHooks.splice(a,1)}};function MA(o){let s=Rm(o),a=s!==null?s.factory:hl(o);if(a!==null)return a;if(o instanceof Fe)throw new xe(204,!1);if(o instanceof Function)return Ehe(o);throw new xe(204,!1)}function Ehe(o){if(o.length>0)throw new xe(204,!1);let a=ohe(o);return a!==null?()=>a.factory(o):()=>new o}function vhe(o){if(a4(o))return Hh(void 0,o.useValue);{let s=oD(o);return Hh(s,Fy)}}function oD(o,s,a){let d;if(pl(o)){let p=Hr(o);return hl(p)||MA(p)}else if(a4(o))d=()=>Hr(o.useValue);else if(_he(o))d=()=>o.useFactory(...kA(o.deps||[]));else if(ghe(o))d=(p,g)=>et(Hr(o.useExisting),g!==void 0&&g&8?8:void 0);else{let p=Hr(o&&(o.useClass||o.provide));if(yhe(o))d=()=>new p(...kA(o.deps));else return hl(p)||MA(p)}return d}function Sm(o){if(o.destroyed)throw new xe(205,!1)}function Hh(o,s,a=!1){return{factory:o,value:s,multi:a?[]:void 0}}function yhe(o){return!!o.deps}function She(o){return o!==null&&typeof o=="object"&&typeof o.ngOnDestroy=="function"}function The(o){return typeof o=="function"||typeof o=="object"&&o.ngMetadataName==="InjectionToken"}function xA(o,s){for(let a of o)Array.isArray(a)?xA(a,s):a&&qA(a)?xA(a.\u0275providers,s):s(a)}function Gr(o,s){let a;o instanceof fl?(Sm(o),a=o):a=new LA(o);let d,p=$s(a),g=Xi(void 0);try{return s()}finally{$s(p),Xi(g)}}function d4(){return e4()!==void 0||ry()!=null}var ps=0,ut=1,Et=2,Ar=3,Po=4,Lo=5,Wh=6,qh=7,Jn=8,zc=9,xa=10,jn=11,zh=12,sD=13,_l=14,Zi=15,El=16,vl=17,yl=18,Am=19,aD=20,Pa=21,zy=22,Dm=23,Qi=24,Ky=25,Sl=26,ni=27,l4=1,cD=6,Kc=7,Om=8,Nm=9,fr=10;function Zs(o){return Array.isArray(o)&&typeof o[l4]=="object"}function fs(o){return Array.isArray(o)&&o[l4]===!0}function dD(o){return(o.flags&4)!==0}function Yc(o){return o.componentOffset>-1}function Yy(o){return(o.flags&1)===1}function Qs(o){return!!o.template}function Kh(o){return(o[Et]&512)!==0}function Tl(o){return(o[Et]&256)===256}var u4="svg",h4="math";function ko(o){for(;Array.isArray(o);)o=o[ps];return o}function lD(o,s){return ko(s[o])}function ms(o,s){return ko(s[o.index])}function Pm(o,s){return o.data[s]}function Mo(o,s){let a=s[o];return Zs(a)?a:a[ps]}function $y(o){return(o[Et]&128)===128}function p4(o){return fs(o[Ar])}function $c(o,s){return s==null?null:o[s]}function uD(o){o[vl]=0}function hD(o){o[Et]&1024||(o[Et]|=1024,$y(o)&&km(o))}function f4(o,s){for(;o>0;)s=s[_l],o--;return s}function Lm(o){return!!(o[Et]&9216||o[Qi]?.dirty)}function Xy(o){o[xa].changeDetectionScheduler?.notify(8),o[Et]&64&&(o[Et]|=1024),Lm(o)&&km(o)}function km(o){o[xa].changeDetectionScheduler?.notify(0);let s=Hc(o);for(;s!==null&&!(s[Et]&8192||(s[Et]|=8192,!$y(s)));)s=Hc(s)}function pD(o,s){if(Tl(o))throw new xe(911,!1);o[Pa]===null&&(o[Pa]=[]),o[Pa].push(s)}function m4(o,s){if(o[Pa]===null)return;let a=o[Pa].indexOf(s);a!==-1&&o[Pa].splice(a,1)}function Hc(o){let s=o[Ar];return fs(s)?s[Ar]:s}function g4(o){return o[qh]??=[]}function _4(o){return o.cleanup??=[]}var Vt={lFrame:k4(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var UA=!1;function E4(){return Vt.lFrame.elementDepthCount}function v4(){Vt.lFrame.elementDepthCount++}function y4(){Vt.lFrame.elementDepthCount--}function S4(){return Vt.bindingsEnabled}function T4(){return Vt.skipHydrationRootTNode!==null}function C4(o){return Vt.skipHydrationRootTNode===o}function R4(){Vt.skipHydrationRootTNode=null}function sn(){return Vt.lFrame.lView}function pi(){return Vt.lFrame.tView}function eo(o){return Vt.lFrame.contextLView=o,o[Jn]}function to(o){return Vt.lFrame.contextLView=null,o}function no(){let o=fD();for(;o!==null&&o.type===64;)o=o.parent;return o}function fD(){return Vt.lFrame.currentTNode}function I4(){let o=Vt.lFrame,s=o.currentTNode;return o.isParent?s:s.parent}function Yh(o,s){let a=Vt.lFrame;a.currentTNode=o,a.isParent=s}function mD(){return Vt.lFrame.isParent}function b4(){Vt.lFrame.isParent=!1}function gD(){return UA}function _D(o){let s=UA;return UA=o,s}function w4(){return Vt.lFrame.bindingIndex}function A4(o){return Vt.lFrame.bindingIndex=o}function Cl(){return Vt.lFrame.bindingIndex++}function ED(o){let s=Vt.lFrame,a=s.bindingIndex;return s.bindingIndex=s.bindingIndex+o,a}function D4(){return Vt.lFrame.inI18n}function O4(o,s){let a=Vt.lFrame;a.bindingIndex=a.bindingRootIndex=o,Jy(s)}function N4(){return Vt.lFrame.currentDirectiveIndex}function Jy(o){Vt.lFrame.currentDirectiveIndex=o}function P4(o){let s=Vt.lFrame.currentDirectiveIndex;return s===-1?null:o[s]}function vD(o){Vt.lFrame.currentQueryIndex=o}function Che(o){let s=o[ut];return s.type===2?s.declTNode:s.type===1?o[Lo]:null}function yD(o,s,a){if(a&4){let p=s,g=o;for(;p=p.parent,p===null&&!(a&1);)if(p=Che(g),p===null||(g=g[_l],p.type&10))break;if(p===null)return!1;s=p,o=g}let d=Vt.lFrame=L4();return d.currentTNode=s,d.lView=o,!0}function Zy(o){let s=L4(),a=o[ut];Vt.lFrame=s,s.currentTNode=a.firstChild,s.lView=o,s.tView=a,s.contextLView=o,s.bindingIndex=a.bindingStartIndex,s.inI18n=!1}function L4(){let o=Vt.lFrame,s=o===null?null:o.child;return s===null?k4(o):s}function k4(o){let s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:o,child:null,inI18n:!1};return o!==null&&(o.child=s),s}function M4(){let o=Vt.lFrame;return Vt.lFrame=o.parent,o.currentTNode=null,o.lView=null,o}var SD=M4;function Qy(){let o=M4();o.isParent=!0,o.tView=null,o.selectedIndex=-1,o.contextLView=null,o.elementDepthCount=0,o.currentDirectiveIndex=-1,o.currentNamespace=null,o.bindingRootIndex=-1,o.bindingIndex=-1,o.currentQueryIndex=0}function x4(o){return(Vt.lFrame.contextLView=f4(o,Vt.lFrame.contextLView))[Jn]}function Ua(){return Vt.lFrame.selectedIndex}function Xc(o){Vt.lFrame.selectedIndex=o}function eS(){let o=Vt.lFrame;return Pm(o.tView,o.selectedIndex)}function U4(){return Vt.lFrame.currentNamespace}var F4=!0;function tS(){return F4}function nS(o){F4=o}function FA(o,s=null,a=null,d){let p=TD(o,s,a,d);return p.resolveInjectorInitializers(),p}function TD(o,s=null,a=null,d,p=new Set){let g=[a||Ji,o4(o)];return d=d||(typeof o=="object"?void 0:La(o)),new fl(g,s||wm(),d||null,p)}var us=class o{static THROW_IF_NOT_FOUND=ll;static NULL=new Cm;static create(s,a){if(Array.isArray(s))return FA({name:""},a,s,"");{let d=s.name??"";return FA({name:d},s.parent,s.providers,d)}}static \u0275prov=qe({token:o,providedIn:"any",factory:()=>et(QA)});static __NG_ELEMENT_ID__=-1},or=new Fe(""),Fa=(()=>{class o{static __NG_ELEMENT_ID__=Rhe;static __NG_ENV_ID__=a=>a}return o})(),VA=class extends Fa{_lView;constructor(s){super(),this._lView=s}get destroyed(){return Tl(this._lView)}onDestroy(s){let a=this._lView;return pD(a,s),()=>m4(a,s)}};function Rhe(){return new VA(sn())}var Xs=class{_console=console;handleError(s){this._console.error("ERROR",s)}},ro=new Fe("",{providedIn:"root",factory:()=>{let o=ge(pr),s;return a=>{o.destroyed&&!s?setTimeout(()=>{throw a}):(s??=o.get(Xs),s.handleError(a))}}}),V4={provide:ka,useValue:()=>void ge(Xs),multi:!0},Ihe=new Fe("",{providedIn:"root",factory:()=>{let o=ge(or).defaultView;if(!o)return;let s=ge(ro),a=g=>{s(g.reason),g.preventDefault()},d=g=>{g.error?s(g.error):s(new Error(g.message,{cause:g})),g.preventDefault()},p=()=>{o.addEventListener("unhandledrejection",a),o.addEventListener("error",d)};typeof Zone<"u"?Zone.root.run(p):p(),ge(Fa).onDestroy(()=>{o.removeEventListener("error",d),o.removeEventListener("unhandledrejection",a)})}});function CD(){return Ma([i4(()=>void ge(Ihe))])}function RD(o){return typeof o=="function"&&o[ei]!==void 0}function ea(o,s){let[a,d,p]=fA(o,s?.equal),g=a,v=g[ei];return g.set=d,g.update=p,g.asReadonly=j4.bind(g),g}function j4(){let o=this[ei];if(o.readonlyFn===void 0){let s=()=>this();s[ei]=o,o.readonlyFn=s}return o.readonlyFn}function ID(o){return RD(o)&&typeof o.set=="function"}var Gc=class{},Mm=new Fe("",{providedIn:"root",factory:()=>!1});var bD=new Fe(""),wD=new Fe(""),ta=(()=>{class o{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Br(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Ft(a=>{a.next(!1),a.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let a=this.taskId++;return this.pendingTasks.add(a),a}has(a){return this.pendingTasks.has(a)}remove(a){this.pendingTasks.delete(a),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=qe({token:o,providedIn:"root",factory:()=>new o})}return o})(),rS=(()=>{class o{internalPendingTasks=ge(ta);scheduler=ge(Gc);errorHandler=ge(ro);add(){let a=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(a)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(a))}}run(a){let d=this.add();a().catch(this.errorHandler).finally(d)}static \u0275prov=qe({token:o,providedIn:"root",factory:()=>new o})}return o})();function xm(...o){}var AD=(()=>{class o{static \u0275prov=qe({token:o,providedIn:"root",factory:()=>new jA})}return o})(),jA=class{dirtyEffectCount=0;queues=new Map;add(s){this.enqueue(s),this.schedule(s)}schedule(s){s.dirty&&this.dirtyEffectCount++}remove(s){let a=s.zone,d=this.queues.get(a);d.has(s)&&(d.delete(s),s.dirty&&this.dirtyEffectCount--)}enqueue(s){let a=s.zone;this.queues.has(a)||this.queues.set(a,new Set);let d=this.queues.get(a);d.has(s)||d.add(s)}flush(){for(;this.dirtyEffectCount>0;){let s=!1;for(let[a,d]of this.queues)a===null?s||=this.flushQueue(d):s||=a.run(()=>this.flushQueue(d));s||(this.dirtyEffectCount=0)}}flushQueue(s){let a=!1;for(let d of s)d.dirty&&(this.dirtyEffectCount--,a=!0,d.run());return a}};function qm(o){return{toString:o}.toString()}function Mhe(o){return typeof o=="function"}var cS=class{previousValue;currentValue;firstChange;constructor(s,a,d){this.previousValue=s,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}};function v5(o,s,a,d){s!==null?s.applyValueToInputSignal(s,d):o[a]=d}var Ba=(()=>{let o=()=>y5;return o.ngInherit=!0,o})();function y5(o){return o.type.prototype.ngOnChanges&&(o.setInput=Uhe),xhe}function xhe(){let o=T5(this),s=o?.current;if(s){let a=o.previous;if(a===Wc)o.previous=s;else for(let d in s)a[d]=s[d];o.current=null,this.ngOnChanges(s)}}function Uhe(o,s,a,d,p){let g=this.declaredInputs[d],v=T5(o)||Fhe(o,{previous:Wc,current:null}),T=v.current||(v.current={}),b=v.previous,x=b[g];T[g]=new cS(x&&x.currentValue,a,b===Wc),v5(o,s,p,a)}var S5="__ngSimpleChanges__";function T5(o){return o[S5]||null}function Fhe(o,s){return o[S5]=s}var B4=[];var yn=function(o,s=null,a){for(let d=0;d<B4.length;d++){let p=B4[d];p(o,s,a)}};function Vhe(o,s,a){let{ngOnChanges:d,ngOnInit:p,ngDoCheck:g}=s.type.prototype;if(d){let v=y5(s);(a.preOrderHooks??=[]).push(o,v),(a.preOrderCheckHooks??=[]).push(o,v)}p&&(a.preOrderHooks??=[]).push(0-o,p),g&&((a.preOrderHooks??=[]).push(o,g),(a.preOrderCheckHooks??=[]).push(o,g))}function jhe(o,s){for(let a=s.directiveStart,d=s.directiveEnd;a<d;a++){let g=o.data[a].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:T,ngAfterViewInit:b,ngAfterViewChecked:x,ngOnDestroy:B}=g;v&&(o.contentHooks??=[]).push(-a,v),T&&((o.contentHooks??=[]).push(a,T),(o.contentCheckHooks??=[]).push(a,T)),b&&(o.viewHooks??=[]).push(-a,b),x&&((o.viewHooks??=[]).push(a,x),(o.viewCheckHooks??=[]).push(a,x)),B!=null&&(o.destroyHooks??=[]).push(a,B)}}function oS(o,s,a){C5(o,s,3,a)}function sS(o,s,a,d){(o[Et]&3)===a&&C5(o,s,a,d)}function DD(o,s){let a=o[Et];(a&3)===s&&(a&=16383,a+=1,o[Et]=a)}function C5(o,s,a,d){let p=d!==void 0?o[vl]&65535:0,g=d??-1,v=s.length-1,T=0;for(let b=p;b<v;b++)if(typeof s[b+1]=="number"){if(T=s[b],d!=null&&T>=d)break}else s[b]<0&&(o[vl]+=65536),(T<g||g==-1)&&(Bhe(o,a,s,b),o[vl]=(o[vl]&4294901760)+b+2),b++}function H4(o,s){yn(4,o,s);let a=lt(null);try{s.call(o)}finally{lt(a),yn(5,o,s)}}function Bhe(o,s,a,d){let p=a[d]<0,g=a[d+1],v=p?-a[d]:a[d],T=o[v];p?o[Et]>>14<o[vl]>>16&&(o[Et]&3)===s&&(o[Et]+=16384,H4(T,g)):H4(T,g)}var Xh=-1,Il=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(s,a,d,p){this.factory=s,this.name=p,this.canSeeViewProviders=a,this.injectImpl=d}};function Hhe(o){return(o.flags&8)!==0}function Ghe(o){return(o.flags&16)!==0}function Whe(o,s,a){let d=0;for(;d<a.length;){let p=a[d];if(typeof p=="number"){if(p!==0)break;d++;let g=a[d++],v=a[d++],T=a[d++];o.setAttribute(s,v,T,g)}else{let g=p,v=a[++d];zhe(g)?o.setProperty(s,g,v):o.setAttribute(s,g,v),d++}}return d}function qhe(o){return o===3||o===4||o===6}function zhe(o){return o.charCodeAt(0)===64}function Vm(o,s){if(!(s===null||s.length===0))if(o===null||o.length===0)o=s.slice();else{let a=-1;for(let d=0;d<s.length;d++){let p=s[d];typeof p=="number"?a=p:a===0||(a===-1||a===2?G4(o,a,p,null,s[++d]):G4(o,a,p,null,null))}}return o}function G4(o,s,a,d,p){let g=0,v=o.length;if(s===-1)v=-1;else for(;g<o.length;){let T=o[g++];if(typeof T=="number"){if(T===s){v=-1;break}else if(T>s){v=g-1;break}}}for(;g<o.length;){let T=o[g];if(typeof T=="number")break;if(T===a){p!==null&&(o[g+1]=p);return}g++,p!==null&&g++}v!==-1&&(o.splice(v,0,s),g=v+1),o.splice(g++,0,a),p!==null&&o.splice(g++,0,p)}function R5(o){return o!==Xh}function dS(o){return o&32767}function Khe(o){return o>>16}function lS(o,s){let a=Khe(o),d=s;for(;a>0;)d=d[_l],a--;return d}var jD=!0;function W4(o){let s=jD;return jD=o,s}var Yhe=256,I5=Yhe-1,b5=5,$he=0,na={};function Xhe(o,s,a){let d;typeof a=="string"?d=a.charCodeAt(0)||0:a.hasOwnProperty(ml)&&(d=a[ml]),d==null&&(d=a[ml]=$he++);let p=d&I5,g=1<<p;s.data[o+(p>>b5)]|=g}function uS(o,s){let a=w5(o,s);if(a!==-1)return a;let d=s[ut];d.firstCreatePass&&(o.injectorIndex=s.length,OD(d.data,o),OD(s,null),OD(d.blueprint,null));let p=hO(o,s),g=o.injectorIndex;if(R5(p)){let v=dS(p),T=lS(p,s),b=T[ut].data;for(let x=0;x<8;x++)s[g+x]=T[v+x]|b[v+x]}return s[g+8]=p,g}function OD(o,s){o.push(0,0,0,0,0,0,0,0,s)}function w5(o,s){return o.injectorIndex===-1||o.parent&&o.parent.injectorIndex===o.injectorIndex||s[o.injectorIndex+8]===null?-1:o.injectorIndex}function hO(o,s){if(o.parent&&o.parent.injectorIndex!==-1)return o.parent.injectorIndex;let a=0,d=null,p=s;for(;p!==null;){if(d=P5(p),d===null)return Xh;if(a++,p=p[_l],d.injectorIndex!==-1)return d.injectorIndex|a<<16}return Xh}function BD(o,s,a){Xhe(o,s,a)}function A5(o,s,a){if(a&8||o!==void 0)return o;Gy(s,"NodeInjector")}function D5(o,s,a,d){if(a&8&&d===void 0&&(d=null),(a&3)===0){let p=o[zc],g=Xi(void 0);try{return p?p.get(s,d,a&8):JA(s,d,a&8)}finally{Xi(g)}}return A5(d,s,a)}function O5(o,s,a,d=0,p){if(o!==null){if(s[Et]&2048&&!(d&2)){let v=tpe(o,s,a,d,na);if(v!==na)return v}let g=N5(o,s,a,d,na);if(g!==na)return g}return D5(s,a,d,p)}function N5(o,s,a,d,p){let g=Qhe(a);if(typeof g=="function"){if(!yD(s,o,d))return d&1?A5(p,a,d):D5(s,a,d,p);try{let v;if(v=g(d),v==null&&!(d&8))Gy(a);else return v}finally{SD()}}else if(typeof g=="number"){let v=null,T=w5(o,s),b=Xh,x=d&1?s[Zi][Lo]:null;for((T===-1||d&4)&&(b=T===-1?hO(o,s):s[T+8],b===Xh||!z4(d,!1)?T=-1:(v=s[ut],T=dS(b),s=lS(b,s)));T!==-1;){let B=s[ut];if(q4(g,T,B.data)){let W=Jhe(T,s,a,v,d,x);if(W!==na)return W}b=s[T+8],b!==Xh&&z4(d,s[ut].data[T+8]===x)&&q4(g,T,s)?(v=B,T=dS(b),s=lS(b,s)):T=-1}}return p}function Jhe(o,s,a,d,p,g){let v=s[ut],T=v.data[o+8],b=d==null?Yc(T)&&jD:d!=v&&(T.type&3)!==0,x=p&1&&g===T,B=Zhe(T,v,a,b,x);return B!==null?hS(s,v,B,T,p):na}function Zhe(o,s,a,d,p){let g=o.providerIndexes,v=s.data,T=g&1048575,b=o.directiveStart,x=o.directiveEnd,B=g>>20,W=d?T:T+B,ee=p?T+B:x;for(let re=W;re<ee;re++){let Se=v[re];if(re<b&&a===Se||re>=b&&Se.type===a)return re}if(p){let re=v[b];if(re&&Qs(re)&&re.type===a)return b}return null}function hS(o,s,a,d,p){let g=o[a],v=s.data;if(g instanceof Il){let T=g;if(T.resolving){let re=JW(v[a]);throw XA(re)}let b=W4(T.canSeeViewProviders);T.resolving=!0;let x=v[a].type||v[a],B,W=T.injectImpl?Xi(T.injectImpl):null,ee=yD(o,d,0);try{g=o[a]=T.factory(void 0,p,v,o,d),s.firstCreatePass&&a>=d.directiveStart&&Vhe(a,v[a],s)}finally{W!==null&&Xi(W),W4(b),T.resolving=!1,SD()}}return g}function Qhe(o){if(typeof o=="string")return o.charCodeAt(0)||0;let s=o.hasOwnProperty(ml)?o[ml]:void 0;return typeof s=="number"?s>=0?s&I5:epe:s}function q4(o,s,a){let d=1<<o;return!!(a[s+(o>>b5)]&d)}function z4(o,s){return!(o&2)&&!(o&1&&s)}var Rl=class{_tNode;_lView;constructor(s,a){this._tNode=s,this._lView=a}get(s,a,d){return O5(this._tNode,this._lView,s,ul(d),a)}};function epe(){return new Rl(no(),sn())}function Dl(o){return qm(()=>{let s=o.prototype.constructor,a=s[Tm]||HD(s),d=Object.prototype,p=Object.getPrototypeOf(o.prototype).constructor;for(;p&&p!==d;){let g=p[Tm]||HD(p);if(g&&g!==a)return g;p=Object.getPrototypeOf(p)}return g=>new g})}function HD(o){return GA(o)?()=>{let s=HD(Hr(o));return s&&s()}:hl(o)}function tpe(o,s,a,d,p){let g=o,v=s;for(;g!==null&&v!==null&&v[Et]&2048&&!Kh(v);){let T=N5(g,v,a,d|2,na);if(T!==na)return T;let b=g.parent;if(!b){let x=v[aD];if(x){let B=x.get(a,na,d);if(B!==na)return B}b=P5(v),v=v[_l]}g=b}return p}function P5(o){let s=o[ut],a=s.type;return a===2?s.declTNode:a===1?o[Lo]:null}function npe(){return pO(no(),sn())}function pO(o,s){return new Ol(ms(o,s))}var Ol=(()=>{class o{nativeElement;constructor(a){this.nativeElement=a}static __NG_ELEMENT_ID__=npe}return o})();function L5(o){return(o.flags&128)===128}var fO=(function(o){return o[o.OnPush=0]="OnPush",o[o.Default=1]="Default",o})(fO||{}),k5=new Map,rpe=0;function ipe(){return rpe++}function ope(o){k5.set(o[Am],o)}function GD(o){k5.delete(o[Am])}var K4="__ngContext__";function Jh(o,s){Zs(s)?(o[K4]=s[Am],ope(s)):o[K4]=s}function M5(o){return U5(o[zh])}function x5(o){return U5(o[Po])}function U5(o){for(;o!==null&&!fs(o);)o=o[Po];return o}var WD;function mO(o){WD=o}function F5(){if(WD!==void 0)return WD;if(typeof document<"u")return document;throw new xe(210,!1)}var IS=new Fe("",{providedIn:"root",factory:()=>spe}),spe="ng",bS=new Fe(""),np=new Fe("",{providedIn:"platform",factory:()=>"unknown"});var wS=new Fe("",{providedIn:"root",factory:()=>F5().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var ape="h",cpe="b";var V5="r";var j5="di";var B5=!1,H5=new Fe("",{providedIn:"root",factory:()=>B5});var dpe=(o,s,a,d)=>{};function lpe(o,s,a,d){dpe(o,s,a,d)}function gO(o){return(o.flags&32)===32}var upe=()=>null;function G5(o,s,a=!1){return upe(o,s,a)}function W5(o,s){let a=o.contentQueries;if(a!==null){let d=lt(null);try{for(let p=0;p<a.length;p+=2){let g=a[p],v=a[p+1];if(v!==-1){let T=o.data[v];vD(g),T.contentQueries(2,s[v],v)}}}finally{lt(d)}}}function qD(o,s,a){vD(0);let d=lt(null);try{s(o,a)}finally{lt(d)}}function q5(o,s,a){if(dD(s)){let d=lt(null);try{let p=s.directiveStart,g=s.directiveEnd;for(let v=p;v<g;v++){let T=o.data[v];if(T.contentQueries){let b=a[v];T.contentQueries(1,b,v)}}}finally{lt(d)}}}var Va=(function(o){return o[o.Emulated=0]="Emulated",o[o.None=2]="None",o[o.ShadowDom=3]="ShadowDom",o})(Va||{});var zD=class{changingThisBreaksApplicationSecurity;constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${BA})`}};function z5(o){return o instanceof zD?o.changingThisBreaksApplicationSecurity:o}function K5(o){return o instanceof Function?o():o}function hpe(o,s,a){let d=o.length;for(;;){let p=o.indexOf(s,a);if(p===-1)return p;if(p===0||o.charCodeAt(p-1)<=32){let g=s.length;if(p+g===d||o.charCodeAt(p+g)<=32)return p}a=p+1}}var Y5="ng-template";function ppe(o,s,a,d){let p=0;if(d){for(;p<s.length&&typeof s[p]=="string";p+=2)if(s[p]==="class"&&hpe(s[p+1].toLowerCase(),a,0)!==-1)return!0}else if(_O(o))return!1;if(p=s.indexOf(1,p),p>-1){let g;for(;++p<s.length&&typeof(g=s[p])=="string";)if(g.toLowerCase()===a)return!0}return!1}function _O(o){return o.type===4&&o.value!==Y5}function fpe(o,s,a){let d=o.type===4&&!a?Y5:o.value;return s===d}function mpe(o,s,a){let d=4,p=o.attrs,g=p!==null?Epe(p):0,v=!1;for(let T=0;T<s.length;T++){let b=s[T];if(typeof b=="number"){if(!v&&!gs(d)&&!gs(b))return!1;if(v&&gs(b))continue;v=!1,d=b|d&1;continue}if(!v)if(d&4){if(d=2|d&1,b!==""&&!fpe(o,b,a)||b===""&&s.length===1){if(gs(d))return!1;v=!0}}else if(d&8){if(p===null||!ppe(o,p,b,a)){if(gs(d))return!1;v=!0}}else{let x=s[++T],B=gpe(b,p,_O(o),a);if(B===-1){if(gs(d))return!1;v=!0;continue}if(x!==""){let W;if(B>g?W="":W=p[B+1].toLowerCase(),d&2&&x!==W){if(gs(d))return!1;v=!0}}}}return gs(d)||v}function gs(o){return(o&1)===0}function gpe(o,s,a,d){if(s===null)return-1;let p=0;if(d||!a){let g=!1;for(;p<s.length;){let v=s[p];if(v===o)return p;if(v===3||v===6)g=!0;else if(v===1||v===2){let T=s[++p];for(;typeof T=="string";)T=s[++p];continue}else{if(v===4)break;if(v===0){p+=4;continue}}p+=g?1:2}return-1}else return vpe(s,o)}function _pe(o,s,a=!1){for(let d=0;d<s.length;d++)if(mpe(o,s[d],a))return!0;return!1}function Epe(o){for(let s=0;s<o.length;s++){let a=o[s];if(qhe(a))return s}return o.length}function vpe(o,s){let a=o.indexOf(4);if(a>-1)for(a++;a<o.length;){let d=o[a];if(typeof d=="number")return-1;if(d===s)return a;a++}return-1}function Y4(o,s){return o?":not("+s.trim()+")":s}function ype(o){let s=o[0],a=1,d=2,p="",g=!1;for(;a<o.length;){let v=o[a];if(typeof v=="string")if(d&2){let T=o[++a];p+="["+v+(T.length>0?'="'+T+'"':"")+"]"}else d&8?p+="."+v:d&4&&(p+=" "+v);else p!==""&&!gs(v)&&(s+=Y4(g,p),p=""),d=v,g=g||!gs(d);a++}return p!==""&&(s+=Y4(g,p)),s}function Spe(o){return o.map(ype).join(",")}function Tpe(o){let s=[],a=[],d=1,p=2;for(;d<o.length;){let g=o[d];if(typeof g=="string")p===2?g!==""&&s.push(g,o[++d]):p===8&&a.push(g);else{if(!gs(p))break;p=g}d++}return a.length&&s.push(1,...a),s}var _s={};function Cpe(o,s){return o.createText(s)}function Rpe(o,s,a){o.setValue(s,a)}function $5(o,s,a){return o.createElement(s,a)}function pS(o,s,a,d,p){o.insertBefore(s,a,d,p)}function X5(o,s,a){o.appendChild(s,a)}function $4(o,s,a,d,p){d!==null?pS(o,s,a,d,p):X5(o,s,a)}function J5(o,s,a,d){o.removeChild(null,s,a,d)}function Ipe(o,s,a){o.setAttribute(s,"style",a)}function bpe(o,s,a){a===""?o.removeAttribute(s,"class"):o.setAttribute(s,"class",a)}function Z5(o,s,a){let{mergedAttrs:d,classes:p,styles:g}=a;d!==null&&Whe(o,s,d),p!==null&&bpe(o,s,p),g!==null&&Ipe(o,s,g)}function EO(o,s,a,d,p,g,v,T,b,x,B){let W=ni+d,ee=W+p,re=wpe(W,ee),Se=typeof x=="function"?x():x;return re[ut]={type:o,blueprint:re,template:a,queries:null,viewQuery:T,declTNode:s,data:re.slice().fill(null,W),bindingStartIndex:W,expandoStartIndex:ee,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof g=="function"?g():g,pipeRegistry:typeof v=="function"?v():v,firstChild:null,schemas:b,consts:Se,incompleteFirstPass:!1,ssrId:B}}function wpe(o,s){let a=[];for(let d=0;d<s;d++)a.push(d<o?null:_s);return a}function Ape(o){let s=o.tView;return s===null||s.incompleteFirstPass?o.tView=EO(1,null,o.template,o.decls,o.vars,o.directiveDefs,o.pipeDefs,o.viewQuery,o.schemas,o.consts,o.id):s}function vO(o,s,a,d,p,g,v,T,b,x,B){let W=s.blueprint.slice();return W[ps]=p,W[Et]=d|4|128|8|64|1024,(x!==null||o&&o[Et]&2048)&&(W[Et]|=2048),uD(W),W[Ar]=W[_l]=o,W[Jn]=a,W[xa]=v||o&&o[xa],W[jn]=T||o&&o[jn],W[zc]=b||o&&o[zc]||null,W[Lo]=g,W[Am]=ipe(),W[Wh]=B,W[aD]=x,W[Zi]=s.type==2?o[Zi]:W,W}function Dpe(o,s,a){let d=ms(s,o),p=Ape(a),g=o[xa].rendererFactory,v=yO(o,vO(o,p,null,Q5(a),d,s,null,g.createRenderer(d,a),null,null,null));return o[s.index]=v}function Q5(o){let s=16;return o.signals?s=4096:o.onPush&&(s=64),s}function e8(o,s,a,d){if(a===0)return-1;let p=s.length;for(let g=0;g<a;g++)s.push(d),o.blueprint.push(d),o.data.push(null);return p}function yO(o,s){return o[zh]?o[sD][Po]=s:o[zh]=s,o[sD]=s,s}function wn(o=1){t8(pi(),sn(),Ua()+o,!1)}function t8(o,s,a,d){if(!d)if((s[Et]&3)===3){let g=o.preOrderCheckHooks;g!==null&&oS(s,g,a)}else{let g=o.preOrderHooks;g!==null&&sS(s,g,0,a)}Xc(a)}var AS=(function(o){return o[o.None=0]="None",o[o.SignalBased=1]="SignalBased",o[o.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",o})(AS||{});function KD(o,s,a,d){let p=lt(null);try{let[g,v,T]=o.inputs[a],b=null;(v&AS.SignalBased)!==0&&(b=s[g][ei]),b!==null&&b.transformFn!==void 0?d=b.transformFn(d):T!==null&&(d=T.call(s,d)),o.setInput!==null?o.setInput(s,b,d,a,g):v5(s,b,g,d)}finally{lt(p)}}var ja=(function(o){return o[o.Important=1]="Important",o[o.DashCase=2]="DashCase",o})(ja||{}),Ope;function SO(o,s){return Ope(o,s)}var Zh=new Set,TO=(function(o){return o[o.CHANGE_DETECTION=0]="CHANGE_DETECTION",o[o.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",o})(TO||{}),zm=new Fe(""),X4=new Set;function Jc(o){X4.has(o)||(X4.add(o),performance?.mark?.("mark_feature_usage",{detail:{feature:o}}))}var n8=!1,YD=class extends ur{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(s=!1){super(),this.__isAsync=s,d4()&&(this.destroyRef=ge(Fa,{optional:!0})??void 0,this.pendingTasks=ge(ta,{optional:!0})??void 0)}emit(s){let a=lt(null);try{super.next(s)}finally{lt(a)}}subscribe(s,a,d){let p=s,g=a||(()=>null),v=d;if(s&&typeof s=="object"){let b=s;p=b.next?.bind(b),g=b.error?.bind(b),v=b.complete?.bind(b)}this.__isAsync&&(g=this.wrapInTimeout(g),p&&(p=this.wrapInTimeout(p)),v&&(v=this.wrapInTimeout(v)));let T=super.subscribe({next:p,error:g,complete:v});return s instanceof rr&&s.add(T),T}wrapInTimeout(s){return a=>{let d=this.pendingTasks?.add();setTimeout(()=>{try{s(a)}finally{d!==void 0&&this.pendingTasks?.remove(d)}})}}},Zn=YD;function r8(o){let s,a;function d(){o=xm;try{a!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(a),s!==void 0&&clearTimeout(s)}catch{}}return s=setTimeout(()=>{o(),d()}),typeof requestAnimationFrame=="function"&&(a=requestAnimationFrame(()=>{o(),d()})),()=>d()}function J4(o){return queueMicrotask(()=>o()),()=>{o=xm}}var CO="isAngularZone",fS=CO+"_ID",Npe=0,sr=class o{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Zn(!1);onMicrotaskEmpty=new Zn(!1);onStable=new Zn(!1);onError=new Zn(!1);constructor(s){let{enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:d=!1,shouldCoalesceRunChangeDetection:p=!1,scheduleInRootZone:g=n8}=s;if(typeof Zone>"u")throw new xe(908,!1);Zone.assertZonePatched();let v=this;v._nesting=0,v._outer=v._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!p&&d,v.shouldCoalesceRunChangeDetection=p,v.callbackScheduled=!1,v.scheduleInRootZone=g,kpe(v)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(CO)===!0}static assertInAngularZone(){if(!o.isInAngularZone())throw new xe(909,!1)}static assertNotInAngularZone(){if(o.isInAngularZone())throw new xe(909,!1)}run(s,a,d){return this._inner.run(s,a,d)}runTask(s,a,d,p){let g=this._inner,v=g.scheduleEventTask("NgZoneEvent: "+p,s,Ppe,xm,xm);try{return g.runTask(v,a,d)}finally{g.cancelTask(v)}}runGuarded(s,a,d){return this._inner.runGuarded(s,a,d)}runOutsideAngular(s){return this._outer.run(s)}},Ppe={};function RO(o){if(o._nesting==0&&!o.hasPendingMicrotasks&&!o.isStable)try{o._nesting++,o.onMicrotaskEmpty.emit(null)}finally{if(o._nesting--,!o.hasPendingMicrotasks)try{o.runOutsideAngular(()=>o.onStable.emit(null))}finally{o.isStable=!0}}}function Lpe(o){if(o.isCheckStableRunning||o.callbackScheduled)return;o.callbackScheduled=!0;function s(){r8(()=>{o.callbackScheduled=!1,$D(o),o.isCheckStableRunning=!0,RO(o),o.isCheckStableRunning=!1})}o.scheduleInRootZone?Zone.root.run(()=>{s()}):o._outer.run(()=>{s()}),$D(o)}function kpe(o){let s=()=>{Lpe(o)},a=Npe++;o._inner=o._inner.fork({name:"angular",properties:{[CO]:!0,[fS]:a,[fS+a]:!0},onInvokeTask:(d,p,g,v,T,b)=>{if(Mpe(b))return d.invokeTask(g,v,T,b);try{return Z4(o),d.invokeTask(g,v,T,b)}finally{(o.shouldCoalesceEventChangeDetection&&v.type==="eventTask"||o.shouldCoalesceRunChangeDetection)&&s(),Q4(o)}},onInvoke:(d,p,g,v,T,b,x)=>{try{return Z4(o),d.invoke(g,v,T,b,x)}finally{o.shouldCoalesceRunChangeDetection&&!o.callbackScheduled&&!xpe(b)&&s(),Q4(o)}},onHasTask:(d,p,g,v)=>{d.hasTask(g,v),p===g&&(v.change=="microTask"?(o._hasPendingMicrotasks=v.microTask,$D(o),RO(o)):v.change=="macroTask"&&(o.hasPendingMacrotasks=v.macroTask))},onHandleError:(d,p,g,v)=>(d.handleError(g,v),o.runOutsideAngular(()=>o.onError.emit(v)),!1)})}function $D(o){o._hasPendingMicrotasks||(o.shouldCoalesceEventChangeDetection||o.shouldCoalesceRunChangeDetection)&&o.callbackScheduled===!0?o.hasPendingMicrotasks=!0:o.hasPendingMicrotasks=!1}function Z4(o){o._nesting++,o.isStable&&(o.isStable=!1,o.onUnstable.emit(null))}function Q4(o){o._nesting--,RO(o)}var mS=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Zn;onMicrotaskEmpty=new Zn;onStable=new Zn;onError=new Zn;run(s,a,d){return s.apply(a,d)}runGuarded(s,a,d){return s.apply(a,d)}runOutsideAngular(s){return s()}runTask(s,a,d,p){return s.apply(a,d)}};function Mpe(o){return i8(o,"__ignore_ng_zone__")}function xpe(o){return i8(o,"__scheduler_tick__")}function i8(o,s){return!Array.isArray(o)||o.length!==1?!1:o[0]?.data?.[s]===!0}var o8=(()=>{class o{impl=null;execute(){this.impl?.execute()}static \u0275prov=qe({token:o,providedIn:"root",factory:()=>new o})}return o})();var Upe=new Fe("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function s8(o,s){let a=o.get(Upe);if(Array.isArray(s))for(let d of s)a.queue.add(d);else a.queue.add(s);a.scheduler&&a.scheduler(o)}function Fpe(o,s){for(let[a,d]of s)s8(o,d.animateFns)}function e5(o,s,a,d){let p=o?.[Sl]?.enter;s!==null&&p&&p.has(a.index)&&Fpe(d,p)}function $h(o,s,a,d,p,g,v,T){if(p!=null){let b,x=!1;fs(p)?b=p:Zs(p)&&(x=!0,p=p[ps]);let B=ko(p);o===0&&d!==null?(e5(T,d,g,a),v==null?X5(s,d,B):pS(s,d,B,v||null,!0)):o===1&&d!==null?(e5(T,d,g,a),pS(s,d,B,v||null,!0)):o===2?t5(T,g,a,W=>{J5(s,B,x,W)}):o===3&&t5(T,g,a,()=>{s.destroyNode(B)}),b!=null&&Jpe(s,o,a,b,g,d,v)}}function Vpe(o,s){a8(o,s),s[ps]=null,s[Lo]=null}function jpe(o,s,a,d,p,g){d[ps]=p,d[Lo]=s,OS(o,d,a,1,p,g)}function a8(o,s){s[xa].changeDetectionScheduler?.notify(9),OS(o,s,s[jn],2,null,null)}function Bpe(o){let s=o[zh];if(!s)return ND(o[ut],o);for(;s;){let a=null;if(Zs(s))a=s[zh];else{let d=s[fr];d&&(a=d)}if(!a){for(;s&&!s[Po]&&s!==o;)Zs(s)&&ND(s[ut],s),s=s[Ar];s===null&&(s=o),Zs(s)&&ND(s[ut],s),a=s&&s[Po]}s=a}}function IO(o,s){let a=o[Nm],d=a.indexOf(s);a.splice(d,1)}function DS(o,s){if(Tl(s))return;let a=s[jn];a.destroyNode&&OS(o,s,a,3,null,null),Bpe(s)}function ND(o,s){if(Tl(s))return;let a=lt(null);try{s[Et]&=-129,s[Et]|=256,s[Qi]&&_m(s[Qi]),Wpe(o,s),Gpe(o,s),s[ut].type===1&&s[jn].destroy();let d=s[El];if(d!==null&&fs(s[Ar])){d!==s[Ar]&&IO(d,s);let p=s[yl];p!==null&&p.detachView(o)}GD(s)}finally{lt(a)}}function t5(o,s,a,d){let p=o?.[Sl];if(p==null||p.leave==null||!p.leave.has(s.index))return d(!1);if(p.skipLeaveAnimations)return p.skipLeaveAnimations=!1,d(!1);o&&Zh.add(o),s8(a,()=>{if(p.leave&&p.leave.has(s.index)){let v=p.leave.get(s.index),T=[];if(v)for(let b=0;b<v.animateFns.length;b++){let x=v.animateFns[b],{promise:B}=x();T.push(B)}p.running=Promise.allSettled(T),Hpe(o,d)}else o&&Zh.delete(o),d(!1)})}function Hpe(o,s){let a=o[Sl]?.running;if(a){a.then(()=>{o[Sl].running=void 0,Zh.delete(o),s(!0)});return}s(!1)}function Gpe(o,s){let a=o.cleanup,d=s[qh];if(a!==null)for(let v=0;v<a.length-1;v+=2)if(typeof a[v]=="string"){let T=a[v+3];T>=0?d[T]():d[-T].unsubscribe(),v+=2}else{let T=d[a[v+1]];a[v].call(T)}d!==null&&(s[qh]=null);let p=s[Pa];if(p!==null){s[Pa]=null;for(let v=0;v<p.length;v++){let T=p[v];T()}}let g=s[Dm];if(g!==null){s[Dm]=null;for(let v of g)v.destroy()}}function Wpe(o,s){let a;if(o!=null&&(a=o.destroyHooks)!=null)for(let d=0;d<a.length;d+=2){let p=s[a[d]];if(!(p instanceof Il)){let g=a[d+1];if(Array.isArray(g))for(let v=0;v<g.length;v+=2){let T=p[g[v]],b=g[v+1];yn(4,T,b);try{b.call(T)}finally{yn(5,T,b)}}else{yn(4,p,g);try{g.call(p)}finally{yn(5,p,g)}}}}}function qpe(o,s,a){return zpe(o,s.parent,a)}function zpe(o,s,a){let d=s;for(;d!==null&&d.type&168;)s=d,d=s.parent;if(d===null)return a[ps];if(Yc(d)){let{encapsulation:p}=o.data[d.directiveStart+d.componentOffset];if(p===Va.None||p===Va.Emulated)return null}return ms(d,a)}function Kpe(o,s,a){return $pe(o,s,a)}function Ype(o,s,a){return o.type&40?ms(o,a):null}var $pe=Ype,n5;function bO(o,s,a,d){let p=qpe(o,d,s),g=s[jn],v=d.parent||s[Lo],T=Kpe(v,d,s);if(p!=null)if(Array.isArray(a))for(let b=0;b<a.length;b++)$4(g,p,a[b],T,!1);else $4(g,p,a,T,!1);n5!==void 0&&n5(g,d,s,a,p)}function Um(o,s){if(s!==null){let a=s.type;if(a&3)return ms(s,o);if(a&4)return XD(-1,o[s.index]);if(a&8){let d=s.child;if(d!==null)return Um(o,d);{let p=o[s.index];return fs(p)?XD(-1,p):ko(p)}}else{if(a&128)return Um(o,s.next);if(a&32)return SO(s,o)()||ko(o[s.index]);{let d=c8(o,s);if(d!==null){if(Array.isArray(d))return d[0];let p=Hc(o[Zi]);return Um(p,d)}else return Um(o,s.next)}}}return null}function c8(o,s){if(s!==null){let d=o[Zi][Lo],p=s.projection;return d.projection[p]}return null}function XD(o,s){let a=fr+o+1;if(a<s.length){let d=s[a],p=d[ut].firstChild;if(p!==null)return Um(d,p)}return s[Kc]}function wO(o,s,a,d,p,g,v){for(;a!=null;){let T=d[zc];if(a.type===128){a=a.next;continue}let b=d[a.index],x=a.type;if(v&&s===0&&(b&&Jh(ko(b),d),a.flags|=2),!gO(a))if(x&8)wO(o,s,a.child,d,p,g,!1),$h(s,o,T,p,b,a,g,d);else if(x&32){let B=SO(a,d),W;for(;W=B();)$h(s,o,T,p,W,a,g,d);$h(s,o,T,p,b,a,g,d)}else x&16?Xpe(o,s,d,a,p,g):$h(s,o,T,p,b,a,g,d);a=v?a.projectionNext:a.next}}function OS(o,s,a,d,p,g){wO(a,d,o.firstChild,s,p,g,!1)}function Xpe(o,s,a,d,p,g){let v=a[Zi],b=v[Lo].projection[d.projection];if(Array.isArray(b))for(let x=0;x<b.length;x++){let B=b[x];$h(s,o,a[zc],p,B,d,g,a)}else{let x=b,B=v[Ar];L5(d)&&(x.flags|=128),wO(o,s,x,B,p,g,!0)}}function Jpe(o,s,a,d,p,g,v){let T=d[Kc],b=ko(d);T!==b&&$h(s,o,a,g,T,p,v);for(let x=fr;x<d.length;x++){let B=d[x];OS(B[ut],B,o,s,g,T)}}function Zpe(o,s,a,d,p){if(s)p?o.addClass(a,d):o.removeClass(a,d);else{let g=d.indexOf("-")===-1?void 0:ja.DashCase;p==null?o.removeStyle(a,d,g):(typeof p=="string"&&p.endsWith("!important")&&(p=p.slice(0,-10),g|=ja.Important),o.setStyle(a,d,p,g))}}function d8(o,s,a,d,p){let g=Ua(),v=d&2;try{Xc(-1),v&&s.length>ni&&t8(o,s,ni,!1),yn(v?2:0,p,a),a(d,p)}finally{Xc(g),yn(v?3:1,p,a)}}function l8(o,s,a){ofe(o,s,a),(a.flags&64)===64&&sfe(o,s,a)}function u8(o,s,a=ms){let d=s.localNames;if(d!==null){let p=s.index+1;for(let g=0;g<d.length;g+=2){let v=d[g+1],T=v===-1?a(s,o):o[v];o[p++]=T}}}function Qpe(o,s,a,d){let g=d.get(H5,B5)||a===Va.ShadowDom,v=o.selectRootElement(s,g);return efe(v),v}function efe(o){tfe(o)}var tfe=()=>null;function nfe(o){return o==="class"?"className":o==="for"?"htmlFor":o==="formaction"?"formAction":o==="innerHtml"?"innerHTML":o==="readonly"?"readOnly":o==="tabindex"?"tabIndex":o}function h8(o,s,a,d,p,g){let v=s[ut];if(AO(o,v,s,a,d)){Yc(o)&&ife(s,o.index);return}o.type&3&&(a=nfe(a)),rfe(o,s,a,d,p,g)}function rfe(o,s,a,d,p,g){if(o.type&3){let v=ms(o,s);d=g!=null?g(d,o.value||"",a):d,p.setProperty(v,a,d)}else o.type&12}function ife(o,s){let a=Mo(s,o);a[Et]&16||(a[Et]|=64)}function ofe(o,s,a){let d=a.directiveStart,p=a.directiveEnd;Yc(a)&&Dpe(s,a,o.data[d+a.componentOffset]),o.firstCreatePass||uS(a,s);let g=a.initialInputs;for(let v=d;v<p;v++){let T=o.data[v],b=hS(s,o,v,a);if(Jh(b,s),g!==null&&ufe(s,v-d,b,T,a,g),Qs(T)){let x=Mo(a.index,s);x[Jn]=hS(s,o,v,a)}}}function sfe(o,s,a){let d=a.directiveStart,p=a.directiveEnd,g=a.index,v=N4();try{Xc(g);for(let T=d;T<p;T++){let b=o.data[T],x=s[T];Jy(T),(b.hostBindings!==null||b.hostVars!==0||b.hostAttrs!==null)&&afe(b,x)}}finally{Xc(-1),Jy(v)}}function afe(o,s){o.hostBindings!==null&&o.hostBindings(1,s)}function cfe(o,s){let a=o.directiveRegistry,d=null;if(a)for(let p=0;p<a.length;p++){let g=a[p];_pe(s,g.selectors,!1)&&(d??=[],Qs(g)?d.unshift(g):d.push(g))}return d}function dfe(o,s,a,d,p,g){let v=ms(o,s);lfe(s[jn],v,g,o.value,a,d,p)}function lfe(o,s,a,d,p,g,v){if(g==null)o.removeAttribute(s,p,a);else{let T=v==null?gl(g):v(g,d||"",p);o.setAttribute(s,p,T,a)}}function ufe(o,s,a,d,p,g){let v=g[s];if(v!==null)for(let T=0;T<v.length;T+=2){let b=v[T],x=v[T+1];KD(d,a,b,x)}}function hfe(o,s,a,d,p){let g=ni+a,v=s[ut],T=p(v,s,o,d,a);s[g]=T,Yh(o,!0);let b=o.type===2;return b?(Z5(s[jn],T,o),(E4()===0||Yy(o))&&Jh(T,s),v4()):Jh(T,s),tS()&&(!b||!gO(o))&&bO(v,s,T,o),o}function pfe(o){let s=o;return mD()?b4():(s=s.parent,Yh(s,!1)),s}function ffe(o,s){let a=o[zc];if(!a)return;let d;try{d=a.get(ro,null)}catch{d=null}d?.(s)}function AO(o,s,a,d,p){let g=o.inputs?.[d],v=o.hostDirectiveInputs?.[d],T=!1;if(v)for(let b=0;b<v.length;b+=2){let x=v[b],B=v[b+1],W=s.data[x];KD(W,a[x],B,p),T=!0}if(g)for(let b of g){let x=a[b],B=s.data[b];KD(B,x,d,p),T=!0}return T}function mfe(o,s){let a=Mo(s,o),d=a[ut];gfe(d,a);let p=a[ps];p!==null&&a[Wh]===null&&(a[Wh]=G5(p,a[zc])),yn(18),DO(d,a,a[Jn]),yn(19,a[Jn])}function gfe(o,s){for(let a=s.length;a<o.blueprint.length;a++)s.push(o.blueprint[a])}function DO(o,s,a){Zy(s);try{let d=o.viewQuery;d!==null&&qD(1,d,a);let p=o.template;p!==null&&d8(o,s,p,1,a),o.firstCreatePass&&(o.firstCreatePass=!1),s[yl]?.finishViewCreation(o),o.staticContentQueries&&W5(o,s),o.staticViewQueries&&qD(2,o.viewQuery,a);let g=o.components;g!==null&&_fe(s,g)}catch(d){throw o.firstCreatePass&&(o.incompleteFirstPass=!0,o.firstCreatePass=!1),d}finally{s[Et]&=-5,Qy()}}function _fe(o,s){for(let a=0;a<s.length;a++)mfe(o,s[a])}function OO(o,s,a,d){let p=lt(null);try{let g=s.tView,T=o[Et]&4096?4096:16,b=vO(o,g,a,T,null,s,null,null,d?.injector??null,d?.embeddedViewInjector??null,d?.dehydratedView??null),x=o[s.index];b[El]=x;let B=o[yl];return B!==null&&(b[yl]=B.createEmbeddedView(g)),DO(g,b,a),b}finally{lt(p)}}function jm(o,s){return!s||s.firstChild===null||L5(o)}function Bm(o,s,a,d,p=!1){for(;a!==null;){if(a.type===128){a=p?a.projectionNext:a.next;continue}let g=s[a.index];g!==null&&d.push(ko(g)),fs(g)&&p8(g,d);let v=a.type;if(v&8)Bm(o,s,a.child,d);else if(v&32){let T=SO(a,s),b;for(;b=T();)d.push(b)}else if(v&16){let T=c8(s,a);if(Array.isArray(T))d.push(...T);else{let b=Hc(s[Zi]);Bm(b[ut],b,T,d,!0)}}a=p?a.projectionNext:a.next}return d}function p8(o,s){for(let a=fr;a<o.length;a++){let d=o[a],p=d[ut].firstChild;p!==null&&Bm(d[ut],d,p,s)}o[Kc]!==o[ps]&&s.push(o[Kc])}function f8(o){if(o[Ky]!==null){for(let s of o[Ky])s.impl.addSequence(s);o[Ky].length=0}}var m8=[];function Efe(o){return o[Qi]??vfe(o)}function vfe(o){let s=m8.pop()??Object.create(Sfe);return s.lView=o,s}function yfe(o){o.lView[Qi]!==o&&(o.lView=null,m8.push(o))}var Sfe=gt(Ee({},wh),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:o=>{km(o.lView)},consumerOnSignalRead(){this.lView[Qi]=this}});function Tfe(o){let s=o[Qi]??Object.create(Cfe);return s.lView=o,s}var Cfe=gt(Ee({},wh),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:o=>{let s=Hc(o.lView);for(;s&&!g8(s[ut]);)s=Hc(s);s&&hD(s)},consumerOnSignalRead(){this.lView[Qi]=this}});function g8(o){return o.type!==2}function _8(o){if(o[Dm]===null)return;let s=!0;for(;s;){let a=!1;for(let d of o[Dm])d.dirty&&(a=!0,d.zone===null||Zone.current===d.zone?d.run():d.zone.run(()=>d.run()));s=a&&!!(o[Et]&8192)}}var Rfe=100;function E8(o,s=0){let d=o[xa].rendererFactory,p=!1;p||d.begin?.();try{Ife(o,s)}finally{p||d.end?.()}}function Ife(o,s){let a=gD();try{_D(!0),JD(o,s);let d=0;for(;Lm(o);){if(d===Rfe)throw new xe(103,!1);d++,JD(o,1)}}finally{_D(a)}}function bfe(o,s,a,d){if(Tl(s))return;let p=s[Et],g=!1,v=!1;Zy(s);let T=!0,b=null,x=null;g||(g8(o)?(x=Efe(s),b=Dh(x)):cy()===null?(T=!1,x=Tfe(s),b=Dh(x)):s[Qi]&&(_m(s[Qi]),s[Qi]=null));try{uD(s),A4(o.bindingStartIndex),a!==null&&d8(o,s,a,2,d);let B=(p&3)===3;if(!g)if(B){let re=o.preOrderCheckHooks;re!==null&&oS(s,re,null)}else{let re=o.preOrderHooks;re!==null&&sS(s,re,0,null),DD(s,0)}if(v||wfe(s),_8(s),v8(s,0),o.contentQueries!==null&&W5(o,s),!g)if(B){let re=o.contentCheckHooks;re!==null&&oS(s,re)}else{let re=o.contentHooks;re!==null&&sS(s,re,1),DD(s,1)}Dfe(o,s);let W=o.components;W!==null&&S8(s,W,0);let ee=o.viewQuery;if(ee!==null&&qD(2,ee,d),!g)if(B){let re=o.viewCheckHooks;re!==null&&oS(s,re)}else{let re=o.viewHooks;re!==null&&sS(s,re,2),DD(s,2)}if(o.firstUpdatePass===!0&&(o.firstUpdatePass=!1),s[zy]){for(let re of s[zy])re();s[zy]=null}g||(f8(s),s[Et]&=-73)}catch(B){throw g||km(s),B}finally{x!==null&&(mm(x,b),T&&yfe(x)),Qy()}}function v8(o,s){for(let a=M5(o);a!==null;a=x5(a))for(let d=fr;d<a.length;d++){let p=a[d];y8(p,s)}}function wfe(o){for(let s=M5(o);s!==null;s=x5(s)){if(!(s[Et]&2))continue;let a=s[Nm];for(let d=0;d<a.length;d++){let p=a[d];hD(p)}}}function Afe(o,s,a){yn(18);let d=Mo(s,o);y8(d,a),yn(19,d[Jn])}function y8(o,s){$y(o)&&JD(o,s)}function JD(o,s){let d=o[ut],p=o[Et],g=o[Qi],v=!!(s===0&&p&16);if(v||=!!(p&64&&s===0),v||=!!(p&1024),v||=!!(g?.dirty&&gm(g)),v||=!1,g&&(g.dirty=!1),o[Et]&=-9217,v)bfe(d,o,d.template,o[Jn]);else if(p&8192){let T=lt(null);try{_8(o),v8(o,1);let b=d.components;b!==null&&S8(o,b,1),f8(o)}finally{lt(T)}}}function S8(o,s,a){for(let d=0;d<s.length;d++)Afe(o,s[d],a)}function Dfe(o,s){let a=o.hostBindingOpCodes;if(a!==null)try{for(let d=0;d<a.length;d++){let p=a[d];if(p<0)Xc(~p);else{let g=p,v=a[++d],T=a[++d];O4(v,g);let b=s[g];yn(24,b),T(2,b),yn(25,b)}}}finally{Xc(-1)}}function NO(o,s){let a=gD()?64:1088;for(o[xa].changeDetectionScheduler?.notify(s);o;){o[Et]|=a;let d=Hc(o);if(Kh(o)&&!d)return o;o=d}return null}function T8(o,s,a,d){return[o,!0,0,s,null,d,null,a,null,null]}function C8(o,s){let a=fr+s;if(a<o.length)return o[a]}function NS(o,s,a,d=!0){let p=s[ut];if(Ofe(p,s,o,a),d){let v=XD(a,o),T=s[jn],b=T.parentNode(o[Kc]);b!==null&&jpe(p,o[Lo],T,s,b,v)}let g=s[Wh];g!==null&&g.firstChild!==null&&(g.firstChild=null)}function R8(o,s){let a=Hm(o,s);return a!==void 0&&DS(a[ut],a),a}function Hm(o,s){if(o.length<=fr)return;let a=fr+s,d=o[a];if(d){let p=d[El];p!==null&&p!==o&&IO(p,d),s>0&&(o[a-1][Po]=d[Po]);let g=Im(o,fr+s);Vpe(d[ut],d);let v=g[yl];v!==null&&v.detachView(g[ut]),d[Ar]=null,d[Po]=null,d[Et]&=-129}return d}function Ofe(o,s,a,d){let p=fr+d,g=a.length;d>0&&(a[p-1][Po]=s),d<g-fr?(s[Po]=a[p],ZA(a,fr+d,s)):(a.push(s),s[Po]=null),s[Ar]=a;let v=s[El];v!==null&&a!==v&&I8(v,s);let T=s[yl];T!==null&&T.insertView(o),Xy(s),s[Et]|=128}function I8(o,s){let a=o[Nm],d=s[Ar];if(Zs(d))o[Et]|=2;else{let p=d[Ar][Zi];s[Zi]!==p&&(o[Et]|=2)}a===null?o[Nm]=[s]:a.push(s)}var bl=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let s=this._lView,a=s[ut];return Bm(a,s,a.firstChild,[])}constructor(s,a){this._lView=s,this._cdRefInjectingView=a}get context(){return this._lView[Jn]}set context(s){this._lView[Jn]=s}get destroyed(){return Tl(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let s=this._lView[Ar];if(fs(s)){let a=s[Om],d=a?a.indexOf(this):-1;d>-1&&(Hm(s,d),Im(a,d))}this._attachedToViewContainer=!1}DS(this._lView[ut],this._lView)}onDestroy(s){pD(this._lView,s)}markForCheck(){NO(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Et]&=-129}reattach(){Xy(this._lView),this._lView[Et]|=128}detectChanges(){this._lView[Et]|=1024,E8(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new xe(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let s=Kh(this._lView),a=this._lView[El];a!==null&&!s&&IO(a,this._lView),a8(this._lView[ut],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new xe(902,!1);this._appRef=s;let a=Kh(this._lView),d=this._lView[El];d!==null&&!a&&I8(d,this._lView),Xy(this._lView)}};function PO(o,s,a,d,p){let g=o.data[s];if(g===null)g=Nfe(o,s,a,d,p),D4()&&(g.flags|=32);else if(g.type&64){g.type=a,g.value=d,g.attrs=p;let v=I4();g.injectorIndex=v===null?-1:v.injectorIndex}return Yh(g,!0),g}function Nfe(o,s,a,d,p){let g=fD(),v=mD(),T=v?g:g&&g.parent,b=o.data[s]=Lfe(o,T,a,s,d,p);return Pfe(o,b,g,v),b}function Pfe(o,s,a,d){o.firstChild===null&&(o.firstChild=s),a!==null&&(d?a.child==null&&s.parent!==null&&(a.child=s):a.next===null&&(a.next=s,s.prev=a))}function Lfe(o,s,a,d,p,g){let v=s?s.injectorIndex:-1,T=0;return T4()&&(T|=128),{type:a,index:d,insertBeforeIndex:null,injectorIndex:v,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:T,providerIndexes:0,value:p,attrs:g,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var AAe=new RegExp(`^(\\d+)*(${cpe}|${ape})*(.*)`);function kfe(o){let s=o[cD]??[],d=o[Ar][jn],p=[];for(let g of s)g.data[j5]!==void 0?p.push(g):Mfe(g,d);o[cD]=p}function Mfe(o,s){let a=0,d=o.firstChild;if(d){let p=o.data[V5];for(;a<p;){let g=d.nextSibling;J5(s,d,!1),d=g,a++}}}var xfe=()=>null,Ufe=()=>null;function ZD(o,s){return xfe(o,s)}function b8(o,s,a){return Ufe(o,s,a)}var w8=class{},PS=class{},QD=class{resolveComponentFactory(s){throw new xe(917,!1)}},Km=class{static NULL=new QD},wl=class{},rp=(()=>{class o{destroyNode=null;static __NG_ELEMENT_ID__=()=>Ffe()}return o})();function Ffe(){let o=sn(),s=no(),a=Mo(s.index,o);return(Zs(a)?a:o)[jn]}var A8=(()=>{class o{static \u0275prov=qe({token:o,providedIn:"root",factory:()=>null})}return o})();var aS={},eO=class{injector;parentInjector;constructor(s,a){this.injector=s,this.parentInjector=a}get(s,a,d){let p=this.injector.get(s,aS,d);return p!==aS||a===aS?p:this.parentInjector.get(s,a,d)}};function r5(o,s,a){let d=a?o.styles:null,p=a?o.classes:null,g=0;if(s!==null)for(let v=0;v<s.length;v++){let T=s[v];if(typeof T=="number")g=T;else if(g==1)p=HA(p,T);else if(g==2){let b=T,x=s[++v];d=HA(d,b+": "+x+";")}}a?o.styles=d:o.stylesWithoutHost=d,a?o.classes=p:o.classesWithoutHost=p}function Qt(o,s=0){let a=sn();if(a===null)return et(o,s);let d=no();return O5(d,a,Hr(o),s)}function Vfe(o,s,a,d,p){let g=d===null?null:{"":-1},v=p(o,a);if(v!==null){let T=v,b=null,x=null;for(let B of v)if(B.resolveHostDirectives!==null){[T,b,x]=B.resolveHostDirectives(v);break}Hfe(o,s,a,T,g,b,x)}g!==null&&d!==null&&jfe(a,d,g)}function jfe(o,s,a){let d=o.localNames=[];for(let p=0;p<s.length;p+=2){let g=a[s[p+1]];if(g==null)throw new xe(-301,!1);d.push(s[p],g)}}function Bfe(o,s,a){s.componentOffset=a,(o.components??=[]).push(s.index)}function Hfe(o,s,a,d,p,g,v){let T=d.length,b=!1;for(let ee=0;ee<T;ee++){let re=d[ee];!b&&Qs(re)&&(b=!0,Bfe(o,a,ee)),BD(uS(a,s),o,re.type)}Yfe(a,o.data.length,T);for(let ee=0;ee<T;ee++){let re=d[ee];re.providersResolver&&re.providersResolver(re)}let x=!1,B=!1,W=e8(o,s,T,null);T>0&&(a.directiveToIndex=new Map);for(let ee=0;ee<T;ee++){let re=d[ee];if(a.mergedAttrs=Vm(a.mergedAttrs,re.hostAttrs),Wfe(o,a,s,W,re),Kfe(W,re,p),v!==null&&v.has(re)){let[ze,Me]=v.get(re);a.directiveToIndex.set(re.type,[W,ze+a.directiveStart,Me+a.directiveStart])}else(g===null||!g.has(re))&&a.directiveToIndex.set(re.type,W);re.contentQueries!==null&&(a.flags|=4),(re.hostBindings!==null||re.hostAttrs!==null||re.hostVars!==0)&&(a.flags|=64);let Se=re.type.prototype;!x&&(Se.ngOnChanges||Se.ngOnInit||Se.ngDoCheck)&&((o.preOrderHooks??=[]).push(a.index),x=!0),!B&&(Se.ngOnChanges||Se.ngDoCheck)&&((o.preOrderCheckHooks??=[]).push(a.index),B=!0),W++}Gfe(o,a,g)}function Gfe(o,s,a){for(let d=s.directiveStart;d<s.directiveEnd;d++){let p=o.data[d];if(a===null||!a.has(p))i5(0,s,p,d),i5(1,s,p,d),s5(s,d,!1);else{let g=a.get(p);o5(0,s,g,d),o5(1,s,g,d),s5(s,d,!0)}}}function i5(o,s,a,d){let p=o===0?a.inputs:a.outputs;for(let g in p)if(p.hasOwnProperty(g)){let v;o===0?v=s.inputs??={}:v=s.outputs??={},v[g]??=[],v[g].push(d),D8(s,g)}}function o5(o,s,a,d){let p=o===0?a.inputs:a.outputs;for(let g in p)if(p.hasOwnProperty(g)){let v=p[g],T;o===0?T=s.hostDirectiveInputs??={}:T=s.hostDirectiveOutputs??={},T[v]??=[],T[v].push(d,g),D8(s,v)}}function D8(o,s){s==="class"?o.flags|=8:s==="style"&&(o.flags|=16)}function s5(o,s,a){let{attrs:d,inputs:p,hostDirectiveInputs:g}=o;if(d===null||!a&&p===null||a&&g===null||_O(o)){o.initialInputs??=[],o.initialInputs.push(null);return}let v=null,T=0;for(;T<d.length;){let b=d[T];if(b===0){T+=4;continue}else if(b===5){T+=2;continue}else if(typeof b=="number")break;if(!a&&p.hasOwnProperty(b)){let x=p[b];for(let B of x)if(B===s){v??=[],v.push(b,d[T+1]);break}}else if(a&&g.hasOwnProperty(b)){let x=g[b];for(let B=0;B<x.length;B+=2)if(x[B]===s){v??=[],v.push(x[B+1],d[T+1]);break}}T+=2}o.initialInputs??=[],o.initialInputs.push(v)}function Wfe(o,s,a,d,p){o.data[d]=p;let g=p.factory||(p.factory=hl(p.type,!0)),v=new Il(g,Qs(p),Qt,null);o.blueprint[d]=v,a[d]=v,qfe(o,s,d,e8(o,a,p.hostVars,_s),p)}function qfe(o,s,a,d,p){let g=p.hostBindings;if(g){let v=o.hostBindingOpCodes;v===null&&(v=o.hostBindingOpCodes=[]);let T=~s.index;zfe(v)!=T&&v.push(T),v.push(a,d,g)}}function zfe(o){let s=o.length;for(;s>0;){let a=o[--s];if(typeof a=="number"&&a<0)return a}return 0}function Kfe(o,s,a){if(a){if(s.exportAs)for(let d=0;d<s.exportAs.length;d++)a[s.exportAs[d]]=o;Qs(s)&&(a[""]=o)}}function Yfe(o,s,a){o.flags|=1,o.directiveStart=s,o.directiveEnd=s+a,o.providerIndexes=s}function O8(o,s,a,d,p,g,v,T){let b=s[ut],x=b.consts,B=$c(x,v),W=PO(b,o,a,d,B);return g&&Vfe(b,s,W,$c(x,T),p),W.mergedAttrs=Vm(W.mergedAttrs,W.attrs),W.attrs!==null&&r5(W,W.attrs,!1),W.mergedAttrs!==null&&r5(W,W.mergedAttrs,!0),b.queries!==null&&b.queries.elementStart(b,W),W}function N8(o,s){jhe(o,s),dD(s)&&o.queries.elementEnd(s)}function ra(o,s,a){if(a===_s)return!1;let d=o[s];return Object.is(d,a)?!1:(o[s]=a,!0)}function $fe(o,s,a,d){let p=ra(o,s,a);return ra(o,s+1,d)||p}function Xfe(o,s,a,d,p){let g=$fe(o,s,a,d);return ra(o,s+2,p)||g}function PD(o,s,a){return function d(p){let g=Yc(o)?Mo(o.index,s):s;NO(g,5);let v=s[Jn],T=a5(s,v,a,p),b=d.__ngNextListenerFn__;for(;b;)T=a5(s,v,b,p)&&T,b=b.__ngNextListenerFn__;return T}}function a5(o,s,a,d){let p=lt(null);try{return yn(6,s,a),a(d)!==!1}catch(g){return ffe(o,g),!1}finally{yn(7,s,a),lt(p)}}function Jfe(o,s,a,d,p,g,v,T){let b=Yy(o),x=!1,B=null;if(!d&&b&&(B=Qfe(s,a,g,o.index)),B!==null){let W=B.__ngLastListenerFn__||B;W.__ngNextListenerFn__=v,B.__ngLastListenerFn__=v,x=!0}else{let W=ms(o,a),ee=d?d(W):W;lpe(a,ee,g,T);let re=p.listen(ee,g,T);if(!Zfe(g)){let Se=d?ze=>d(ko(ze[o.index])):o.index;P8(Se,s,a,g,T,re,!1)}}return x}function Zfe(o){return o.startsWith("animation")||o.startsWith("transition")}function Qfe(o,s,a,d){let p=o.cleanup;if(p!=null)for(let g=0;g<p.length-1;g+=2){let v=p[g];if(v===a&&p[g+1]===d){let T=s[qh],b=p[g+2];return T&&T.length>b?T[b]:null}typeof v=="string"&&(g+=2)}return null}function P8(o,s,a,d,p,g,v){let T=s.firstCreatePass?_4(s):null,b=g4(a),x=b.length;b.push(p,g),T&&T.push(d,o,x,(x+1)*(v?-1:1))}function c5(o,s,a,d,p,g){let v=s[a],T=s[ut],x=T.data[a].outputs[d],W=v[x].subscribe(g);P8(o.index,T,s,p,g,W,!0)}var tO=Symbol("BINDING");var gS=class extends Km{ngModule;constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){let a=qc(s);return new Qh(a,this.ngModule)}};function eme(o){return Object.keys(o).map(s=>{let[a,d,p]=o[s],g={propName:a,templateName:s,isSignal:(d&AS.SignalBased)!==0};return p&&(g.transform=p),g})}function tme(o){return Object.keys(o).map(s=>({propName:o[s],templateName:s}))}function nme(o,s,a){let d=s instanceof pr?s:s?.injector;return d&&o.getStandaloneInjector!==null&&(d=o.getStandaloneInjector(d)||d),d?new eO(a,d):a}function rme(o){let s=o.get(wl,null);if(s===null)throw new xe(407,!1);let a=o.get(A8,null),d=o.get(Gc,null);return{rendererFactory:s,sanitizer:a,changeDetectionScheduler:d,ngReflect:!1}}function ime(o,s){let a=L8(o);return $5(s,a,a==="svg"?u4:a==="math"?h4:null)}function L8(o){return(o.selectors[0][0]||"div").toLowerCase()}var Qh=class extends PS{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=eme(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=tme(this.componentDef.outputs),this.cachedOutputs}constructor(s,a){super(),this.componentDef=s,this.ngModule=a,this.componentType=s.type,this.selector=Spe(s.selectors),this.ngContentSelectors=s.ngContentSelectors??[],this.isBoundToModule=!!a}create(s,a,d,p,g,v){yn(22);let T=lt(null);try{let b=this.componentDef,x=ome(d,b,v,g),B=nme(b,p||this.ngModule,s),W=rme(B),ee=W.rendererFactory.createRenderer(null,b),re=d?Qpe(ee,d,b.encapsulation,B):ime(b,ee),Se=v?.some(d5)||g?.some(Oe=>typeof Oe!="function"&&Oe.bindings.some(d5)),ze=vO(null,x,null,512|Q5(b),null,null,W,ee,B,null,G5(re,B,!0));ze[ni]=re,Zy(ze);let Me=null;try{let Oe=O8(ni,ze,2,"#host",()=>x.directiveRegistry,!0,0);Z5(ee,re,Oe),Jh(re,ze),l8(x,ze,Oe),q5(x,Oe,ze),N8(x,Oe),a!==void 0&&ame(Oe,this.ngContentSelectors,a),Me=Mo(Oe.index,ze),ze[Jn]=Me[Jn],DO(x,ze,null)}catch(Oe){throw Me!==null&&GD(Me),GD(ze),Oe}finally{yn(23),Qy()}return new _S(this.componentType,ze,!!Se)}finally{lt(T)}}};function ome(o,s,a,d){let p=o?["ng-version","20.3.6"]:Tpe(s.selectors[0]),g=null,v=null,T=0;if(a)for(let B of a)T+=B[tO].requiredVars,B.create&&(B.targetIdx=0,(g??=[]).push(B)),B.update&&(B.targetIdx=0,(v??=[]).push(B));if(d)for(let B=0;B<d.length;B++){let W=d[B];if(typeof W!="function")for(let ee of W.bindings){T+=ee[tO].requiredVars;let re=B+1;ee.create&&(ee.targetIdx=re,(g??=[]).push(ee)),ee.update&&(ee.targetIdx=re,(v??=[]).push(ee))}}let b=[s];if(d)for(let B of d){let W=typeof B=="function"?B:B.type,ee=nD(W);b.push(ee)}return EO(0,null,sme(g,v),1,T,b,null,null,null,[p],null)}function sme(o,s){return!o&&!s?null:a=>{if(a&1&&o)for(let d of o)d.create();if(a&2&&s)for(let d of s)d.update()}}function d5(o){let s=o[tO].kind;return s==="input"||s==="twoWay"}var _S=class extends w8{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(s,a,d){super(),this._rootLView=a,this._hasInputBindings=d,this._tNode=Pm(a[ut],ni),this.location=pO(this._tNode,a),this.instance=Mo(this._tNode.index,a)[Jn],this.hostView=this.changeDetectorRef=new bl(a,void 0),this.componentType=s}setInput(s,a){this._hasInputBindings;let d=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(s)&&Object.is(this.previousInputValues.get(s),a))return;let p=this._rootLView,g=AO(d,p[ut],p,s,a);this.previousInputValues.set(s,a);let v=Mo(d.index,p);NO(v,1)}get injector(){return new Rl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}};function ame(o,s,a){let d=o.projection=[];for(let p=0;p<s.length;p++){let g=a[p];d.push(g!=null&&g.length?Array.from(g):null)}}var Ym=(()=>{class o{static __NG_ELEMENT_ID__=cme}return o})();function cme(){let o=no();return lme(o,sn())}var dme=Ym,k8=class extends dme{_lContainer;_hostTNode;_hostLView;constructor(s,a,d){super(),this._lContainer=s,this._hostTNode=a,this._hostLView=d}get element(){return pO(this._hostTNode,this._hostLView)}get injector(){return new Rl(this._hostTNode,this._hostLView)}get parentInjector(){let s=hO(this._hostTNode,this._hostLView);if(R5(s)){let a=lS(s,this._hostLView),d=dS(s),p=a[ut].data[d+8];return new Rl(p,a)}else return new Rl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){let a=l5(this._lContainer);return a!==null&&a[s]||null}get length(){return this._lContainer.length-fr}createEmbeddedView(s,a,d){let p,g;typeof d=="number"?p=d:d!=null&&(p=d.index,g=d.injector);let v=ZD(this._lContainer,s.ssrId),T=s.createEmbeddedViewImpl(a||{},g,v);return this.insertImpl(T,p,jm(this._hostTNode,v)),T}createComponent(s,a,d,p,g,v,T){let b=s&&!Mhe(s),x;if(b)x=a;else{let Me=a||{};x=Me.index,d=Me.injector,p=Me.projectableNodes,g=Me.environmentInjector||Me.ngModuleRef,v=Me.directives,T=Me.bindings}let B=b?s:new Qh(qc(s)),W=d||this.parentInjector;if(!g&&B.ngModule==null){let Oe=(b?W:this.parentInjector).get(pr,null);Oe&&(g=Oe)}let ee=qc(B.componentType??{}),re=ZD(this._lContainer,ee?.id??null),Se=re?.firstChild??null,ze=B.create(W,p,Se,g,v,T);return this.insertImpl(ze.hostView,x,jm(this._hostTNode,re)),ze}insert(s,a){return this.insertImpl(s,a,!0)}insertImpl(s,a,d){let p=s._lView;if(p4(p)){let T=this.indexOf(s);if(T!==-1)this.detach(T);else{let b=p[Ar],x=new k8(b,b[Lo],b[Ar]);x.detach(x.indexOf(s))}}let g=this._adjustIndex(a),v=this._lContainer;return NS(v,p,g,d),s.attachToViewContainerRef(),ZA(LD(v),g,s),s}move(s,a){return this.insert(s,a)}indexOf(s){let a=l5(this._lContainer);return a!==null?a.indexOf(s):-1}remove(s){let a=this._adjustIndex(s,-1),d=Hm(this._lContainer,a);d&&(Im(LD(this._lContainer),a),DS(d[ut],d))}detach(s){let a=this._adjustIndex(s,-1),d=Hm(this._lContainer,a);return d&&Im(LD(this._lContainer),a)!=null?new bl(d):null}_adjustIndex(s,a=0){return s??this.length+a}};function l5(o){return o[Om]}function LD(o){return o[Om]||(o[Om]=[])}function lme(o,s){let a,d=s[o.index];return fs(d)?a=d:(a=T8(d,s,null,o),s[o.index]=a,yO(s,a)),hme(a,s,o,d),new k8(a,o,s)}function ume(o,s){let a=o[jn],d=a.createComment(""),p=ms(s,o),g=a.parentNode(p);return pS(a,g,d,a.nextSibling(p),!1),d}var hme=mme,pme=()=>!1;function fme(o,s,a){return pme(o,s,a)}function mme(o,s,a,d){if(o[Kc])return;let p;a.type&8?p=ko(d):p=ume(s,a),o[Kc]=p}var ep=class{},LS=class{};var ES=class extends ep{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new gS(this);constructor(s,a,d,p=!0){super(),this.ngModuleType=s,this._parent=a;let g=tD(s);this._bootstrapComponents=K5(g.bootstrap),this._r3Injector=TD(s,a,[{provide:ep,useValue:this},{provide:Km,useValue:this.componentFactoryResolver},...d],La(s),new Set(["environment"])),p&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}},vS=class extends LS{moduleType;constructor(s){super(),this.moduleType=s}create(s){return new ES(this.moduleType,s,[])}};var Gm=class extends ep{injector;componentFactoryResolver=new gS(this);instance=null;constructor(s){super();let a=new fl([...s.providers,{provide:ep,useValue:this},{provide:Km,useValue:this.componentFactoryResolver}],s.parent||wm(),s.debugName,new Set(["environment"]));this.injector=a,s.runEnvironmentInitializers&&a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}};function $m(o,s,a=null){return new Gm({providers:o,parent:s,debugName:a,runEnvironmentInitializers:!0}).injector}var gme=(()=>{class o{_injector;cachedInjectors=new Map;constructor(a){this._injector=a}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a)){let d=rD(!1,a.type),p=d.length>0?$m([d],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a,p)}return this.cachedInjectors.get(a)}ngOnDestroy(){try{for(let a of this.cachedInjectors.values())a!==null&&a.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=qe({token:o,providedIn:"environment",factory:()=>new o(et(pr))})}return o})();function Es(o){return qm(()=>{let s=M8(o),a=gt(Ee({},s),{decls:o.decls,vars:o.vars,template:o.template,consts:o.consts||null,ngContentSelectors:o.ngContentSelectors,onPush:o.changeDetection===fO.OnPush,directiveDefs:null,pipeDefs:null,dependencies:s.standalone&&o.dependencies||null,getStandaloneInjector:s.standalone?p=>p.get(gme).getOrCreateStandaloneInjector(a):null,getExternalStyles:null,signals:o.signals??!1,data:o.data||{},encapsulation:o.encapsulation||Va.Emulated,styles:o.styles||Ji,_:null,schemas:o.schemas||null,tView:null,id:""});s.standalone&&Jc("NgStandalone"),x8(a);let d=o.dependencies;return a.directiveDefs=u5(d,_me),a.pipeDefs=u5(d,r4),a.id=yme(a),a})}function _me(o){return qc(o)||nD(o)}function ia(o){return qm(()=>({type:o.type,bootstrap:o.bootstrap||Ji,declarations:o.declarations||Ji,imports:o.imports||Ji,exports:o.exports||Ji,transitiveCompileScopes:null,schemas:o.schemas||null,id:o.id||null}))}function Eme(o,s){if(o==null)return Wc;let a={};for(let d in o)if(o.hasOwnProperty(d)){let p=o[d],g,v,T,b;Array.isArray(p)?(T=p[0],g=p[1],v=p[2]??g,b=p[3]||null):(g=p,v=p,T=AS.None,b=null),a[g]=[d,T,b],s[g]=v}return a}function vme(o){if(o==null)return Wc;let s={};for(let a in o)o.hasOwnProperty(a)&&(s[o[a]]=a);return s}function Wr(o){return qm(()=>{let s=M8(o);return x8(s),s})}function M8(o){let s={};return{type:o.type,providersResolver:null,factory:null,hostBindings:o.hostBindings||null,hostVars:o.hostVars||0,hostAttrs:o.hostAttrs||null,contentQueries:o.contentQueries||null,declaredInputs:s,inputConfig:o.inputs||Wc,exportAs:o.exportAs||null,standalone:o.standalone??!0,signals:o.signals===!0,selectors:o.selectors||Ji,viewQuery:o.viewQuery||null,features:o.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:Eme(o.inputs,s),outputs:vme(o.outputs),debugInfo:null}}function x8(o){o.features?.forEach(s=>s(o))}function u5(o,s){return o?()=>{let a=typeof o=="function"?o():o,d=[];for(let p of a){let g=s(p);g!==null&&d.push(g)}return d}:null}function yme(o){let s=0,a=typeof o.consts=="function"?"":o.consts,d=[o.selectors,o.ngContentSelectors,o.hostVars,o.hostAttrs,a,o.vars,o.decls,o.encapsulation,o.standalone,o.signals,o.exportAs,JSON.stringify(o.inputs),JSON.stringify(o.outputs),Object.getOwnPropertyNames(o.type.prototype),!!o.contentQueries,!!o.viewQuery];for(let g of d.join("|"))s=Math.imul(31,s)+g.charCodeAt(0)<<0;return s+=2147483648,"c"+s}function Sme(o){return Object.getPrototypeOf(o.prototype).constructor}function vs(o){let s=Sme(o.type),a=!0,d=[o];for(;s;){let p;if(Qs(o))p=s.\u0275cmp||s.\u0275dir;else{if(s.\u0275cmp)throw new xe(903,!1);p=s.\u0275dir}if(p){if(a){d.push(p);let v=o;v.inputs=kD(o.inputs),v.declaredInputs=kD(o.declaredInputs),v.outputs=kD(o.outputs);let T=p.hostBindings;T&&bme(o,T);let b=p.viewQuery,x=p.contentQueries;if(b&&Rme(o,b),x&&Ime(o,x),Tme(o,p),XW(o.outputs,p.outputs),Qs(p)&&p.data.animation){let B=o.data;B.animation=(B.animation||[]).concat(p.data.animation)}}let g=p.features;if(g)for(let v=0;v<g.length;v++){let T=g[v];T&&T.ngInherit&&T(o),T===vs&&(a=!1)}}s=Object.getPrototypeOf(s)}Cme(d)}function Tme(o,s){for(let a in s.inputs){if(!s.inputs.hasOwnProperty(a)||o.inputs.hasOwnProperty(a))continue;let d=s.inputs[a];d!==void 0&&(o.inputs[a]=d,o.declaredInputs[a]=s.declaredInputs[a])}}function Cme(o){let s=0,a=null;for(let d=o.length-1;d>=0;d--){let p=o[d];p.hostVars=s+=p.hostVars,p.hostAttrs=Vm(p.hostAttrs,a=Vm(a,p.hostAttrs))}}function kD(o){return o===Wc?{}:o===Ji?[]:o}function Rme(o,s){let a=o.viewQuery;a?o.viewQuery=(d,p)=>{s(d,p),a(d,p)}:o.viewQuery=s}function Ime(o,s){let a=o.contentQueries;a?o.contentQueries=(d,p,g)=>{s(d,p,g),a(d,p,g)}:o.contentQueries=s}function bme(o,s){let a=o.hostBindings;a?o.hostBindings=(d,p)=>{s(d,p),a(d,p)}:o.hostBindings=s}function wme(o,s,a,d,p,g,v,T){if(a.firstCreatePass){o.mergedAttrs=Vm(o.mergedAttrs,o.attrs);let B=o.tView=EO(2,o,p,g,v,a.directiveRegistry,a.pipeRegistry,null,a.schemas,a.consts,null);a.queries!==null&&(a.queries.template(a,o),B.queries=a.queries.embeddedTView(o))}T&&(o.flags|=T),Yh(o,!1);let b=Ame(a,s,o,d);tS()&&bO(a,s,b,o),Jh(b,s);let x=T8(b,s,b,o);s[d+ni]=x,yO(s,x),fme(x,o,s)}function yS(o,s,a,d,p,g,v,T,b,x,B){let W=a+ni,ee;if(s.firstCreatePass){if(ee=PO(s,W,4,v||null,T||null),x!=null){let re=$c(s.consts,x);ee.localNames=[];for(let Se=0;Se<re.length;Se+=2)ee.localNames.push(re[Se],-1)}}else ee=s.data[W];return wme(ee,o,s,a,d,p,g,b),x!=null&&u8(o,ee,B),ee}var Ame=Dme;function Dme(o,s,a,d){return nS(!0),s[jn].createComment("")}var LO=(()=>{class o{log(a){console.log(a)}warn(a){console.warn(a)}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"platform"})}return o})();var kO=new Fe("");function Nl(o){return!!o&&typeof o.then=="function"}function U8(o){return!!o&&typeof o.subscribe=="function"}var F8=new Fe("");var MO=(()=>{class o{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((a,d)=>{this.resolve=a,this.reject=d});appInits=ge(F8,{optional:!0})??[];injector=ge(us);constructor(){}runInitializers(){if(this.initialized)return;let a=[];for(let p of this.appInits){let g=Gr(this.injector,p);if(Nl(g))a.push(g);else if(U8(g)){let v=new Promise((T,b)=>{g.subscribe({complete:T,error:b})});a.push(v)}}let d=()=>{this.done=!0,this.resolve()};Promise.all(a).then(()=>{d()}).catch(p=>{this.reject(p)}),a.length===0&&d(),this.initialized=!0}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),kS=new Fe("");function V8(){pA(()=>{let o="";throw new xe(600,o)})}function j8(o){return o.isBoundToModule}var Ome=10;var Zc=(()=>{class o{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=ge(ro);afterRenderManager=ge(o8);zonelessEnabled=ge(Mm);rootEffectScheduler=ge(AD);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new ur;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=ge(ta);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(wt(a=>!a))}constructor(){ge(zm,{optional:!0})}whenStable(){let a;return new Promise(d=>{a=this.isStable.subscribe({next:p=>{p&&d()}})}).finally(()=>{a.unsubscribe()})}_injector=ge(pr);_rendererFactory=null;get injector(){return this._injector}bootstrap(a,d){return this.bootstrapImpl(a,d)}bootstrapImpl(a,d,p=us.NULL){return this._injector.get(sr).run(()=>{yn(10);let v=a instanceof PS;if(!this._injector.get(MO).done){let Se="";throw new xe(405,Se)}let b;v?b=a:b=this._injector.get(Km).resolveComponentFactory(a),this.componentTypes.push(b.componentType);let x=j8(b)?void 0:this._injector.get(ep),B=d||b.selector,W=b.create(p,[],B,x),ee=W.location.nativeElement,re=W.injector.get(kO,null);return re?.registerApplication(ee),W.onDestroy(()=>{this.detachView(W.hostView),Fm(this.components,W),re?.unregisterApplication(ee)}),this._loadComponent(W),yn(11,W),W})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){yn(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(TO.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new xe(101,!1);let a=lt(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,lt(a),this.afterTick.next(),yn(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(wl,null,{optional:!0}));let a=0;for(;this.dirtyFlags!==0&&a++<Ome;)yn(14),this.synchronizeOnce(),yn(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let a=!1;if(this.dirtyFlags&7){let d=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:p}of this.allViews){if(!d&&!Lm(p))continue;let g=d&&!this.zonelessEnabled?0:1;E8(p,g),a=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}a||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:a})=>Lm(a))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(a){let d=a;this._views.push(d),d.attachToAppRef(this)}detachView(a){let d=a;Fm(this._views,d),d.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView);try{this.tick()}catch(p){this.internalErrorHandler(p)}this.components.push(a),this._injector.get(kS,[]).forEach(p=>p(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>Fm(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new xe(406,!1);let a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function Fm(o,s){let a=o.indexOf(s);a>-1&&o.splice(a,1)}function MS(o,s,a,d){let p=sn(),g=Cl();if(ra(p,g,s)){let v=pi(),T=eS();dfe(T,p,o,s,a,d)}return MS}var MAe=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var nO=class{destroy(s){}updateValue(s,a){}swap(s,a){let d=Math.min(s,a),p=Math.max(s,a),g=this.detach(p);if(p-d>1){let v=this.detach(d);this.attach(d,g),this.attach(p,v)}else this.attach(d,g)}move(s,a){this.attach(a,this.detach(s,!0))}};function MD(o,s,a,d,p){return o===a&&Object.is(s,d)?1:Object.is(p(o,s),p(a,d))?-1:0}function Nme(o,s,a){let d,p,g=0,v=o.length-1,T=void 0;if(Array.isArray(s)){let b=s.length-1;for(;g<=v&&g<=b;){let x=o.at(g),B=s[g],W=MD(g,x,g,B,a);if(W!==0){W<0&&o.updateValue(g,B),g++;continue}let ee=o.at(v),re=s[b],Se=MD(v,ee,b,re,a);if(Se!==0){Se<0&&o.updateValue(v,re),v--,b--;continue}let ze=a(g,x),Me=a(v,ee),Oe=a(g,B);if(Object.is(Oe,Me)){let kn=a(b,re);Object.is(kn,ze)?(o.swap(g,v),o.updateValue(v,re),b--,v--):o.move(v,g),o.updateValue(g,B),g++;continue}if(d??=new SS,p??=p5(o,g,v,a),rO(o,d,g,Oe))o.updateValue(g,B),g++,v++;else if(p.has(Oe))d.set(ze,o.detach(g)),v--;else{let kn=o.create(g,s[g]);o.attach(g,kn),g++,v++}}for(;g<=b;)h5(o,d,a,g,s[g]),g++}else if(s!=null){let b=s[Symbol.iterator](),x=b.next();for(;!x.done&&g<=v;){let B=o.at(g),W=x.value,ee=MD(g,B,g,W,a);if(ee!==0)ee<0&&o.updateValue(g,W),g++,x=b.next();else{d??=new SS,p??=p5(o,g,v,a);let re=a(g,W);if(rO(o,d,g,re))o.updateValue(g,W),g++,v++,x=b.next();else if(!p.has(re))o.attach(g,o.create(g,W)),g++,v++,x=b.next();else{let Se=a(g,B);d.set(Se,o.detach(g)),v--}}}for(;!x.done;)h5(o,d,a,o.length,x.value),x=b.next()}for(;g<=v;)o.destroy(o.detach(v--));d?.forEach(b=>{o.destroy(b)})}function rO(o,s,a,d){return s!==void 0&&s.has(d)?(o.attach(a,s.get(d)),s.delete(d),!0):!1}function h5(o,s,a,d,p){if(rO(o,s,d,a(d,p)))o.updateValue(d,p);else{let g=o.create(d,p);o.attach(d,g)}}function p5(o,s,a,d){let p=new Set;for(let g=s;g<=a;g++)p.add(d(g,o.at(g)));return p}var SS=class{kvMap=new Map;_vMap=void 0;has(s){return this.kvMap.has(s)}delete(s){if(!this.has(s))return!1;let a=this.kvMap.get(s);return this._vMap!==void 0&&this._vMap.has(a)?(this.kvMap.set(s,this._vMap.get(a)),this._vMap.delete(a)):this.kvMap.delete(s),!0}get(s){return this.kvMap.get(s)}set(s,a){if(this.kvMap.has(s)){let d=this.kvMap.get(s);this._vMap===void 0&&(this._vMap=new Map);let p=this._vMap;for(;p.has(d);)d=p.get(d);p.set(d,a)}else this.kvMap.set(s,a)}forEach(s){for(let[a,d]of this.kvMap)if(s(d,a),this._vMap!==void 0){let p=this._vMap;for(;p.has(d);)d=p.get(d),s(d,a)}}};function xo(o,s,a,d,p,g,v,T){Jc("NgControlFlow");let b=sn(),x=pi(),B=$c(x.consts,g);return yS(b,x,o,s,a,d,p,B,256,v,T),xO}function xO(o,s,a,d,p,g,v,T){Jc("NgControlFlow");let b=sn(),x=pi(),B=$c(x.consts,g);return yS(b,x,o,s,a,d,p,B,512,v,T),xO}function Uo(o,s){Jc("NgControlFlow");let a=sn(),d=Cl(),p=a[d]!==_s?a[d]:-1,g=p!==-1?TS(a,ni+p):void 0,v=0;if(ra(a,d,o)){let T=lt(null);try{if(g!==void 0&&R8(g,v),o!==-1){let b=ni+o,x=TS(a,b),B=aO(a[ut],b),W=b8(x,B,a),ee=OO(a,B,s,{dehydratedView:W});NS(x,ee,v,jm(B,W))}}finally{lt(T)}}else if(g!==void 0){let T=C8(g,v);T!==void 0&&(T[Jn]=s)}}var iO=class{lContainer;$implicit;$index;constructor(s,a,d){this.lContainer=s,this.$implicit=a,this.$index=d}get $count(){return this.lContainer.length-fr}};function xS(o){return o}var oO=class{hasEmptyBlock;trackByFn;liveCollection;constructor(s,a,d){this.hasEmptyBlock=s,this.trackByFn=a,this.liveCollection=d}};function US(o,s,a,d,p,g,v,T,b,x,B,W,ee){Jc("NgControlFlow");let re=sn(),Se=pi(),ze=b!==void 0,Me=sn(),Oe=T?v.bind(Me[Zi][Jn]):v,kn=new oO(ze,Oe);Me[ni+o]=kn,yS(re,Se,o+1,s,a,d,p,$c(Se.consts,g),256),ze&&yS(re,Se,o+2,b,x,B,W,$c(Se.consts,ee),512)}var sO=class extends nO{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(s,a,d){super(),this.lContainer=s,this.hostLView=a,this.templateTNode=d}get length(){return this.lContainer.length-fr}at(s){return this.getLView(s)[Jn].$implicit}attach(s,a){let d=a[Wh];this.needsIndexUpdate||=s!==this.length,NS(this.lContainer,a,s,jm(this.templateTNode,d))}detach(s,a){return this.needsIndexUpdate||=s!==this.length-1,a&&Pme(this.lContainer,s),Lme(this.lContainer,s)}create(s,a){let d=ZD(this.lContainer,this.templateTNode.tView.ssrId),p=OO(this.hostLView,this.templateTNode,new iO(this.lContainer,a,s),{dehydratedView:d});return this.operationsCounter?.recordCreate(),p}destroy(s){DS(s[ut],s),this.operationsCounter?.recordDestroy()}updateValue(s,a){this.getLView(s)[Jn].$implicit=a}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let s=0;s<this.length;s++)this.getLView(s)[Jn].$index=s}getLView(s){return kme(this.lContainer,s)}};function FS(o){let s=lt(null),a=Ua();try{let d=sn(),p=d[ut],g=d[a],v=a+1,T=TS(d,v);if(g.liveCollection===void 0){let x=aO(p,v);g.liveCollection=new sO(T,d,x)}else g.liveCollection.reset();let b=g.liveCollection;if(Nme(b,o,g.trackByFn),b.updateIndexes(),g.hasEmptyBlock){let x=Cl(),B=b.length===0;if(ra(d,x,B)){let W=a+2,ee=TS(d,W);if(B){let re=aO(p,W),Se=b8(ee,re,d),ze=OO(d,re,void 0,{dehydratedView:Se});NS(ee,ze,0,jm(re,Se))}else p.firstUpdatePass&&kfe(ee),R8(ee,0)}}}finally{lt(s)}}function TS(o,s){return o[s]}function Pme(o,s){if(o.length<=fr)return;let a=fr+s,d=o[a];d&&d[Sl]&&(d[Sl].skipLeaveAnimations=!0)}function Lme(o,s){return Hm(o,s)}function kme(o,s){return C8(o,s)}function aO(o,s){return Pm(o,s)}function Pl(o,s,a){let d=sn(),p=Cl();if(ra(d,p,s)){let g=pi(),v=eS();h8(v,d,o,s,d[jn],a)}return Pl}function f5(o,s,a,d,p){AO(s,o,a,p?"class":"style",d)}function At(o,s,a,d){let p=sn(),g=p[ut],v=o+ni,T=g.firstCreatePass?O8(v,p,2,s,cfe,S4(),a,d):g.data[v];if(hfe(T,p,o,s,Mme),Yy(T)){let b=p[ut];l8(b,p,T),q5(b,T,p)}return d!=null&&u8(p,T),At}function Ot(){let o=pi(),s=no(),a=pfe(s);return o.firstCreatePass&&N8(o,a),C4(a)&&R4(),y4(),a.classesWithoutHost!=null&&Hhe(a)&&f5(o,a,sn(),a.classesWithoutHost,!0),a.stylesWithoutHost!=null&&Ghe(a)&&f5(o,a,sn(),a.stylesWithoutHost,!1),Ot}function Dr(o,s,a,d){return At(o,s,a,d),Ot(),Dr}var Mme=(o,s,a,d,p)=>(nS(!0),$5(s[jn],d,U4()));function Qc(){return sn()}var Xm="en-US";var xme=Xm;function B8(o){typeof o=="string"&&(xme=o.toLowerCase().replace(/_/g,"-"))}function qr(o,s,a){let d=sn(),p=pi(),g=no();return H8(p,d,d[jn],g,o,s,a),qr}function H8(o,s,a,d,p,g,v){let T=!0,b=null;if((d.type&3||v)&&(b??=PD(d,s,g),Jfe(d,o,s,v,a,p,g,b)&&(T=!1)),T){let x=d.outputs?.[p],B=d.hostDirectiveOutputs?.[p];if(B&&B.length)for(let W=0;W<B.length;W+=2){let ee=B[W],re=B[W+1];b??=PD(d,s,g),c5(d,s,ee,re,p,b)}if(x&&x.length)for(let W of x)b??=PD(d,s,g),c5(d,s,W,p,p,b)}}function Li(o=1){return x4(o)}function iS(o,s){return o<<17|s<<2}function Al(o){return o>>17&32767}function Ume(o){return(o&2)==2}function Fme(o,s){return o&131071|s<<17}function cO(o){return o|2}function tp(o){return(o&131068)>>2}function xD(o,s){return o&-131069|s<<2}function Vme(o){return(o&1)===1}function dO(o){return o|1}function jme(o,s,a,d,p,g){let v=g?s.classBindings:s.styleBindings,T=Al(v),b=tp(v);o[d]=a;let x=!1,B;if(Array.isArray(a)){let W=a;B=W[1],(B===null||Gh(W,B)>0)&&(x=!0)}else B=a;if(p)if(b!==0){let ee=Al(o[T+1]);o[d+1]=iS(ee,T),ee!==0&&(o[ee+1]=xD(o[ee+1],d)),o[T+1]=Fme(o[T+1],d)}else o[d+1]=iS(T,0),T!==0&&(o[T+1]=xD(o[T+1],d)),T=d;else o[d+1]=iS(b,0),T===0?T=d:o[b+1]=xD(o[b+1],d),b=d;x&&(o[d+1]=cO(o[d+1])),m5(o,B,d,!0),m5(o,B,d,!1),Bme(s,B,o,d,g),v=iS(T,b),g?s.classBindings=v:s.styleBindings=v}function Bme(o,s,a,d,p){let g=p?o.residualClasses:o.residualStyles;g!=null&&typeof s=="string"&&Gh(g,s)>=0&&(a[d+1]=dO(a[d+1]))}function m5(o,s,a,d){let p=o[a+1],g=s===null,v=d?Al(p):tp(p),T=!1;for(;v!==0&&(T===!1||g);){let b=o[v],x=o[v+1];Hme(b,s)&&(T=!0,o[v+1]=d?dO(x):cO(x)),v=d?Al(x):tp(x)}T&&(o[a+1]=d?cO(p):dO(p))}function Hme(o,s){return o===null||s==null||(Array.isArray(o)?o[1]:o)===s?!0:Array.isArray(o)&&typeof s=="string"?Gh(o,s)>=0:!1}function VS(o,s,a){return G8(o,s,a,!1),VS}function Jm(o,s){return G8(o,s,null,!0),Jm}function G8(o,s,a,d){let p=sn(),g=pi(),v=ED(2);if(g.firstUpdatePass&&Wme(g,o,v,d),s!==_s&&ra(p,v,s)){let T=g.data[Ua()];$me(g,T,p,p[jn],o,p[v+1]=Xme(s,a),d,v)}}function Gme(o,s){return s>=o.expandoStartIndex}function Wme(o,s,a,d){let p=o.data;if(p[a+1]===null){let g=p[Ua()],v=Gme(o,a);Jme(g,d)&&s===null&&!v&&(s=!1),s=qme(p,g,s,d),jme(p,g,s,a,v,d)}}function qme(o,s,a,d){let p=P4(o),g=d?s.residualClasses:s.residualStyles;if(p===null)(d?s.classBindings:s.styleBindings)===0&&(a=UD(null,o,s,a,d),a=Wm(a,s.attrs,d),g=null);else{let v=s.directiveStylingLast;if(v===-1||o[v]!==p)if(a=UD(p,o,s,a,d),g===null){let b=zme(o,s,d);b!==void 0&&Array.isArray(b)&&(b=UD(null,o,s,b[1],d),b=Wm(b,s.attrs,d),Kme(o,s,d,b))}else g=Yme(o,s,d)}return g!==void 0&&(d?s.residualClasses=g:s.residualStyles=g),a}function zme(o,s,a){let d=a?s.classBindings:s.styleBindings;if(tp(d)!==0)return o[Al(d)]}function Kme(o,s,a,d){let p=a?s.classBindings:s.styleBindings;o[Al(p)]=d}function Yme(o,s,a){let d,p=s.directiveEnd;for(let g=1+s.directiveStylingLast;g<p;g++){let v=o[g].hostAttrs;d=Wm(d,v,a)}return Wm(d,s.attrs,a)}function UD(o,s,a,d,p){let g=null,v=a.directiveEnd,T=a.directiveStylingLast;for(T===-1?T=a.directiveStart:T++;T<v&&(g=s[T],d=Wm(d,g.hostAttrs,p),g!==o);)T++;return o!==null&&(a.directiveStylingLast=T),d}function Wm(o,s,a){let d=a?1:2,p=-1;if(s!==null)for(let g=0;g<s.length;g++){let v=s[g];typeof v=="number"?p=v:p===d&&(Array.isArray(o)||(o=o===void 0?[]:["",o]),n4(o,v,a?!0:s[++g]))}return o===void 0?null:o}function $me(o,s,a,d,p,g,v,T){if(!(s.type&3))return;let b=o.data,x=b[T+1],B=Vme(x)?g5(b,s,a,p,tp(x),v):void 0;if(!CS(B)){CS(g)||Ume(x)&&(g=g5(b,null,a,p,T,v));let W=lD(Ua(),a);Zpe(d,v,W,p,g)}}function g5(o,s,a,d,p,g){let v=s===null,T;for(;p>0;){let b=o[p],x=Array.isArray(b),B=x?b[1]:b,W=B===null,ee=a[p+1];ee===_s&&(ee=W?Ji:void 0);let re=W?qy(ee,d):B===d?ee:void 0;if(x&&!CS(re)&&(re=qy(b,d)),CS(re)&&(T=re,v))return T;let Se=o[p+1];p=v?Al(Se):tp(Se)}if(s!==null){let b=g?s.residualClasses:s.residualStyles;b!=null&&(T=qy(b,d))}return T}function CS(o){return o!==void 0}function Xme(o,s){return o==null||o===""||(typeof s=="string"?o=o+s:typeof o=="object"&&(o=La(z5(o)))),o}function Jme(o,s){return(o.flags&(s?8:16))!==0}function Bn(o,s=""){let a=sn(),d=pi(),p=o+ni,g=d.firstCreatePass?PO(d,p,1,s,null):d.data[p],v=Zme(d,a,g,s,o);a[p]=v,tS()&&bO(d,a,v,g),Yh(g,!1)}var Zme=(o,s,a,d,p)=>(nS(!0),Cpe(s[jn],d));function Qme(o,s,a,d=""){return ra(o,Cl(),a)?s+gl(a)+d:_s}function ege(o,s,a,d,p,g,v,T=""){let b=w4(),x=Xfe(o,b,a,p,v);return ED(3),x?s+gl(a)+d+gl(p)+g+gl(v)+T:_s}function Ha(o){return Ll("",o),Ha}function Ll(o,s,a){let d=sn(),p=Qme(d,o,s,a);return p!==_s&&W8(d,Ua(),p),Ll}function jS(o,s,a,d,p,g,v){let T=sn(),b=ege(T,o,s,a,d,p,g,v);return b!==_s&&W8(T,Ua(),b),jS}function W8(o,s,a){let d=lD(s,o);Rpe(o[jn],d,a)}function BS(o,s,a){ID(s)&&(s=s());let d=sn(),p=Cl();if(ra(d,p,s)){let g=pi(),v=eS();h8(v,d,o,s,d[jn],a)}return BS}function UO(o,s){let a=ID(o);return a&&o.set(s),a}function HS(o,s){let a=sn(),d=pi(),p=no();return H8(d,a,a[jn],p,o,s),HS}function tge(o,s,a){let d=pi();if(d.firstCreatePass){let p=Qs(o);lO(a,d.data,d.blueprint,p,!0),lO(s,d.data,d.blueprint,p,!1)}}function lO(o,s,a,d,p){if(o=Hr(o),Array.isArray(o))for(let g=0;g<o.length;g++)lO(o[g],s,a,d,p);else{let g=pi(),v=sn(),T=no(),b=pl(o)?o:Hr(o.provide),x=oD(o),B=T.providerIndexes&1048575,W=T.directiveStart,ee=T.providerIndexes>>20;if(pl(o)||!o.multi){let re=new Il(x,p,Qt,null),Se=VD(b,s,p?B:B+ee,W);Se===-1?(BD(uS(T,v),g,b),FD(g,o,s.length),s.push(b),T.directiveStart++,T.directiveEnd++,p&&(T.providerIndexes+=1048576),a.push(re),v.push(re)):(a[Se]=re,v[Se]=re)}else{let re=VD(b,s,B+ee,W),Se=VD(b,s,B,B+ee),ze=re>=0&&a[re],Me=Se>=0&&a[Se];if(p&&!Me||!p&&!ze){BD(uS(T,v),g,b);let Oe=ige(p?rge:nge,a.length,p,d,x,o);!p&&Me&&(a[Se].providerFactory=Oe),FD(g,o,s.length,0),s.push(b),T.directiveStart++,T.directiveEnd++,p&&(T.providerIndexes+=1048576),a.push(Oe),v.push(Oe)}else{let Oe=q8(a[p?Se:re],x,!p&&d);FD(g,o,re>-1?re:Se,Oe)}!p&&d&&Me&&a[Se].componentProviders++}}}function FD(o,s,a,d){let p=pl(s),g=c4(s);if(p||g){let b=(g?Hr(s.useClass):s).prototype.ngOnDestroy;if(b){let x=o.destroyHooks||(o.destroyHooks=[]);if(!p&&s.multi){let B=x.indexOf(a);B===-1?x.push(a,[d,b]):x[B+1].push(d,b)}else x.push(a,b)}}}function q8(o,s,a){return a&&o.componentProviders++,o.multi.push(s)-1}function VD(o,s,a,d){for(let p=a;p<d;p++)if(s[p]===o)return p;return-1}function nge(o,s,a,d,p){return uO(this.multi,[])}function rge(o,s,a,d,p){let g=this.multi,v;if(this.providerFactory){let T=this.providerFactory.componentProviders,b=hS(d,d[ut],this.providerFactory.index,p);v=b.slice(0,T),uO(g,v);for(let x=T;x<b.length;x++)v.push(b[x])}else v=[],uO(g,v);return v}function uO(o,s){for(let a=0;a<o.length;a++){let d=o[a];s.push(d())}return s}function ige(o,s,a,d,p,g){let v=new Il(o,a,Qt,null);return v.multi=[],v.index=s,v.componentProviders=0,q8(v,p,d&&!a),v}function kl(o,s=[]){return a=>{a.providersResolver=(d,p)=>tge(d,p?p(o):o,s)}}var RS=class{ngModuleFactory;componentFactories;constructor(s,a){this.ngModuleFactory=s,this.componentFactories=a}},FO=(()=>{class o{compileModuleSync(a){return new vS(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){let d=this.compileModuleSync(a),p=tD(a),g=K5(p.declarations).reduce((v,T)=>{let b=qc(T);return b&&v.push(new Qh(b)),v},[]);return new RS(d,g)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var oge=(()=>{class o{zone=ge(sr);changeDetectionScheduler=ge(Gc);applicationRef=ge(Zc);applicationErrorHandler=ge(ro);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(a){this.applicationErrorHandler(a)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),z8=new Fe("",{factory:()=>!1});function VO({ngZoneFactory:o,ignoreChangesOutsideZone:s,scheduleInRootZone:a}){return o??=()=>new sr(gt(Ee({},BO()),{scheduleInRootZone:a})),[{provide:sr,useFactory:o},{provide:ka,multi:!0,useFactory:()=>{let d=ge(oge,{optional:!0});return()=>d.initialize()}},{provide:ka,multi:!0,useFactory:()=>{let d=ge(sge);return()=>{d.initialize()}}},s===!0?{provide:bD,useValue:!0}:[],{provide:wD,useValue:a??n8},{provide:ro,useFactory:()=>{let d=ge(sr),p=ge(pr),g;return v=>{d.runOutsideAngular(()=>{p.destroyed&&!g?setTimeout(()=>{throw v}):(g??=p.get(Xs),g.handleError(v))})}}}]}function jO(o){let s=o?.ignoreChangesOutsideZone,a=o?.scheduleInRootZone,d=VO({ngZoneFactory:()=>{let p=BO(o);return p.scheduleInRootZone=a,p.shouldCoalesceEventChangeDetection&&Jc("NgZone_CoalesceEvent"),new sr(p)},ignoreChangesOutsideZone:s,scheduleInRootZone:a});return Ma([{provide:z8,useValue:!0},{provide:Mm,useValue:!1},d])}function BO(o){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:o?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:o?.runCoalescing??!1}}var sge=(()=>{class o{subscription=new rr;initialized=!1;zone=ge(sr);pendingTasks=ge(ta);initialize(){if(this.initialized)return;this.initialized=!0;let a=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(a=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{sr.assertNotInAngularZone(),queueMicrotask(()=>{a!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(a),a=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{sr.assertInAngularZone(),a??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var K8=(()=>{class o{applicationErrorHandler=ge(ro);appRef=ge(Zc);taskService=ge(ta);ngZone=ge(sr);zonelessEnabled=ge(Mm);tracing=ge(zm,{optional:!0});disableScheduling=ge(bD,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new rr;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(fS):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(ge(wD,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof mS||!this.zoneIsDefined)}notify(a){if(!this.zonelessEnabled&&a===5)return;let d=!1;switch(a){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,d=!0;break}case 12:{this.appRef.dirtyFlags|=16,d=!0;break}case 13:{this.appRef.dirtyFlags|=2,d=!0;break}case 11:{d=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(d))return;let p=this.useMicrotaskScheduler?J4:r8;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>p(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>p(()=>this.tick()))}shouldScheduleTick(a){return!(this.disableScheduling&&!a||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(fS+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let a=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(d){this.taskService.remove(a),this.applicationErrorHandler(d)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,J4(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(a)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let a=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(a)}}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function age(){return typeof $localize<"u"&&$localize.locale||Xm}var HO=new Fe("",{providedIn:"root",factory:()=>ge(HO,{optional:!0,skipSelf:!0})||age()});function ri(o){return KW(o)}function ip(o,s){return hy(o,s?.equal)}var Y8=class{[ei];constructor(s){this[ei]=s}destroy(){this[ei].destroy()}};var J8=Symbol("InputSignalNode#UNSET"),yge=gt(Ee({},py),{transformFn:void 0,applyValueToInputSignal(o,s){Nh(o,s)}});function Z8(o,s){let a=Object.create(yge);a.value=o,a.transformFn=s?.transform;function d(){if(Ah(a),a.value===J8){let p=null;throw new xe(-950,p)}return a.value}return d[ei]=a,d}var Sge=new Fe("");Sge.__NG_ELEMENT_ID__=o=>{let s=no();if(s===null)throw new xe(204,!1);if(s.type&2)return s.value;if(o&8)return null;throw new xe(204,!1)};function $8(o,s){return Z8(o,s)}function Tge(o){return Z8(J8,o)}var Q8=($8.required=Tge,$8);var GO=new Fe(""),Cge=new Fe("");function Zm(o){return!o.moduleRef}function Rge(o){let s=Zm(o)?o.r3Injector:o.moduleRef.injector,a=s.get(sr);return a.run(()=>{Zm(o)?o.r3Injector.resolveInjectorInitializers():o.moduleRef.resolveInjectorInitializers();let d=s.get(ro),p;if(a.runOutsideAngular(()=>{p=a.onError.subscribe({next:d})}),Zm(o)){let g=()=>s.destroy(),v=o.platformInjector.get(GO);v.add(g),s.onDestroy(()=>{p.unsubscribe(),v.delete(g)})}else{let g=()=>o.moduleRef.destroy(),v=o.platformInjector.get(GO);v.add(g),o.moduleRef.onDestroy(()=>{Fm(o.allPlatformModules,o.moduleRef),p.unsubscribe(),v.delete(g)})}return bge(d,a,()=>{let g=s.get(ta),v=g.add(),T=s.get(MO);return T.runInitializers(),T.donePromise.then(()=>{let b=s.get(HO,Xm);if(B8(b||Xm),!s.get(Cge,!0))return Zm(o)?s.get(Zc):(o.allPlatformModules.push(o.moduleRef),o.moduleRef);if(Zm(o)){let B=s.get(Zc);return o.rootComponent!==void 0&&B.bootstrap(o.rootComponent),B}else return Ige?.(o.moduleRef,o.allPlatformModules),o.moduleRef}).finally(()=>void g.remove(v))})})}var Ige;function bge(o,s,a){try{let d=a();return Nl(d)?d.catch(p=>{throw s.runOutsideAngular(()=>o(p)),p}):d}catch(d){throw s.runOutsideAngular(()=>o(d)),d}}var GS=null;function wge(o=[],s){return us.create({name:s,providers:[{provide:bm,useValue:"platform"},{provide:GO,useValue:new Set([()=>GS=null])},...o]})}function Age(o=[]){if(GS)return GS;let s=wge(o);return GS=s,V8(),Dge(s),s}function Dge(o){let s=o.get(bS,null);Gr(o,()=>{s?.forEach(a=>a())})}var Qm=(()=>{class o{static __NG_ELEMENT_ID__=Oge}return o})();function Oge(o){return Nge(no(),sn(),(o&16)===16)}function Nge(o,s,a){if(Yc(o)&&!a){let d=Mo(o.index,s);return new bl(d,d)}else if(o.type&175){let d=s[Zi];return new bl(d,s)}return null}function e6(o){let{rootComponent:s,appProviders:a,platformProviders:d,platformRef:p}=o;yn(8);try{let g=p?.injector??Age(d),v=[VO({}),{provide:Gc,useExisting:K8},V4,...a||[]],T=new Gm({providers:v,parent:g,debugName:"",runEnvironmentInitializers:!1});return Rge({r3Injector:T.injector,platformInjector:g,rootComponent:s})}catch(g){return Promise.reject(g)}finally{yn(9)}}function qS(o){return typeof o=="boolean"?o:o!=null&&o!=="false"}var r6=null;function Fo(){return r6}function WO(o){r6??=o}var eg=class{},tg=(()=>{class o{historyGo(a){throw new Error("")}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:()=>ge(i6),providedIn:"platform"})}return o})();var i6=(()=>{class o extends tg{_location;_history;_doc=ge(or);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Fo().getBaseHref(this._doc)}onPopState(a){let d=Fo().getGlobalEventTarget(this._doc,"window");return d.addEventListener("popstate",a,!1),()=>d.removeEventListener("popstate",a)}onHashChange(a){let d=Fo().getGlobalEventTarget(this._doc,"window");return d.addEventListener("hashchange",a,!1),()=>d.removeEventListener("hashchange",a)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(a){this._location.pathname=a}pushState(a,d,p){this._history.pushState(a,d,p)}replaceState(a,d,p){this._history.replaceState(a,d,p)}forward(){this._history.forward()}back(){this._history.back()}historyGo(a=0){this._history.go(a)}getState(){return this._history.state}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:()=>new o,providedIn:"platform"})}return o})();function zS(o,s){return o?s?o.endsWith("/")?s.startsWith("/")?o+s.slice(1):o+s:s.startsWith("/")?o+s:`${o}/${s}`:o:s}function t6(o){let s=o.search(/#|\?|$/);return o[s-1]==="/"?o.slice(0,s-1)+o.slice(s):o}function ys(o){return o&&o[0]!=="?"?`?${o}`:o}var ed=(()=>{class o{historyGo(a){throw new Error("")}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:()=>ge(qO),providedIn:"root"})}return o})(),KS=new Fe(""),qO=(()=>{class o extends ed{_platformLocation;_baseHref;_removeListenerFns=[];constructor(a,d){super(),this._platformLocation=a,this._baseHref=d??this._platformLocation.getBaseHrefFromDOM()??ge(or).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(a){this._removeListenerFns.push(this._platformLocation.onPopState(a),this._platformLocation.onHashChange(a))}getBaseHref(){return this._baseHref}prepareExternalUrl(a){return zS(this._baseHref,a)}path(a=!1){let d=this._platformLocation.pathname+ys(this._platformLocation.search),p=this._platformLocation.hash;return p&&a?`${d}${p}`:d}pushState(a,d,p,g){let v=this.prepareExternalUrl(p+ys(g));this._platformLocation.pushState(a,d,v)}replaceState(a,d,p,g){let v=this.prepareExternalUrl(p+ys(g));this._platformLocation.replaceState(a,d,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(a=0){this._platformLocation.historyGo?.(a)}static \u0275fac=function(d){return new(d||o)(et(tg),et(KS,8))};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Ml=(()=>{class o{_subject=new ur;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(a){this._locationStrategy=a;let d=this._locationStrategy.getBaseHref();this._basePath=kge(t6(n6(d))),this._locationStrategy.onPopState(p=>{this._subject.next({url:this.path(!0),pop:!0,state:p.state,type:p.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(a=!1){return this.normalize(this._locationStrategy.path(a))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(a,d=""){return this.path()==this.normalize(a+ys(d))}normalize(a){return o.stripTrailingSlash(Lge(this._basePath,n6(a)))}prepareExternalUrl(a){return a&&a[0]!=="/"&&(a="/"+a),this._locationStrategy.prepareExternalUrl(a)}go(a,d="",p=null){this._locationStrategy.pushState(p,"",a,d),this._notifyUrlChangeListeners(this.prepareExternalUrl(a+ys(d)),p)}replaceState(a,d="",p=null){this._locationStrategy.replaceState(p,"",a,d),this._notifyUrlChangeListeners(this.prepareExternalUrl(a+ys(d)),p)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(a=0){this._locationStrategy.historyGo?.(a)}onUrlChange(a){return this._urlChangeListeners.push(a),this._urlChangeSubscription??=this.subscribe(d=>{this._notifyUrlChangeListeners(d.url,d.state)}),()=>{let d=this._urlChangeListeners.indexOf(a);this._urlChangeListeners.splice(d,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(a="",d){this._urlChangeListeners.forEach(p=>p(a,d))}subscribe(a,d,p){return this._subject.subscribe({next:a,error:d??void 0,complete:p??void 0})}static normalizeQueryParams=ys;static joinWithSlash=zS;static stripTrailingSlash=t6;static \u0275fac=function(d){return new(d||o)(et(ed))};static \u0275prov=qe({token:o,factory:()=>Pge(),providedIn:"root"})}return o})();function Pge(){return new Ml(et(ed))}function Lge(o,s){if(!o||!s.startsWith(o))return s;let a=s.substring(o.length);return a===""||["/",";","?","#"].includes(a[0])?a:s}function n6(o){return o.replace(/\/index.html$/,"")}function kge(o){if(new RegExp("^(https?:)?//").test(o)){let[,a]=o.split(/\/\/[^\/]+/);return a}return o}var KO=(()=>{class o extends ed{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(a,d){super(),this._platformLocation=a,d!=null&&(this._baseHref=d)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(a){this._removeListenerFns.push(this._platformLocation.onPopState(a),this._platformLocation.onHashChange(a))}getBaseHref(){return this._baseHref}path(a=!1){let d=this._platformLocation.hash??"#";return d.length>0?d.substring(1):d}prepareExternalUrl(a){let d=zS(this._baseHref,a);return d.length>0?"#"+d:d}pushState(a,d,p,g){let v=this.prepareExternalUrl(p+ys(g))||this._platformLocation.pathname;this._platformLocation.pushState(a,d,v)}replaceState(a,d,p,g){let v=this.prepareExternalUrl(p+ys(g))||this._platformLocation.pathname;this._platformLocation.replaceState(a,d,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(a=0){this._platformLocation.historyGo?.(a)}static \u0275fac=function(d){return new(d||o)(et(tg),et(KS,8))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})();var zO=/\s+/,o6=[],YO=(()=>{class o{_ngEl;_renderer;initialClasses=o6;rawClass;stateMap=new Map;constructor(a,d){this._ngEl=a,this._renderer=d}set klass(a){this.initialClasses=a!=null?a.trim().split(zO):o6}set ngClass(a){this.rawClass=typeof a=="string"?a.trim().split(zO):a}ngDoCheck(){for(let d of this.initialClasses)this._updateState(d,!0);let a=this.rawClass;if(Array.isArray(a)||a instanceof Set)for(let d of a)this._updateState(d,!0);else if(a!=null)for(let d of Object.keys(a))this._updateState(d,!!a[d]);this._applyStateDiff()}_updateState(a,d){let p=this.stateMap.get(a);p!==void 0?(p.enabled!==d&&(p.changed=!0,p.enabled=d),p.touched=!0):this.stateMap.set(a,{enabled:d,changed:!0,touched:!0})}_applyStateDiff(){for(let a of this.stateMap){let d=a[0],p=a[1];p.changed?(this._toggleClass(d,p.enabled),p.changed=!1):p.touched||(p.enabled&&this._toggleClass(d,!1),this.stateMap.delete(d)),p.touched=!1}}_toggleClass(a,d){a=a.trim(),a.length>0&&a.split(zO).forEach(p=>{d?this._renderer.addClass(this._ngEl.nativeElement,p):this._renderer.removeClass(this._ngEl.nativeElement,p)})}static \u0275fac=function(d){return new(d||o)(Qt(Ol),Qt(rp))};static \u0275dir=Wr({type:o,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return o})();var op=(()=>{class o{static \u0275fac=function(d){return new(d||o)};static \u0275mod=ia({type:o});static \u0275inj=hs({})}return o})();function ng(o,s){s=encodeURIComponent(s);for(let a of o.split(";")){let d=a.indexOf("="),[p,g]=d==-1?[a,""]:[a.slice(0,d),a.slice(d+1)];if(p.trim()===s)return decodeURIComponent(g)}return null}var xl=class{};var s6="browser";var rg=class{_doc;constructor(s){this._doc=s}manager},YS=(()=>{class o extends rg{constructor(a){super(a)}supports(a){return!0}addEventListener(a,d,p,g){return a.addEventListener(d,p,g),()=>this.removeEventListener(a,d,p,g)}removeEventListener(a,d,p,g){return a.removeEventListener(d,p,g)}static \u0275fac=function(d){return new(d||o)(et(or))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})(),XS=new Fe(""),QO=(()=>{class o{_zone;_plugins;_eventNameToPlugin=new Map;constructor(a,d){this._zone=d,a.forEach(v=>{v.manager=this});let p=a.filter(v=>!(v instanceof YS));this._plugins=p.slice().reverse();let g=a.find(v=>v instanceof YS);g&&this._plugins.push(g)}addEventListener(a,d,p,g){return this._findPluginFor(d).addEventListener(a,d,p,g)}getZone(){return this._zone}_findPluginFor(a){let d=this._eventNameToPlugin.get(a);if(d)return d;if(d=this._plugins.find(g=>g.supports(a)),!d)throw new xe(5101,!1);return this._eventNameToPlugin.set(a,d),d}static \u0275fac=function(d){return new(d||o)(et(XS),et(sr))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})(),$O="ng-app-id";function a6(o){for(let s of o)s.remove()}function c6(o,s){let a=s.createElement("style");return a.textContent=o,a}function Fge(o,s,a,d){let p=o.head?.querySelectorAll(`style[${$O}="${s}"],link[${$O}="${s}"]`);if(p)for(let g of p)g.removeAttribute($O),g instanceof HTMLLinkElement?d.set(g.href.slice(g.href.lastIndexOf("/")+1),{usage:0,elements:[g]}):g.textContent&&a.set(g.textContent,{usage:0,elements:[g]})}function JO(o,s){let a=s.createElement("link");return a.setAttribute("rel","stylesheet"),a.setAttribute("href",o),a}var eN=(()=>{class o{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(a,d,p,g={}){this.doc=a,this.appId=d,this.nonce=p,Fge(a,d,this.inline,this.external),this.hosts.add(a.head)}addStyles(a,d){for(let p of a)this.addUsage(p,this.inline,c6);d?.forEach(p=>this.addUsage(p,this.external,JO))}removeStyles(a,d){for(let p of a)this.removeUsage(p,this.inline);d?.forEach(p=>this.removeUsage(p,this.external))}addUsage(a,d,p){let g=d.get(a);g?g.usage++:d.set(a,{usage:1,elements:[...this.hosts].map(v=>this.addElement(v,p(a,this.doc)))})}removeUsage(a,d){let p=d.get(a);p&&(p.usage--,p.usage<=0&&(a6(p.elements),d.delete(a)))}ngOnDestroy(){for(let[,{elements:a}]of[...this.inline,...this.external])a6(a);this.hosts.clear()}addHost(a){this.hosts.add(a);for(let[d,{elements:p}]of this.inline)p.push(this.addElement(a,c6(d,this.doc)));for(let[d,{elements:p}]of this.external)p.push(this.addElement(a,JO(d,this.doc)))}removeHost(a){this.hosts.delete(a)}addElement(a,d){return this.nonce&&d.setAttribute("nonce",this.nonce),a.appendChild(d)}static \u0275fac=function(d){return new(d||o)(et(or),et(IS),et(wS,8),et(np))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})(),XO={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},tN=/%COMP%/g;var l6="%COMP%",Vge=`_nghost-${l6}`,jge=`_ngcontent-${l6}`,Bge=!0,Hge=new Fe("",{providedIn:"root",factory:()=>Bge});function Gge(o){return jge.replace(tN,o)}function Wge(o){return Vge.replace(tN,o)}function u6(o,s){return s.map(a=>a.replace(tN,o))}var nN=(()=>{class o{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(a,d,p,g,v,T,b,x=null,B=null){this.eventManager=a,this.sharedStylesHost=d,this.appId=p,this.removeStylesOnCompDestroy=g,this.doc=v,this.platformId=T,this.ngZone=b,this.nonce=x,this.tracingService=B,this.platformIsServer=!1,this.defaultRenderer=new ig(a,v,b,this.platformIsServer,this.tracingService)}createRenderer(a,d){if(!a||!d)return this.defaultRenderer;let p=this.getOrCreateRenderer(a,d);return p instanceof $S?p.applyToHost(a):p instanceof og&&p.applyStyles(),p}getOrCreateRenderer(a,d){let p=this.rendererByCompId,g=p.get(d.id);if(!g){let v=this.doc,T=this.ngZone,b=this.eventManager,x=this.sharedStylesHost,B=this.removeStylesOnCompDestroy,W=this.platformIsServer,ee=this.tracingService;switch(d.encapsulation){case Va.Emulated:g=new $S(b,x,d,this.appId,B,v,T,W,ee);break;case Va.ShadowDom:return new ZO(b,x,a,d,v,T,this.nonce,W,ee);default:g=new og(b,x,d,B,v,T,W,ee);break}p.set(d.id,g)}return g}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(a){this.rendererByCompId.delete(a)}static \u0275fac=function(d){return new(d||o)(et(QO),et(eN),et(IS),et(Hge),et(or),et(np),et(sr),et(wS),et(zm,8))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})(),ig=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(s,a,d,p,g){this.eventManager=s,this.doc=a,this.ngZone=d,this.platformIsServer=p,this.tracingService=g}destroy(){}destroyNode=null;createElement(s,a){return a?this.doc.createElementNS(XO[a]||a,s):this.doc.createElement(s)}createComment(s){return this.doc.createComment(s)}createText(s){return this.doc.createTextNode(s)}appendChild(s,a){(d6(s)?s.content:s).appendChild(a)}insertBefore(s,a,d){s&&(d6(s)?s.content:s).insertBefore(a,d)}removeChild(s,a){a.remove()}selectRootElement(s,a){let d=typeof s=="string"?this.doc.querySelector(s):s;if(!d)throw new xe(-5104,!1);return a||(d.textContent=""),d}parentNode(s){return s.parentNode}nextSibling(s){return s.nextSibling}setAttribute(s,a,d,p){if(p){a=p+":"+a;let g=XO[p];g?s.setAttributeNS(g,a,d):s.setAttribute(a,d)}else s.setAttribute(a,d)}removeAttribute(s,a,d){if(d){let p=XO[d];p?s.removeAttributeNS(p,a):s.removeAttribute(`${d}:${a}`)}else s.removeAttribute(a)}addClass(s,a){s.classList.add(a)}removeClass(s,a){s.classList.remove(a)}setStyle(s,a,d,p){p&(ja.DashCase|ja.Important)?s.style.setProperty(a,d,p&ja.Important?"important":""):s.style[a]=d}removeStyle(s,a,d){d&ja.DashCase?s.style.removeProperty(a):s.style[a]=""}setProperty(s,a,d){s!=null&&(s[a]=d)}setValue(s,a){s.nodeValue=a}listen(s,a,d,p){if(typeof s=="string"&&(s=Fo().getGlobalEventTarget(this.doc,s),!s))throw new xe(5102,!1);let g=this.decoratePreventDefault(d);return this.tracingService?.wrapEventListener&&(g=this.tracingService.wrapEventListener(s,a,g)),this.eventManager.addEventListener(s,a,g,p)}decoratePreventDefault(s){return a=>{if(a==="__ngUnwrap__")return s;s(a)===!1&&a.preventDefault()}}};function d6(o){return o.tagName==="TEMPLATE"&&o.content!==void 0}var ZO=class extends ig{sharedStylesHost;hostEl;shadowRoot;constructor(s,a,d,p,g,v,T,b,x){super(s,g,v,b,x),this.sharedStylesHost=a,this.hostEl=d,this.shadowRoot=d.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let B=p.styles;B=u6(p.id,B);for(let ee of B){let re=document.createElement("style");T&&re.setAttribute("nonce",T),re.textContent=ee,this.shadowRoot.appendChild(re)}let W=p.getExternalStyles?.();if(W)for(let ee of W){let re=JO(ee,g);T&&re.setAttribute("nonce",T),this.shadowRoot.appendChild(re)}}nodeOrShadowRoot(s){return s===this.hostEl?this.shadowRoot:s}appendChild(s,a){return super.appendChild(this.nodeOrShadowRoot(s),a)}insertBefore(s,a,d){return super.insertBefore(this.nodeOrShadowRoot(s),a,d)}removeChild(s,a){return super.removeChild(null,a)}parentNode(s){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(s)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},og=class extends ig{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(s,a,d,p,g,v,T,b,x){super(s,g,v,T,b),this.sharedStylesHost=a,this.removeStylesOnCompDestroy=p;let B=d.styles;this.styles=x?u6(x,B):B,this.styleUrls=d.getExternalStyles?.(x)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Zh.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},$S=class extends og{contentAttr;hostAttr;constructor(s,a,d,p,g,v,T,b,x){let B=p+"-"+d.id;super(s,a,d,g,v,T,b,x,B),this.contentAttr=Gge(B),this.hostAttr=Wge(B)}applyToHost(s){this.applyStyles(),this.setAttribute(s,this.hostAttr,"")}createElement(s,a){let d=super.createElement(s,a);return super.setAttribute(d,this.contentAttr,""),d}};var JS=class o extends eg{supportsDOMEvents=!0;static makeCurrent(){WO(new o)}onAndCancel(s,a,d,p){return s.addEventListener(a,d,p),()=>{s.removeEventListener(a,d,p)}}dispatchEvent(s,a){s.dispatchEvent(a)}remove(s){s.remove()}createElement(s,a){return a=a||this.getDefaultDocument(),a.createElement(s)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(s){return s.nodeType===Node.ELEMENT_NODE}isShadowRoot(s){return s instanceof DocumentFragment}getGlobalEventTarget(s,a){return a==="window"?window:a==="document"?s:a==="body"?s.body:null}getBaseHref(s){let a=qge();return a==null?null:zge(a)}resetBaseElement(){sg=null}getUserAgent(){return window.navigator.userAgent}getCookie(s){return ng(document.cookie,s)}},sg=null;function qge(){return sg=sg||document.head.querySelector("base"),sg?sg.getAttribute("href"):null}function zge(o){return new URL(o,document.baseURI).pathname}var Kge=(()=>{class o{build(){return new XMLHttpRequest}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})(),h6=["alt","control","meta","shift"],Yge={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},$ge={alt:o=>o.altKey,control:o=>o.ctrlKey,meta:o=>o.metaKey,shift:o=>o.shiftKey},p6=(()=>{class o extends rg{constructor(a){super(a)}supports(a){return o.parseEventName(a)!=null}addEventListener(a,d,p,g){let v=o.parseEventName(d),T=o.eventCallback(v.fullKey,p,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Fo().onAndCancel(a,v.domEventName,T,g))}static parseEventName(a){let d=a.toLowerCase().split("."),p=d.shift();if(d.length===0||!(p==="keydown"||p==="keyup"))return null;let g=o._normalizeKey(d.pop()),v="",T=d.indexOf("code");if(T>-1&&(d.splice(T,1),v="code."),h6.forEach(x=>{let B=d.indexOf(x);B>-1&&(d.splice(B,1),v+=x+".")}),v+=g,d.length!=0||g.length===0)return null;let b={};return b.domEventName=p,b.fullKey=v,b}static matchEventFullKeyCode(a,d){let p=Yge[a.key]||a.key,g="";return d.indexOf("code.")>-1&&(p=a.code,g="code."),p==null||!p?!1:(p=p.toLowerCase(),p===" "?p="space":p==="."&&(p="dot"),h6.forEach(v=>{if(v!==p){let T=$ge[v];T(a)&&(g+=v+".")}}),g+=p,g===d)}static eventCallback(a,d,p){return g=>{o.matchEventFullKeyCode(g,a)&&p.runGuarded(()=>d(g))}}static _normalizeKey(a){return a==="esc"?"escape":a}static \u0275fac=function(d){return new(d||o)(et(or))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})();function rN(o,s,a){let d=Ee({rootComponent:o,platformRef:a?.platformRef},Xge(s));return e6(d)}function Xge(o){return{appProviders:[...t_e,...o?.providers??[]],platformProviders:e_e}}function Jge(){JS.makeCurrent()}function Zge(){return new Xs}function Qge(){return mO(document),document}var e_e=[{provide:np,useValue:s6},{provide:bS,useValue:Jge,multi:!0},{provide:or,useFactory:Qge}];var t_e=[{provide:bm,useValue:"root"},{provide:Xs,useFactory:Zge},{provide:XS,useClass:YS,multi:!0,deps:[or]},{provide:XS,useClass:p6,multi:!0,deps:[or]},nN,eN,QO,{provide:wl,useExisting:nN},{provide:xl,useClass:Kge},[]];var cp=class{},ag=class{},td=class o{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(s){s?typeof s=="string"?this.lazyInit=()=>{this.headers=new Map,s.split(`
`).forEach(a=>{let d=a.indexOf(":");if(d>0){let p=a.slice(0,d),g=a.slice(d+1).trim();this.addHeaderEntry(p,g)}})}:typeof Headers<"u"&&s instanceof Headers?(this.headers=new Map,s.forEach((a,d)=>{this.addHeaderEntry(d,a)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(s).forEach(([a,d])=>{this.setHeaderEntries(a,d)})}:this.headers=new Map}has(s){return this.init(),this.headers.has(s.toLowerCase())}get(s){this.init();let a=this.headers.get(s.toLowerCase());return a&&a.length>0?a[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(s){return this.init(),this.headers.get(s.toLowerCase())||null}append(s,a){return this.clone({name:s,value:a,op:"a"})}set(s,a){return this.clone({name:s,value:a,op:"s"})}delete(s,a){return this.clone({name:s,value:a,op:"d"})}maybeSetNormalizedName(s,a){this.normalizedNames.has(a)||this.normalizedNames.set(a,s)}init(){this.lazyInit&&(this.lazyInit instanceof o?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(s=>this.applyUpdate(s)),this.lazyUpdate=null))}copyFrom(s){s.init(),Array.from(s.headers.keys()).forEach(a=>{this.headers.set(a,s.headers.get(a)),this.normalizedNames.set(a,s.normalizedNames.get(a))})}clone(s){let a=new o;return a.lazyInit=this.lazyInit&&this.lazyInit instanceof o?this.lazyInit:this,a.lazyUpdate=(this.lazyUpdate||[]).concat([s]),a}applyUpdate(s){let a=s.name.toLowerCase();switch(s.op){case"a":case"s":let d=s.value;if(typeof d=="string"&&(d=[d]),d.length===0)return;this.maybeSetNormalizedName(s.name,a);let p=(s.op==="a"?this.headers.get(a):void 0)||[];p.push(...d),this.headers.set(a,p);break;case"d":let g=s.value;if(!g)this.headers.delete(a),this.normalizedNames.delete(a);else{let v=this.headers.get(a);if(!v)return;v=v.filter(T=>g.indexOf(T)===-1),v.length===0?(this.headers.delete(a),this.normalizedNames.delete(a)):this.headers.set(a,v)}break}}addHeaderEntry(s,a){let d=s.toLowerCase();this.maybeSetNormalizedName(s,d),this.headers.has(d)?this.headers.get(d).push(a):this.headers.set(d,[a])}setHeaderEntries(s,a){let d=(Array.isArray(a)?a:[a]).map(g=>g.toString()),p=s.toLowerCase();this.headers.set(p,d),this.maybeSetNormalizedName(s,p)}forEach(s){this.init(),Array.from(this.normalizedNames.keys()).forEach(a=>s(this.normalizedNames.get(a),this.headers.get(a)))}};var QS=class{encodeKey(s){return f6(s)}encodeValue(s){return f6(s)}decodeKey(s){return decodeURIComponent(s)}decodeValue(s){return decodeURIComponent(s)}};function n_e(o,s){let a=new Map;return o.length>0&&o.replace(/^\?/,"").split("&").forEach(p=>{let g=p.indexOf("="),[v,T]=g==-1?[s.decodeKey(p),""]:[s.decodeKey(p.slice(0,g)),s.decodeValue(p.slice(g+1))],b=a.get(v)||[];b.push(T),a.set(v,b)}),a}var r_e=/%(\d[a-f0-9])/gi,i_e={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function f6(o){return encodeURIComponent(o).replace(r_e,(s,a)=>i_e[a]??s)}function ZS(o){return`${o}`}var Ga=class o{map;encoder;updates=null;cloneFrom=null;constructor(s={}){if(this.encoder=s.encoder||new QS,s.fromString){if(s.fromObject)throw new xe(2805,!1);this.map=n_e(s.fromString,this.encoder)}else s.fromObject?(this.map=new Map,Object.keys(s.fromObject).forEach(a=>{let d=s.fromObject[a],p=Array.isArray(d)?d.map(ZS):[ZS(d)];this.map.set(a,p)})):this.map=null}has(s){return this.init(),this.map.has(s)}get(s){this.init();let a=this.map.get(s);return a?a[0]:null}getAll(s){return this.init(),this.map.get(s)||null}keys(){return this.init(),Array.from(this.map.keys())}append(s,a){return this.clone({param:s,value:a,op:"a"})}appendAll(s){let a=[];return Object.keys(s).forEach(d=>{let p=s[d];Array.isArray(p)?p.forEach(g=>{a.push({param:d,value:g,op:"a"})}):a.push({param:d,value:p,op:"a"})}),this.clone(a)}set(s,a){return this.clone({param:s,value:a,op:"s"})}delete(s,a){return this.clone({param:s,value:a,op:"d"})}toString(){return this.init(),this.keys().map(s=>{let a=this.encoder.encodeKey(s);return this.map.get(s).map(d=>a+"="+this.encoder.encodeValue(d)).join("&")}).filter(s=>s!=="").join("&")}clone(s){let a=new o({encoder:this.encoder});return a.cloneFrom=this.cloneFrom||this,a.updates=(this.updates||[]).concat(s),a}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(s=>this.map.set(s,this.cloneFrom.map.get(s))),this.updates.forEach(s=>{switch(s.op){case"a":case"s":let a=(s.op==="a"?this.map.get(s.param):void 0)||[];a.push(ZS(s.value)),this.map.set(s.param,a);break;case"d":if(s.value!==void 0){let d=this.map.get(s.param)||[],p=d.indexOf(ZS(s.value));p!==-1&&d.splice(p,1),d.length>0?this.map.set(s.param,d):this.map.delete(s.param)}else{this.map.delete(s.param);break}}}),this.cloneFrom=this.updates=null)}};var eT=class{map=new Map;set(s,a){return this.map.set(s,a),this}get(s){return this.map.has(s)||this.map.set(s,s.defaultValue()),this.map.get(s)}delete(s){return this.map.delete(s),this}has(s){return this.map.has(s)}keys(){return this.map.keys()}};function o_e(o){switch(o){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function m6(o){return typeof ArrayBuffer<"u"&&o instanceof ArrayBuffer}function g6(o){return typeof Blob<"u"&&o instanceof Blob}function _6(o){return typeof FormData<"u"&&o instanceof FormData}function s_e(o){return typeof URLSearchParams<"u"&&o instanceof URLSearchParams}var E6="Content-Type",v6="Accept",y6="X-Request-URL",S6="text/plain",T6="application/json",a_e=`${T6}, ${S6}, */*`,sp=class o{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(s,a,d,p){this.url=a,this.method=s.toUpperCase();let g;if(o_e(this.method)||p?(this.body=d!==void 0?d:null,g=p):g=d,g){if(this.reportProgress=!!g.reportProgress,this.withCredentials=!!g.withCredentials,this.keepalive=!!g.keepalive,g.responseType&&(this.responseType=g.responseType),g.headers&&(this.headers=g.headers),g.context&&(this.context=g.context),g.params&&(this.params=g.params),g.priority&&(this.priority=g.priority),g.cache&&(this.cache=g.cache),g.credentials&&(this.credentials=g.credentials),typeof g.timeout=="number"){if(g.timeout<1||!Number.isInteger(g.timeout))throw new xe(2822,"");this.timeout=g.timeout}g.mode&&(this.mode=g.mode),g.redirect&&(this.redirect=g.redirect),g.integrity&&(this.integrity=g.integrity),g.referrer&&(this.referrer=g.referrer),this.transferCache=g.transferCache}if(this.headers??=new td,this.context??=new eT,!this.params)this.params=new Ga,this.urlWithParams=a;else{let v=this.params.toString();if(v.length===0)this.urlWithParams=a;else{let T=a.indexOf("?"),b=T===-1?"?":T<a.length-1?"&":"";this.urlWithParams=a+b+v}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||m6(this.body)||g6(this.body)||_6(this.body)||s_e(this.body)?this.body:this.body instanceof Ga?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||_6(this.body)?null:g6(this.body)?this.body.type||null:m6(this.body)?null:typeof this.body=="string"?S6:this.body instanceof Ga?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?T6:null}clone(s={}){let a=s.method||this.method,d=s.url||this.url,p=s.responseType||this.responseType,g=s.keepalive??this.keepalive,v=s.priority||this.priority,T=s.cache||this.cache,b=s.mode||this.mode,x=s.redirect||this.redirect,B=s.credentials||this.credentials,W=s.referrer||this.referrer,ee=s.integrity||this.integrity,re=s.transferCache??this.transferCache,Se=s.timeout??this.timeout,ze=s.body!==void 0?s.body:this.body,Me=s.withCredentials??this.withCredentials,Oe=s.reportProgress??this.reportProgress,kn=s.headers||this.headers,Mi=s.params||this.params,gr=s.context??this.context;return s.setHeaders!==void 0&&(kn=Object.keys(s.setHeaders).reduce((_r,pa)=>_r.set(pa,s.setHeaders[pa]),kn)),s.setParams&&(Mi=Object.keys(s.setParams).reduce((_r,pa)=>_r.set(pa,s.setParams[pa]),Mi)),new o(a,d,ze,{params:Mi,headers:kn,context:gr,reportProgress:Oe,responseType:p,withCredentials:Me,transferCache:re,keepalive:g,cache:T,priority:v,timeout:Se,mode:b,redirect:x,credentials:B,referrer:W,integrity:ee})}},Ul=(function(o){return o[o.Sent=0]="Sent",o[o.UploadProgress=1]="UploadProgress",o[o.ResponseHeader=2]="ResponseHeader",o[o.DownloadProgress=3]="DownloadProgress",o[o.Response=4]="Response",o[o.User=5]="User",o})(Ul||{}),dp=class{headers;status;statusText;url;ok;type;redirected;constructor(s,a=200,d="OK"){this.headers=s.headers||new td,this.status=s.status!==void 0?s.status:a,this.statusText=s.statusText||d,this.url=s.url||null,this.redirected=s.redirected,this.ok=this.status>=200&&this.status<300}},tT=class o extends dp{constructor(s={}){super(s)}type=Ul.ResponseHeader;clone(s={}){return new o({headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},cg=class o extends dp{body;constructor(s={}){super(s),this.body=s.body!==void 0?s.body:null}type=Ul.Response;clone(s={}){return new o({body:s.body!==void 0?s.body:this.body,headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0,redirected:s.redirected??this.redirected})}},ap=class extends dp{name="HttpErrorResponse";message;error;ok=!1;constructor(s){super(s,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${s.url||"(unknown url)"}`:this.message=`Http failure response for ${s.url||"(unknown url)"}: ${s.status} ${s.statusText}`,this.error=s.error||null}},c_e=200,d_e=204;function iN(o,s){return{body:s,headers:o.headers,context:o.context,observe:o.observe,params:o.params,reportProgress:o.reportProgress,responseType:o.responseType,withCredentials:o.withCredentials,credentials:o.credentials,transferCache:o.transferCache,timeout:o.timeout,keepalive:o.keepalive,priority:o.priority,cache:o.cache,mode:o.mode,redirect:o.redirect,integrity:o.integrity,referrer:o.referrer}}var rT=(()=>{class o{handler;constructor(a){this.handler=a}request(a,d,p={}){let g;if(a instanceof sp)g=a;else{let b;p.headers instanceof td?b=p.headers:b=new td(p.headers);let x;p.params&&(p.params instanceof Ga?x=p.params:x=new Ga({fromObject:p.params})),g=new sp(a,d,p.body!==void 0?p.body:null,{headers:b,context:p.context,params:x,reportProgress:p.reportProgress,responseType:p.responseType||"json",withCredentials:p.withCredentials,transferCache:p.transferCache,keepalive:p.keepalive,priority:p.priority,cache:p.cache,mode:p.mode,redirect:p.redirect,credentials:p.credentials,referrer:p.referrer,integrity:p.integrity,timeout:p.timeout})}let v=rt(g).pipe(jc(b=>this.handler.handle(b)));if(a instanceof sp||p.observe==="events")return v;let T=v.pipe(Pi(b=>b instanceof cg));switch(p.observe||"body"){case"body":switch(g.responseType){case"arraybuffer":return T.pipe(wt(b=>{if(b.body!==null&&!(b.body instanceof ArrayBuffer))throw new xe(2806,!1);return b.body}));case"blob":return T.pipe(wt(b=>{if(b.body!==null&&!(b.body instanceof Blob))throw new xe(2807,!1);return b.body}));case"text":return T.pipe(wt(b=>{if(b.body!==null&&typeof b.body!="string")throw new xe(2808,!1);return b.body}));case"json":default:return T.pipe(wt(b=>b.body))}case"response":return T;default:throw new xe(2809,!1)}}delete(a,d={}){return this.request("DELETE",a,d)}get(a,d={}){return this.request("GET",a,d)}head(a,d={}){return this.request("HEAD",a,d)}jsonp(a,d){return this.request("JSONP",a,{params:new Ga().append(d,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(a,d={}){return this.request("OPTIONS",a,d)}patch(a,d,p={}){return this.request("PATCH",a,iN(p,d))}post(a,d,p={}){return this.request("POST",a,iN(p,d))}put(a,d,p={}){return this.request("PUT",a,iN(p,d))}static \u0275fac=function(d){return new(d||o)(et(cp))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})();var l_e=new Fe("");function u_e(o,s){return s(o)}function h_e(o,s,a){return(d,p)=>Gr(a,()=>s(d,g=>o(g,p)))}var C6=new Fe(""),R6=new Fe(""),I6=new Fe("",{providedIn:"root",factory:()=>!0});var nT=(()=>{class o extends cp{backend;injector;chain=null;pendingTasks=ge(rS);contributeToStability=ge(I6);constructor(a,d){super(),this.backend=a,this.injector=d}handle(a){if(this.chain===null){let d=Array.from(new Set([...this.injector.get(C6),...this.injector.get(R6,[])]));this.chain=d.reduceRight((p,g)=>h_e(p,g,this.injector),u_e)}if(this.contributeToStability){let d=this.pendingTasks.add();return this.chain(a,p=>this.backend.handle(p)).pipe(dl(d))}else return this.chain(a,d=>this.backend.handle(d))}static \u0275fac=function(d){return new(d||o)(et(ag),et(pr))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})();var p_e=/^\)\]\}',?\n/,f_e=RegExp(`^${y6}:`,"m");function m_e(o){return"responseURL"in o&&o.responseURL?o.responseURL:f_e.test(o.getAllResponseHeaders())?o.getResponseHeader(y6):null}var oN=(()=>{class o{xhrFactory;constructor(a){this.xhrFactory=a}handle(a){if(a.method==="JSONP")throw new xe(-2800,!1);let d=this.xhrFactory;return rt(null).pipe(ti(()=>new Ft(g=>{let v=d.build();if(v.open(a.method,a.urlWithParams),a.withCredentials&&(v.withCredentials=!0),a.headers.forEach((Me,Oe)=>v.setRequestHeader(Me,Oe.join(","))),a.headers.has(v6)||v.setRequestHeader(v6,a_e),!a.headers.has(E6)){let Me=a.detectContentTypeHeader();Me!==null&&v.setRequestHeader(E6,Me)}if(a.timeout&&(v.timeout=a.timeout),a.responseType){let Me=a.responseType.toLowerCase();v.responseType=Me!=="json"?Me:"text"}let T=a.serializeBody(),b=null,x=()=>{if(b!==null)return b;let Me=v.statusText||"OK",Oe=new td(v.getAllResponseHeaders()),kn=m_e(v)||a.url;return b=new tT({headers:Oe,status:v.status,statusText:Me,url:kn}),b},B=()=>{let{headers:Me,status:Oe,statusText:kn,url:Mi}=x(),gr=null;Oe!==d_e&&(gr=typeof v.response>"u"?v.responseText:v.response),Oe===0&&(Oe=gr?c_e:0);let _r=Oe>=200&&Oe<300;if(a.responseType==="json"&&typeof gr=="string"){let pa=gr;gr=gr.replace(p_e,"");try{gr=gr!==""?JSON.parse(gr):null}catch(CC){gr=pa,_r&&(_r=!1,gr={error:CC,text:gr})}}_r?(g.next(new cg({body:gr,headers:Me,status:Oe,statusText:kn,url:Mi||void 0})),g.complete()):g.error(new ap({error:gr,headers:Me,status:Oe,statusText:kn,url:Mi||void 0}))},W=Me=>{let{url:Oe}=x(),kn=new ap({error:Me,status:v.status||0,statusText:v.statusText||"Unknown Error",url:Oe||void 0});g.error(kn)},ee=W;a.timeout&&(ee=Me=>{let{url:Oe}=x(),kn=new ap({error:new DOMException("Request timed out","TimeoutError"),status:v.status||0,statusText:v.statusText||"Request timeout",url:Oe||void 0});g.error(kn)});let re=!1,Se=Me=>{re||(g.next(x()),re=!0);let Oe={type:Ul.DownloadProgress,loaded:Me.loaded};Me.lengthComputable&&(Oe.total=Me.total),a.responseType==="text"&&v.responseText&&(Oe.partialText=v.responseText),g.next(Oe)},ze=Me=>{let Oe={type:Ul.UploadProgress,loaded:Me.loaded};Me.lengthComputable&&(Oe.total=Me.total),g.next(Oe)};return v.addEventListener("load",B),v.addEventListener("error",W),v.addEventListener("timeout",ee),v.addEventListener("abort",W),a.reportProgress&&(v.addEventListener("progress",Se),T!==null&&v.upload&&v.upload.addEventListener("progress",ze)),v.send(T),g.next({type:Ul.Sent}),()=>{v.removeEventListener("error",W),v.removeEventListener("abort",W),v.removeEventListener("load",B),v.removeEventListener("timeout",ee),a.reportProgress&&(v.removeEventListener("progress",Se),T!==null&&v.upload&&v.upload.removeEventListener("progress",ze)),v.readyState!==v.DONE&&v.abort()}})))}static \u0275fac=function(d){return new(d||o)(et(xl))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})(),b6=new Fe(""),g_e="XSRF-TOKEN",__e=new Fe("",{providedIn:"root",factory:()=>g_e}),E_e="X-XSRF-TOKEN",v_e=new Fe("",{providedIn:"root",factory:()=>E_e}),dg=class{},y_e=(()=>{class o{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(a,d){this.doc=a,this.cookieName=d}getToken(){let a=this.doc.cookie||"";return a!==this.lastCookieString&&(this.parseCount++,this.lastToken=ng(a,this.cookieName),this.lastCookieString=a),this.lastToken}static \u0275fac=function(d){return new(d||o)(et(or),et(__e))};static \u0275prov=qe({token:o,factory:o.\u0275fac})}return o})();function S_e(o,s){let a=o.url.toLowerCase();if(!ge(b6)||o.method==="GET"||o.method==="HEAD"||a.startsWith("http://")||a.startsWith("https://"))return s(o);let d=ge(dg).getToken(),p=ge(v_e);return d!=null&&!o.headers.has(p)&&(o=o.clone({headers:o.headers.set(p,d)})),s(o)}function sN(...o){let s=[rT,oN,nT,{provide:cp,useExisting:nT},{provide:ag,useFactory:()=>ge(l_e,{optional:!0})??ge(oN)},{provide:C6,useValue:S_e,multi:!0},{provide:b6,useValue:!0},{provide:dg,useClass:y_e}];for(let a of o)s.push(...a.\u0275providers);return Ma(s)}var w6=(()=>{class o{_doc;constructor(a){this._doc=a}getTitle(){return this._doc.title}setTitle(a){this._doc.title=a||""}static \u0275fac=function(d){return new(d||o)(et(or))};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Ct="primary",Rg=Symbol("RouteTitle"),uN=class{params;constructor(s){this.params=s||{}}has(s){return Object.prototype.hasOwnProperty.call(this.params,s)}get(s){if(this.has(s)){let a=this.params[s];return Array.isArray(a)?a[0]:a}return null}getAll(s){if(this.has(s)){let a=this.params[s];return Array.isArray(a)?a:[a]}return[]}get keys(){return Object.keys(this.params)}};function jl(o){return new uN(o)}function M6(o,s,a){let d=a.path.split("/");if(d.length>o.length||a.pathMatch==="full"&&(s.hasChildren()||d.length<o.length))return null;let p={};for(let g=0;g<d.length;g++){let v=d[g],T=o[g];if(v[0]===":")p[v.substring(1)]=T;else if(v!==T.path)return null}return{consumed:o.slice(0,d.length),posParams:p}}function R_e(o,s){if(o.length!==s.length)return!1;for(let a=0;a<o.length;++a)if(!oa(o[a],s[a]))return!1;return!0}function oa(o,s){let a=o?hN(o):void 0,d=s?hN(s):void 0;if(!a||!d||a.length!=d.length)return!1;let p;for(let g=0;g<a.length;g++)if(p=a[g],!x6(o[p],s[p]))return!1;return!0}function hN(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}function x6(o,s){if(Array.isArray(o)&&Array.isArray(s)){if(o.length!==s.length)return!1;let a=[...o].sort(),d=[...s].sort();return a.every((p,g)=>d[g]===p)}else return o===s}function U6(o){return o.length>0?o[o.length-1]:null}function za(o){return IA(o)?o:Nl(o)?Kn(Promise.resolve(o)):rt(o)}var I_e={exact:V6,subset:j6},F6={exact:b_e,subset:w_e,ignored:()=>!0};function A6(o,s,a){return I_e[a.paths](o.root,s.root,a.matrixParams)&&F6[a.queryParams](o.queryParams,s.queryParams)&&!(a.fragment==="exact"&&o.fragment!==s.fragment)}function b_e(o,s){return oa(o,s)}function V6(o,s,a){if(!Fl(o.segments,s.segments)||!sT(o.segments,s.segments,a)||o.numberOfChildren!==s.numberOfChildren)return!1;for(let d in s.children)if(!o.children[d]||!V6(o.children[d],s.children[d],a))return!1;return!0}function w_e(o,s){return Object.keys(s).length<=Object.keys(o).length&&Object.keys(s).every(a=>x6(o[a],s[a]))}function j6(o,s,a){return B6(o,s,s.segments,a)}function B6(o,s,a,d){if(o.segments.length>a.length){let p=o.segments.slice(0,a.length);return!(!Fl(p,a)||s.hasChildren()||!sT(p,a,d))}else if(o.segments.length===a.length){if(!Fl(o.segments,a)||!sT(o.segments,a,d))return!1;for(let p in s.children)if(!o.children[p]||!j6(o.children[p],s.children[p],d))return!1;return!0}else{let p=a.slice(0,o.segments.length),g=a.slice(o.segments.length);return!Fl(o.segments,p)||!sT(o.segments,p,d)||!o.children[Ct]?!1:B6(o.children[Ct],s,g,d)}}function sT(o,s,a){return s.every((d,p)=>F6[a](o[p].parameters,d.parameters))}var aa=class{root;queryParams;fragment;_queryParamMap;constructor(s=new en([],{}),a={},d=null){this.root=s,this.queryParams=a,this.fragment=d}get queryParamMap(){return this._queryParamMap??=jl(this.queryParams),this._queryParamMap}toString(){return O_e.serialize(this)}},en=class{segments;children;parent=null;constructor(s,a){this.segments=s,this.children=a,Object.values(a).forEach(d=>d.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return aT(this)}},nd=class{path;parameters;_parameterMap;constructor(s,a){this.path=s,this.parameters=a}get parameterMap(){return this._parameterMap??=jl(this.parameters),this._parameterMap}toString(){return G6(this)}};function A_e(o,s){return Fl(o,s)&&o.every((a,d)=>oa(a.parameters,s[d].parameters))}function Fl(o,s){return o.length!==s.length?!1:o.every((a,d)=>a.path===s[d].path)}function D_e(o,s){let a=[];return Object.entries(o.children).forEach(([d,p])=>{d===Ct&&(a=a.concat(s(p,d)))}),Object.entries(o.children).forEach(([d,p])=>{d!==Ct&&(a=a.concat(s(p,d)))}),a}var Ig=(()=>{class o{static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:()=>new Bl,providedIn:"root"})}return o})(),Bl=class{parse(s){let a=new fN(s);return new aa(a.parseRootSegment(),a.parseQueryParams(),a.parseFragment())}serialize(s){let a=`/${lg(s.root,!0)}`,d=L_e(s.queryParams),p=typeof s.fragment=="string"?`#${N_e(s.fragment)}`:"";return`${a}${d}${p}`}},O_e=new Bl;function aT(o){return o.segments.map(s=>G6(s)).join("/")}function lg(o,s){if(!o.hasChildren())return aT(o);if(s){let a=o.children[Ct]?lg(o.children[Ct],!1):"",d=[];return Object.entries(o.children).forEach(([p,g])=>{p!==Ct&&d.push(`${p}:${lg(g,!1)}`)}),d.length>0?`${a}(${d.join("//")})`:a}else{let a=D_e(o,(d,p)=>p===Ct?[lg(o.children[Ct],!1)]:[`${p}:${lg(d,!1)}`]);return Object.keys(o.children).length===1&&o.children[Ct]!=null?`${aT(o)}/${a[0]}`:`${aT(o)}/(${a.join("//")})`}}function H6(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function iT(o){return H6(o).replace(/%3B/gi,";")}function N_e(o){return encodeURI(o)}function pN(o){return H6(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function cT(o){return decodeURIComponent(o)}function D6(o){return cT(o.replace(/\+/g,"%20"))}function G6(o){return`${pN(o.path)}${P_e(o.parameters)}`}function P_e(o){return Object.entries(o).map(([s,a])=>`;${pN(s)}=${pN(a)}`).join("")}function L_e(o){let s=Object.entries(o).map(([a,d])=>Array.isArray(d)?d.map(p=>`${iT(a)}=${iT(p)}`).join("&"):`${iT(a)}=${iT(d)}`).filter(a=>a);return s.length?`?${s.join("&")}`:""}var k_e=/^[^\/()?;#]+/;function aN(o){let s=o.match(k_e);return s?s[0]:""}var M_e=/^[^\/()?;=#]+/;function x_e(o){let s=o.match(M_e);return s?s[0]:""}var U_e=/^[^=?&#]+/;function F_e(o){let s=o.match(U_e);return s?s[0]:""}var V_e=/^[^&#]+/;function j_e(o){let s=o.match(V_e);return s?s[0]:""}var fN=class{url;remaining;constructor(s){this.url=s,this.remaining=s}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new en([],{}):new en([],this.parseChildren())}parseQueryParams(){let s={};if(this.consumeOptional("?"))do this.parseQueryParam(s);while(this.consumeOptional("&"));return s}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let s=[];for(this.peekStartsWith("(")||s.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),s.push(this.parseSegment());let a={};this.peekStartsWith("/(")&&(this.capture("/"),a=this.parseParens(!0));let d={};return this.peekStartsWith("(")&&(d=this.parseParens(!1)),(s.length>0||Object.keys(a).length>0)&&(d[Ct]=new en(s,a)),d}parseSegment(){let s=aN(this.remaining);if(s===""&&this.peekStartsWith(";"))throw new xe(4009,!1);return this.capture(s),new nd(cT(s),this.parseMatrixParams())}parseMatrixParams(){let s={};for(;this.consumeOptional(";");)this.parseParam(s);return s}parseParam(s){let a=x_e(this.remaining);if(!a)return;this.capture(a);let d="";if(this.consumeOptional("=")){let p=aN(this.remaining);p&&(d=p,this.capture(d))}s[cT(a)]=cT(d)}parseQueryParam(s){let a=F_e(this.remaining);if(!a)return;this.capture(a);let d="";if(this.consumeOptional("=")){let v=j_e(this.remaining);v&&(d=v,this.capture(d))}let p=D6(a),g=D6(d);if(s.hasOwnProperty(p)){let v=s[p];Array.isArray(v)||(v=[v],s[p]=v),v.push(g)}else s[p]=g}parseParens(s){let a={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let d=aN(this.remaining),p=this.remaining[d.length];if(p!=="/"&&p!==")"&&p!==";")throw new xe(4010,!1);let g;d.indexOf(":")>-1?(g=d.slice(0,d.indexOf(":")),this.capture(g),this.capture(":")):s&&(g=Ct);let v=this.parseChildren();a[g]=Object.keys(v).length===1?v[Ct]:new en([],v),this.consumeOptional("//")}return a}peekStartsWith(s){return this.remaining.startsWith(s)}consumeOptional(s){return this.peekStartsWith(s)?(this.remaining=this.remaining.substring(s.length),!0):!1}capture(s){if(!this.consumeOptional(s))throw new xe(4011,!1)}};function W6(o){return o.segments.length>0?new en([],{[Ct]:o}):o}function q6(o){let s={};for(let[d,p]of Object.entries(o.children)){let g=q6(p);if(d===Ct&&g.segments.length===0&&g.hasChildren())for(let[v,T]of Object.entries(g.children))s[v]=T;else(g.segments.length>0||g.hasChildren())&&(s[d]=g)}let a=new en(o.segments,s);return B_e(a)}function B_e(o){if(o.numberOfChildren===1&&o.children[Ct]){let s=o.children[Ct];return new en(o.segments.concat(s.segments),s.children)}return o}function fp(o){return o instanceof aa}function z6(o,s,a=null,d=null){let p=K6(o);return Y6(p,s,a,d)}function K6(o){let s;function a(g){let v={};for(let b of g.children){let x=a(b);v[b.outlet]=x}let T=new en(g.url,v);return g===o&&(s=T),T}let d=a(o.root),p=W6(d);return s??p}function Y6(o,s,a,d){let p=o;for(;p.parent;)p=p.parent;if(s.length===0)return cN(p,p,p,a,d);let g=H_e(s);if(g.toRoot())return cN(p,p,new en([],{}),a,d);let v=G_e(g,p,o),T=v.processChildren?hg(v.segmentGroup,v.index,g.commands):X6(v.segmentGroup,v.index,g.commands);return cN(p,v.segmentGroup,T,a,d)}function dT(o){return typeof o=="object"&&o!=null&&!o.outlets&&!o.segmentPath}function mg(o){return typeof o=="object"&&o!=null&&o.outlets}function cN(o,s,a,d,p){let g={};d&&Object.entries(d).forEach(([b,x])=>{g[b]=Array.isArray(x)?x.map(B=>`${B}`):`${x}`});let v;o===s?v=a:v=$6(o,s,a);let T=W6(q6(v));return new aa(T,g,p)}function $6(o,s,a){let d={};return Object.entries(o.children).forEach(([p,g])=>{g===s?d[p]=a:d[p]=$6(g,s,a)}),new en(o.segments,d)}var lT=class{isAbsolute;numberOfDoubleDots;commands;constructor(s,a,d){if(this.isAbsolute=s,this.numberOfDoubleDots=a,this.commands=d,s&&d.length>0&&dT(d[0]))throw new xe(4003,!1);let p=d.find(mg);if(p&&p!==U6(d))throw new xe(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function H_e(o){if(typeof o[0]=="string"&&o.length===1&&o[0]==="/")return new lT(!0,0,o);let s=0,a=!1,d=o.reduce((p,g,v)=>{if(typeof g=="object"&&g!=null){if(g.outlets){let T={};return Object.entries(g.outlets).forEach(([b,x])=>{T[b]=typeof x=="string"?x.split("/"):x}),[...p,{outlets:T}]}if(g.segmentPath)return[...p,g.segmentPath]}return typeof g!="string"?[...p,g]:v===0?(g.split("/").forEach((T,b)=>{b==0&&T==="."||(b==0&&T===""?a=!0:T===".."?s++:T!=""&&p.push(T))}),p):[...p,g]},[]);return new lT(a,s,d)}var hp=class{segmentGroup;processChildren;index;constructor(s,a,d){this.segmentGroup=s,this.processChildren=a,this.index=d}};function G_e(o,s,a){if(o.isAbsolute)return new hp(s,!0,0);if(!a)return new hp(s,!1,NaN);if(a.parent===null)return new hp(a,!0,0);let d=dT(o.commands[0])?0:1,p=a.segments.length-1+d;return W_e(a,p,o.numberOfDoubleDots)}function W_e(o,s,a){let d=o,p=s,g=a;for(;g>p;){if(g-=p,d=d.parent,!d)throw new xe(4005,!1);p=d.segments.length}return new hp(d,!1,p-g)}function q_e(o){return mg(o[0])?o[0].outlets:{[Ct]:o}}function X6(o,s,a){if(o??=new en([],{}),o.segments.length===0&&o.hasChildren())return hg(o,s,a);let d=z_e(o,s,a),p=a.slice(d.commandIndex);if(d.match&&d.pathIndex<o.segments.length){let g=new en(o.segments.slice(0,d.pathIndex),{});return g.children[Ct]=new en(o.segments.slice(d.pathIndex),o.children),hg(g,0,p)}else return d.match&&p.length===0?new en(o.segments,{}):d.match&&!o.hasChildren()?mN(o,s,a):d.match?hg(o,0,p):mN(o,s,a)}function hg(o,s,a){if(a.length===0)return new en(o.segments,{});{let d=q_e(a),p={};if(Object.keys(d).some(g=>g!==Ct)&&o.children[Ct]&&o.numberOfChildren===1&&o.children[Ct].segments.length===0){let g=hg(o.children[Ct],s,a);return new en(o.segments,g.children)}return Object.entries(d).forEach(([g,v])=>{typeof v=="string"&&(v=[v]),v!==null&&(p[g]=X6(o.children[g],s,v))}),Object.entries(o.children).forEach(([g,v])=>{d[g]===void 0&&(p[g]=v)}),new en(o.segments,p)}}function z_e(o,s,a){let d=0,p=s,g={match:!1,pathIndex:0,commandIndex:0};for(;p<o.segments.length;){if(d>=a.length)return g;let v=o.segments[p],T=a[d];if(mg(T))break;let b=`${T}`,x=d<a.length-1?a[d+1]:null;if(p>0&&b===void 0)break;if(b&&x&&typeof x=="object"&&x.outlets===void 0){if(!N6(b,x,v))return g;d+=2}else{if(!N6(b,{},v))return g;d++}p++}return{match:!0,pathIndex:p,commandIndex:d}}function mN(o,s,a){let d=o.segments.slice(0,s),p=0;for(;p<a.length;){let g=a[p];if(mg(g)){let b=K_e(g.outlets);return new en(d,b)}if(p===0&&dT(a[0])){let b=o.segments[s];d.push(new nd(b.path,O6(a[0]))),p++;continue}let v=mg(g)?g.outlets[Ct]:`${g}`,T=p<a.length-1?a[p+1]:null;v&&T&&dT(T)?(d.push(new nd(v,O6(T))),p+=2):(d.push(new nd(v,{})),p++)}return new en(d,{})}function K_e(o){let s={};return Object.entries(o).forEach(([a,d])=>{typeof d=="string"&&(d=[d]),d!==null&&(s[a]=mN(new en([],{}),0,d))}),s}function O6(o){let s={};return Object.entries(o).forEach(([a,d])=>s[a]=`${d}`),s}function N6(o,s,a){return o==a.path&&oa(s,a.parameters)}var pg="imperative",Or=(function(o){return o[o.NavigationStart=0]="NavigationStart",o[o.NavigationEnd=1]="NavigationEnd",o[o.NavigationCancel=2]="NavigationCancel",o[o.NavigationError=3]="NavigationError",o[o.RoutesRecognized=4]="RoutesRecognized",o[o.ResolveStart=5]="ResolveStart",o[o.ResolveEnd=6]="ResolveEnd",o[o.GuardsCheckStart=7]="GuardsCheckStart",o[o.GuardsCheckEnd=8]="GuardsCheckEnd",o[o.RouteConfigLoadStart=9]="RouteConfigLoadStart",o[o.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",o[o.ChildActivationStart=11]="ChildActivationStart",o[o.ChildActivationEnd=12]="ChildActivationEnd",o[o.ActivationStart=13]="ActivationStart",o[o.ActivationEnd=14]="ActivationEnd",o[o.Scroll=15]="Scroll",o[o.NavigationSkipped=16]="NavigationSkipped",o})(Or||{}),so=class{id;url;constructor(s,a){this.id=s,this.url=a}},Hl=class extends so{type=Or.NavigationStart;navigationTrigger;restoredState;constructor(s,a,d="imperative",p=null){super(s,a),this.navigationTrigger=d,this.restoredState=p}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Wa=class extends so{urlAfterRedirects;type=Or.NavigationEnd;constructor(s,a,d){super(s,a),this.urlAfterRedirects=d}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},fi=(function(o){return o[o.Redirect=0]="Redirect",o[o.SupersededByNewNavigation=1]="SupersededByNewNavigation",o[o.NoDataFromResolver=2]="NoDataFromResolver",o[o.GuardRejected=3]="GuardRejected",o[o.Aborted=4]="Aborted",o})(fi||{}),gg=(function(o){return o[o.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",o[o.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",o})(gg||{}),sa=class extends so{reason;code;type=Or.NavigationCancel;constructor(s,a,d,p){super(s,a),this.reason=d,this.code=p}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},qa=class extends so{reason;code;type=Or.NavigationSkipped;constructor(s,a,d,p){super(s,a),this.reason=d,this.code=p}},mp=class extends so{error;target;type=Or.NavigationError;constructor(s,a,d,p){super(s,a),this.error=d,this.target=p}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},_g=class extends so{urlAfterRedirects;state;type=Or.RoutesRecognized;constructor(s,a,d,p){super(s,a),this.urlAfterRedirects=d,this.state=p}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},uT=class extends so{urlAfterRedirects;state;type=Or.GuardsCheckStart;constructor(s,a,d,p){super(s,a),this.urlAfterRedirects=d,this.state=p}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},hT=class extends so{urlAfterRedirects;state;shouldActivate;type=Or.GuardsCheckEnd;constructor(s,a,d,p,g){super(s,a),this.urlAfterRedirects=d,this.state=p,this.shouldActivate=g}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},pT=class extends so{urlAfterRedirects;state;type=Or.ResolveStart;constructor(s,a,d,p){super(s,a),this.urlAfterRedirects=d,this.state=p}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},fT=class extends so{urlAfterRedirects;state;type=Or.ResolveEnd;constructor(s,a,d,p){super(s,a),this.urlAfterRedirects=d,this.state=p}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},mT=class{route;type=Or.RouteConfigLoadStart;constructor(s){this.route=s}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},gT=class{route;type=Or.RouteConfigLoadEnd;constructor(s){this.route=s}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},_T=class{snapshot;type=Or.ChildActivationStart;constructor(s){this.snapshot=s}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ET=class{snapshot;type=Or.ChildActivationEnd;constructor(s){this.snapshot=s}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},vT=class{snapshot;type=Or.ActivationStart;constructor(s){this.snapshot=s}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},yT=class{snapshot;type=Or.ActivationEnd;constructor(s){this.snapshot=s}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Eg=class{},gp=class{url;navigationBehaviorOptions;constructor(s,a){this.url=s,this.navigationBehaviorOptions=a}};function Y_e(o){return!(o instanceof Eg)&&!(o instanceof gp)}function $_e(o,s){return o.providers&&!o._injector&&(o._injector=$m(o.providers,s,`Route: ${o.path}`)),o._injector??s}function Ss(o){return o.outlet||Ct}function X_e(o,s){let a=o.filter(d=>Ss(d)===s);return a.push(...o.filter(d=>Ss(d)!==s)),a}function vp(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let s=o.parent;s;s=s.parent){let a=s.routeConfig;if(a?._loadedInjector)return a._loadedInjector;if(a?._injector)return a._injector}return null}var ST=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return vp(this.route?.snapshot)??this.rootInjector}constructor(s){this.rootInjector=s,this.children=new yp(this.rootInjector)}},yp=(()=>{class o{rootInjector;contexts=new Map;constructor(a){this.rootInjector=a}onChildOutletCreated(a,d){let p=this.getOrCreateContext(a);p.outlet=d,this.contexts.set(a,p)}onChildOutletDestroyed(a){let d=this.getContext(a);d&&(d.outlet=null,d.attachRef=null)}onOutletDeactivated(){let a=this.contexts;return this.contexts=new Map,a}onOutletReAttached(a){this.contexts=a}getOrCreateContext(a){let d=this.getContext(a);return d||(d=new ST(this.rootInjector),this.contexts.set(a,d)),d}getContext(a){return this.contexts.get(a)||null}static \u0275fac=function(d){return new(d||o)(et(pr))};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),TT=class{_root;constructor(s){this._root=s}get root(){return this._root.value}parent(s){let a=this.pathFromRoot(s);return a.length>1?a[a.length-2]:null}children(s){let a=gN(s,this._root);return a?a.children.map(d=>d.value):[]}firstChild(s){let a=gN(s,this._root);return a&&a.children.length>0?a.children[0].value:null}siblings(s){let a=_N(s,this._root);return a.length<2?[]:a[a.length-2].children.map(p=>p.value).filter(p=>p!==s)}pathFromRoot(s){return _N(s,this._root).map(a=>a.value)}};function gN(o,s){if(o===s.value)return s;for(let a of s.children){let d=gN(o,a);if(d)return d}return null}function _N(o,s){if(o===s.value)return[s];for(let a of s.children){let d=_N(o,a);if(d.length)return d.unshift(s),d}return[]}var oo=class{value;children;constructor(s,a){this.value=s,this.children=a}toString(){return`TreeNode(${this.value})`}};function up(o){let s={};return o&&o.children.forEach(a=>s[a.value.outlet]=a),s}var vg=class extends TT{snapshot;constructor(s,a){super(s),this.snapshot=a,IN(this,s)}toString(){return this.snapshot.toString()}};function J6(o){let s=J_e(o),a=new Br([new nd("",{})]),d=new Br({}),p=new Br({}),g=new Br({}),v=new Br(""),T=new rd(a,d,g,v,p,Ct,o,s.root);return T.snapshot=s.root,new vg(new oo(T,[]),s)}function J_e(o){let s={},a={},d={},g=new Vl([],s,d,"",a,Ct,o,null,{});return new yg("",new oo(g,[]))}var rd=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(s,a,d,p,g,v,T,b){this.urlSubject=s,this.paramsSubject=a,this.queryParamsSubject=d,this.fragmentSubject=p,this.dataSubject=g,this.outlet=v,this.component=T,this._futureSnapshot=b,this.title=this.dataSubject?.pipe(wt(x=>x[Rg]))??rt(void 0),this.url=s,this.params=a,this.queryParams=d,this.fragment=p,this.data=g}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(wt(s=>jl(s))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(wt(s=>jl(s))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function CT(o,s,a="emptyOnly"){let d,{routeConfig:p}=o;return s!==null&&(a==="always"||p?.path===""||!s.component&&!s.routeConfig?.loadComponent)?d={params:Ee(Ee({},s.params),o.params),data:Ee(Ee({},s.data),o.data),resolve:Ee(Ee(Ee(Ee({},o.data),s.data),p?.data),o._resolvedData)}:d={params:Ee({},o.params),data:Ee({},o.data),resolve:Ee(Ee({},o.data),o._resolvedData??{})},p&&Q6(p)&&(d.resolve[Rg]=p.title),d}var Vl=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Rg]}constructor(s,a,d,p,g,v,T,b,x){this.url=s,this.params=a,this.queryParams=d,this.fragment=p,this.data=g,this.outlet=v,this.component=T,this.routeConfig=b,this._resolve=x}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=jl(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=jl(this.queryParams),this._queryParamMap}toString(){let s=this.url.map(d=>d.toString()).join("/"),a=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${s}', path:'${a}')`}},yg=class extends TT{url;constructor(s,a){super(a),this.url=s,IN(this,a)}toString(){return Z6(this._root)}};function IN(o,s){s.value._routerState=o,s.children.forEach(a=>IN(o,a))}function Z6(o){let s=o.children.length>0?` { ${o.children.map(Z6).join(", ")} } `:"";return`${o.value}${s}`}function dN(o){if(o.snapshot){let s=o.snapshot,a=o._futureSnapshot;o.snapshot=a,oa(s.queryParams,a.queryParams)||o.queryParamsSubject.next(a.queryParams),s.fragment!==a.fragment&&o.fragmentSubject.next(a.fragment),oa(s.params,a.params)||o.paramsSubject.next(a.params),R_e(s.url,a.url)||o.urlSubject.next(a.url),oa(s.data,a.data)||o.dataSubject.next(a.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function EN(o,s){let a=oa(o.params,s.params)&&A_e(o.url,s.url),d=!o.parent!=!s.parent;return a&&!d&&(!o.parent||EN(o.parent,s.parent))}function Q6(o){return typeof o.title=="string"||o.title===null}var eq=new Fe(""),bg=(()=>{class o{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Ct;activateEvents=new Zn;deactivateEvents=new Zn;attachEvents=new Zn;detachEvents=new Zn;routerOutletData=Q8(void 0);parentContexts=ge(yp);location=ge(Ym);changeDetector=ge(Qm);inputBinder=ge(wT,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(a){if(a.name){let{firstChange:d,previousValue:p}=a.name;if(d)return;this.isTrackedInParentContexts(p)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(p)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(a){return this.parentContexts.getContext(a)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let a=this.parentContexts.getContext(this.name);a?.route&&(a.attachRef?this.attach(a.attachRef,a.route):this.activateWith(a.route,a.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new xe(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new xe(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new xe(4012,!1);this.location.detach();let a=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(a.instance),a}attach(a,d){this.activated=a,this._activatedRoute=d,this.location.insert(a.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(a.instance)}deactivate(){if(this.activated){let a=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(a)}}activateWith(a,d){if(this.isActivated)throw new xe(4013,!1);this._activatedRoute=a;let p=this.location,v=a.snapshot.component,T=this.parentContexts.getOrCreateContext(this.name).children,b=new vN(a,T,p.injector,this.routerOutletData);this.activated=p.createComponent(v,{index:p.length,injector:b,environmentInjector:d}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(d){return new(d||o)};static \u0275dir=Wr({type:o,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Ba]})}return o})(),vN=class{route;childContexts;parent;outletData;constructor(s,a,d,p){this.route=s,this.childContexts=a,this.parent=d,this.outletData=p}get(s,a){return s===rd?this.route:s===yp?this.childContexts:s===eq?this.outletData:this.parent.get(s,a)}},wT=new Fe("");var bN=(()=>{class o{static \u0275fac=function(d){return new(d||o)};static \u0275cmp=Es({type:o,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(d,p){d&1&&Dr(0,"router-outlet")},dependencies:[bg],encapsulation:2})}return o})();function wN(o){let s=o.children&&o.children.map(wN),a=s?gt(Ee({},o),{children:s}):Ee({},o);return!a.component&&!a.loadComponent&&(s||a.loadChildren)&&a.outlet&&a.outlet!==Ct&&(a.component=bN),a}function Z_e(o,s,a){let d=Sg(o,s._root,a?a._root:void 0);return new vg(d,s)}function Sg(o,s,a){if(a&&o.shouldReuseRoute(s.value,a.value.snapshot)){let d=a.value;d._futureSnapshot=s.value;let p=Q_e(o,s,a);return new oo(d,p)}else{if(o.shouldAttach(s.value)){let g=o.retrieve(s.value);if(g!==null){let v=g.route;return v.value._futureSnapshot=s.value,v.children=s.children.map(T=>Sg(o,T)),v}}let d=eEe(s.value),p=s.children.map(g=>Sg(o,g));return new oo(d,p)}}function Q_e(o,s,a){return s.children.map(d=>{for(let p of a.children)if(o.shouldReuseRoute(d.value,p.value.snapshot))return Sg(o,d,p);return Sg(o,d)})}function eEe(o){return new rd(new Br(o.url),new Br(o.params),new Br(o.queryParams),new Br(o.fragment),new Br(o.data),o.outlet,o.component,o)}var _p=class{redirectTo;navigationBehaviorOptions;constructor(s,a){this.redirectTo=s,this.navigationBehaviorOptions=a}},tq="ngNavigationCancelingError";function RT(o,s){let{redirectTo:a,navigationBehaviorOptions:d}=fp(s)?{redirectTo:s,navigationBehaviorOptions:void 0}:s,p=nq(!1,fi.Redirect);return p.url=a,p.navigationBehaviorOptions=d,p}function nq(o,s){let a=new Error(`NavigationCancelingError: ${o||""}`);return a[tq]=!0,a.cancellationCode=s,a}function tEe(o){return rq(o)&&fp(o.url)}function rq(o){return!!o&&o[tq]}var nEe=(o,s,a,d)=>wt(p=>(new yN(s,p.targetRouterState,p.currentRouterState,a,d).activate(o),p)),yN=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(s,a,d,p,g){this.routeReuseStrategy=s,this.futureState=a,this.currState=d,this.forwardEvent=p,this.inputBindingEnabled=g}activate(s){let a=this.futureState._root,d=this.currState?this.currState._root:null;this.deactivateChildRoutes(a,d,s),dN(this.futureState.root),this.activateChildRoutes(a,d,s)}deactivateChildRoutes(s,a,d){let p=up(a);s.children.forEach(g=>{let v=g.value.outlet;this.deactivateRoutes(g,p[v],d),delete p[v]}),Object.values(p).forEach(g=>{this.deactivateRouteAndItsChildren(g,d)})}deactivateRoutes(s,a,d){let p=s.value,g=a?a.value:null;if(p===g)if(p.component){let v=d.getContext(p.outlet);v&&this.deactivateChildRoutes(s,a,v.children)}else this.deactivateChildRoutes(s,a,d);else g&&this.deactivateRouteAndItsChildren(a,d)}deactivateRouteAndItsChildren(s,a){s.value.component&&this.routeReuseStrategy.shouldDetach(s.value.snapshot)?this.detachAndStoreRouteSubtree(s,a):this.deactivateRouteAndOutlet(s,a)}detachAndStoreRouteSubtree(s,a){let d=a.getContext(s.value.outlet),p=d&&s.value.component?d.children:a,g=up(s);for(let v of Object.values(g))this.deactivateRouteAndItsChildren(v,p);if(d&&d.outlet){let v=d.outlet.detach(),T=d.children.onOutletDeactivated();this.routeReuseStrategy.store(s.value.snapshot,{componentRef:v,route:s,contexts:T})}}deactivateRouteAndOutlet(s,a){let d=a.getContext(s.value.outlet),p=d&&s.value.component?d.children:a,g=up(s);for(let v of Object.values(g))this.deactivateRouteAndItsChildren(v,p);d&&(d.outlet&&(d.outlet.deactivate(),d.children.onOutletDeactivated()),d.attachRef=null,d.route=null)}activateChildRoutes(s,a,d){let p=up(a);s.children.forEach(g=>{this.activateRoutes(g,p[g.value.outlet],d),this.forwardEvent(new yT(g.value.snapshot))}),s.children.length&&this.forwardEvent(new ET(s.value.snapshot))}activateRoutes(s,a,d){let p=s.value,g=a?a.value:null;if(dN(p),p===g)if(p.component){let v=d.getOrCreateContext(p.outlet);this.activateChildRoutes(s,a,v.children)}else this.activateChildRoutes(s,a,d);else if(p.component){let v=d.getOrCreateContext(p.outlet);if(this.routeReuseStrategy.shouldAttach(p.snapshot)){let T=this.routeReuseStrategy.retrieve(p.snapshot);this.routeReuseStrategy.store(p.snapshot,null),v.children.onOutletReAttached(T.contexts),v.attachRef=T.componentRef,v.route=T.route.value,v.outlet&&v.outlet.attach(T.componentRef,T.route.value),dN(T.route.value),this.activateChildRoutes(s,null,v.children)}else v.attachRef=null,v.route=p,v.outlet&&v.outlet.activateWith(p,v.injector),this.activateChildRoutes(s,null,v.children)}else this.activateChildRoutes(s,null,d)}},IT=class{path;route;constructor(s){this.path=s,this.route=this.path[this.path.length-1]}},pp=class{component;route;constructor(s,a){this.component=s,this.route=a}};function rEe(o,s,a){let d=o._root,p=s?s._root:null;return ug(d,p,a,[d.value])}function iEe(o){let s=o.routeConfig?o.routeConfig.canActivateChild:null;return!s||s.length===0?null:{node:o,guards:s}}function Sp(o,s){let a=Symbol(),d=s.get(o,a);return d===a?typeof o=="function"&&!WA(o)?o:s.get(o):d}function ug(o,s,a,d,p={canDeactivateChecks:[],canActivateChecks:[]}){let g=up(s);return o.children.forEach(v=>{oEe(v,g[v.value.outlet],a,d.concat([v.value]),p),delete g[v.value.outlet]}),Object.entries(g).forEach(([v,T])=>fg(T,a.getContext(v),p)),p}function oEe(o,s,a,d,p={canDeactivateChecks:[],canActivateChecks:[]}){let g=o.value,v=s?s.value:null,T=a?a.getContext(o.value.outlet):null;if(v&&g.routeConfig===v.routeConfig){let b=sEe(v,g,g.routeConfig.runGuardsAndResolvers);b?p.canActivateChecks.push(new IT(d)):(g.data=v.data,g._resolvedData=v._resolvedData),g.component?ug(o,s,T?T.children:null,d,p):ug(o,s,a,d,p),b&&T&&T.outlet&&T.outlet.isActivated&&p.canDeactivateChecks.push(new pp(T.outlet.component,v))}else v&&fg(s,T,p),p.canActivateChecks.push(new IT(d)),g.component?ug(o,null,T?T.children:null,d,p):ug(o,null,a,d,p);return p}function sEe(o,s,a){if(typeof a=="function")return a(o,s);switch(a){case"pathParamsChange":return!Fl(o.url,s.url);case"pathParamsOrQueryParamsChange":return!Fl(o.url,s.url)||!oa(o.queryParams,s.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!EN(o,s)||!oa(o.queryParams,s.queryParams);case"paramsChange":default:return!EN(o,s)}}function fg(o,s,a){let d=up(o),p=o.value;Object.entries(d).forEach(([g,v])=>{p.component?s?fg(v,s.children.getContext(g),a):fg(v,null,a):fg(v,s,a)}),p.component?s&&s.outlet&&s.outlet.isActivated?a.canDeactivateChecks.push(new pp(s.outlet.component,p)):a.canDeactivateChecks.push(new pp(null,p)):a.canDeactivateChecks.push(new pp(null,p))}function wg(o){return typeof o=="function"}function aEe(o){return typeof o=="boolean"}function cEe(o){return o&&wg(o.canLoad)}function dEe(o){return o&&wg(o.canActivate)}function lEe(o){return o&&wg(o.canActivateChild)}function uEe(o){return o&&wg(o.canDeactivate)}function hEe(o){return o&&wg(o.canMatch)}function iq(o){return o instanceof Da||o?.name==="EmptyError"}var oT=Symbol("INITIAL_VALUE");function Ep(){return ti(o=>My(o.map(s=>s.pipe(Oa(1),DA(oT)))).pipe(wt(s=>{for(let a of s)if(a!==!0){if(a===oT)return oT;if(a===!1||pEe(a))return a}return!0}),Pi(s=>s!==oT),Oa(1)))}function pEe(o){return fp(o)||o instanceof _p}function fEe(o,s){return hr(a=>{let{targetSnapshot:d,currentSnapshot:p,guards:{canActivateChecks:g,canDeactivateChecks:v}}=a;return v.length===0&&g.length===0?rt(gt(Ee({},a),{guardsResult:!0})):mEe(v,d,p,o).pipe(hr(T=>T&&aEe(T)?gEe(d,g,o,s):rt(T)),wt(T=>gt(Ee({},a),{guardsResult:T})))})}function mEe(o,s,a,d){return Kn(o).pipe(hr(p=>SEe(p.component,p.route,a,s,d)),Na(p=>p!==!0,!0))}function gEe(o,s,a,d){return Kn(s).pipe(jc(p=>jh(EEe(p.route.parent,d),_Ee(p.route,d),yEe(o,p.path,a),vEe(o,p.route,a))),Na(p=>p!==!0,!0))}function _Ee(o,s){return o!==null&&s&&s(new vT(o)),rt(!0)}function EEe(o,s){return o!==null&&s&&s(new _T(o)),rt(!0)}function vEe(o,s,a){let d=s.routeConfig?s.routeConfig.canActivate:null;if(!d||d.length===0)return rt(!0);let p=d.map(g=>ym(()=>{let v=vp(s)??a,T=Sp(g,v),b=dEe(T)?T.canActivate(s,o):Gr(v,()=>T(s,o));return za(b).pipe(Na())}));return rt(p).pipe(Ep())}function yEe(o,s,a){let d=s[s.length-1],g=s.slice(0,s.length-1).reverse().map(v=>iEe(v)).filter(v=>v!==null).map(v=>ym(()=>{let T=v.guards.map(b=>{let x=vp(v.node)??a,B=Sp(b,x),W=lEe(B)?B.canActivateChild(d,o):Gr(x,()=>B(d,o));return za(W).pipe(Na())});return rt(T).pipe(Ep())}));return rt(g).pipe(Ep())}function SEe(o,s,a,d,p){let g=s&&s.routeConfig?s.routeConfig.canDeactivate:null;if(!g||g.length===0)return rt(!0);let v=g.map(T=>{let b=vp(s)??p,x=Sp(T,b),B=uEe(x)?x.canDeactivate(o,s,a,d):Gr(b,()=>x(o,s,a,d));return za(B).pipe(Na())});return rt(v).pipe(Ep())}function TEe(o,s,a,d){let p=s.canLoad;if(p===void 0||p.length===0)return rt(!0);let g=p.map(v=>{let T=Sp(v,o),b=cEe(T)?T.canLoad(s,a):Gr(o,()=>T(s,a));return za(b)});return rt(g).pipe(Ep(),oq(d))}function oq(o){return SA(wr(s=>{if(typeof s!="boolean")throw RT(o,s)}),wt(s=>s===!0))}function CEe(o,s,a,d){let p=s.canMatch;if(!p||p.length===0)return rt(!0);let g=p.map(v=>{let T=Sp(v,o),b=hEe(T)?T.canMatch(s,a):Gr(o,()=>T(s,a));return za(b)});return rt(g).pipe(Ep(),oq(d))}var Tg=class{segmentGroup;constructor(s){this.segmentGroup=s||null}},Cg=class extends Error{urlTree;constructor(s){super(),this.urlTree=s}};function lp(o){return Vh(new Tg(o))}function REe(o){return Vh(new xe(4e3,!1))}function IEe(o){return Vh(nq(!1,fi.GuardRejected))}var SN=class{urlSerializer;urlTree;constructor(s,a){this.urlSerializer=s,this.urlTree=a}lineralizeSegments(s,a){let d=[],p=a.root;for(;;){if(d=d.concat(p.segments),p.numberOfChildren===0)return rt(d);if(p.numberOfChildren>1||!p.children[Ct])return REe(`${s.redirectTo}`);p=p.children[Ct]}}applyRedirectCommands(s,a,d,p,g){return bEe(a,p,g).pipe(wt(v=>{if(v instanceof aa)throw new Cg(v);let T=this.applyRedirectCreateUrlTree(v,this.urlSerializer.parse(v),s,d);if(v[0]==="/")throw new Cg(T);return T}))}applyRedirectCreateUrlTree(s,a,d,p){let g=this.createSegmentGroup(s,a.root,d,p);return new aa(g,this.createQueryParams(a.queryParams,this.urlTree.queryParams),a.fragment)}createQueryParams(s,a){let d={};return Object.entries(s).forEach(([p,g])=>{if(typeof g=="string"&&g[0]===":"){let T=g.substring(1);d[p]=a[T]}else d[p]=g}),d}createSegmentGroup(s,a,d,p){let g=this.createSegments(s,a.segments,d,p),v={};return Object.entries(a.children).forEach(([T,b])=>{v[T]=this.createSegmentGroup(s,b,d,p)}),new en(g,v)}createSegments(s,a,d,p){return a.map(g=>g.path[0]===":"?this.findPosParam(s,g,p):this.findOrReturn(g,d))}findPosParam(s,a,d){let p=d[a.path.substring(1)];if(!p)throw new xe(4001,!1);return p}findOrReturn(s,a){let d=0;for(let p of a){if(p.path===s.path)return a.splice(d),p;d++}return s}};function bEe(o,s,a){if(typeof o=="string")return rt(o);let d=o,{queryParams:p,fragment:g,routeConfig:v,url:T,outlet:b,params:x,data:B,title:W}=s;return za(Gr(a,()=>d({params:x,data:B,queryParams:p,fragment:g,routeConfig:v,url:T,outlet:b,title:W})))}var TN={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function wEe(o,s,a,d,p){let g=sq(o,s,a);return g.matched?(d=$_e(s,d),CEe(d,s,a,p).pipe(wt(v=>v===!0?g:Ee({},TN)))):rt(g)}function sq(o,s,a){if(s.path==="**")return AEe(a);if(s.path==="")return s.pathMatch==="full"&&(o.hasChildren()||a.length>0)?Ee({},TN):{matched:!0,consumedSegments:[],remainingSegments:a,parameters:{},positionalParamSegments:{}};let p=(s.matcher||M6)(a,o,s);if(!p)return Ee({},TN);let g={};Object.entries(p.posParams??{}).forEach(([T,b])=>{g[T]=b.path});let v=p.consumed.length>0?Ee(Ee({},g),p.consumed[p.consumed.length-1].parameters):g;return{matched:!0,consumedSegments:p.consumed,remainingSegments:a.slice(p.consumed.length),parameters:v,positionalParamSegments:p.posParams??{}}}function AEe(o){return{matched:!0,parameters:o.length>0?U6(o).parameters:{},consumedSegments:o,remainingSegments:[],positionalParamSegments:{}}}function P6(o,s,a,d){return a.length>0&&NEe(o,a,d)?{segmentGroup:new en(s,OEe(d,new en(a,o.children))),slicedSegments:[]}:a.length===0&&PEe(o,a,d)?{segmentGroup:new en(o.segments,DEe(o,a,d,o.children)),slicedSegments:a}:{segmentGroup:new en(o.segments,o.children),slicedSegments:a}}function DEe(o,s,a,d){let p={};for(let g of a)if(AT(o,s,g)&&!d[Ss(g)]){let v=new en([],{});p[Ss(g)]=v}return Ee(Ee({},d),p)}function OEe(o,s){let a={};a[Ct]=s;for(let d of o)if(d.path===""&&Ss(d)!==Ct){let p=new en([],{});a[Ss(d)]=p}return a}function NEe(o,s,a){return a.some(d=>AT(o,s,d)&&Ss(d)!==Ct)}function PEe(o,s,a){return a.some(d=>AT(o,s,d))}function AT(o,s,a){return(o.hasChildren()||s.length>0)&&a.pathMatch==="full"?!1:a.path===""}function LEe(o,s,a){return s.length===0&&!o.children[a]}var CN=class{};function kEe(o,s,a,d,p,g,v="emptyOnly"){return new RN(o,s,a,d,p,v,g).recognize()}var MEe=31,RN=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(s,a,d,p,g,v,T){this.injector=s,this.configLoader=a,this.rootComponentType=d,this.config=p,this.urlTree=g,this.paramsInheritanceStrategy=v,this.urlSerializer=T,this.applyRedirects=new SN(this.urlSerializer,this.urlTree)}noMatchError(s){return new xe(4002,`'${s.segmentGroup}'`)}recognize(){let s=P6(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(s).pipe(wt(({children:a,rootSnapshot:d})=>{let p=new oo(d,a),g=new yg("",p),v=z6(d,[],this.urlTree.queryParams,this.urlTree.fragment);return v.queryParams=this.urlTree.queryParams,g.url=this.urlSerializer.serialize(v),{state:g,tree:v}}))}match(s){let a=new Vl([],Object.freeze({}),Object.freeze(Ee({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Ct,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,s,Ct,a).pipe(wt(d=>({children:d,rootSnapshot:a})),Vc(d=>{if(d instanceof Cg)return this.urlTree=d.urlTree,this.match(d.urlTree.root);throw d instanceof Tg?this.noMatchError(d):d}))}processSegmentGroup(s,a,d,p,g){return d.segments.length===0&&d.hasChildren()?this.processChildren(s,a,d,g):this.processSegment(s,a,d,d.segments,p,!0,g).pipe(wt(v=>v instanceof oo?[v]:[]))}processChildren(s,a,d,p){let g=[];for(let v of Object.keys(d.children))v==="primary"?g.unshift(v):g.push(v);return Kn(g).pipe(jc(v=>{let T=d.children[v],b=X_e(a,v);return this.processSegmentGroup(s,b,T,v,p)}),AA((v,T)=>(v.push(...T),v)),Bc(null),wA(),hr(v=>{if(v===null)return lp(d);let T=aq(v);return xEe(T),rt(T)}))}processSegment(s,a,d,p,g,v,T){return Kn(a).pipe(jc(b=>this.processSegmentAgainstRoute(b._injector??s,a,b,d,p,g,v,T).pipe(Vc(x=>{if(x instanceof Tg)return rt(null);throw x}))),Na(b=>!!b),Vc(b=>{if(iq(b))return LEe(d,p,g)?rt(new CN):lp(d);throw b}))}processSegmentAgainstRoute(s,a,d,p,g,v,T,b){return Ss(d)!==v&&(v===Ct||!AT(p,g,d))?lp(p):d.redirectTo===void 0?this.matchSegmentAgainstRoute(s,p,d,g,v,b):this.allowRedirects&&T?this.expandSegmentAgainstRouteUsingRedirect(s,p,a,d,g,v,b):lp(p)}expandSegmentAgainstRouteUsingRedirect(s,a,d,p,g,v,T){let{matched:b,parameters:x,consumedSegments:B,positionalParamSegments:W,remainingSegments:ee}=sq(a,p,g);if(!b)return lp(a);typeof p.redirectTo=="string"&&p.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>MEe&&(this.allowRedirects=!1));let re=new Vl(g,x,Object.freeze(Ee({},this.urlTree.queryParams)),this.urlTree.fragment,L6(p),Ss(p),p.component??p._loadedComponent??null,p,k6(p)),Se=CT(re,T,this.paramsInheritanceStrategy);return re.params=Object.freeze(Se.params),re.data=Object.freeze(Se.data),this.applyRedirects.applyRedirectCommands(B,p.redirectTo,W,re,s).pipe(ti(Me=>this.applyRedirects.lineralizeSegments(p,Me)),hr(Me=>this.processSegment(s,d,a,Me.concat(ee),v,!1,T)))}matchSegmentAgainstRoute(s,a,d,p,g,v){let T=wEe(a,d,p,s,this.urlSerializer);return d.path==="**"&&(a.children={}),T.pipe(ti(b=>b.matched?(s=d._injector??s,this.getChildConfig(s,d,p).pipe(ti(({routes:x})=>{let B=d._loadedInjector??s,{parameters:W,consumedSegments:ee,remainingSegments:re}=b,Se=new Vl(ee,W,Object.freeze(Ee({},this.urlTree.queryParams)),this.urlTree.fragment,L6(d),Ss(d),d.component??d._loadedComponent??null,d,k6(d)),ze=CT(Se,v,this.paramsInheritanceStrategy);Se.params=Object.freeze(ze.params),Se.data=Object.freeze(ze.data);let{segmentGroup:Me,slicedSegments:Oe}=P6(a,ee,re,x);if(Oe.length===0&&Me.hasChildren())return this.processChildren(B,x,Me,Se).pipe(wt(Mi=>new oo(Se,Mi)));if(x.length===0&&Oe.length===0)return rt(new oo(Se,[]));let kn=Ss(d)===g;return this.processSegment(B,x,Me,Oe,kn?Ct:g,!0,Se).pipe(wt(Mi=>new oo(Se,Mi instanceof oo?[Mi]:[])))}))):lp(a)))}getChildConfig(s,a,d){return a.children?rt({routes:a.children,injector:s}):a.loadChildren?a._loadedRoutes!==void 0?rt({routes:a._loadedRoutes,injector:a._loadedInjector}):TEe(s,a,d,this.urlSerializer).pipe(hr(p=>p?this.configLoader.loadChildren(s,a).pipe(wr(g=>{a._loadedRoutes=g.routes,a._loadedInjector=g.injector})):IEe(a))):rt({routes:[],injector:s})}};function xEe(o){o.sort((s,a)=>s.value.outlet===Ct?-1:a.value.outlet===Ct?1:s.value.outlet.localeCompare(a.value.outlet))}function UEe(o){let s=o.value.routeConfig;return s&&s.path===""}function aq(o){let s=[],a=new Set;for(let d of o){if(!UEe(d)){s.push(d);continue}let p=s.find(g=>d.value.routeConfig===g.value.routeConfig);p!==void 0?(p.children.push(...d.children),a.add(p)):s.push(d)}for(let d of a){let p=aq(d.children);s.push(new oo(d.value,p))}return s.filter(d=>!a.has(d))}function L6(o){return o.data||{}}function k6(o){return o.resolve||{}}function FEe(o,s,a,d,p,g){return hr(v=>kEe(o,s,a,d,v.extractedUrl,p,g).pipe(wt(({state:T,tree:b})=>gt(Ee({},v),{targetSnapshot:T,urlAfterRedirects:b}))))}function VEe(o,s){return hr(a=>{let{targetSnapshot:d,guards:{canActivateChecks:p}}=a;if(!p.length)return rt(a);let g=new Set(p.map(b=>b.route)),v=new Set;for(let b of g)if(!v.has(b))for(let x of cq(b))v.add(x);let T=0;return Kn(v).pipe(jc(b=>g.has(b)?jEe(b,d,o,s):(b.data=CT(b,b.parent,o).resolve,rt(void 0))),wr(()=>T++),Bh(1),hr(b=>T===v.size?rt(a):Oi))})}function cq(o){let s=o.children.map(a=>cq(a)).flat();return[o,...s]}function jEe(o,s,a,d){let p=o.routeConfig,g=o._resolve;return p?.title!==void 0&&!Q6(p)&&(g[Rg]=p.title),ym(()=>(o.data=CT(o,o.parent,a).resolve,BEe(g,o,s,d).pipe(wt(v=>(o._resolvedData=v,o.data=Ee(Ee({},o.data),v),null)))))}function BEe(o,s,a,d){let p=hN(o);if(p.length===0)return rt({});let g={};return Kn(p).pipe(hr(v=>HEe(o[v],s,a,d).pipe(Na(),wr(T=>{if(T instanceof _p)throw RT(new Bl,T);g[v]=T}))),Bh(1),wt(()=>g),Vc(v=>iq(v)?Oi:Vh(v)))}function HEe(o,s,a,d){let p=vp(s)??d,g=Sp(o,p),v=g.resolve?g.resolve(s,a):Gr(p,()=>g(s,a));return za(v)}function lN(o){return ti(s=>{let a=o(s);return a?Kn(a).pipe(wt(()=>s)):rt(s)})}var AN=(()=>{class o{buildTitle(a){let d,p=a.root;for(;p!==void 0;)d=this.getResolvedTitleForRoute(p)??d,p=p.children.find(g=>g.outlet===Ct);return d}getResolvedTitleForRoute(a){return a.data[Rg]}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:()=>ge(dq),providedIn:"root"})}return o})(),dq=(()=>{class o extends AN{title;constructor(a){super(),this.title=a}updateTitle(a){let d=this.buildTitle(a);d!==void 0&&this.title.setTitle(d)}static \u0275fac=function(d){return new(d||o)(et(w6))};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Ag=new Fe("",{providedIn:"root",factory:()=>({})}),Dg=new Fe(""),lq=(()=>{class o{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=ge(FO);loadComponent(a,d){if(this.componentLoaders.get(d))return this.componentLoaders.get(d);if(d._loadedComponent)return rt(d._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(d);let p=za(Gr(a,()=>d.loadComponent())).pipe(wt(hq),ti(pq),wr(v=>{this.onLoadEndListener&&this.onLoadEndListener(d),d._loadedComponent=v}),dl(()=>{this.componentLoaders.delete(d)})),g=new Fh(p,()=>new ur).pipe(Uh());return this.componentLoaders.set(d,g),g}loadChildren(a,d){if(this.childrenLoaders.get(d))return this.childrenLoaders.get(d);if(d._loadedRoutes)return rt({routes:d._loadedRoutes,injector:d._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(d);let g=uq(d,this.compiler,a,this.onLoadEndListener).pipe(dl(()=>{this.childrenLoaders.delete(d)})),v=new Fh(g,()=>new ur).pipe(Uh());return this.childrenLoaders.set(d,v),v}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function uq(o,s,a,d){return za(Gr(a,()=>o.loadChildren())).pipe(wt(hq),ti(pq),hr(p=>p instanceof LS||Array.isArray(p)?rt(p):Kn(s.compileModuleAsync(p))),wt(p=>{d&&d(o);let g,v,T=!1;return Array.isArray(p)?(v=p,T=!0):(g=p.create(a).injector,v=g.get(Dg,[],{optional:!0,self:!0}).flat()),{routes:v.map(wN),injector:g}}))}function GEe(o){return o&&typeof o=="object"&&"default"in o}function hq(o){return GEe(o)?o.default:o}function pq(o){return rt(o)}var DT=(()=>{class o{static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:()=>ge(WEe),providedIn:"root"})}return o})(),WEe=(()=>{class o{shouldProcessUrl(a){return!0}extract(a){return a}merge(a,d){return a}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),fq=new Fe("");var mq=new Fe(""),gq=(()=>{class o{currentNavigation=ea(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new ur;transitionAbortWithErrorSubject=new ur;configLoader=ge(lq);environmentInjector=ge(pr);destroyRef=ge(Fa);urlSerializer=ge(Ig);rootContexts=ge(yp);location=ge(Ml);inputBindingEnabled=ge(wT,{optional:!0})!==null;titleStrategy=ge(AN);options=ge(Ag,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=ge(DT);createViewTransition=ge(fq,{optional:!0});navigationErrorHandler=ge(mq,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>rt(void 0);rootComponentType=null;destroyed=!1;constructor(){let a=p=>this.events.next(new mT(p)),d=p=>this.events.next(new gT(p));this.configLoader.onLoadEndListener=d,this.configLoader.onLoadStartListener=a,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(a){let d=++this.navigationId;ri(()=>{this.transitions?.next(gt(Ee({},a),{extractedUrl:this.urlHandlingStrategy.extract(a.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:d}))})}setupNavigations(a){return this.transitions=new Br(null),this.transitions.pipe(Pi(d=>d!==null),ti(d=>{let p=!1;return rt(d).pipe(ti(g=>{if(this.navigationId>d.id)return this.cancelNavigationTransition(d,"",fi.SupersededByNewNavigation),Oi;this.currentTransition=d,this.currentNavigation.set({id:g.id,initialUrl:g.rawUrl,extractedUrl:g.extractedUrl,targetBrowserUrl:typeof g.extras.browserUrl=="string"?this.urlSerializer.parse(g.extras.browserUrl):g.extras.browserUrl,trigger:g.source,extras:g.extras,previousNavigation:this.lastSuccessfulNavigation?gt(Ee({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>g.abortController.abort()});let v=!a.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),T=g.extras.onSameUrlNavigation??a.onSameUrlNavigation;if(!v&&T!=="reload")return this.events.next(new qa(g.id,this.urlSerializer.serialize(g.rawUrl),"",gg.IgnoredSameUrlNavigation)),g.resolve(!1),Oi;if(this.urlHandlingStrategy.shouldProcessUrl(g.rawUrl))return rt(g).pipe(ti(b=>(this.events.next(new Hl(b.id,this.urlSerializer.serialize(b.extractedUrl),b.source,b.restoredState)),b.id!==this.navigationId?Oi:Promise.resolve(b))),FEe(this.environmentInjector,this.configLoader,this.rootComponentType,a.config,this.urlSerializer,this.paramsInheritanceStrategy),wr(b=>{d.targetSnapshot=b.targetSnapshot,d.urlAfterRedirects=b.urlAfterRedirects,this.currentNavigation.update(B=>(B.finalUrl=b.urlAfterRedirects,B));let x=new _g(b.id,this.urlSerializer.serialize(b.extractedUrl),this.urlSerializer.serialize(b.urlAfterRedirects),b.targetSnapshot);this.events.next(x)}));if(v&&this.urlHandlingStrategy.shouldProcessUrl(g.currentRawUrl)){let{id:b,extractedUrl:x,source:B,restoredState:W,extras:ee}=g,re=new Hl(b,this.urlSerializer.serialize(x),B,W);this.events.next(re);let Se=J6(this.rootComponentType).snapshot;return this.currentTransition=d=gt(Ee({},g),{targetSnapshot:Se,urlAfterRedirects:x,extras:gt(Ee({},ee),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(ze=>(ze.finalUrl=x,ze)),rt(d)}else return this.events.next(new qa(g.id,this.urlSerializer.serialize(g.extractedUrl),"",gg.IgnoredByUrlHandlingStrategy)),g.resolve(!1),Oi}),wr(g=>{let v=new uT(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects),g.targetSnapshot);this.events.next(v)}),wt(g=>(this.currentTransition=d=gt(Ee({},g),{guards:rEe(g.targetSnapshot,g.currentSnapshot,this.rootContexts)}),d)),fEe(this.environmentInjector,g=>this.events.next(g)),wr(g=>{if(d.guardsResult=g.guardsResult,g.guardsResult&&typeof g.guardsResult!="boolean")throw RT(this.urlSerializer,g.guardsResult);let v=new hT(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects),g.targetSnapshot,!!g.guardsResult);this.events.next(v)}),Pi(g=>g.guardsResult?!0:(this.cancelNavigationTransition(g,"",fi.GuardRejected),!1)),lN(g=>{if(g.guards.canActivateChecks.length!==0)return rt(g).pipe(wr(v=>{let T=new pT(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects),v.targetSnapshot);this.events.next(T)}),ti(v=>{let T=!1;return rt(v).pipe(VEe(this.paramsInheritanceStrategy,this.environmentInjector),wr({next:()=>T=!0,complete:()=>{T||this.cancelNavigationTransition(v,"",fi.NoDataFromResolver)}}))}),wr(v=>{let T=new fT(v.id,this.urlSerializer.serialize(v.extractedUrl),this.urlSerializer.serialize(v.urlAfterRedirects),v.targetSnapshot);this.events.next(T)}))}),lN(g=>{let v=T=>{let b=[];if(T.routeConfig?.loadComponent){let x=vp(T)??this.environmentInjector;b.push(this.configLoader.loadComponent(x,T.routeConfig).pipe(wr(B=>{T.component=B}),wt(()=>{})))}for(let x of T.children)b.push(...v(x));return b};return My(v(g.targetSnapshot.root)).pipe(Bc(null),Oa(1))}),lN(()=>this.afterPreactivation()),ti(()=>{let{currentSnapshot:g,targetSnapshot:v}=d,T=this.createViewTransition?.(this.environmentInjector,g.root,v.root);return T?Kn(T).pipe(wt(()=>d)):rt(d)}),wt(g=>{let v=Z_e(a.routeReuseStrategy,g.targetSnapshot,g.currentRouterState);return this.currentTransition=d=gt(Ee({},g),{targetRouterState:v}),this.currentNavigation.update(T=>(T.targetRouterState=v,T)),d}),wr(()=>{this.events.next(new Eg)}),nEe(this.rootContexts,a.routeReuseStrategy,g=>this.events.next(g),this.inputBindingEnabled),Oa(1),Uy(new Ft(g=>{let v=d.abortController.signal,T=()=>g.next();return v.addEventListener("abort",T),()=>v.removeEventListener("abort",T)}).pipe(Pi(()=>!p&&!d.targetRouterState),wr(()=>{this.cancelNavigationTransition(d,d.abortController.signal.reason+"",fi.Aborted)}))),wr({next:g=>{p=!0,this.lastSuccessfulNavigation=ri(this.currentNavigation),this.events.next(new Wa(g.id,this.urlSerializer.serialize(g.extractedUrl),this.urlSerializer.serialize(g.urlAfterRedirects))),this.titleStrategy?.updateTitle(g.targetRouterState.snapshot),g.resolve(!0)},complete:()=>{p=!0}}),Uy(this.transitionAbortWithErrorSubject.pipe(wr(g=>{throw g}))),dl(()=>{p||this.cancelNavigationTransition(d,"",fi.SupersededByNewNavigation),this.currentTransition?.id===d.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),Vc(g=>{if(this.destroyed)return d.resolve(!1),Oi;if(p=!0,rq(g))this.events.next(new sa(d.id,this.urlSerializer.serialize(d.extractedUrl),g.message,g.cancellationCode)),tEe(g)?this.events.next(new gp(g.url,g.navigationBehaviorOptions)):d.resolve(!1);else{let v=new mp(d.id,this.urlSerializer.serialize(d.extractedUrl),g,d.targetSnapshot??void 0);try{let T=Gr(this.environmentInjector,()=>this.navigationErrorHandler?.(v));if(T instanceof _p){let{message:b,cancellationCode:x}=RT(this.urlSerializer,T);this.events.next(new sa(d.id,this.urlSerializer.serialize(d.extractedUrl),b,x)),this.events.next(new gp(T.redirectTo,T.navigationBehaviorOptions))}else throw this.events.next(v),g}catch(T){this.options.resolveNavigationPromiseOnError?d.resolve(!1):d.reject(T)}}return Oi}))}))}cancelNavigationTransition(a,d,p){let g=new sa(a.id,this.urlSerializer.serialize(a.extractedUrl),d,p);this.events.next(g),a.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let a=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),d=ri(this.currentNavigation),p=d?.targetBrowserUrl??d?.extractedUrl;return a.toString()!==p?.toString()&&!d?.extras.skipLocationChange}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function qEe(o){return o!==pg}var _q=(()=>{class o{static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:()=>ge(zEe),providedIn:"root"})}return o})(),bT=class{shouldDetach(s){return!1}store(s,a){}shouldAttach(s){return!1}retrieve(s){return null}shouldReuseRoute(s,a){return s.routeConfig===a.routeConfig}},zEe=(()=>{class o extends bT{static \u0275fac=(()=>{let a;return function(p){return(a||(a=Dl(o)))(p||o)}})();static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Eq=(()=>{class o{urlSerializer=ge(Ig);options=ge(Ag,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=ge(Ml);urlHandlingStrategy=ge(DT);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new aa;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:a,initialUrl:d,targetBrowserUrl:p}){let g=a!==void 0?this.urlHandlingStrategy.merge(a,d):d,v=p??g;return v instanceof aa?this.urlSerializer.serialize(v):v}commitTransition({targetRouterState:a,finalUrl:d,initialUrl:p}){d&&a?(this.currentUrlTree=d,this.rawUrlTree=this.urlHandlingStrategy.merge(d,p),this.routerState=a):this.rawUrlTree=p}routerState=J6(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:a}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,a??this.rawUrlTree)}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:()=>ge(KEe),providedIn:"root"})}return o})(),KEe=(()=>{class o extends Eq{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(a){return this.location.subscribe(d=>{d.type==="popstate"&&setTimeout(()=>{a(d.url,d.state,"popstate")})})}handleRouterEvent(a,d){a instanceof Hl?this.updateStateMemento():a instanceof qa?this.commitTransition(d):a instanceof _g?this.urlUpdateStrategy==="eager"&&(d.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(d),d)):a instanceof Eg?(this.commitTransition(d),this.urlUpdateStrategy==="deferred"&&!d.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(d),d)):a instanceof sa&&a.code!==fi.SupersededByNewNavigation&&a.code!==fi.Redirect?this.restoreHistory(d):a instanceof mp?this.restoreHistory(d,!0):a instanceof Wa&&(this.lastSuccessfulId=a.id,this.currentPageId=this.browserPageId)}setBrowserUrl(a,{extras:d,id:p}){let{replaceUrl:g,state:v}=d;if(this.location.isCurrentPathEqualTo(a)||g){let T=this.browserPageId,b=Ee(Ee({},v),this.generateNgRouterState(p,T));this.location.replaceState(a,"",b)}else{let T=Ee(Ee({},v),this.generateNgRouterState(p,this.browserPageId+1));this.location.go(a,"",T)}}restoreHistory(a,d=!1){if(this.canceledNavigationResolution==="computed"){let p=this.browserPageId,g=this.currentPageId-p;g!==0?this.location.historyGo(g):this.getCurrentUrlTree()===a.finalUrl&&g===0&&(this.resetInternalState(a),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(d&&this.resetInternalState(a),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(a,d){return this.canceledNavigationResolution==="computed"?{navigationId:a,\u0275routerPageId:d}:{navigationId:a}}static \u0275fac=(()=>{let a;return function(p){return(a||(a=Dl(o)))(p||o)}})();static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function DN(o,s){o.events.pipe(Pi(a=>a instanceof Wa||a instanceof sa||a instanceof mp||a instanceof qa),wt(a=>a instanceof Wa||a instanceof qa?0:(a instanceof sa?a.code===fi.Redirect||a.code===fi.SupersededByNewNavigation:!1)?2:1),Pi(a=>a!==2),Oa(1)).subscribe(()=>{s()})}var YEe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},$Ee={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Tp=(()=>{class o{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=ge(LO);stateManager=ge(Eq);options=ge(Ag,{optional:!0})||{};pendingTasks=ge(ta);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=ge(gq);urlSerializer=ge(Ig);location=ge(Ml);urlHandlingStrategy=ge(DT);injector=ge(pr);_events=new ur;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=ge(_q);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=ge(Dg,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!ge(wT,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:a=>{this.console.warn(a)}}),this.subscribeToNavigationEvents()}eventsSubscription=new rr;subscribeToNavigationEvents(){let a=this.navigationTransitions.events.subscribe(d=>{try{let p=this.navigationTransitions.currentTransition,g=ri(this.navigationTransitions.currentNavigation);if(p!==null&&g!==null){if(this.stateManager.handleRouterEvent(d,g),d instanceof sa&&d.code!==fi.Redirect&&d.code!==fi.SupersededByNewNavigation)this.navigated=!0;else if(d instanceof Wa)this.navigated=!0;else if(d instanceof gp){let v=d.navigationBehaviorOptions,T=this.urlHandlingStrategy.merge(d.url,p.currentRawUrl),b=Ee({browserUrl:p.extras.browserUrl,info:p.extras.info,skipLocationChange:p.extras.skipLocationChange,replaceUrl:p.extras.replaceUrl||this.urlUpdateStrategy==="eager"||qEe(p.source)},v);this.scheduleNavigation(T,pg,null,b,{resolve:p.resolve,reject:p.reject,promise:p.promise})}}Y_e(d)&&this._events.next(d)}catch(p){this.navigationTransitions.transitionAbortWithErrorSubject.next(p)}});this.eventsSubscription.add(a)}resetRootComponentType(a){this.routerState.root.component=a,this.navigationTransitions.rootComponentType=a}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),pg,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((a,d,p)=>{this.navigateToSyncWithBrowser(a,p,d)})}navigateToSyncWithBrowser(a,d,p){let g={replaceUrl:!0},v=p?.navigationId?p:null;if(p){let b=Ee({},p);delete b.navigationId,delete b.\u0275routerPageId,Object.keys(b).length!==0&&(g.state=b)}let T=this.parseUrl(a);this.scheduleNavigation(T,d,v,g).catch(b=>{this.disposed||this.injector.get(ro)(b)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return ri(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(a){this.config=a.map(wN),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(a,d={}){let{relativeTo:p,queryParams:g,fragment:v,queryParamsHandling:T,preserveFragment:b}=d,x=b?this.currentUrlTree.fragment:v,B=null;switch(T??this.options.defaultQueryParamsHandling){case"merge":B=Ee(Ee({},this.currentUrlTree.queryParams),g);break;case"preserve":B=this.currentUrlTree.queryParams;break;default:B=g||null}B!==null&&(B=this.removeEmptyProps(B));let W;try{let ee=p?p.snapshot:this.routerState.snapshot.root;W=K6(ee)}catch{(typeof a[0]!="string"||a[0][0]!=="/")&&(a=[]),W=this.currentUrlTree.root}return Y6(W,a,B,x??null)}navigateByUrl(a,d={skipLocationChange:!1}){let p=fp(a)?a:this.parseUrl(a),g=this.urlHandlingStrategy.merge(p,this.rawUrlTree);return this.scheduleNavigation(g,pg,null,d)}navigate(a,d={skipLocationChange:!1}){return XEe(a),this.navigateByUrl(this.createUrlTree(a,d),d)}serializeUrl(a){return this.urlSerializer.serialize(a)}parseUrl(a){try{return this.urlSerializer.parse(a)}catch{return this.urlSerializer.parse("/")}}isActive(a,d){let p;if(d===!0?p=Ee({},YEe):d===!1?p=Ee({},$Ee):p=d,fp(a))return A6(this.currentUrlTree,a,p);let g=this.parseUrl(a);return A6(this.currentUrlTree,g,p)}removeEmptyProps(a){return Object.entries(a).reduce((d,[p,g])=>(g!=null&&(d[p]=g),d),{})}scheduleNavigation(a,d,p,g,v){if(this.disposed)return Promise.resolve(!1);let T,b,x;v?(T=v.resolve,b=v.reject,x=v.promise):x=new Promise((W,ee)=>{T=W,b=ee});let B=this.pendingTasks.add();return DN(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(B))}),this.navigationTransitions.handleNavigationRequest({source:d,restoredState:p,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:a,extras:g,resolve:T,reject:b,promise:x,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),x.catch(W=>Promise.reject(W))}static \u0275fac=function(d){return new(d||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function XEe(o){for(let s=0;s<o.length;s++)if(o[s]==null)throw new xe(4008,!1)}var ZEe=new Fe("");function ON(o,...s){return Ma([{provide:Dg,multi:!0,useValue:o},[],{provide:rd,useFactory:QEe,deps:[Tp]},{provide:kS,multi:!0,useFactory:tve},s.map(a=>a.\u0275providers)])}function QEe(o){return o.routerState.root}function eve(o,s){return{\u0275kind:o,\u0275providers:s}}function tve(){let o=ge(us);return s=>{let a=o.get(Zc);if(s!==a.components[0])return;let d=o.get(Tp),p=o.get(nve);o.get(rve)===1&&d.initialNavigation(),o.get(ive,null,{optional:!0})?.setUpPreloading(),o.get(ZEe,null,{optional:!0})?.init(),d.resetRootComponentType(a.componentTypes[0]),p.closed||(p.next(),p.complete(),p.unsubscribe())}}var nve=new Fe("",{factory:()=>new ur}),rve=new Fe("",{providedIn:"root",factory:()=>1});var ive=new Fe("");function NN(){return eve(6,[{provide:ed,useClass:KO}])}var bq=(()=>{class o{_renderer;_elementRef;onChange=a=>{};onTouched=()=>{};constructor(a,d){this._renderer=a,this._elementRef=d}setProperty(a,d){this._renderer.setProperty(this._elementRef.nativeElement,a,d)}registerOnTouched(a){this.onTouched=a}registerOnChange(a){this.onChange=a}setDisabledState(a){this.setProperty("disabled",a)}static \u0275fac=function(d){return new(d||o)(Qt(rp),Qt(Ol))};static \u0275dir=Wr({type:o})}return o})(),sve=(()=>{class o extends bq{static \u0275fac=(()=>{let a;return function(p){return(a||(a=Dl(o)))(p||o)}})();static \u0275dir=Wr({type:o,features:[vs]})}return o})(),MN=new Fe("");var ave={provide:MN,useExisting:Js(()=>Ip),multi:!0};function cve(){let o=Fo()?Fo().getUserAgent():"";return/android (\d+)/.test(o.toLowerCase())}var dve=new Fe(""),Ip=(()=>{class o extends bq{_compositionMode;_composing=!1;constructor(a,d,p){super(a,d),this._compositionMode=p,this._compositionMode==null&&(this._compositionMode=!cve())}writeValue(a){let d=a??"";this.setProperty("value",d)}_handleInput(a){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(a)}_compositionStart(){this._composing=!0}_compositionEnd(a){this._composing=!1,this._compositionMode&&this.onChange(a)}static \u0275fac=function(d){return new(d||o)(Qt(rp),Qt(Ol),Qt(dve,8))};static \u0275dir=Wr({type:o,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(d,p){d&1&&qr("input",function(v){return p._handleInput(v.target.value)})("blur",function(){return p.onTouched()})("compositionstart",function(){return p._compositionStart()})("compositionend",function(v){return p._compositionEnd(v.target.value)})},standalone:!1,features:[kl([ave]),vs]})}return o})();function xN(o){return o==null||UN(o)===0}function UN(o){return o==null?null:Array.isArray(o)||typeof o=="string"?o.length:o instanceof Set?o.size:null}var HT=new Fe(""),FN=new Fe(""),lve=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,NT=class{static min(s){return uve(s)}static max(s){return hve(s)}static required(s){return wq(s)}static requiredTrue(s){return pve(s)}static email(s){return fve(s)}static minLength(s){return mve(s)}static maxLength(s){return gve(s)}static pattern(s){return _ve(s)}static nullValidator(s){return PT()}static compose(s){return Lq(s)}static composeAsync(s){return Mq(s)}};function uve(o){return s=>{if(s.value==null||o==null)return null;let a=parseFloat(s.value);return!isNaN(a)&&a<o?{min:{min:o,actual:s.value}}:null}}function hve(o){return s=>{if(s.value==null||o==null)return null;let a=parseFloat(s.value);return!isNaN(a)&&a>o?{max:{max:o,actual:s.value}}:null}}function wq(o){return xN(o.value)?{required:!0}:null}function pve(o){return o.value===!0?null:{required:!0}}function fve(o){return xN(o.value)||lve.test(o.value)?null:{email:!0}}function mve(o){return s=>{let a=s.value?.length??UN(s.value);return a===null||a===0?null:a<o?{minlength:{requiredLength:o,actualLength:a}}:null}}function gve(o){return s=>{let a=s.value?.length??UN(s.value);return a!==null&&a>o?{maxlength:{requiredLength:o,actualLength:a}}:null}}function _ve(o){if(!o)return PT;let s,a;return typeof o=="string"?(a="",o.charAt(0)!=="^"&&(a+="^"),a+=o,o.charAt(o.length-1)!=="$"&&(a+="$"),s=new RegExp(a)):(a=o.toString(),s=o),d=>{if(xN(d.value))return null;let p=d.value;return s.test(p)?null:{pattern:{requiredPattern:a,actualValue:p}}}}function PT(o){return null}function Aq(o){return o!=null}function Dq(o){return Nl(o)?Kn(o):o}function Oq(o){let s={};return o.forEach(a=>{s=a!=null?Ee(Ee({},s),a):s}),Object.keys(s).length===0?null:s}function Nq(o,s){return s.map(a=>a(o))}function Eve(o){return!o.validate}function Pq(o){return o.map(s=>Eve(s)?s:a=>s.validate(a))}function Lq(o){if(!o)return null;let s=o.filter(Aq);return s.length==0?null:function(a){return Oq(Nq(a,s))}}function kq(o){return o!=null?Lq(Pq(o)):null}function Mq(o){if(!o)return null;let s=o.filter(Aq);return s.length==0?null:function(a){let d=Nq(a,s).map(Dq);return bA(d).pipe(wt(Oq))}}function xq(o){return o!=null?Mq(Pq(o)):null}function vq(o,s){return o===null?[s]:Array.isArray(o)?[...o,s]:[o,s]}function Uq(o){return o._rawValidators}function Fq(o){return o._rawAsyncValidators}function PN(o){return o?Array.isArray(o)?o:[o]:[]}function LT(o,s){return Array.isArray(o)?o.includes(s):o===s}function yq(o,s){let a=PN(s);return PN(o).forEach(p=>{LT(a,p)||a.push(p)}),a}function Sq(o,s){return PN(s).filter(a=>!LT(o,a))}var kT=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(s){this._rawValidators=s||[],this._composedValidatorFn=kq(this._rawValidators)}_setAsyncValidators(s){this._rawAsyncValidators=s||[],this._composedAsyncValidatorFn=xq(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(s){this._onDestroyCallbacks.push(s)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(s=>s()),this._onDestroyCallbacks=[]}reset(s=void 0){this.control&&this.control.reset(s)}hasError(s,a){return this.control?this.control.hasError(s,a):!1}getError(s,a){return this.control?this.control.getError(s,a):null}},Gl=class extends kT{name;get formDirective(){return null}get path(){return null}},Wl=class extends kT{_parent=null;name=null;valueAccessor=null},MT=class{_cd;constructor(s){this._cd=s}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},vve={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},CFe=gt(Ee({},vve),{"[class.ng-submitted]":"isSubmitted"}),GT=(()=>{class o extends MT{constructor(a){super(a)}static \u0275fac=function(d){return new(d||o)(Qt(Wl,2))};static \u0275dir=Wr({type:o,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(d,p){d&2&&Jm("ng-untouched",p.isUntouched)("ng-touched",p.isTouched)("ng-pristine",p.isPristine)("ng-dirty",p.isDirty)("ng-valid",p.isValid)("ng-invalid",p.isInvalid)("ng-pending",p.isPending)},standalone:!1,features:[vs]})}return o})(),Vq=(()=>{class o extends MT{constructor(a){super(a)}static \u0275fac=function(d){return new(d||o)(Qt(Gl,10))};static \u0275dir=Wr({type:o,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(d,p){d&2&&Jm("ng-untouched",p.isUntouched)("ng-touched",p.isTouched)("ng-pristine",p.isPristine)("ng-dirty",p.isDirty)("ng-valid",p.isValid)("ng-invalid",p.isInvalid)("ng-pending",p.isPending)("ng-submitted",p.isSubmitted)},standalone:!1,features:[vs]})}return o})();var Og="VALID",OT="INVALID",Cp="PENDING",Ng="DISABLED",id=class{},xT=class extends id{value;source;constructor(s,a){super(),this.value=s,this.source=a}},Pg=class extends id{pristine;source;constructor(s,a){super(),this.pristine=s,this.source=a}},Lg=class extends id{touched;source;constructor(s,a){super(),this.touched=s,this.source=a}},Rp=class extends id{status;source;constructor(s,a){super(),this.status=s,this.source=a}},LN=class extends id{source;constructor(s){super(),this.source=s}},UT=class extends id{source;constructor(s){super(),this.source=s}};function jq(o){return(WT(o)?o.validators:o)||null}function yve(o){return Array.isArray(o)?kq(o):o||null}function Bq(o,s){return(WT(s)?s.asyncValidators:o)||null}function Sve(o){return Array.isArray(o)?xq(o):o||null}function WT(o){return o!=null&&!Array.isArray(o)&&typeof o=="object"}function Tve(o,s,a){let d=o.controls;if(!(s?Object.keys(d):d).length)throw new xe(1e3,"");if(!d[a])throw new xe(1001,"")}function Cve(o,s,a){o._forEachChild((d,p)=>{if(a[p]===void 0)throw new xe(1002,"")})}var FT=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(s,a){this._assignValidators(s),this._assignAsyncValidators(a)}get validator(){return this._composedValidatorFn}set validator(s){this._rawValidators=this._composedValidatorFn=s}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(s){this._rawAsyncValidators=this._composedAsyncValidatorFn=s}get parent(){return this._parent}get status(){return ri(this.statusReactive)}set status(s){ri(()=>this.statusReactive.set(s))}_status=ip(()=>this.statusReactive());statusReactive=ea(void 0);get valid(){return this.status===Og}get invalid(){return this.status===OT}get pending(){return this.status==Cp}get disabled(){return this.status===Ng}get enabled(){return this.status!==Ng}errors;get pristine(){return ri(this.pristineReactive)}set pristine(s){ri(()=>this.pristineReactive.set(s))}_pristine=ip(()=>this.pristineReactive());pristineReactive=ea(!0);get dirty(){return!this.pristine}get touched(){return ri(this.touchedReactive)}set touched(s){ri(()=>this.touchedReactive.set(s))}_touched=ip(()=>this.touchedReactive());touchedReactive=ea(!1);get untouched(){return!this.touched}_events=new ur;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(s){this._assignValidators(s)}setAsyncValidators(s){this._assignAsyncValidators(s)}addValidators(s){this.setValidators(yq(s,this._rawValidators))}addAsyncValidators(s){this.setAsyncValidators(yq(s,this._rawAsyncValidators))}removeValidators(s){this.setValidators(Sq(s,this._rawValidators))}removeAsyncValidators(s){this.setAsyncValidators(Sq(s,this._rawAsyncValidators))}hasValidator(s){return LT(this._rawValidators,s)}hasAsyncValidator(s){return LT(this._rawAsyncValidators,s)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(s={}){let a=this.touched===!1;this.touched=!0;let d=s.sourceControl??this;this._parent&&!s.onlySelf&&this._parent.markAsTouched(gt(Ee({},s),{sourceControl:d})),a&&s.emitEvent!==!1&&this._events.next(new Lg(!0,d))}markAllAsDirty(s={}){this.markAsDirty({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:this}),this._forEachChild(a=>a.markAllAsDirty(s))}markAllAsTouched(s={}){this.markAsTouched({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:this}),this._forEachChild(a=>a.markAllAsTouched(s))}markAsUntouched(s={}){let a=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let d=s.sourceControl??this;this._forEachChild(p=>{p.markAsUntouched({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:d})}),this._parent&&!s.onlySelf&&this._parent._updateTouched(s,d),a&&s.emitEvent!==!1&&this._events.next(new Lg(!1,d))}markAsDirty(s={}){let a=this.pristine===!0;this.pristine=!1;let d=s.sourceControl??this;this._parent&&!s.onlySelf&&this._parent.markAsDirty(gt(Ee({},s),{sourceControl:d})),a&&s.emitEvent!==!1&&this._events.next(new Pg(!1,d))}markAsPristine(s={}){let a=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let d=s.sourceControl??this;this._forEachChild(p=>{p.markAsPristine({onlySelf:!0,emitEvent:s.emitEvent})}),this._parent&&!s.onlySelf&&this._parent._updatePristine(s,d),a&&s.emitEvent!==!1&&this._events.next(new Pg(!0,d))}markAsPending(s={}){this.status=Cp;let a=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new Rp(this.status,a)),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.markAsPending(gt(Ee({},s),{sourceControl:a}))}disable(s={}){let a=this._parentMarkedDirty(s.onlySelf);this.status=Ng,this.errors=null,this._forEachChild(p=>{p.disable(gt(Ee({},s),{onlySelf:!0}))}),this._updateValue();let d=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new xT(this.value,d)),this._events.next(new Rp(this.status,d)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(gt(Ee({},s),{skipPristineCheck:a}),this),this._onDisabledChange.forEach(p=>p(!0))}enable(s={}){let a=this._parentMarkedDirty(s.onlySelf);this.status=Og,this._forEachChild(d=>{d.enable(gt(Ee({},s),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent}),this._updateAncestors(gt(Ee({},s),{skipPristineCheck:a}),this),this._onDisabledChange.forEach(d=>d(!1))}_updateAncestors(s,a){this._parent&&!s.onlySelf&&(this._parent.updateValueAndValidity(s),s.skipPristineCheck||this._parent._updatePristine({},a),this._parent._updateTouched({},a))}setParent(s){this._parent=s}getRawValue(){return this.value}updateValueAndValidity(s={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let d=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Og||this.status===Cp)&&this._runAsyncValidator(d,s.emitEvent)}let a=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new xT(this.value,a)),this._events.next(new Rp(this.status,a)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.updateValueAndValidity(gt(Ee({},s),{sourceControl:a}))}_updateTreeValidity(s={emitEvent:!0}){this._forEachChild(a=>a._updateTreeValidity(s)),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ng:Og}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(s,a){if(this.asyncValidator){this.status=Cp,this._hasOwnPendingAsyncValidator={emitEvent:a!==!1,shouldHaveEmitted:s!==!1};let d=Dq(this.asyncValidator(this));this._asyncValidationSubscription=d.subscribe(p=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(p,{emitEvent:a,shouldHaveEmitted:s})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let s=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,s}return!1}setErrors(s,a={}){this.errors=s,this._updateControlsErrors(a.emitEvent!==!1,this,a.shouldHaveEmitted)}get(s){let a=s;return a==null||(Array.isArray(a)||(a=a.split(".")),a.length===0)?null:a.reduce((d,p)=>d&&d._find(p),this)}getError(s,a){let d=a?this.get(a):this;return d&&d.errors?d.errors[s]:null}hasError(s,a){return!!this.getError(s,a)}get root(){let s=this;for(;s._parent;)s=s._parent;return s}_updateControlsErrors(s,a,d){this.status=this._calculateStatus(),s&&this.statusChanges.emit(this.status),(s||d)&&this._events.next(new Rp(this.status,a)),this._parent&&this._parent._updateControlsErrors(s,a,d)}_initObservables(){this.valueChanges=new Zn,this.statusChanges=new Zn}_calculateStatus(){return this._allControlsDisabled()?Ng:this.errors?OT:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Cp)?Cp:this._anyControlsHaveStatus(OT)?OT:Og}_anyControlsHaveStatus(s){return this._anyControls(a=>a.status===s)}_anyControlsDirty(){return this._anyControls(s=>s.dirty)}_anyControlsTouched(){return this._anyControls(s=>s.touched)}_updatePristine(s,a){let d=!this._anyControlsDirty(),p=this.pristine!==d;this.pristine=d,this._parent&&!s.onlySelf&&this._parent._updatePristine(s,a),p&&this._events.next(new Pg(this.pristine,a))}_updateTouched(s={},a){this.touched=this._anyControlsTouched(),this._events.next(new Lg(this.touched,a)),this._parent&&!s.onlySelf&&this._parent._updateTouched(s,a)}_onDisabledChange=[];_registerOnCollectionChange(s){this._onCollectionChange=s}_setUpdateStrategy(s){WT(s)&&s.updateOn!=null&&(this._updateOn=s.updateOn)}_parentMarkedDirty(s){let a=this._parent&&this._parent.dirty;return!s&&!!a&&!this._parent._anyControlsDirty()}_find(s){return null}_assignValidators(s){this._rawValidators=Array.isArray(s)?s.slice():s,this._composedValidatorFn=yve(this._rawValidators)}_assignAsyncValidators(s){this._rawAsyncValidators=Array.isArray(s)?s.slice():s,this._composedAsyncValidatorFn=Sve(this._rawAsyncValidators)}},VT=class extends FT{constructor(s,a,d){super(jq(a),Bq(d,a)),this.controls=s,this._initObservables(),this._setUpdateStrategy(a),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(s,a){return this.controls[s]?this.controls[s]:(this.controls[s]=a,a.setParent(this),a._registerOnCollectionChange(this._onCollectionChange),a)}addControl(s,a,d={}){this.registerControl(s,a),this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}removeControl(s,a={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}setControl(s,a,d={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],a&&this.registerControl(s,a),this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}contains(s){return this.controls.hasOwnProperty(s)&&this.controls[s].enabled}setValue(s,a={}){Cve(this,!0,s),Object.keys(s).forEach(d=>{Tve(this,!0,d),this.controls[d].setValue(s[d],{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a)}patchValue(s,a={}){s!=null&&(Object.keys(s).forEach(d=>{let p=this.controls[d];p&&p.patchValue(s[d],{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a))}reset(s={},a={}){this._forEachChild((d,p)=>{d.reset(s?s[p]:null,{onlySelf:!0,emitEvent:a.emitEvent})}),this._updatePristine(a,this),this._updateTouched(a,this),this.updateValueAndValidity(a),a?.emitEvent!==!1&&this._events.next(new UT(this))}getRawValue(){return this._reduceChildren({},(s,a,d)=>(s[d]=a.getRawValue(),s))}_syncPendingControls(){let s=this._reduceChildren(!1,(a,d)=>d._syncPendingControls()?!0:a);return s&&this.updateValueAndValidity({onlySelf:!0}),s}_forEachChild(s){Object.keys(this.controls).forEach(a=>{let d=this.controls[a];d&&s(d,a)})}_setUpControls(){this._forEachChild(s=>{s.setParent(this),s._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(s){for(let[a,d]of Object.entries(this.controls))if(this.contains(a)&&s(d))return!0;return!1}_reduceValue(){let s={};return this._reduceChildren(s,(a,d,p)=>((d.enabled||this.disabled)&&(a[p]=d.value),a))}_reduceChildren(s,a){let d=s;return this._forEachChild((p,g)=>{d=a(d,p,g)}),d}_allControlsDisabled(){for(let s of Object.keys(this.controls))if(this.controls[s].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(s){return this.controls.hasOwnProperty(s)?this.controls[s]:null}};var qT=new Fe("",{providedIn:"root",factory:()=>zT}),zT="always";function Hq(o,s){return[...s.path,o]}function kN(o,s,a=zT){VN(o,s),s.valueAccessor.writeValue(o.value),(o.disabled||a==="always")&&s.valueAccessor.setDisabledState?.(o.disabled),Ive(o,s),wve(o,s),bve(o,s),Rve(o,s)}function Tq(o,s,a=!0){let d=()=>{};s.valueAccessor&&(s.valueAccessor.registerOnChange(d),s.valueAccessor.registerOnTouched(d)),BT(o,s),o&&(s._invokeOnDestroyCallbacks(),o._registerOnCollectionChange(()=>{}))}function jT(o,s){o.forEach(a=>{a.registerOnValidatorChange&&a.registerOnValidatorChange(s)})}function Rve(o,s){if(s.valueAccessor.setDisabledState){let a=d=>{s.valueAccessor.setDisabledState(d)};o.registerOnDisabledChange(a),s._registerOnDestroy(()=>{o._unregisterOnDisabledChange(a)})}}function VN(o,s){let a=Uq(o);s.validator!==null?o.setValidators(vq(a,s.validator)):typeof a=="function"&&o.setValidators([a]);let d=Fq(o);s.asyncValidator!==null?o.setAsyncValidators(vq(d,s.asyncValidator)):typeof d=="function"&&o.setAsyncValidators([d]);let p=()=>o.updateValueAndValidity();jT(s._rawValidators,p),jT(s._rawAsyncValidators,p)}function BT(o,s){let a=!1;if(o!==null){if(s.validator!==null){let p=Uq(o);if(Array.isArray(p)&&p.length>0){let g=p.filter(v=>v!==s.validator);g.length!==p.length&&(a=!0,o.setValidators(g))}}if(s.asyncValidator!==null){let p=Fq(o);if(Array.isArray(p)&&p.length>0){let g=p.filter(v=>v!==s.asyncValidator);g.length!==p.length&&(a=!0,o.setAsyncValidators(g))}}}let d=()=>{};return jT(s._rawValidators,d),jT(s._rawAsyncValidators,d),a}function Ive(o,s){s.valueAccessor.registerOnChange(a=>{o._pendingValue=a,o._pendingChange=!0,o._pendingDirty=!0,o.updateOn==="change"&&Gq(o,s)})}function bve(o,s){s.valueAccessor.registerOnTouched(()=>{o._pendingTouched=!0,o.updateOn==="blur"&&o._pendingChange&&Gq(o,s),o.updateOn!=="submit"&&o.markAsTouched()})}function Gq(o,s){o._pendingDirty&&o.markAsDirty(),o.setValue(o._pendingValue,{emitModelToViewChange:!1}),s.viewToModelUpdate(o._pendingValue),o._pendingChange=!1}function wve(o,s){let a=(d,p)=>{s.valueAccessor.writeValue(d),p&&s.viewToModelUpdate(d)};o.registerOnChange(a),s._registerOnDestroy(()=>{o._unregisterOnChange(a)})}function Ave(o,s){o==null,VN(o,s)}function Dve(o,s){return BT(o,s)}function Wq(o,s){if(!o.hasOwnProperty("model"))return!1;let a=o.model;return a.isFirstChange()?!0:!Object.is(s,a.currentValue)}function Ove(o){return Object.getPrototypeOf(o.constructor)===sve}function Nve(o,s){o._syncPendingControls(),s.forEach(a=>{let d=a.control;d.updateOn==="submit"&&d._pendingChange&&(a.viewToModelUpdate(d._pendingValue),d._pendingChange=!1)})}function qq(o,s){if(!s)return null;Array.isArray(s);let a,d,p;return s.forEach(g=>{g.constructor===Ip?a=g:Ove(g)?d=g:p=g}),p||d||a||null}function Pve(o,s){let a=o.indexOf(s);a>-1&&o.splice(a,1)}function Cq(o,s){let a=o.indexOf(s);a>-1&&o.splice(a,1)}function Rq(o){return typeof o=="object"&&o!==null&&Object.keys(o).length===2&&"value"in o&&"disabled"in o}var KT=class extends FT{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(s=null,a,d){super(jq(a),Bq(d,a)),this._applyFormState(s),this._setUpdateStrategy(a),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),WT(a)&&(a.nonNullable||a.initialValueIsDefault)&&(Rq(s)?this.defaultValue=s.value:this.defaultValue=s)}setValue(s,a={}){this.value=this._pendingValue=s,this._onChange.length&&a.emitModelToViewChange!==!1&&this._onChange.forEach(d=>d(this.value,a.emitViewToModelChange!==!1)),this.updateValueAndValidity(a)}patchValue(s,a={}){this.setValue(s,a)}reset(s=this.defaultValue,a={}){this._applyFormState(s),this.markAsPristine(a),this.markAsUntouched(a),this.setValue(this.value,a),this._pendingChange=!1,a?.emitEvent!==!1&&this._events.next(new UT(this))}_updateValue(){}_anyControls(s){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(s){this._onChange.push(s)}_unregisterOnChange(s){Cq(this._onChange,s)}registerOnDisabledChange(s){this._onDisabledChange.push(s)}_unregisterOnDisabledChange(s){Cq(this._onDisabledChange,s)}_forEachChild(s){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(s){Rq(s)?(this.value=this._pendingValue=s.value,s.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=s}};var Lve=o=>o instanceof KT;var kve={provide:Wl,useExisting:Js(()=>jN)},Iq=Promise.resolve(),jN=(()=>{class o extends Wl{_changeDetectorRef;callSetDisabledState;control=new KT;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Zn;constructor(a,d,p,g,v,T){super(),this._changeDetectorRef=v,this.callSetDisabledState=T,this._parent=a,this._setValidators(d),this._setAsyncValidators(p),this.valueAccessor=qq(this,g)}ngOnChanges(a){if(this._checkForErrors(),!this._registered||"name"in a){if(this._registered&&(this._checkName(),this.formDirective)){let d=a.name.previousValue;this.formDirective.removeControl({name:d,path:this._getPath(d)})}this._setUpControl()}"isDisabled"in a&&this._updateDisabled(a),Wq(a,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(a){this.viewModel=a,this.update.emit(a)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){kN(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(a){Iq.then(()=>{this.control.setValue(a,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(a){let d=a.isDisabled.currentValue,p=d!==0&&qS(d);Iq.then(()=>{p&&!this.control.disabled?this.control.disable():!p&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(a){return this._parent?Hq(a,this._parent):[a]}static \u0275fac=function(d){return new(d||o)(Qt(Gl,9),Qt(HT,10),Qt(FN,10),Qt(MN,10),Qt(Qm,8),Qt(qT,8))};static \u0275dir=Wr({type:o,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[kl([kve]),vs,Ba]})}return o})();var zq=(()=>{class o{static \u0275fac=function(d){return new(d||o)};static \u0275dir=Wr({type:o,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return o})();var Kq=new Fe("");var Mve={provide:Gl,useExisting:Js(()=>BN)},BN=(()=>{class o extends Gl{callSetDisabledState;get submitted(){return ri(this._submittedReactive)}set submitted(a){this._submittedReactive.set(a)}_submitted=ip(()=>this._submittedReactive());_submittedReactive=ea(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Zn;constructor(a,d,p){super(),this.callSetDisabledState=p,this._setValidators(a),this._setAsyncValidators(d)}ngOnChanges(a){a.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(BT(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(a){let d=this.form.get(a.path);return kN(d,a,this.callSetDisabledState),d.updateValueAndValidity({emitEvent:!1}),this.directives.push(a),d}getControl(a){return this.form.get(a.path)}removeControl(a){Tq(a.control||null,a,!1),Pve(this.directives,a)}addFormGroup(a){this._setUpFormContainer(a)}removeFormGroup(a){this._cleanUpFormContainer(a)}getFormGroup(a){return this.form.get(a.path)}addFormArray(a){this._setUpFormContainer(a)}removeFormArray(a){this._cleanUpFormContainer(a)}getFormArray(a){return this.form.get(a.path)}updateModel(a,d){this.form.get(a.path).setValue(d)}onSubmit(a){return this._submittedReactive.set(!0),Nve(this.form,this.directives),this.ngSubmit.emit(a),this.form._events.next(new LN(this.control)),a?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(a=void 0,d={}){this.form.reset(a,d),this._submittedReactive.set(!1)}_updateDomValue(){this.directives.forEach(a=>{let d=a.control,p=this.form.get(a.path);d!==p&&(Tq(d||null,a),Lve(p)&&(kN(p,a,this.callSetDisabledState),a.control=p))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(a){let d=this.form.get(a.path);Ave(d,a),d.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(a){if(this.form){let d=this.form.get(a.path);d&&Dve(d,a)&&d.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){VN(this.form,this),this._oldForm&&BT(this._oldForm,this)}static \u0275fac=function(d){return new(d||o)(Qt(HT,10),Qt(FN,10),Qt(qT,8))};static \u0275dir=Wr({type:o,selectors:[["","formGroup",""]],hostBindings:function(d,p){d&1&&qr("submit",function(v){return p.onSubmit(v)})("reset",function(){return p.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[kl([Mve]),vs,Ba]})}return o})();var xve={provide:Wl,useExisting:Js(()=>HN)},HN=(()=>{class o extends Wl{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(a){}model;update=new Zn;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(a,d,p,g,v){super(),this._ngModelWarningConfig=v,this._parent=a,this._setValidators(d),this._setAsyncValidators(p),this.valueAccessor=qq(this,g)}ngOnChanges(a){this._added||this._setUpControl(),Wq(a,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(a){this.viewModel=a,this.update.emit(a)}get path(){return Hq(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(d){return new(d||o)(Qt(Gl,13),Qt(HT,10),Qt(FN,10),Qt(MN,10),Qt(Kq,8))};static \u0275dir=Wr({type:o,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[kl([xve]),vs,Ba]})}return o})();var Uve=(()=>{class o{_validator=PT;_onChange;_enabled;ngOnChanges(a){if(this.inputName in a){let d=this.normalizeInput(a[this.inputName].currentValue);this._enabled=this.enabled(d),this._validator=this._enabled?this.createValidator(d):PT,this._onChange&&this._onChange()}}validate(a){return this._validator(a)}registerOnValidatorChange(a){this._onChange=a}enabled(a){return a!=null}static \u0275fac=function(d){return new(d||o)};static \u0275dir=Wr({type:o,features:[Ba]})}return o})();var Fve={provide:HT,useExisting:Js(()=>GN),multi:!0};var GN=(()=>{class o extends Uve{required;inputName="required";normalizeInput=qS;createValidator=a=>wq;enabled(a){return a}static \u0275fac=(()=>{let a;return function(p){return(a||(a=Dl(o)))(p||o)}})();static \u0275dir=Wr({type:o,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(d,p){d&2&&MS("required",p._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[kl([Fve]),vs]})}return o})();var Yq=(()=>{class o{static \u0275fac=function(d){return new(d||o)};static \u0275mod=ia({type:o});static \u0275inj=hs({})}return o})();var $q=(()=>{class o{static withConfig(a){return{ngModule:o,providers:[{provide:qT,useValue:a.callSetDisabledState??zT}]}}static \u0275fac=function(d){return new(d||o)};static \u0275mod=ia({type:o});static \u0275inj=hs({imports:[Yq]})}return o})(),Xq=(()=>{class o{static withConfig(a){return{ngModule:o,providers:[{provide:Kq,useValue:a.warnOnNgModelWithFormControl??"always"},{provide:qT,useValue:a.callSetDisabledState??zT}]}}static \u0275fac=function(d){return new(d||o)};static \u0275mod=ia({type:o});static \u0275inj=hs({imports:[Yq]})}return o})();var VY=pW(UY());function FY(o,s){o.terminate=function(){let a=()=>{};this.onerror=a,this.onmessage=a,this.onopen=a;let d=new Date,p=Math.random().toString().substring(2,8),g=this.onclose;this.onclose=v=>{let T=new Date().getTime()-d.getTime();s(`Discarded socket (#${p})  closed after ${T}ms, with code/reason: ${v.code}/${v.reason}`)},this.close(),g?.call(o,{code:4001,reason:`Quick discarding socket (#${p}) without waiting for the shutdown sequence.`,wasClean:!1})}}var Ql={LF:`
`,NULL:"\0"};var Zg=class o{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(s){let{command:a,headers:d,body:p,binaryBody:g,escapeHeaderValues:v,skipContentLengthHeader:T}=s;this.command=a,this.headers=Object.assign({},d||{}),g?(this._binaryBody=g,this.isBinaryBody=!0):(this._body=p||"",this.isBinaryBody=!1),this.escapeHeaderValues=v||!1,this.skipContentLengthHeader=T||!1}static fromRawFrame(s,a){let d={},p=g=>g.replace(/^\s+|\s+$/g,"");for(let g of s.headers.reverse()){let v=g.indexOf(":"),T=p(g[0]),b=p(g[1]);a&&s.command!=="CONNECT"&&s.command!=="CONNECTED"&&(b=o.hdrValueUnEscape(b)),d[T]=b}return new o({command:s.command,headers:d,binaryBody:s.binaryBody,escapeHeaderValues:a})}toString(){return this.serializeCmdAndHeaders()}serialize(){let s=this.serializeCmdAndHeaders();return this.isBinaryBody?o.toUnit8Array(s,this._binaryBody).buffer:s+this._body+Ql.NULL}serializeCmdAndHeaders(){let s=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(let a of Object.keys(this.headers||{})){let d=this.headers[a];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?s.push(`${a}:${o.hdrValueEscape(`${d}`)}`):s.push(`${a}:${d}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&s.push(`content-length:${this.bodyLength()}`),s.join(Ql.LF)+Ql.LF+Ql.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){let s=this.binaryBody;return s?s.length:0}static sizeOfUTF8(s){return s?new TextEncoder().encode(s).length:0}static toUnit8Array(s,a){let d=new TextEncoder().encode(s),p=new Uint8Array([0]),g=new Uint8Array(d.length+a.length+p.length);return g.set(d),g.set(a,d.length),g.set(p,d.length+a.length),g}static marshall(s){return new o(s).serialize()}static hdrValueEscape(s){return s.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(s){return s.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}};var fC=class{constructor(s,a){this.onFrame=s,this.onIncomingPing=a,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(s,a=!1){let d;if(typeof s=="string"?d=this._encoder.encode(s):d=new Uint8Array(s),a&&d[d.length-1]!==0){let p=new Uint8Array(d.length+1);p.set(d,0),p[d.length]=0,d=p}for(let p=0;p<d.length;p++){let g=d[p];this._onByte(g)}}_collectFrame(s){if(s!==0&&s!==13){if(s===10){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(s)}}_collectCommand(s){if(s!==13){if(s===10){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(s)}}_collectHeaders(s){if(s!==13){if(s===10){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(s)}}_reinjectByte(s){this._onByte(s)}_collectHeaderKey(s){if(s===58){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(s)}_collectHeaderValue(s){if(s!==13){if(s===10){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(s)}}_setupCollectBody(){let s=this._results.headers.filter(a=>a[0]==="content-length")[0];s?(this._bodyBytesRemaining=parseInt(s[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(s){if(s===0){this._retrievedBody();return}this._consumeByte(s)}_collectBodyFixedSize(s){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(s)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(s){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",s)}this._initState()}_consumeByte(s){this._token.push(s)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){let s=new Uint8Array(this._token);return this._token=[],s}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}};var tc=(function(o){return o[o.CONNECTING=0]="CONNECTING",o[o.OPEN=1]="OPEN",o[o.CLOSING=2]="CLOSING",o[o.CLOSED=3]="CLOSED",o})(tc||{}),Rs=(function(o){return o[o.ACTIVE=0]="ACTIVE",o[o.DEACTIVATING=1]="DEACTIVATING",o[o.INACTIVE=2]="INACTIVE",o})(Rs||{}),mC=(function(o){return o[o.LINEAR=0]="LINEAR",o[o.EXPONENTIAL=1]="EXPONENTIAL",o})(mC||{}),kp=(function(o){return o.Interval="interval",o.Worker="worker",o})(kp||{});var gC=class{constructor(s,a=kp.Interval,d){this._interval=s,this._strategy=a,this._debug=d,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(s){this.stop(),this.shouldUseWorker()?this.runWorker(s):this.runInterval(s)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===kp.Worker}runWorker(s){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=a=>s(a.data))}runInterval(s){if(this._debug("Using runInterval for outgoing pings"),!this._timer){let a=Date.now();this._timer=setInterval(()=>{s(Date.now()-a)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}};var mr=class{constructor(s){this.versions=s}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(s=>`v${s.replace(".","")}.stomp`)}};mr.V1_0="1.0";mr.V1_1="1.1";mr.V1_2="1.2";mr.default=new mr([mr.V1_2,mr.V1_1,mr.V1_0]);var _C=class{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(s,a,d){this._client=s,this._webSocket=a,this._connected=!1,this._serverFrameHandlers={CONNECTED:p=>{this.debug(`connected to server ${p.headers.server}`),this._connected=!0,this._connectedVersion=p.headers.version,this._connectedVersion===mr.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(p.headers),this.onConnect(p)},MESSAGE:p=>{let g=p.headers.subscription,v=this._subscriptions[g]||this.onUnhandledMessage,T=p,b=this,x=this._connectedVersion===mr.V1_2?T.headers.ack:T.headers["message-id"];T.ack=(B={})=>b.ack(x,g,B),T.nack=(B={})=>b.nack(x,g,B),v(T)},RECEIPT:p=>{let g=this._receiptWatchers[p.headers["receipt-id"]];g?(g(p),delete this._receiptWatchers[p.headers["receipt-id"]]):this.onUnhandledReceipt(p)},ERROR:p=>{this.onStompError(p)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=d.debug,this.stompVersions=d.stompVersions,this.connectHeaders=d.connectHeaders,this.disconnectHeaders=d.disconnectHeaders,this.heartbeatIncoming=d.heartbeatIncoming,this.heartbeatToleranceMultiplier=d.heartbeatGracePeriods,this.heartbeatOutgoing=d.heartbeatOutgoing,this.splitLargeFrames=d.splitLargeFrames,this.maxWebSocketChunkSize=d.maxWebSocketChunkSize,this.forceBinaryWSFrames=d.forceBinaryWSFrames,this.logRawCommunication=d.logRawCommunication,this.appendMissingNULLonIncoming=d.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=d.discardWebsocketOnCommFailure,this.onConnect=d.onConnect,this.onDisconnect=d.onDisconnect,this.onStompError=d.onStompError,this.onWebSocketClose=d.onWebSocketClose,this.onWebSocketError=d.onWebSocketError,this.onUnhandledMessage=d.onUnhandledMessage,this.onUnhandledReceipt=d.onUnhandledReceipt,this.onUnhandledFrame=d.onUnhandledFrame,this.onHeartbeatReceived=d.onHeartbeatReceived,this.onHeartbeatLost=d.onHeartbeatLost}start(){let s=new fC(a=>{let d=Zg.fromRawFrame(a,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${d}`),(this._serverFrameHandlers[d.command]||this.onUnhandledFrame)(d)},()=>{this.debug("<<< PONG"),this.onHeartbeatReceived()});this._webSocket.onmessage=a=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){let d=a.data instanceof ArrayBuffer?new TextDecoder().decode(a.data):a.data;this.debug(`<<< ${d}`)}s.parseChunk(a.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=a=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(a)},this._webSocket.onerror=a=>{this.onWebSocketError(a)},this._webSocket.onopen=()=>{let a=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),a["accept-version"]=this.stompVersions.supportedVersions(),a["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:a})}}_setupHeartbeat(s){if(s.version!==mr.V1_1&&s.version!==mr.V1_2||!s["heart-beat"])return;let[a,d]=s["heart-beat"].split(",").map(p=>parseInt(p,10));if(this.heartbeatOutgoing!==0&&d!==0){let p=Math.max(this.heartbeatOutgoing,d);this.debug(`send PING every ${p}ms`),this._pinger=new gC(p,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===tc.OPEN&&(this._webSocket.send(Ql.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&a!==0){let p=Math.max(this.heartbeatIncoming,a);this.debug(`check PONG every ${p}ms`),this._ponger=setInterval(()=>{let g=Date.now()-this._lastServerActivityTS;g>p*this.heartbeatToleranceMultiplier&&(this.debug(`did not receive server activity for the last ${g}ms`),this.onHeartbeatLost(),this._closeOrDiscardWebsocket())},p)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===tc.CONNECTING||this._webSocket.readyState===tc.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&FY(this._webSocket,s=>this.debug(s)),this._webSocket.terminate()}_transmit(s){let{command:a,headers:d,body:p,binaryBody:g,skipContentLengthHeader:v}=s,T=new Zg({command:a,headers:d,body:p,binaryBody:g,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:v}),b=T.serialize();if(this.logRawCommunication?this.debug(`>>> ${b}`):this.debug(`>>> ${T}`),this.forceBinaryWSFrames&&typeof b=="string"&&(b=new TextEncoder().encode(b)),typeof b!="string"||!this.splitLargeFrames)this._webSocket.send(b);else{let x=b;for(;x.length>0;){let B=x.substring(0,this.maxWebSocketChunkSize);x=x.substring(this.maxWebSocketChunkSize),this._webSocket.send(B),this.debug(`chunk sent = ${B.length}, remaining = ${x.length}`)}}}dispose(){if(this.connected)try{let s=Object.assign({},this.disconnectHeaders);s.receipt||(s.receipt=`close-${this._counter++}`),this.watchForReceipt(s.receipt,a=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(a)}),this._transmit({command:"DISCONNECT",headers:s})}catch(s){this.debug(`Ignoring error during disconnect ${s}`)}else(this._webSocket.readyState===tc.CONNECTING||this._webSocket.readyState===tc.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(s){let{destination:a,headers:d,body:p,binaryBody:g,skipContentLengthHeader:v}=s,T=Object.assign({destination:a},d);this._transmit({command:"SEND",headers:T,body:p,binaryBody:g,skipContentLengthHeader:v})}watchForReceipt(s,a){this._receiptWatchers[s]=a}subscribe(s,a,d={}){d=Object.assign({},d),d.id||(d.id=`sub-${this._counter++}`),d.destination=s,this._subscriptions[d.id]=a,this._transmit({command:"SUBSCRIBE",headers:d});let p=this;return{id:d.id,unsubscribe(g){return p.unsubscribe(d.id,g)}}}unsubscribe(s,a={}){a=Object.assign({},a),delete this._subscriptions[s],a.id=s,this._transmit({command:"UNSUBSCRIBE",headers:a})}begin(s){let a=s||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:a}});let d=this;return{id:a,commit(){d.commit(a)},abort(){d.abort(a)}}}commit(s){this._transmit({command:"COMMIT",headers:{transaction:s}})}abort(s){this._transmit({command:"ABORT",headers:{transaction:s}})}ack(s,a,d={}){d=Object.assign({},d),this._connectedVersion===mr.V1_2?d.id=s:d["message-id"]=s,d.subscription=a,this._transmit({command:"ACK",headers:d})}nack(s,a,d={}){return d=Object.assign({},d),this._connectedVersion===mr.V1_2?d.id=s:d["message-id"]=s,d.subscription=a,this._transmit({command:"NACK",headers:d})}};var Qg=class{get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(s){this._disconnectHeaders=s,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===Rs.ACTIVE}_changeState(s){this.state=s,this.onChangeState(s)}constructor(s={}){this.stompVersions=mr.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=900*1e3,this.reconnectTimeMode=mC.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatToleranceMultiplier=2,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=kp.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=Rs.INACTIVE;let a=()=>{};this.debug=a,this.beforeConnect=a,this.onConnect=a,this.onDisconnect=a,this.onUnhandledMessage=a,this.onUnhandledReceipt=a,this.onUnhandledFrame=a,this.onHeartbeatReceived=a,this.onHeartbeatLost=a,this.onStompError=a,this.onWebSocketClose=a,this.onWebSocketError=a,this.logRawCommunication=!1,this.onChangeState=a,this.connectHeaders={},this._disconnectHeaders={},this.configure(s)}configure(s){Object.assign(this,s),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){let s=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(Rs.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===Rs.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{s()})):s()}_connect(){return O(this,null,function*(){if(yield this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");let s=this._createWebSocket();this._stompHandler=new _C(this,s,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatGracePeriods:this.heartbeatToleranceMultiplier,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:a=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),this._nextReconnectDelay=this.reconnectDelay,!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(a)},onDisconnect:a=>{this.onDisconnect(a)},onStompError:a=>{this.onStompError(a)},onWebSocketClose:a=>{this._stompHandler=void 0,this.state===Rs.DEACTIVATING&&this._changeState(Rs.INACTIVE),this.onWebSocketClose(a),this.active&&this._schedule_reconnect()},onWebSocketError:a=>{this.onWebSocketError(a)},onUnhandledMessage:a=>{this.onUnhandledMessage(a)},onUnhandledReceipt:a=>{this.onUnhandledReceipt(a)},onUnhandledFrame:a=>{this.onUnhandledFrame(a)},onHeartbeatReceived:()=>{this.onHeartbeatReceived()},onHeartbeatLost:()=>{this.onHeartbeatLost()}}),this._stompHandler.start()})}_createWebSocket(){let s;if(this.webSocketFactory)s=this.webSocketFactory();else if(this.brokerURL)s=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return s.binaryType="arraybuffer",s}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===mC.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}deactivate(){return O(this,arguments,function*(s={}){let a=s.force||!1,d=this.active,p;if(this.state===Rs.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(Rs.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==tc.CLOSED){let g=this._stompHandler.onWebSocketClose;p=new Promise((v,T)=>{this._stompHandler.onWebSocketClose=b=>{g(b),v()}})}else return this._changeState(Rs.INACTIVE),Promise.resolve();return a?this._stompHandler?.discardWebsocket():d&&this._disposeStompHandler(),p})}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(s){this._checkConnection(),this._stompHandler.publish(s)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(s,a){this._checkConnection(),this._stompHandler.watchForReceipt(s,a)}subscribe(s,a,d={}){return this._checkConnection(),this._stompHandler.subscribe(s,a,d)}unsubscribe(s,a={}){this._checkConnection(),this._stompHandler.unsubscribe(s,a)}begin(s){return this._checkConnection(),this._stompHandler.begin(s)}commit(s){this._checkConnection(),this._stompHandler.commit(s)}abort(s){this._checkConnection(),this._stompHandler.abort(s)}ack(s,a,d={}){this._checkConnection(),this._stompHandler.ack(s,a,d)}nack(s,a,d={}){this._checkConnection(),this._stompHandler.nack(s,a,d)}};var Mp=class o{client=new Qg;initiateSocket(s){return new Promise((a,d)=>{this.client=new Qg({webSocketFactory:()=>new VY.default("https://communicationapi-3.onrender.com/ws"),reconnectDelay:5e3,connectHeaders:{username:s},debug:p=>console.log(p),onConnect:p=>{console.log("\u2705 Connected:",p),a(!0),this.client.subscribe("/user/queue/connected-users",g=>{console.log("\u{1F4E9} connected users:",g)})},onWebSocketError:p=>{console.error("\u274C WebSocket Error:",p)}}),this.client.activate()})}static \u0275fac=function(a){return new(a||o)};static \u0275prov=qe({token:o,factory:o.\u0275fac,providedIn:"root"})};function GSe(o,s){if(o&1&&(At(0,"div",11),Dr(1,"div",12),Ot(),At(2,"div",13)(3,"span",14),Bn(4),Ot()()),o&2){let a=Li();wn(),VS("width",a.loaderPercentage,"%"),wn(3),Ll("",a.loaderPercentage,"%")}}var EC=class o{loginFormGroup;socketService=ge(Mp);router=ge(Tp);serverLoader=!1;loaderPercentage=0;serverLoaderClearInterval;constructor(){}ngOnInit(){this.loginFormGroup=new VT({username:new KT("",NT.required)})}submitForm(){this.serverLoader=!0,this.serverLoaderClearInterval=setInterval(()=>{this.loaderPercentage!=100&&(this.loaderPercentage+=1)},1e3),this.socketService.initiateSocket(this.loginFormGroup.value.username).then(s=>{console.log(s),sessionStorage.setItem("username",this.loginFormGroup.value.username),this.router.navigateByUrl("/chat")})}ngOnDestroy(){clearInterval(this.serverLoaderClearInterval)}static \u0275fac=function(a){return new(a||o)};static \u0275cmp=Es({type:o,selectors:[["app-login"]],decls:18,vars:2,consts:[[1,"flex","min-h-full","flex-col","justify-center","px-6","py-12","lg:px-8"],[1,"sm:mx-auto","sm:w-full","sm:max-w-sm"],["src","https://tailwindcss.com/plus-assets/img/logos/mark.svg?color=indigo&shade=600","alt","Your Company",1,"mx-auto","h-10","w-auto","dark:hidden"],["src","https://tailwindcss.com/plus-assets/img/logos/mark.svg?color=indigo&shade=500","alt","Your Company",1,"mx-auto","h-10","w-auto","not-dark:hidden"],[1,"mt-10","text-center","text-2xl/9","font-bold","tracking-tight","text-gray-900","dark:text-white"],[1,"mt-10","sm:mx-auto","sm:w-full","sm:max-w-sm"],[1,"space-y-6",3,"formGroup"],["for","username",1,"block","text-sm/6","font-medium","text-gray-900","dark:text-gray-100"],[1,"mt-2"],["id","username","formControlName","username","type","text","name","username","required","","autocomplete","email",1,"block","w-full","rounded-md","bg-white","px-3","py-1.5","text-base","text-gray-900","outline-1","-outline-offset-1","outline-gray-300","placeholder:text-gray-400","focus:outline-2","focus:-outline-offset-2","focus:outline-indigo-600","sm:text-sm/6","dark:bg-white/5","dark:text-white","dark:outline-white/10","dark:placeholder:text-gray-500","dark:focus:outline-indigo-500"],["type","submit",1,"flex","w-full","justify-center","rounded-md","bg-indigo-600","px-3","py-1.5","text-sm/6","font-semibold","text-white","shadow-xs","hover:bg-indigo-500","focus-visible:outline-2","focus-visible:outline-offset-2","focus-visible:outline-indigo-600","dark:bg-indigo-500","dark:shadow-none","dark:hover:bg-indigo-400","dark:focus-visible:outline-indigo-500",3,"click"],[1,"w-full","mt-2","bg-gray-200","rounded-full","h-2"],[1,"bg-brand","bg-blue-900","h-2","rounded-full"],[1,"flex","justify-center","mb-1"],[1,"text-sm","font-medium","text-body"]],template:function(a,d){a&1&&(At(0,"div",0)(1,"div",1),Dr(2,"img",2)(3,"img",3),At(4,"h2",4),Bn(5,"Sign in to your account"),Ot()(),At(6,"div",5)(7,"form",6)(8,"div")(9,"label",7),Bn(10,"User Name"),Ot(),At(11,"div",8),Dr(12,"input",9),Ot()(),Dr(13,"div"),At(14,"div")(15,"button",10),qr("click",function(){return d.submitForm()}),Bn(16,"Sign in"),Ot()()(),xo(17,GSe,5,3),Ot()()),a&2&&(wn(7),Pl("formGroup",d.loginFormGroup),wn(10),Uo(d.serverLoader?17:-1))},dependencies:[op,Xq,zq,Ip,GT,Vq,GN,BN,HN],encapsulation:2})};var t_=pW(HY());function WSe(o,s){if(o&1){let a=Qc();At(0,"div",20),qr("click",function(){let p=eo(a).$implicit,g=Li();return to(g.changeReciverUser(p))}),At(1,"div",21),Dr(2,"img",22),Ot(),At(3,"div",11)(4,"h2",23),Bn(5),Ot(),At(6,"p",24),Bn(7),Ot()()()}if(o&2){let a=s.$implicit,d=Li();Pl("ngClass",d.currentReceiverUser.socketId==a.socketId?"bg-gray-300":"hover:bg-gray-100"),wn(5),Ha(a.username),wn(2),Ha(a.socketId)}}function qSe(o,s){if(o&1&&(At(0,"div",25)(1,"div",27)(2,"p"),Bn(3),Ot()(),At(4,"div",28),Dr(5,"img",29),Ot()()),o&2){let a=Li(2).$implicit;wn(3),Ha(a.message)}}function zSe(o,s){if(o&1&&(At(0,"div",26)(1,"div",30),Dr(2,"img",31),Ot(),At(3,"div",32)(4,"p",33),Bn(5),Ot()()()),o&2){let a=Li(2).$implicit;wn(5),Ha(a.message)}}function KSe(o,s){if(o&1&&xo(0,qSe,6,1,"div",25)(1,zSe,6,1,"div",26),o&2){let a=Li().$implicit,d=Li();Uo((a==null?null:a.sender)==d.ownUser.socketId?0:1)}}function YSe(o,s){if(o&1&&xo(0,KSe,2,1),o&2){let a=s.$implicit;Uo(a.communicationType=="CHAT"?0:-1)}}function $Se(o,s){o&1&&(At(0,"div",37),Dr(1,"div",41)(2,"div",42),Ot())}function XSe(o,s){if(o&1){let a=Qc();At(0,"button",43),qr("click",function(){eo(a);let p=Li(2);return to(p.joinAudio(p.currentAudioDetails))}),Bn(1,"Accept"),Ot()}}function JSe(o,s){if(o&1){let a=Qc();At(0,"button",44),qr("click",function(){eo(a);let p=Li(2);return to(p.cancelAudio(p.currentAudioDetails))}),Bn(1,"Cancel"),Ot()}}function ZSe(o,s){if(o&1){let a=Qc();At(0,"button",44),qr("click",function(){eo(a);let p=Li(2);return to(p.cancelAudio(p.currentAudioDetails))}),Bn(1,"End"),Ot()}}function QSe(o,s){if(o&1){let a=Qc();At(0,"div",19)(1,"div",34,0),qr("click",function(p){return eo(a),to(p.stopPropagation())}),At(3,"h2",35),Bn(4),Ot(),At(5,"p",36),Bn(6),Ot(),xo(7,$Se,3,0,"div",37),At(8,"div",38),xo(9,XSe,2,0,"button",39),xo(10,JSe,2,0,"button",40)(11,ZSe,2,0,"button",40),Ot()()()}if(o&2){let a=Li();wn(4),Ha(a.currentAudioDetails.communicationRequestType=="JOIN"?"Ongoing...":"Calling..."),wn(2),jS(" ",a.currentAudioDetails.communicationType," Call - ",a.currentAudioDetails.senderName," -> ",a.currentAudioDetails.receiverName," "),wn(),Uo((a.currentAudioDetails==null?null:a.currentAudioDetails.communicationRequestType)=="JOIN"&&a.currentAudioDetails.communicationType=="VIDEO"?7:-1),wn(2),Uo(a.ownUser.socketId!=(a.currentAudioDetails==null?null:a.currentAudioDetails.sender)&&(a.currentAudioDetails==null?null:a.currentAudioDetails.communicationRequestType)=="REQUEST"?9:-1),wn(),Uo((a.currentAudioDetails==null?null:a.currentAudioDetails.communicationRequestType)=="REQUEST"?10:(a.currentAudioDetails==null?null:a.currentAudioDetails.communicationRequestType)=="JOIN"?11:-1)}}var yC=class o{constructor(s){this.httpClient=s}clientService=ge(Mp);userList=[];currentReceiverUser;ownUser;messageContent;hash=new Map;check=new Array(5);isSideBarOpen=!1;client;localAudioTrack;localVideoTrack;appId="48b5127bfa5e4dd582f08a1adcfd77f6";channel="c5e9589a20ca4fdd84579509518ca491";token="<-- Insert token -->";uid=0;audioActive=!1;currentAudioDetails={active:!1};audioVideo=["AUDIO","VIDEO"];ngOnInit(){return O(this,null,function*(){console.log(this.clientService.client.connected),this.initializeClient(),this.clientService.client.connected&&(this.clientService.client.subscribe("/chat/chatroom",s=>{console.log("\u{1F4E9} Message received:",s);let a=JSON.parse(s.body);if(a.userStatus=="JOIN")this.userList.length==0&&(this.currentReceiverUser={username:a?.username,socketId:a?.socketId,userStatus:a?.userStatus}),this.userList.push(JSON.parse(s.body)),this.clientService.client.subscribe(`/user/${JSON.parse(s.body).socketId}_${this.ownUser.socketId}/queue/messages`,d=>{console.log("Private:",JSON.parse(d.body));let p=JSON.parse(d.body);if(p.communicationType=="CHAT"){let g={message:p.message,sender:p.sender,receiver:p.receiver,time:new Date().toISOString(),communicationType:p.communicationType};if(console.log(g),this.hash.has(`${p.sender}_${p.receiver}`)){let T=[...this.hash.get(`${p.sender}_${p.receiver}`),g];this.hash.set(`${p.sender}_${p.receiver}`,T),console.log(this.hash)}else{let v=[g];this.hash.set(`${p.sender}_${p.receiver}`,v),console.log(this.hash)}}else if(this.audioVideo.indexOf(p.communicationType)!=-1){if(p.communicationRequestType=="LEAVE"){this.currentAudioDetails={active:!1},this.client&&(p.communicationType=="AUDIO"?this.leaveAgoraChannel():p.communicationType=="VIDEO"&&this.leaveChannelVideo());return}let g={message:p.token,sender:p.sender,receiver:p.receiver,token:p.token,time:new Date().toISOString(),communicationType:p.communicationType,communicationRequestType:p.communicationRequestType,senderName:p.senderName,receiverName:p.receiverName};console.log(g),this.currentAudioDetails=gt(Ee(Ee({},this.currentAudioDetails),g),{active:!0}),console.log(g),console.log(this.currentAudioDetails),p.communicationRequestType=="JOIN"&&(p.communicationType=="AUDIO"?this.joinChannel(`${g.sender}_${p.receiver}`,g.sender,g.token):p.communicationType=="VIDEO"&&this.joinChannelVideo(`${g.sender}_${p.receiver}`,g.sender,g.token))}});else if(a.userStatus=="LEAVE"&&(this.userList=this.userList.filter(d=>d.socketId!=a.socketId),this.currentReceiverUser.socketId==a.socketId&&(this.userList.length!=0?this.currentReceiverUser={username:this.userList?.[0]?.username,socketId:this.userList?.[0]?.socketId,userStatus:this.userList?.[0]?.userStatus}:this.currentReceiverUser={username:"",socketId:"",userStatus:this.userList?.[0]?.userStatus}),this.hash.delete(`${a?.socketId}_${this.ownUser.socketId}`),this.currentAudioDetails.active==!0&&(a.socketId==this.currentAudioDetails.sender||a.socketId==this.currentAudioDetails.receiver))){console.log(JSON.stringify(this.currentAudioDetails)),this.client&&(this.currentAudioDetails.communicationType=="AUDIO"?this.leaveAgoraChannel():this.currentAudioDetails.communicationType=="VIDEO"&&this.leaveChannelVideo()),this.currentAudioDetails={active:!1};return}}),setTimeout(()=>{this.clientService.client.subscribe("/chat/chatrooms",s=>{console.log("\u{1F4E9} connected user:",s);let a=JSON.parse(s.body);Object.keys(a).forEach((d,p)=>{let g=a[d],v={username:d,socketId:g,userStatus:"JOIN"};this.userList.push(v),console.log("check")}),console.log("userlist",this.userList),this.currentReceiverUser={username:this.userList?.[0]?.username,socketId:this.userList?.[0]?.socketId,userStatus:this.userList?.[0]?.userStatus}})},2e3),this.httpClient.get("https://communicationapi-3.onrender.com/getuserlist").subscribe({next:s=>{console.log(s);let a=s;Object.keys(a).forEach(d=>{let p=a[d],g={username:p,socketId:d,userStatus:"JOIN"};p==sessionStorage.getItem("username")&&(this.ownUser=g)}),Object.keys(a).forEach(d=>{let p=a[d],g={username:p,socketId:d,userStatus:"JOIN"};p==sessionStorage.getItem("username")||(this.clientService.client.subscribe(`/user/${g.socketId}_${this.ownUser.socketId}/queue/messages`,v=>{console.log("Private:",JSON.parse(v.body));let T=JSON.parse(v.body);if(T.communicationType=="CHAT"){let b={message:T.message,sender:T.sender,receiver:T.receiver,time:new Date().toISOString(),communicationType:T.communicationType};if(console.log(b),this.hash.has(`${T.sender}_${T.receiver}`)){let B=[...this.hash.get(`${T.sender}_${T.receiver}`),b];this.hash.set(`${T.sender}_${T.receiver}`,B),console.log(this.hash)}else{let x=[b];this.hash.set(`${T.sender}_${T.receiver}`,x),console.log(this.hash)}}else if(this.audioVideo.indexOf(T.communicationType)!=-1){if(T.communicationRequestType=="LEAVE"){this.currentAudioDetails={active:!1},this.client&&(T.communicationType=="AUDIO"?this.leaveAgoraChannel():T.communicationType=="VIDEO"&&this.leaveChannelVideo());return}let b={message:T.token,sender:T.sender,receiver:T.receiver,token:T.token,time:new Date().toISOString(),communicationType:T.communicationType,communicationRequestType:T.communicationRequestType,senderName:T.senderName,receiverName:T.receiverName};this.currentAudioDetails=gt(Ee(Ee({},this.currentAudioDetails),b),{active:!0}),console.log(b),console.log(this.currentAudioDetails),T.communicationRequestType=="JOIN"&&(T.communicationType=="AUDIO"?this.joinChannel(`${b.sender}_${T.receiver}`,b.sender,b.token):T.communicationType=="VIDEO"&&this.joinChannelVideo(`${b.sender}_${T.receiver}`,b.sender,b.token)),console.log(b)}}),this.userList.push(g)),this.currentReceiverUser={username:this.userList?.[0]?.username,socketId:this.userList?.[0]?.socketId,userStatus:this.userList?.[0]?.userStatus}})}}))})}submitChat(){let s={message:this.messageContent,sender:this.ownUser.socketId,receiver:this.currentReceiverUser.socketId,time:new Date().toISOString(),communicationType:"CHAT"};if(this.hash.has(`${s.receiver}_${this.ownUser.socketId}`)){let d=[...this.hash.get(`${s.receiver}_${this.ownUser.socketId}`),s];this.hash.set(`${s.receiver}_${this.ownUser.socketId}`,d),console.log(this.hash)}else{let a=[s];this.hash.set(`${s.receiver}_${this.ownUser.socketId}`,a),console.log(this.hash)}this.clientService.client.publish({destination:"/app/private-message",body:JSON.stringify({sender:this.ownUser.socketId,receiver:this.currentReceiverUser.socketId,message:this.messageContent,communicationType:"CHAT",communicationRequestType:""})}),this.messageContent=""}changeReciverUser(s){console.log(s),this.currentReceiverUser={username:s?.username,socketId:s?.socketId,userStatus:s?.userStatus},console.log(`${this.currentReceiverUser?.socketId}_${this.ownUser?.socketId}`),console.log(this.hash.get(`${this.currentReceiverUser?.socketId}_${this.ownUser?.socketId}`))}initializeClient(){this.client=t_.default.createClient({mode:"rtc",codec:"vp8"}),this.setupEventListeners()}setupEventListeners(){this.client.on("user-published",(s,a)=>O(this,null,function*(){yield this.client.subscribe(s,a),console.log("subscribe success"),a==="audio"&&s.audioTrack.play(),a==="video"&&this.displayRemoteVideo(s)})),this.client.on("user-unpublished",s=>O(this,null,function*(){}))}joinChannel(s,a,d){return O(this,null,function*(){yield this.client.join(this.appId,s,d,a),yield this.createLocalAudioTrack(),yield this.publishLocalAudio(),console.log("Publish success!")})}publishLocalAudio(){return O(this,null,function*(){yield this.client.publish([this.localAudioTrack])})}createLocalAudioTrack(){return O(this,null,function*(){this.localAudioTrack=yield t_.default.createMicrophoneAudioTrack()})}initiateAudio(){this.audioActive=!0;let s={message:this.messageContent,sender:this.ownUser.socketId,receiver:this.currentReceiverUser.socketId,time:new Date().toISOString(),communicationType:"AUDIO",communicationRequestType:"REQUEST",senderName:this.ownUser.username,receiverName:this.currentReceiverUser.username};this.currentAudioDetails=gt(Ee({},s),{active:!0}),this.clientService.client.publish({destination:"/app/private-message",body:JSON.stringify({sender:this.ownUser.socketId,receiver:this.currentReceiverUser.socketId,message:this.messageContent,communicationType:"AUDIO",communicationRequestType:"REQUEST",senderName:this.ownUser.username,receiverName:this.currentReceiverUser.username})})}joinAudio(s){console.log(s);let a=gt(Ee({},s),{communicationRequestType:"JOIN"});this.currentAudioDetails=Ee(Ee({},this.currentAudioDetails),a),console.log(this.currentAudioDetails),s.communicationType=="AUDIO"?this.joinChannel(`${s.sender}_${s.receiver}`,s.receiver,s.token):s.communicationType=="VIDEO"&&this.joinChannelVideo(`${s.sender}_${s.receiver}`,s.receiver,s.token),this.clientService.client.publish({destination:"/app/private-message",body:JSON.stringify({sender:a.sender,receiver:a.receiver,message:this.messageContent,communicationType:s.communicationType,communicationRequestType:"JOIN",senderName:a.senderName,receiverName:a.receiverName})})}cancelAudio(s){let a=gt(Ee({},s),{communicationRequestType:"LEAVE"});this.currentAudioDetails=Ee(Ee({},this.currentAudioDetails),a),this.clientService.client.publish({destination:"/app/private-message",body:JSON.stringify({sender:this.ownUser.socketId==a.sender?a.receiver:a.sender,receiver:this.ownUser.socketId==a.sender?a.sender:a.receiver,message:this.messageContent,communicationType:a.communicationType,communicationRequestType:"LEAVE",senderName:a.senderName,receiverName:a.receiverName})}),a.communicationRequestType=="LEAVE"&&(this.currentAudioDetails={active:!1},this.client&&(a.communicationType=="AUDIO"?this.leaveAgoraChannel():a.communicationType=="VIDEO"&&this.leaveChannelVideo()))}leaveAgoraChannel(){return O(this,null,function*(){this.localAudioTrack&&(yield this.client.unpublish(this.localAudioTrack),this.localAudioTrack.close()),yield this.client?.leave(),console.log("Left the channel successfully.")})}leaveChannelVideo(){return O(this,null,function*(){this.localAudioTrack?.close(),this.localVideoTrack?.close();let s=document.getElementById("localVideo");s&&s?.remove();let a=document.getElementById("remoteVideo");a&&a?.remove(),yield this.client.leave()})}initiateVideo(){this.audioActive=!0;let s={message:this.messageContent,sender:this.ownUser.socketId,receiver:this.currentReceiverUser.socketId,time:new Date().toISOString(),communicationType:"VIDEO",communicationRequestType:"REQUEST",senderName:this.ownUser.username,receiverName:this.currentReceiverUser.username};this.currentAudioDetails=gt(Ee({},s),{active:!0}),this.clientService.client.publish({destination:"/app/private-message",body:JSON.stringify({sender:this.ownUser.socketId,receiver:this.currentReceiverUser.socketId,message:this.messageContent,communicationType:"VIDEO",communicationRequestType:"REQUEST",senderName:this.ownUser.username,receiverName:this.currentReceiverUser.username})})}joinChannelVideo(s,a,d){return O(this,null,function*(){yield this.client.join(this.appId,s,d,a),yield this.createLocalMediaTracks(),this.displayLocalVideo(),this.publishLocalTracks()})}displayRemoteVideo(s){console.log("test",s);let a=s.videoTrack,d=document.getElementById("remoteVideo");a.play(d)}displayLocalVideo(){let s=document.getElementById("localVideo");this.localVideoTrack.play(s)}createLocalMediaTracks(){return O(this,null,function*(){this.localAudioTrack=yield t_.default.createMicrophoneAudioTrack(),this.localVideoTrack=yield t_.default.createCameraVideoTrack()})}publishLocalTracks(){return O(this,null,function*(){yield this.client.publish([this.localAudioTrack,this.localVideoTrack])})}static \u0275fac=function(a){return new(a||o)(Qt(rT))};static \u0275cmp=Es({type:o,selectors:[["app-chat"]],decls:34,vars:5,consts:[["toolbarRef",""],[1,"flex","h-screen","overflow-hidden"],[1,"w-1/4","bg-white","border-r","border-gray-300"],[1,"p-4","border-b","border-gray-300","flex","justify-between","items-center","bg-indigo-600","text-white"],[1,"text-2xl","font-semibold"],[1,"relative"],["id","menuDropdown",1,"absolute","right-0","mt-2","w-48","bg-white","border","border-gray-300","rounded-md","shadow-lg","hidden"],[1,"py-2","px-3"],["href","#",1,"block","px-4","py-2","text-gray-800","hover:text-gray-400"],[1,"overflow-y-auto","h-screen","p-3","mb-9","pb-20"],[1,"flex","items-center","mb-4","cursor-pointer","p-2","rounded-md",3,"ngClass"],[1,"flex-1"],[1,"bg-white","p-4","text-gray-700"],[1,"h-screen","overflow-y-auto","p-4","pb-36"],[1,"bg-white","border-t","border-gray-300","p-4","absolute","bottom-0","w-3/4"],[1,"flex","items-center"],["type","text","placeholder","Type a message...",1,"w-full","p-2","rounded-md","border","border-gray-400","focus:outline-none","focus:border-blue-500",3,"keyup.enter","ngModelChange","ngModel"],[1,"bg-indigo-500","disabled:bg-gray-300","disabled:text-gray-500","text-white","px-4","py-2","rounded-md","ml-2",3,"click"],[1,"bg-indigo-500","disabled:bg-gray-300","disabled:text-gray-500","text-white","px-4","py-2","rounded-md","ml-2",3,"click","disabled"],[1,"fixed","inset-0","z-50","flex","items-start","justify-end","bg-black/40"],[1,"flex","items-center","mb-4","cursor-pointer","p-2","rounded-md",3,"click","ngClass"],[1,"w-12","h-12","bg-gray-300","rounded-full","mr-3"],["src","https://placehold.co/200x/ffa8e4/ffffff.svg?text=\u0295\u2022\u0301\u1D25\u2022\u0300\u0294&font=Lato","alt","User Avatar",1,"w-12","h-12","rounded-full"],[1,"text-lg","font-semibold"],[1,"text-gray-600"],[1,"flex","justify-end","mb-4","cursor-pointer"],[1,"flex","mb-4","cursor-pointer"],[1,"flex","max-w-96","bg-indigo-500","text-white","rounded-lg","p-3","gap-3"],[1,"w-9","h-9","rounded-full","flex","items-center","justify-center","ml-2"],["src","https://placehold.co/200x/b7a8ff/ffffff.svg?text=\u0295\u2022\u0301\u1D25\u2022\u0300\u0294&font=Lato","alt","My Avatar",1,"w-8","h-8","rounded-full"],[1,"w-9","h-9","rounded-full","flex","items-center","justify-center","mr-2"],["src","https://placehold.co/200x/ffa8e4/ffffff.svg?text=\u0295\u2022\u0301\u1D25\u2022\u0300\u0294&font=Lato","alt","User Avatar",1,"w-8","h-8","rounded-full"],[1,"flex","max-w-96","bg-white","rounded-lg","p-3","gap-3"],[1,"text-gray-700"],[1,"w-full","max-w-xl","mx-4","p-6","rounded-2xl","shadow-xl","bg-white","relative",3,"click"],[1,"text-xl","font-semibold","mb-2"],[1,"text-gray-600","mb-4"],[1,"h-[70vh]","relative"],[1,"flex","gap-3","justify-end"],[1,"px-4","py-2","rounded-xl","bg-gray-200"],[1,"px-4","py-2","rounded-xl","bg-blue-600","text-white"],["id","remoteVideo",1,"h-full","absolute","w-full","border-2","border-red-600"],["id","localVideo",1,"absolute","bottom-0","right-0","z-[99999999]","border-1","border-indigo-600","w-[120px]","h-[150px]"],[1,"px-4","py-2","rounded-xl","bg-gray-200",3,"click"],[1,"px-4","py-2","rounded-xl","bg-blue-600","text-white",3,"click"]],template:function(a,d){if(a&1){let p=Qc();At(0,"div",1)(1,"div",2)(2,"header",3)(3,"h1",4),Bn(4),Ot(),At(5,"div",5)(6,"div",6)(7,"ul",7)(8,"li")(9,"a",8),Bn(10,"Option 1"),Ot()(),At(11,"li")(12,"a",8),Bn(13,"Option 2"),Ot()()()()()(),At(14,"div",9),US(15,WSe,8,3,"div",10,xS),Ot()(),At(17,"div",11)(18,"header",12)(19,"h1",4),Bn(20),Ot()(),At(21,"div",13),US(22,YSe,1,1,null,null,xS),Ot(),At(24,"footer",14)(25,"div",15)(26,"input",16),qr("keyup.enter",function(){return eo(p),to(d.messageContent?d.submitChat():"")}),HS("ngModelChange",function(v){return eo(p),UO(d.messageContent,v)||(d.messageContent=v),to(v)}),Ot(),At(27,"button",17),qr("click",function(){return eo(p),to(d.initiateVideo())}),Bn(28,"Video"),Ot(),At(29,"button",17),qr("click",function(){return eo(p),to(d.initiateAudio())}),Bn(30,"Audio"),Ot(),At(31,"button",18),qr("click",function(){return eo(p),to(d.submitChat())}),Bn(32,"Send"),Ot()()()()(),xo(33,QSe,12,7,"div",19)}if(a&2){wn(4),Ll("Chat Web - ",d.ownUser==null?null:d.ownUser.username),wn(11),FS(d.userList),wn(5),Ha(d.currentReceiverUser==null?null:d.currentReceiverUser.username);let p=d.hash.get(`${d.currentReceiverUser==null?null:d.currentReceiverUser.socketId}_${d.ownUser==null?null:d.ownUser.socketId}`);wn(2),FS(p),wn(4),BS("ngModel",d.messageContent),wn(5),Pl("disabled",!d.messageContent),wn(2),Uo(d.currentAudioDetails.active?33:-1)}},dependencies:[op,YO,$q,Ip,GT,jN],encapsulation:2})};function eTe(o,s){o&1&&(At(0,"div",0),Dr(1,"app-chat"),Ot())}var SC=class o{static \u0275fac=function(a){return new(a||o)};static \u0275cmp=Es({type:o,selectors:[["app-chataudiovideo"]],decls:2,vars:1,consts:[[1,"h-screen"]],template:function(a,d){a&1&&(At(0,"div",0),xo(1,eTe,2,0,"div",0),Ot()),a&2&&(wn(),Uo(1))},dependencies:[yC],encapsulation:2})};var GY=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:EC},{path:"chat",component:SC}];var WY={providers:[CD(),jO({eventCoalescing:!0}),ON(GY,NN()),sN()]};var TC=class o{title="chat-audio-video";static \u0275fac=function(a){return new(a||o)};static \u0275cmp=Es({type:o,selectors:[["app-root"]],decls:1,vars:0,template:function(a,d){a&1&&Dr(0,"router-outlet")},dependencies:[bg],encapsulation:2})};rN(TC,WY).catch(o=>console.error(o));
